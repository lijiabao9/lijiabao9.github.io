<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Gabriel的博客</title>
  
  <subtitle>在代码与文字之间</subtitle>
  <link href="https://lijiabao9.github.io/atom.xml" rel="self"/>
  
  <link href="https://lijiabao9.github.io/"/>
  <updated>2025-12-27T02:22:20.019Z</updated>
  <id>https://lijiabao9.github.io/</id>
  
  <author>
    <name>Gabriel</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>谷歌云 (GCP) 永久免费 VPS 申请指南</title>
    <link href="https://lijiabao9.github.io/posts/94227163.html"/>
    <id>https://lijiabao9.github.io/posts/94227163.html</id>
    <published>2025-12-27T02:10:35.000Z</published>
    <updated>2025-12-27T02:22:20.019Z</updated>
    
    <content type="html"><![CDATA[<p><strong>Google Cloud Platform (GCP)</strong> 的 “Always Free” 计划是目前市面上最稳定的免费 VPS 方案之一。</p><p>只要配置得当，你可以永久免费使用一台 <code>e2-micro</code> 配置的云服务器。但 GCP 的计费规则复杂，稍有不慎（如选错网络层级、IP 未释放）就会产生费用。</p><p>本文将手把手带你完成配置，并教你如何设置“扣费红线”。</p><div class="note danger flat"><p><strong>前提条件：</strong><br>你需要一张支持外币支付的信用卡（Visa/MasterCard）用于验证身份。<br>注册后，<strong>必须升级为付费账号</strong>才能解锁完整的 Compute Engine 功能，但这并不意味着一定会扣费，只要我们在免费额度内使用即可。</p></div><hr><h2 id="第一步：创建实例-核心配置"><a href="#第一步：创建实例-核心配置" class="headerlink" title="第一步：创建实例 (核心配置)"></a>第一步：创建实例 (核心配置)</h2><p>登录 <a href="https://console.cloud.google.com/">Google Cloud Console</a>，在左侧导航栏找到 <strong>Compute Engine</strong> -&gt; <strong>虚拟机实例</strong>，点击 <strong>创建实例</strong>。</p><p>为了确保“零费用”，请严格按照以下参数进行选择：</p><div class="table-container"><table><thead><tr><th>配置项</th><th>必选参数</th><th>说明</th></tr></thead><tbody><tr><td><strong>区域 (Region)</strong></td><td><code>us-west1</code> (俄勒冈) <br> <code>us-central1</code> (爱荷华) <br> <code>us-east1</code> (南卡罗来纳)</td><td><span class='p red'>只能三选一</span>，其他区域均收费。</td></tr><tr><td><strong>机器类型</strong></td><td><code>e2-micro</code></td><td>(2 个 vCPU，1 GB 内存)。<span class='p red'>仅此型号免费</span>。</td></tr><tr><td><strong>启动磁盘</strong></td><td><strong>标准永久性磁盘</strong></td><td>SSD 会收费。</td></tr><tr><td><strong>磁盘大小</strong></td><td><strong>30 GB</strong></td><td>免费额度上限为 30GB。</td></tr></tbody></table></div><p><strong>避坑注意：</strong></p><ul><li>在“数据保护”中，务必确认 <strong>关闭快照 (Snapshot)</strong> 和 <strong>备份</strong> 功能，这些都是额外的收费项。</li><li>在“可观测性”选项卡中，建议 <strong>关闭 Ops Agent</strong>，以节省微型实例宝贵的内存资源，并避免潜在的日志存储费用。</li></ul><hr><h2 id="第二步：网络配置-关键避坑点"><a href="#第二步：网络配置-关键避坑点" class="headerlink" title="第二步：网络配置 (关键避坑点)"></a>第二步：网络配置 (关键避坑点)</h2><p>这是最容易产生隐形费用的环节，请务必仔细配置。</p><p>在创建页面的 <strong>网络</strong> 中：</p><ol><li><strong>防火墙</strong>：<br>勾选 <strong>允许 HTTP 流量</strong> 和 <strong>允许 HTTPS 流量</strong>。</li><li><strong>网络接口 (点击 default 展开)</strong>：<ul><li><strong>IP 栈类型</strong>：选择 IPv4（单栈）。</li><li><strong>外部 IPv4 地址</strong>：选择 <span class='p green'>临时 (Ephemeral)</span>。<blockquote><p><em>解释：不要选择“静态 IP”。<br>如果你删除了实例但忘记释放静态 IP，谷歌会收取“IP 闲置费”。<br>选择“临时”IP，只要你不销毁实例，IP 不会变。</em></p></blockquote></li></ul></li><li><strong>网络服务层级 (Network Service Tier)</strong>：<ul><li><strong>务必切换为</strong>：<span class='p red'>标准 (Standard)</span>。</li><li><em>默认是“高级 (Premium)”，这是收费陷阱！</em></li><li><strong>说明</strong>：标准层级每月提供 <strong>200GB</strong> 的免费出站流量。这对于个人博客或轻量服务完全够用。</li><li><em>注意：这 200GB 不包含回源到 CloudFlare 等 CDN 的流量，建议合理规划。</em></li></ul></li></ol><hr><h2 id="第三步：设置预算报警-最后一道防线"><a href="#第三步：设置预算报警-最后一道防线" class="headerlink" title="第三步：设置预算报警 (最后一道防线)"></a>第三步：设置预算报警 (最后一道防线)</h2><p>为了防止因误操作或流量超标导致信用卡被刷爆，我们需要设置一个极其敏感的预算提醒。</p><ol><li>点击左侧导航栏的 <strong>Billing (结算)</strong>。</li><li>在菜单中选择 <strong>Budgets &amp; alerts (预算和提醒)</strong>，点击 <strong>Create budget (创建预算)</strong>。</li><li><strong>设置阈值</strong>：<ul><li><strong>时间范围</strong>：月度 (Monthly)。</li><li><strong>金额</strong>：指定金额，建议设置为 <strong>0.1</strong> (美元)。</li></ul></li><li><strong>设置动作</strong>：<ul><li>勾选向“结算管理员”和“用户”发送电子邮件提醒。</li><li>当费用达到 50%、90%、100% 时触发。</li></ul></li></ol><hr><div class="note success flat"><p><strong>配置完成</strong><br>至此，你已经拥有了一台永久免费的 Google Cloud 服务器。<br>如果在邮箱中收到了 $0.01 的账单提醒，请立即登录后台检查是否开启了快照、高级网络层级或创建了额外的磁盘。</p></div>]]></content>
    
    
    <summary type="html">手把手教你申请 Google Cloud Platform 的永久免费 VPS 实例。详解区域选择、机器配置、网络层级调整及预算报警设置，助你完美避开扣费陷阱。</summary>
    
    
    
    <category term="资源分享" scheme="https://lijiabao9.github.io/categories/%E8%B5%84%E6%BA%90%E5%88%86%E4%BA%AB/"/>
    
    <category term="福利教程" scheme="https://lijiabao9.github.io/categories/%E8%B5%84%E6%BA%90%E5%88%86%E4%BA%AB/%E7%A6%8F%E5%88%A9%E6%95%99%E7%A8%8B/"/>
    
    
    <category term="GoogleCloud" scheme="https://lijiabao9.github.io/tags/GoogleCloud/"/>
    
    <category term="VPS" scheme="https://lijiabao9.github.io/tags/VPS/"/>
    
    <category term="免费资源" scheme="https://lijiabao9.github.io/tags/%E5%85%8D%E8%B4%B9%E8%B5%84%E6%BA%90/"/>
    
  </entry>
  
  <entry>
    <title>个人微信接收通知：基于 Docker 搭建企业微信推送服务</title>
    <link href="https://lijiabao9.github.io/posts/d8044207.html"/>
    <id>https://lijiabao9.github.io/posts/d8044207.html</id>
    <published>2025-12-20T16:19:21.000Z</published>
    <updated>2025-12-27T02:22:20.017Z</updated>
    
    <content type="html"><![CDATA[<p>在众多通知渠道中，<strong>微信</strong>无疑是国内用户触达率最高的。 但普通微信不开放 API，而公众号推送又受限于模板消息。</p><p>目前最佳的解决方案是利用 <strong>企业微信 (WeCom)</strong>。通过创建一个属于自己的企业（个人免费），并开启“微信插件”，我们可以在<strong>个人微信</strong>中无缝接收来自“企业”应用的消息推送。</p><p>为了简化鉴权流程（复杂的 Token 获取与缓存），我们将部署一个轻量级的中间件 <a href="https://github.com/lijiabao9/wecome-pusher">lijiabao9/wecome-pusher</a>，将其转化为简单的 Webhook 调用。</p><h2 id="第一步：企业微信端配置"><a href="#第一步：企业微信端配置" class="headerlink" title="第一步：企业微信端配置"></a>第一步：企业微信端配置</h2><p>一切的前提是拥有一个企业微信账号。</p><ol><li><strong>注册企业</strong>：<br>访问 <a href="https://work.weixin.qq.com/">企业微信官网</a> 注册一个组织（名称随意，如 <em>我的家庭数据中心</em>）。</li><li><strong>获取企业 ID (<code>CorpID</code>)</strong>：<br>登录后台，点击 <strong>我的企业</strong> -&gt; <strong>企业信息</strong>，在最底部找到 <strong>企业 ID</strong>。</li><li><strong>创建应用</strong>：<ul><li>点击 <strong>应用管理</strong> -&gt; <strong>应用</strong> -&gt; <strong>自建</strong> -&gt; <strong>创建应用</strong>。</li><li><strong>应用名称</strong>：随意（如 <em>ServerBot</em>），<strong>可见范围</strong>：选择你自己或企业。</li><li>创建完成后，进入应用详情页，获取 <strong><code>AgentId</code> (应用 ID)</strong> 和 <strong><code>Secret</code> (应用密钥)</strong>。</li><li><em>注意：Secret 需要在手机端企业微信确认后查看。</em></li></ul></li><li><strong>配置可信 IP (关键)</strong>：<ul><li>在应用详情页 -&gt; <strong>开发者接口</strong> -&gt; <strong>企业可信 IP</strong>。</li><li>点击配置，填入你即将部署 Docker 服务的服务器 <strong>公网 IP</strong>。</li><li><div class="note warning flat"><p><strong>注意</strong>：企业微信对此校验严格。配置 IP 前可能要求进行域名归属权验证（需将指定 txt 文件放置在你的域名根目录下）。</p></div></li></ul></li><li><strong>创建机器人</strong>：<ul><li>手机端进入企业微信，选择一个群聊。</li><li>设置里，<strong>消息推送</strong>，新建机器人，得到回调地址 <code>WebHook</code>。</li></ul></li><li><strong>开启微信插件</strong>：<ul><li>点击左侧菜单 <strong>我的企业</strong> -&gt; <strong>微信插件</strong>。</li><li>找到“邀请关注”，使用你的<strong>个人微信</strong>扫描大尺寸二维码。</li><li>关注后，该企业应用的消息将直接出现在你个人微信的聊天列表中。</li></ul></li></ol><hr><h2 id="第二步：Docker-部署中间件"><a href="#第二步：Docker-部署中间件" class="headerlink" title="第二步：Docker 部署中间件"></a>第二步：Docker 部署中间件</h2><p>我们将使用 Docker Compose 部署 API 服务。</p><ol><li><p><strong>创建目录</strong>：</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> -p /app/wecome-pusher</span><br><span class="line"><span class="built_in">cd</span> /app/wecome-pusher</span><br></pre></td></tr></table></figure></li><li><p><strong>配置文件</strong>：</p><p>创建 <code>docker-compose.yml</code>：</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi docker-compose.yml</span><br></pre></td></tr></table></figure><p> 填入配置：替换第一步得到的 <code>CorpID</code>、<code>AgentId</code>、<code>Secret</code>、<code>WebHook</code>，并修改 <code>KEY</code>，用于后续调用的验证。</p> <figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">core:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">ghcr.io/lijiabao9/wecome-pusher:main</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">wecome-pusher-core</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">unless-stopped</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;8080:8080&quot;</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="comment"># Webhook 通用配置</span></span><br><span class="line">      <span class="attr">KEY:</span> <span class="string">&quot;你的key&quot;</span></span><br><span class="line">      <span class="attr">KIND_DEFAULT:</span> <span class="string">&quot;app&quot;</span></span><br><span class="line">      <span class="attr">TIMEZONE:</span> <span class="string">&quot;Asia/Shanghai&quot;</span></span><br><span class="line"></span><br><span class="line">      <span class="comment"># 企业微信应用消息</span></span><br><span class="line">      <span class="attr">WECOM_CID:</span> <span class="string">&quot;企业ID&quot;</span></span><br><span class="line">      <span class="attr">WECOM_SECRET:</span> <span class="string">&quot;应用Secret&quot;</span></span><br><span class="line">      <span class="attr">WECOM_AID:</span> <span class="string">&quot;应用ID&quot;</span></span><br><span class="line">      <span class="attr">WECOM_TOUID:</span> <span class="string">&quot;@all&quot;</span></span><br><span class="line">      <span class="attr">APP_ENABLE_DUPLICATE_CHECK:</span> <span class="number">0</span></span><br><span class="line">      <span class="attr">APP_DUPLICATE_CHECK_INTERVAL:</span> <span class="number">1800</span></span><br><span class="line"></span><br><span class="line">      <span class="comment"># 企业微信群机器人</span></span><br><span class="line">      <span class="attr">ROBOT_WEBHOOK:</span> <span class="string">&quot;https://qyapi.weixin.qq.com/cgi-bin/webhook/send?key=你的机器人key&quot;</span></span><br><span class="line"></span><br><span class="line">      <span class="comment"># Redis 配置</span></span><br><span class="line">      <span class="attr">REDIS_ON:</span> <span class="number">1</span></span><br><span class="line">      <span class="attr">REDIS_HOST:</span> <span class="string">redis</span></span><br><span class="line">      <span class="attr">REDIS_PORT:</span> <span class="number">6379</span></span><br><span class="line">      <span class="attr">REDIS_EXPIRED:</span> <span class="number">7000</span></span><br><span class="line">      <span class="attr">REDIS_KEY:</span> <span class="string">wecom_access_token</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">redis</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">redis:7-alpine</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">wecome-pusher-redis</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">unless-stopped</span></span><br></pre></td></tr></table></figure></li><li><p><strong>启动服务</strong>：</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker compose up -d</span><br></pre></td></tr></table></figure></li></ol><hr><h2 id="第三步：Nginx-反向代理"><a href="#第三步：Nginx-反向代理" class="headerlink" title="第三步：Nginx 反向代理"></a>第三步：Nginx 反向代理</h2><p>为了通过 HTTPS 安全调用 Webhook，我们需要配置反代。</p><ol><li><p><strong>创建配置</strong>：</p><p> 假设域名为 <code>api.131495.xyz</code>。</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/nginx/sites-available/api.131495.xyz</span><br></pre></td></tr></table></figure> <figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line">    <span class="attribute">listen</span> [::]:<span class="number">80</span>;</span><br><span class="line">    <span class="attribute">server_name</span> api.<span class="number">131495</span>.xyz;</span><br><span class="line">    <span class="attribute">return</span> <span class="number">301</span> https://<span class="variable">$host</span><span class="variable">$request_uri</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">443</span> ssl;</span><br><span class="line">    <span class="attribute">listen</span> [::]:<span class="number">443</span> ssl;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># <span class="doctag">TODO:</span> 修改为对应的子域名</span></span><br><span class="line">    <span class="attribute">server_name</span> api.<span class="number">131495</span>.xyz;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 证书配置</span></span><br><span class="line">    <span class="attribute">ssl_certificate</span> /cert/acme_131495.xyz/cert.pem;</span><br><span class="line">    <span class="attribute">ssl_certificate_key</span> /cert/acme_131495.xyz/key.pem;</span><br><span class="line">    <span class="attribute">ssl_ciphers</span> HIGH:!aNULL:!MD5;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># <span class="doctag">TODO:</span> 独立的日志配置</span></span><br><span class="line">    <span class="attribute">access_log</span> /var/log/nginx/api.access.log proxy_json;</span><br><span class="line">    <span class="attribute">error_log</span> /var/log/nginx/api.<span class="literal">error</span>.log;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 反向代理设置</span></span><br><span class="line">    <span class="section">location</span> /wecome &#123;</span><br><span class="line">        <span class="comment"># 转发至本地 8080 端口</span></span><br><span class="line">        <span class="attribute">proxy_pass</span> http://127.0.0.1:8080;</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 代理参数</span></span><br><span class="line">        <span class="attribute">proxy_set_header</span> Host <span class="variable">$host</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> X-Real-IP <span class="variable">$remote_addr</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>重载 Nginx</strong>：</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ln</span> -s /etc/nginx/sites-available/api.131495.xyz /etc/nginx/sites-enabled/</span><br><span class="line">nginx -t &amp;&amp; nginx -s reload</span><br></pre></td></tr></table></figure></li></ol><hr><h2 id="第四步：调用测试"><a href="#第四步：调用测试" class="headerlink" title="第四步：调用测试"></a>第四步：调用测试</h2><p>服务启动后，接口地址格式如下：<code>https://api.131495.xyz/wecome</code></p><p>你可以直接在浏览器访问该 URL，或者使用 curl 测试：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl <span class="string">&quot;https://api.131495.xyz/wecome?key=你的key&amp;kind=app&amp;msg=Hello_WeChat&quot;</span></span><br></pre></td></tr></table></figure><p>如果你的<strong>个人微信</strong>收到了来自 “企业微信” 应用的消息，即代表服务搭建成功！</p><hr><p>这个接口现在可以集成到 <strong>Uptime Kuma</strong>、<strong>Apprise</strong> 或任何支持 Webhook 的服务中使用了。</p>]]></content>
    
    
    <summary type="html">详解如何利用企业微信的“微信插件”功能，配合 Docker 部署自建的中间件服务，实现将 NAS、服务器、应用报警等消息实时推送到个人微信。</summary>
    
    
    
    <category term="创意工坊" scheme="https://lijiabao9.github.io/categories/%E5%88%9B%E6%84%8F%E5%B7%A5%E5%9D%8A/"/>
    
    <category term="服务搭建" scheme="https://lijiabao9.github.io/categories/%E5%88%9B%E6%84%8F%E5%B7%A5%E5%9D%8A/%E6%9C%8D%E5%8A%A1%E6%90%AD%E5%BB%BA/"/>
    
    
    <category term="Docker" scheme="https://lijiabao9.github.io/tags/Docker/"/>
    
    <category term="消息推送" scheme="https://lijiabao9.github.io/tags/%E6%B6%88%E6%81%AF%E6%8E%A8%E9%80%81/"/>
    
    <category term="企业微信" scheme="https://lijiabao9.github.io/tags/%E4%BC%81%E4%B8%9A%E5%BE%AE%E4%BF%A1/"/>
    
    <category term="Webhook" scheme="https://lijiabao9.github.io/tags/Webhook/"/>
    
  </entry>
  
  <entry>
    <title>MIND 部署指南：基于 Docker 搭建待办事项通知管理</title>
    <link href="https://lijiabao9.github.io/posts/ff7a46e6.html"/>
    <id>https://lijiabao9.github.io/posts/ff7a46e6.html</id>
    <published>2025-12-17T17:42:13.000Z</published>
    <updated>2025-12-27T02:22:20.017Z</updated>
    
    <content type="html"><![CDATA[<p><a href="https://github.com/Casvt/MIND">Mind</a> 是一个轻量级、自托管的消息发送与通知管理服务。</p><p>它集成了强大的 <a href="https://github.com/caronc/apprise">Apprise</a> 库，支持通过单一的 API 接口，将消息推送到 Telegram、Discord、Slack、Email 等数十种渠道。<br>对于拥有 NAS 或云服务器的玩家来说，它是统一管理脚本通知、系统报警的绝佳工具。</p><p>本文将指导你完成 MIND 的搭建、反向代理配置及主流通知渠道的接入。</p><h2 id="第一步：基于-Docker-部署"><a href="#第一步：基于-Docker-部署" class="headerlink" title="第一步：基于 Docker 部署"></a>第一步：基于 Docker 部署</h2><p>我们将使用 Docker Compose 快速拉起服务。</p><ol><li><p><strong>创建目录</strong>：</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> -p /app/mind</span><br><span class="line"><span class="built_in">cd</span> /app/mind</span><br></pre></td></tr></table></figure></li><li><p><strong>编写配置文件</strong>：</p><p>创建 <code>docker-compose.yml</code> 文件。</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi docker-compose.yml</span><br></pre></td></tr></table></figure><p> 填入以下内容：</p> <figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">mind:</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">mind</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">mrcas/mind:latest</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./mind-db:/app/db</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">TZ=Europe/Amsterdam</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">20005</span><span class="string">:8080</span></span><br></pre></td></tr></table></figure></li><li><p><strong>启动服务</strong>：</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker compose up -d</span><br></pre></td></tr></table></figure></li></ol><hr><h2 id="第二步：配置-Nginx-反向代理"><a href="#第二步：配置-Nginx-反向代理" class="headerlink" title="第二步：配置 Nginx 反向代理"></a>第二步：配置 Nginx 反向代理</h2><p>为了通过 HTTPS 安全访问，我们需要配置 Nginx 反代。</p><ol><li><p><strong>添加 DNS 解析</strong>：</p><p>将域名（如 <code>mind.131495.xyz</code>）解析到服务器 IP。</p></li><li><p><strong>创建 Nginx 配置</strong>：</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/nginx/sites-available/mind.131495.xyz</span><br></pre></td></tr></table></figure><p> <strong>注意</strong>：以下配置包含自动 HTTPS 跳转及完整的 SSL 路径设置。</p> <figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line">    <span class="attribute">listen</span> [::]:<span class="number">80</span>;</span><br><span class="line">    <span class="attribute">server_name</span> mind.<span class="number">131495</span>.xyz;</span><br><span class="line">    <span class="attribute">return</span> <span class="number">301</span> https://<span class="variable">$host</span><span class="variable">$request_uri</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">443</span> ssl;</span><br><span class="line">    <span class="attribute">listen</span> [::]:<span class="number">443</span> ssl;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># <span class="doctag">TODO:</span> 修改为对应的子域名</span></span><br><span class="line">    <span class="attribute">server_name</span> mind.<span class="number">131495</span>.xyz;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 证书配置</span></span><br><span class="line">    <span class="attribute">ssl_certificate</span> /cert/acme_131495.xyz/cert.pem;</span><br><span class="line">    <span class="attribute">ssl_certificate_key</span> /cert/acme_131495.xyz/key.pem;</span><br><span class="line">    <span class="attribute">ssl_ciphers</span> HIGH:!aNULL:!MD5;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># <span class="doctag">TODO:</span> 独立的日志配置</span></span><br><span class="line">    <span class="attribute">access_log</span> /var/log/nginx/mind.access.log proxy_json;</span><br><span class="line">    <span class="attribute">error_log</span> /var/log/nginx/mind.<span class="literal">error</span>.log;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 反向代理设置</span></span><br><span class="line">    <span class="section">location</span> / &#123;</span><br><span class="line">        <span class="comment"># <span class="doctag">TODO:</span> 修改为实际的服务地址</span></span><br><span class="line">        <span class="attribute">proxy_pass</span> http://127.0.0.1:20005;</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 代理参数</span></span><br><span class="line">        <span class="attribute">proxy_set_header</span> Host <span class="variable">$host</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> X-Real-IP <span class="variable">$remote_addr</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>启用并重载</strong>：</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ln</span> -s /etc/nginx/sites-available/mind.131495.xyz /etc/nginx/sites-enabled/</span><br><span class="line">nginx -t &amp;&amp; nginx -s reload</span><br></pre></td></tr></table></figure></li></ol><hr><h2 id="第三步：系统初始化与安全设置"><a href="#第三步：系统初始化与安全设置" class="headerlink" title="第三步：系统初始化与安全设置"></a>第三步：系统初始化与安全设置</h2><p>访问 <code>https://mind.131495.xyz</code> 进入管理面板。</p><ol><li><p><strong>初始登录</strong>：</p><p>使用默认账号 <code>admin</code>，密码 <code>admin</code> 登录。</p></li><li><p><strong>安全加固 (关键)</strong>：</p><ul><li>进入 <strong>Authentication</strong> 菜单，关闭 <span class='p red'>Allow New Accounts</span> 选项，禁止外部注册。</li><li>进入 <strong>User Management</strong>，编辑 <code>admin</code> 用户，输入新密码并回车确认修改。</li></ul></li><li><p><strong>创建日常账号</strong>：</p><p>为了安全起见，建议创建一个普通权限的用户（User Role），后续均使用该账号进行操作。</p></li><li><p><strong>界面汉化</strong>：</p><p>登录普通账号，点击左侧导航栏底部的 <strong>Settings (设置)</strong> 图标，将 Locale 修改为 <code>zh-CN</code>。</p></li></ol><hr><h2 id="第四步：配置通知渠道-Apprise"><a href="#第四步：配置通知渠道-Apprise" class="headerlink" title="第四步：配置通知渠道 (Apprise)"></a>第四步：配置通知渠道 (Apprise)</h2><p>MIND 的核心在于其强大的通知转发能力。点击左侧 <strong>Notification Services</strong> 图标即可添加。</p><h3 id="1-Telegram-通知"><a href="#1-Telegram-通知" class="headerlink" title="1. Telegram 通知"></a>1. Telegram 通知</h3><p>最常用的即时通知方式。</p><ul><li><strong>获取 Token</strong>：在 Telegram 搜索 <code>@BotFather</code>，发送 <code>/newbot</code> 创建机器人，获取 <code>API Token</code>。</li><li><strong>获取 User ID</strong>：搜索 <code>@userinfobot</code>，获取你个人的 <code>Chat ID</code>。</li><li><strong>MIND 配置</strong>：<ul><li><strong>Service Title</strong>: <code>My Telegram</code></li><li><strong>Bot Token</strong>: 填入 API Token</li><li><strong>Target</strong>: 填入 Chat ID</li></ul></li></ul><h3 id="2-QQ-邮箱通知"><a href="#2-QQ-邮箱通知" class="headerlink" title="2. QQ 邮箱通知"></a>2. QQ 邮箱通知</h3><p>使用 QQ 邮箱的 SMTP 服务发送通知。</p><ul><li><strong>准备工作</strong><ul><li>登录 QQ 邮箱网页版 -&gt; 设置 -&gt; 账号，开启 SMTP 服务并生成 <code>授权码</code>。</li><li>可参考 <a href="https://wx.mail.qq.com/list/readtemplate?name=app_intro.html#/agreement/authorizationCode">QQ 邮箱 SMTP/IMAP 服务</a></li></ul></li><li><strong>MIND 配置</strong>：<ul><li><strong>Schema</strong>: <code>mailtos</code></li><li><strong>Domain</strong>: <code>qq.com</code></li><li><strong>Username</strong>: 填写 QQ 号（<strong>注意</strong>：不要带 <code>@qq.com</code> 后缀）</li><li><strong>Password</strong>: 填写刚才生成的 <strong>授权码</strong>（非 QQ 登录密码）</li><li><strong>Port</strong>：<code>587</code></li><li><strong>Target Email</strong>: 填写完整的收件地址（如 <code>123456@qq.com</code>）</li></ul></li></ul><h3 id="3-Microsoft-365-Office-365-通知"><a href="#3-Microsoft-365-Office-365-通知" class="headerlink" title="3. Microsoft 365 (Office 365) 通知"></a>3. Microsoft 365 (Office 365) 通知</h3><p>利用企业级 E3 订阅的高权重发信。</p><p>详细的前置配置请参考我的另一篇文章：<br>👉 <a href="/posts/57b282c7.html">Microsoft 365 E3 进阶指南：绑定自定义域名并配置企业级 SMTP 发信</a></p><p>我们需要用到 <strong>Microsoft Graph API</strong> 的参数：</p><ul><li><strong>MIND 配置</strong>：<ul><li><strong>Tenant Domain</strong>: 填入 <code>Directory (tenant) ID</code></li><li><strong>Account Email</strong>: 填入拥有发送权限的完整邮箱地址（如 <code>noreply@gabriel.edu.kg</code>）</li><li><strong>Client ID</strong>: 填入 <code>Application (client) ID</code></li><li><strong>Client Secret</strong>: 填注册生成的 Secret Value</li><li><strong>Target Email</strong>: 填写完整的收件地址（如 <code>123456@qq.com</code>）</li></ul></li></ul><h3 id="4-个人微信通知-推荐"><a href="#4-个人微信通知-推荐" class="headerlink" title="4. 个人微信通知 (推荐)"></a>4. 个人微信通知 (推荐)</h3><p>国内使用最广泛的微信。</p><p>这需要利用企业微信的接口，我已经单独写了一篇详细的搭建教程。<br>👉 <strong>请先完成此服务的搭建：</strong> <a href="/posts/d8044207.html">个人微信接收通知：基于 Docker 搭建企业微信推送服务</a></p><p>搭建完成后，在 MIND 的通知设置中选择 <strong>Custom URL</strong>，填入以下 URL 即可：</p><ul><li><strong>Service Name</strong>: <code>WeChat Work</code></li><li><strong>Apprise URL</strong>: <code>jsons://api.131495.xyz:443/wecome?:key=你的key&amp;:kind=app&amp;:from=MIND</code></li></ul>]]></content>
    
    
    <summary type="html">详解如何使用 Docker 部署 MIND 消息推送服务，配置 Nginx 反向代理，并利用内置的 Apprise 集成实现 Telegram、QQ 邮箱及 Office 365 的全渠道消息通知。</summary>
    
    
    
    <category term="创意工坊" scheme="https://lijiabao9.github.io/categories/%E5%88%9B%E6%84%8F%E5%B7%A5%E5%9D%8A/"/>
    
    <category term="服务搭建" scheme="https://lijiabao9.github.io/categories/%E5%88%9B%E6%84%8F%E5%B7%A5%E5%9D%8A/%E6%9C%8D%E5%8A%A1%E6%90%AD%E5%BB%BA/"/>
    
    
    <category term="Docker" scheme="https://lijiabao9.github.io/tags/Docker/"/>
    
    <category term="MIND" scheme="https://lijiabao9.github.io/tags/MIND/"/>
    
    <category term="Apprise" scheme="https://lijiabao9.github.io/tags/Apprise/"/>
    
    <category term="消息推送" scheme="https://lijiabao9.github.io/tags/%E6%B6%88%E6%81%AF%E6%8E%A8%E9%80%81/"/>
    
  </entry>
  
  <entry>
    <title>LunaTV 部署指南：基于 Docker 搭建高颜值的个人影视聚合平台</title>
    <link href="https://lijiabao9.github.io/posts/fd912215.html"/>
    <id>https://lijiabao9.github.io/posts/fd912215.html</id>
    <published>2025-12-14T15:55:44.000Z</published>
    <updated>2025-12-27T02:22:20.017Z</updated>
    
    <content type="html"><![CDATA[<p><a href="https://github.com/MoonTechLab/LunaTV"><strong>LunaTV</strong></a> 是一个高颜值的个人媒体库聚合项目，支持 IPTV 直播源管理、影视点播等功能。<br>相比于传统的播放器，它提供了一个优雅的 Web 界面，并且可以通过后端服务统一管理配置。</p><p>本文将指导你利用 Docker 快速部署 LunaTV，并结合 Nginx 和 Cloudflare Workers 实现外网访问与跨域流媒体代理。</p><h2 id="第一步：环境准备与-Docker-部署"><a href="#第一步：环境准备与-Docker-部署" class="headerlink" title="第一步：环境准备与 Docker 部署"></a>第一步：环境准备与 Docker 部署</h2><p>我们将使用 Docker Compose 来编排服务，包括 LunaTV 核心服务 (<code>moontv-core</code>) 和持久化存储 (<code>kvrocks</code>)。</p><ol><li><p><strong>创建目录</strong></p><p>在服务器上创建存放配置文件的目录。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> -p /app/moontv</span><br><span class="line"><span class="built_in">cd</span> /app/moontv</span><br></pre></td></tr></table></figure></li><li><p><strong>编写配置文件</strong></p><p>创建 <code>docker-compose.yml</code> 文件。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi docker-compose.yml</span><br></pre></td></tr></table></figure><p>填入以下内容：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">moontv-core:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">ghcr.io/moontechlab/lunatv:latest</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">moontv-core</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">on-failure</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&#x27;20004:3000&#x27;</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="comment"># 必填：管理员账号</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">USERNAME=admin@example.com</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">PASSWORD=your_password</span></span><br><span class="line">      <span class="comment"># 必填：存储配置 (使用 kvrocks)</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">NEXT_PUBLIC_STORAGE_TYPE=kvrocks</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">KVROCKS_URL=redis://moontv-kvrocks:6666</span></span><br><span class="line">      <span class="comment"># 可选：站点配置</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">SITE_BASE=https://moontv.131495.xyz</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">NEXT_PUBLIC_SITE_NAME=Luna</span> <span class="string">Home</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ANNOUNCEMENT=👋</span> <span class="string">欢迎回家！这里是</span> <span class="string">Luna</span> <span class="string">Home</span> <span class="string">个人媒体库，祝您今晚观影愉快！🍿</span></span><br><span class="line">      <span class="comment"># 可选：豆瓣代理配置（推荐）</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">NEXT_PUBLIC_DOUBAN_PROXY_TYPE=cmliussss-cdn-tencent</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">NEXT_PUBLIC_DOUBAN_IMAGE_PROXY_TYPE=cmliussss-cdn-tencent</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">moontv-network</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">moontv-kvrocks</span></span><br><span class="line">  </span><br><span class="line">  <span class="attr">moontv-kvrocks:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">apache/kvrocks</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">moontv-kvrocks</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">unless-stopped</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">kvrocks-data:/var/lib/kvrocks</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">moontv-network</span></span><br><span class="line"></span><br><span class="line"><span class="attr">networks:</span></span><br><span class="line">  <span class="attr">moontv-network:</span></span><br><span class="line">    <span class="attr">driver:</span> <span class="string">bridge</span></span><br><span class="line"></span><br><span class="line"><span class="attr">volumes:</span></span><br><span class="line">  <span class="attr">kvrocks-data:</span></span><br></pre></td></tr></table></figure></li><li><p><strong>启动服务</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker compose up -d</span><br></pre></td></tr></table></figure></li></ol><p><strong>核心变量说明</strong>：</p><div class="table-container"><table><thead><tr><th style="text-align:left">变量名</th><th style="text-align:left">示例值</th><th style="text-align:left">说明</th></tr></thead><tbody><tr><td style="text-align:left"><code>USERNAME</code></td><td style="text-align:left"><code>admin@example.com</code></td><td style="text-align:left">管理后台登录账号</td></tr><tr><td style="text-align:left"><code>PASSWORD</code></td><td style="text-align:left"><code>your_password</code></td><td style="text-align:left">登录密码，<span class='p red'>建议修改</span></td></tr><tr><td style="text-align:left"><code>SITE_BASE</code></td><td style="text-align:left"><code>https://moontv.131495.xyz</code></td><td style="text-align:left">你的外部访问域名</td></tr><tr><td style="text-align:left"><code>KVROCKS_URL</code></td><td style="text-align:left"><code>redis://moontv-kvrocks:6666</code></td><td style="text-align:left">数据库连接串 (无需修改)</td></tr></tbody></table></div><hr><h2 id="第二步：配置-Nginx-反向代理"><a href="#第二步：配置-Nginx-反向代理" class="headerlink" title="第二步：配置 Nginx 反向代理"></a>第二步：配置 Nginx 反向代理</h2><p>为了通过 HTTPS 安全访问，我们需要配置 Nginx 反代。</p><ol><li><p><strong>添加 DNS 解析</strong>：<br>将你的域名（如 <code>moontv.131495.xyz</code>）解析到服务器 IP。</p></li><li><p><strong>创建 Nginx 配置</strong>：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/nginx/sites-available/moontv.131495.xyz</span><br></pre></td></tr></table></figure><p>写入以下配置（请替换为你自己的域名和日志路径）：</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line">    <span class="attribute">listen</span> [::]:<span class="number">80</span>;</span><br><span class="line">    <span class="attribute">server_name</span> moontv.<span class="number">131495</span>.xyz;</span><br><span class="line">    <span class="attribute">return</span> <span class="number">301</span> https://<span class="variable">$host</span><span class="variable">$request_uri</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">443</span> ssl;</span><br><span class="line">    <span class="attribute">listen</span> [::]:<span class="number">443</span> ssl;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">server_name</span> moontv.<span class="number">131495</span>.xyz;</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 证书配置</span></span><br><span class="line">    <span class="attribute">ssl_certificate</span> /cert/acme_131495.xyz/cert.pem;</span><br><span class="line">    <span class="attribute">ssl_certificate_key</span> /cert/acme_131495.xyz/key.pem;</span><br><span class="line">    <span class="attribute">ssl_ciphers</span> HIGH:!aNULL:!MD5;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 独立的日志配置</span></span><br><span class="line">    <span class="attribute">access_log</span> /var/log/nginx/moontv.access.log;</span><br><span class="line">    <span class="attribute">error_log</span> /var/log/nginx/moontv.<span class="literal">error</span>.log;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 反向代理设置</span></span><br><span class="line">    <span class="section">location</span> / &#123;</span><br><span class="line">        <span class="attribute">proxy_pass</span> http://127.0.0.1:20004;</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 代理参数</span></span><br><span class="line">        <span class="attribute">proxy_set_header</span> Host <span class="variable">$host</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> X-Real-IP <span class="variable">$remote_addr</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>启用并重载</strong>：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ln</span> -s /etc/nginx/sites-available/moontv.131495.xyz /etc/nginx/sites-enabled/</span><br><span class="line">nginx -t &amp;&amp; nginx -s reload</span><br></pre></td></tr></table></figure></li></ol><p>此时，访问 <code>https://moontv.131495.xyz</code> 并输入第一步中设置的账号密码，即可进入管理面板。</p><hr><h2 id="第三步：配置视频订阅源"><a href="#第三步：配置视频订阅源" class="headerlink" title="第三步：配置视频订阅源"></a>第三步：配置视频订阅源</h2><p>进入后台后，我们需要导入视频源。这里推荐使用开源项目 <a href="https://github.com/hafrey1/LunaTV-config">hafrey1/LunaTV-config</a> 提供的配置。</p><p>你有两种方式导入：</p><ul><li><strong>静态导入</strong>：直接复制项目中的 <code>jin18.txt</code> 或 <code>jingjian.txt</code> 内容，粘贴到后台的配置文本框中。</li><li><strong>订阅链接 (推荐)</strong>：使用 Raw 文件地址作为订阅 URL，支持一键更新。</li></ul><hr><h2 id="第四步：进阶-Cloudflare-Workers-跨域代理"><a href="#第四步：进阶-Cloudflare-Workers-跨域代理" class="headerlink" title="第四步：进阶 - Cloudflare Workers 跨域代理"></a>第四步：进阶 - Cloudflare Workers 跨域代理</h2><p>为了解决部分视频源的 CORS 跨域问题，以及防止直接请求源站导致的限制，强烈建议自行部署 Cloudflare Workers 代理。</p><ol><li><p><strong>创建 Worker</strong>：<br>登录 <a href="https://www.cloudflare.com/zh-cn/">Cloudflare</a>，创建一个新的 Worker。</p></li><li><p><strong>复制代码</strong>：<br>复制 Github 项目中 <a href="https://github.com/hafrey1/LunaTV-config/blob/main/CORSAPI/_worker.js">_worker.js</a> 的全部代码。</p></li><li><p><strong>关键修改 (重要)</strong>：<br>原代码中的中转代理地址可能不完整，<span class='p red'>务必手动修改 JS 代码</span> 中的 HTML 生成部分。<br>找到生成页面 HTML 的代码段，确保代理的订阅地址加上 <code>&amp;prefix=$&#123;currentOrigin&#125;?url=</code>。</p><p><strong>修改后 (参考)：</strong></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;section&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h3</span>&gt;</span>📦 精简版（jin18）<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>中转代理 JSON：<span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">code</span> <span class="attr">class</span>=<span class="string">&quot;copyable&quot;</span>&gt;</span>$&#123;currentOrigin&#125;?format=1&amp;source=jin18&amp;prefix=$&#123;currentOrigin&#125;?url=<span class="tag">&lt;/<span class="name">code</span>&gt;</span> <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;copy-btn&quot;</span>&gt;</span>复制<span class="tag">&lt;/<span class="name">button</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>中转 Base58：<span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">code</span> <span class="attr">class</span>=<span class="string">&quot;copyable&quot;</span>&gt;</span>$&#123;currentOrigin&#125;?format=3&amp;source=jin18&amp;prefix=$&#123;currentOrigin&#125;?url=<span class="tag">&lt;/<span class="name">code</span>&gt;</span> <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;copy-btn&quot;</span>&gt;</span>复制<span class="tag">&lt;/<span class="name">button</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p><strong>获取订阅地址</strong>：<br>部署完成后，访问你的 Worker 域名（如 <code>https://luna-proxy.yourname.workers.dev</code>）。<br>页面会显示处理好的订阅链接，直接复制 <strong>中转 Base58</strong> 链接填入 LunaTV 后台即可。</p></li></ol><div class="note warning flat"><p><strong>使用提示：</strong><br>Cloudflare Workers 免费版每日请求限制为 <strong>10万次</strong>。<br>此外，请勿滥用代理下载大文件，以免导致账号封禁风险。</p></div>]]></content>
    
    
    <summary type="html">详解如何使用 Docker Compose 部署 LunaTV 个人媒体库，配合 Nginx 反向代理与 Cloudflare Workers 解决跨域播放问题，打造流畅的在线观影体验。</summary>
    
    
    
    <category term="创意工坊" scheme="https://lijiabao9.github.io/categories/%E5%88%9B%E6%84%8F%E5%B7%A5%E5%9D%8A/"/>
    
    <category term="服务搭建" scheme="https://lijiabao9.github.io/categories/%E5%88%9B%E6%84%8F%E5%B7%A5%E5%9D%8A/%E6%9C%8D%E5%8A%A1%E6%90%AD%E5%BB%BA/"/>
    
    
    <category term="Docker" scheme="https://lijiabao9.github.io/tags/Docker/"/>
    
    <category term="LunaTV" scheme="https://lijiabao9.github.io/tags/LunaTV/"/>
    
    <category term="Cloudflare" scheme="https://lijiabao9.github.io/tags/Cloudflare/"/>
    
  </entry>
  
  <entry>
    <title>3X-UI 面板搭建指南：可视化管理 VLESS / Reality / Trojan 节点</title>
    <link href="https://lijiabao9.github.io/posts/e8898327.html"/>
    <id>https://lijiabao9.github.io/posts/e8898327.html</id>
    <published>2025-12-12T12:36:08.000Z</published>
    <updated>2025-12-27T02:22:20.017Z</updated>
    
    <content type="html"><![CDATA[<p><a href="https://github.com/MHSanaei/3x-ui">3X-UI</a> 是 X-UI 的一个优秀分支，支持 Xray 内核的绝大多数新特性（如 Reality、Vision 流控等），并提供了美观的数据统计面板。</p><p>本文将带你搭建一套既方便管理，又具备极高隐蔽性的代理系统。</p><h2 id="一、一键安装面板"><a href="#一、一键安装面板" class="headerlink" title="一、一键安装面板"></a>一、一键安装面板</h2><p>使用官方提供的一键脚本进行安装：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">apt update -y &amp;&amp; apt install git -y</span><br><span class="line"></span><br><span class="line">bash &lt; (curl -Ls https://raw.githubusercontent.com/mhsanaei/3x-ui/master/install.sh))</span><br></pre></td></tr></table></figure><p>安装完成后，终端会输出初始的登录信息：</p><blockquote><p>Username: UtgyyYgtJw  (随机生成)<br>Password: JgaAcZYsVQ  (随机生成)<br>Port:     18857       (随机生成)<br>Access URL: <a href="http://你的IP:18857/随机路径">http://你的IP:18857/随机路径</a></p></blockquote><h3 id="推荐的初始化设置"><a href="#推荐的初始化设置" class="headerlink" title="推荐的初始化设置"></a>推荐的初始化设置</h3><p>在终端输入 <code>x-ui</code> 进入管理菜单：</p><ol><li>输入 <code>23</code>：安装 BBR 拥塞控制算法（推荐 BBR+FQ），显著提升速度。</li><li>输入 <code>6</code>：修改管理员账号和密码（建议改个好记的，但不要太简单）。</li></ol><hr><h2 id="二、面板安全配置-Nginx-反代"><a href="#二、面板安全配置-Nginx-反代" class="headerlink" title="二、面板安全配置 (Nginx 反代)"></a>二、面板安全配置 (Nginx 反代)</h2><p>为了安全，我们不应直接将面板端口暴露在公网，而是将其隐藏在 Nginx 的 443 端口下，通过特定路径访问。</p><h3 id="1-修改面板监听配置"><a href="#1-修改面板监听配置" class="headerlink" title="1. 修改面板监听配置"></a>1. 修改面板监听配置</h3><p>登录面板（使用安装时提供的 IP:端口），进入 <strong>面板设置</strong> -> <strong>常规配置</strong>：</p><ul><li><strong>面板监听 IP</strong>：改为 <code>127.0.0.1</code> (只允许本机访问)</li><li><strong>面板 URL 根路径</strong>：改为 <code>/xui/</code> (或者你喜欢的其他路径，<strong>注意前后都要有斜杠</strong>)</li><li><strong>保存并重启面板</strong>。</li></ul><p><em>注意：重启后，你将无法直接通过 IP:端口 访问面板，必须进行下一步 Nginx 配置。</em></p><h3 id="2-配置-Nginx-反向代理"><a href="#2-配置-Nginx-反向代理" class="headerlink" title="2. 配置 Nginx 反向代理"></a>2. 配置 Nginx 反向代理</h3><p>编辑 Nginx 配置文件：<code>vi /etc/nginx/sites-available/gfw.131495.xyz</code></p><p>我们将面板管理和节点代理都整合在这个配置中：</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line">    <span class="attribute">listen</span> [::]:<span class="number">80</span>;</span><br><span class="line">    <span class="attribute">server_name</span> gfw.<span class="number">131495</span>.xyz;</span><br><span class="line">    <span class="attribute">return</span> <span class="number">301</span> https://<span class="variable">$host</span><span class="variable">$request_uri</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">443</span> ssl;</span><br><span class="line">    <span class="attribute">listen</span> [::]:<span class="number">443</span> ssl;</span><br><span class="line">    </span><br><span class="line">    <span class="attribute">server_name</span> gfw.<span class="number">131495</span>.xyz;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 证书配置</span></span><br><span class="line">    <span class="attribute">ssl_certificate</span> /cert/acme_131495.xyz/cert.pem;</span><br><span class="line">    <span class="attribute">ssl_certificate_key</span> /cert/acme_131495.xyz/key.pem;</span><br><span class="line">    <span class="attribute">ssl_ciphers</span> HIGH:!aNULL:!MD5;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 日志</span></span><br><span class="line">    <span class="attribute">access_log</span> /var/log/nginx/gfw.access.log;</span><br><span class="line">    <span class="attribute">error_log</span> /var/log/nginx/gfw.<span class="literal">error</span>.log;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 1. 默认伪装 (Bing 镜像)</span></span><br><span class="line">    <span class="section">location</span> / &#123;</span><br><span class="line">        <span class="attribute">proxy_pass</span> https://www.bing.com;</span><br><span class="line">        <span class="attribute">proxy_ssl_server_name</span> <span class="literal">on</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> Host www.bing.com;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 2. 面板管理入口 (访问 https://域名/xui/ 进入面板)</span></span><br><span class="line">    <span class="section">location</span> /xui/ &#123;</span><br><span class="line">        <span class="comment"># 注意：端口要和面板设置的一致</span></span><br><span class="line">        <span class="attribute">proxy_pass</span> http://127.0.0.1:18857/xui/; </span><br><span class="line">        </span><br><span class="line">        <span class="attribute">proxy_set_header</span> Host <span class="variable">$host</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> X-Real-IP <span class="variable">$remote_addr</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 3. 节点流量转发 (VLESS+WS)</span></span><br><span class="line">    <span class="section">location</span> /ray &#123;</span><br><span class="line">        <span class="attribute">proxy_pass</span> http://127.0.0.1:21001;</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># WebSocket 关键头</span></span><br><span class="line">        <span class="attribute">proxy_http_version</span> <span class="number">1</span>.<span class="number">1</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> Upgrade <span class="variable">$http_upgrade</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> Connection <span class="string">&quot;upgrade&quot;</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="attribute">proxy_set_header</span> Host <span class="variable">$host</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> X-Real-IP <span class="variable">$remote_addr</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>重载 Nginx：<code>nginx -t &amp;&amp; systemctl reload nginx</code><br>现在，访问 <code>https://gfw.131495.xyz/xui/</code> 即可安全管理面板。</p><hr><h2 id="三、创建节点：CDN-隐匿模式-VLess-WS-TLS"><a href="#三、创建节点：CDN-隐匿模式-VLess-WS-TLS" class="headerlink" title="三、创建节点：CDN 隐匿模式 (VLess+WS+TLS)"></a>三、创建节点：CDN 隐匿模式 (VLess+WS+TLS)</h2><p>这种模式适合需要隐藏 IP 或搭配 Cloudflare CDN 使用的场景。</p><h3 id="1-面板端设置"><a href="#1-面板端设置" class="headerlink" title="1. 面板端设置"></a>1. 面板端设置</h3><p>在 <strong>入站列表</strong> 点击 <strong>添加入站</strong>：</p><ul><li><strong>备注</strong>：<code>VLess-WS-TLS</code></li><li><strong>协议</strong>：<code>vless</code></li><li><strong>监听 IP</strong>：<code>127.0.0.1</code> (仅允许 Nginx 转发)</li><li><strong>端口</strong>：<code>21001</code> (需与 Nginx 配置一致)</li><li><strong>传输配置</strong>：<ul><li><strong>传输协议</strong>：<code>ws</code></li><li><strong>路径</strong>：<code>/ray</code> (需与 Nginx 配置一致)</li><li><strong>Host</strong>：留空或填写域名</li></ul></li><li><strong>TLS</strong>：<code>关闭</code> (TLS 由 Nginx 处理)</li></ul><h3 id="2-客户端配置注意"><a href="#2-客户端配置注意" class="headerlink" title="2. 客户端配置注意"></a>2. 客户端配置注意</h3><p>由于经过了 Nginx 转发，客户端无法自动识别这种复杂的拓扑，通常需要<strong>手动修改</strong>导入后的配置：</p><ul><li><strong>地址</strong>：你的域名</li><li><strong>端口</strong>：<code>443</code></li><li><strong>传输层安全 (TLS)</strong>：<code>开启</code></li></ul><hr><h2 id="四、创建节点：直连性能模式-VLess-Reality"><a href="#四、创建节点：直连性能模式-VLess-Reality" class="headerlink" title="四、创建节点：直连性能模式 (VLess+Reality)"></a>四、创建节点：直连性能模式 (VLess+Reality)</h2><p>这种模式不需要域名证书，不需要 Nginx，速度最快，是目前对抗 GFW 的主流方案。</p><h3 id="1-面板端设置-1"><a href="#1-面板端设置-1" class="headerlink" title="1. 面板端设置"></a>1. 面板端设置</h3><p>在 <strong>入站列表</strong> 点击 <strong>添加入站</strong>：</p><ul><li><strong>备注</strong>：<code>VLess-Reality</code></li><li><strong>协议</strong>：<code>vless</code></li><li><strong>监听 IP</strong>：<code>0.0.0.0</code> (必须暴露给公网)</li><li><strong>端口</strong>：<code>20443</code> (或者其他未被占用的端口，注意 Nginx 已经占用了 443)</li><li><strong>用户设置</strong>：<ul><li><strong>Flow</strong>：<code>xtls-rprx-vision</code> (关键！启用流控)</li></ul></li><li><strong>传输配置</strong>：<ul><li><strong>传输协议</strong>：<code>tcp</code></li></ul></li><li><strong>Reality 设置</strong>：<ul><li><strong>Reality</strong>：<code>开启</code></li><li><strong>uTLS</strong>：<code>chrome</code></li><li><strong>Dest (目标)</strong>：<code>tesla.com:443</code></li><li><strong>SNI</strong>：<code>tesla.com</code> (需与 Dest 对应)</li><li>点击 <strong>Get New Cert</strong> 生成密钥对。</li></ul></li></ul><h3 id="2-连接测试"><a href="#2-连接测试" class="headerlink" title="2. 连接测试"></a>2. 连接测试</h3><ul><li>在云服务器防火墙放行端口（如 <code>20443</code>）。</li><li>如果本地 Ping 不通域名，客户端地址栏可直接填写 <strong>服务器 IP</strong>。</li><li>SNI 必须填写正确，这是 Reality 伪装的关键。</li></ul><hr><h2 id="五、总结"><a href="#五、总结" class="headerlink" title="五、总结"></a>五、总结</h2><div class="note success flat"><p><strong>总结：</strong></p><ul><li><strong>日常浏览/备用</strong>：使用 <code>VLESS+WS+TLS</code> (走 Nginx)，隐蔽性好，可套 CDN。</li><li><strong>看视频/大流量</strong>：使用 <code>VLESS+Reality</code> (走独立端口)，速度最快，延迟最低。</li></ul></div>]]></content>
    
    
    <summary type="html">这是一个新手友好的节点搭建教程。利用 3X-UI 面板可视化管理节点，通过 Nginx 反代实现面板隐藏，并详解 VLESS + WS + TLS 和 VLESS + Reality 两种主流节点的配置方法。</summary>
    
    
    
    <category term="创意工坊" scheme="https://lijiabao9.github.io/categories/%E5%88%9B%E6%84%8F%E5%B7%A5%E5%9D%8A/"/>
    
    <category term="网络代理" scheme="https://lijiabao9.github.io/categories/%E5%88%9B%E6%84%8F%E5%B7%A5%E5%9D%8A/%E7%BD%91%E7%BB%9C%E4%BB%A3%E7%90%86/"/>
    
    
    <category term="Nginx" scheme="https://lijiabao9.github.io/tags/Nginx/"/>
    
    <category term="3X-UI" scheme="https://lijiabao9.github.io/tags/3X-UI/"/>
    
    <category term="Xray" scheme="https://lijiabao9.github.io/tags/Xray/"/>
    
  </entry>
  
  <entry>
    <title>Xray 部署实战：VLESS 协议从 XTLS-Vision 直连到 Nginx + WebSocket 隐匿模式</title>
    <link href="https://lijiabao9.github.io/posts/64f6dbdf.html"/>
    <id>https://lijiabao9.github.io/posts/64f6dbdf.html</id>
    <published>2025-12-10T15:28:53.000Z</published>
    <updated>2025-12-27T02:22:20.017Z</updated>
    
    <content type="html"><![CDATA[<p><strong>VLESS</strong> 是 Xray 内核的专属协议，它是一种无状态的轻量级传输协议。<br>与 VMess 不同，VLESS 不对数据进行加密（因为它依赖外层 TLS 加密），因此协议头极其精简，性能更高。</p><p>本文将介绍两种主流架构：</p><ol><li><strong>性能之选</strong>：VLESS + TCP + TLS + XTLS-Vision（直连抗封锁最强）。</li><li><strong>隐匿之选</strong>：VLESS + WS + Nginx + TLS（支持 CDN）。</li></ol><h2 id="安装-Xray"><a href="#安装-Xray" class="headerlink" title="安装 Xray"></a>安装 Xray</h2><p>推荐使用官方脚本安装，方便管理和更新。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. 安装/更新 Xray</span></span><br><span class="line">bash -c <span class="string">&quot;<span class="subst">$(curl -L https://github.com/XTLS/Xray-install/raw/main/install-release.sh)</span>&quot;</span> @ install</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 生成 UUID (复制备用)</span></span><br><span class="line">xray uuid</span><br></pre></td></tr></table></figure><p><em>常用命令：</em></p><ul><li>更新 GeoIP 库：<code>bash -c &quot;$(curl -L .../install-release.sh)&quot; @ install-geodata</code></li><li>卸载：<code>bash -c &quot;$(curl -L .../install-release.sh)&quot; @ remove</code></li></ul><hr><h2 id="场景一：XTLS-Vision-直连模式-推荐"><a href="#场景一：XTLS-Vision-直连模式-推荐" class="headerlink" title="场景一：XTLS-Vision 直连模式 (推荐)"></a>场景一：XTLS-Vision 直连模式 (推荐)</h2><p>这是目前 Xray 最强大的模式，利用 <code>XTLS-Vision</code> 流控技术，在提升速度的同时，能极有效地对抗 GFW 的主动探测和重放攻击。</p><h3 id="1-修改配置"><a href="#1-修改配置" class="headerlink" title="1. 修改配置"></a>1. 修改配置</h3><p>编辑 <code>/usr/local/etc/xray/config.json</code>：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;log&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span> <span class="attr">&quot;loglevel&quot;</span><span class="punctuation">:</span> <span class="string">&quot;warning&quot;</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;inbounds&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;port&quot;</span><span class="punctuation">:</span> <span class="number">2443</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;protocol&quot;</span><span class="punctuation">:</span> <span class="string">&quot;vless&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;settings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;clients&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                    <span class="punctuation">&#123;</span></span><br><span class="line">                        <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;你的UUID&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;flow&quot;</span><span class="punctuation">:</span> <span class="string">&quot;xtls-rprx-vision&quot;</span></span><br><span class="line">                    <span class="punctuation">&#125;</span></span><br><span class="line">                <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;decryption&quot;</span><span class="punctuation">:</span> <span class="string">&quot;none&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;fallbacks&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                    <span class="punctuation">&#123;</span></span><br><span class="line">                        <span class="attr">&quot;dest&quot;</span><span class="punctuation">:</span> <span class="number">80</span> </span><br><span class="line">                    <span class="punctuation">&#125;</span></span><br><span class="line">                <span class="punctuation">]</span></span><br><span class="line">            <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;streamSettings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;network&quot;</span><span class="punctuation">:</span> <span class="string">&quot;tcp&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;security&quot;</span><span class="punctuation">:</span> <span class="string">&quot;tls&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;tlsSettings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                    <span class="attr">&quot;certificates&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                        <span class="punctuation">&#123;</span></span><br><span class="line">                            <span class="attr">&quot;certificateFile&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/cert/acme_131495.xyz/cert.pem&quot;</span><span class="punctuation">,</span></span><br><span class="line">                            <span class="attr">&quot;keyFile&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/cert/acme_131495.xyz/key.pem&quot;</span></span><br><span class="line">                        <span class="punctuation">&#125;</span></span><br><span class="line">                    <span class="punctuation">]</span></span><br><span class="line">                <span class="punctuation">&#125;</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;outbounds&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span> <span class="punctuation">&#123;</span> <span class="attr">&quot;protocol&quot;</span><span class="punctuation">:</span> <span class="string">&quot;freedom&quot;</span> <span class="punctuation">&#125;</span> <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><div class="note info flat"><p><strong>关于 Fallback (回落)</strong>：<br>配置中的 <code>dest: 80</code> 意味着，如果有人访问你的 2443 端口但不是 VLESS 协议（比如浏览器直接访问），Xray 会把流量转发到本机的 80 端口。<br>建议本机安装一个 Nginx 监听 80 端口并展示一个静态网页，以防探测。</p></div><h3 id="2-解决权限问题-关键"><a href="#2-解决权限问题-关键" class="headerlink" title="2. 解决权限问题 (关键)"></a>2. 解决权限问题 (关键)</h3><p>Xray 默认使用 <code>nobody</code> 用户，无法读取位于 <code>/root/</code> 或 <code>/cert/</code> 等目录下的证书文件，导致启动失败。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl edit xray</span><br></pre></td></tr></table></figure><p>在编辑器中填入：</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[Service]</span></span><br><span class="line"><span class="attr">User</span>=root</span><br><span class="line"><span class="attr">Group</span>=root</span><br></pre></td></tr></table></figure><p><code>Ctrl + O</code>, <code>Enter</code>, <code>Ctrl + X</code> 保存退出后，重启服务：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart xray</span><br><span class="line">systemctl status xray</span><br></pre></td></tr></table></figure><hr><h2 id="场景二：Nginx-反代-WebSocket-模式"><a href="#场景二：Nginx-反代-WebSocket-模式" class="headerlink" title="场景二：Nginx 反代 + WebSocket 模式"></a>场景二：Nginx 反代 + WebSocket 模式</h2><p>如果你需要使用 Cloudflare CDN，或者希望将代理服务隐藏在正常的 Nginx 网站后面，请选择此模式。</p><h3 id="1-修改-Xray-配置"><a href="#1-修改-Xray-配置" class="headerlink" title="1. 修改 Xray 配置"></a>1. 修改 Xray 配置</h3><p><strong>注意</strong>：</p><ol><li><strong>监听本地</strong>：<code>listen</code> 改为 <code>127.0.0.1</code>。</li><li><strong>移除流控</strong>：<code>flow</code> 必须留空（WS 不支持 Vision）。</li><li><strong>移除 TLS</strong>：TLS 交给 Nginx 处理，Xray 内部处理明文。</li><li><strong>WebSocket 配置</strong>：<code>network</code> 改为 <code>ws</code>，<code>path</code> 填写 <code>/ray</code>。</li></ol><p>编辑 <code>/usr/local/etc/xray/config.json</code>：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;log&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span> <span class="attr">&quot;loglevel&quot;</span><span class="punctuation">:</span> <span class="string">&quot;warning&quot;</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;inbounds&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;listen&quot;</span><span class="punctuation">:</span> <span class="string">&quot;127.0.0.1&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;port&quot;</span><span class="punctuation">:</span> <span class="number">2443</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;protocol&quot;</span><span class="punctuation">:</span> <span class="string">&quot;vless&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;settings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;clients&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                    <span class="punctuation">&#123;</span></span><br><span class="line">                        <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;你的UUID&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;flow&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span> </span><br><span class="line">                    <span class="punctuation">&#125;</span></span><br><span class="line">                <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;decryption&quot;</span><span class="punctuation">:</span> <span class="string">&quot;none&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;streamSettings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;network&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ws&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;wsSettings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                    <span class="attr">&quot;path&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/ray&quot;</span></span><br><span class="line">                <span class="punctuation">&#125;</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;outbounds&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span> <span class="punctuation">&#123;</span> <span class="attr">&quot;protocol&quot;</span><span class="punctuation">:</span> <span class="string">&quot;freedom&quot;</span> <span class="punctuation">&#125;</span> <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p><em>重启 Xray：<code>systemctl restart xray</code></em></p><h3 id="2-配置-Nginx-反向代理"><a href="#2-配置-Nginx-反向代理" class="headerlink" title="2. 配置 Nginx 反向代理"></a>2. 配置 Nginx 反向代理</h3><p>编辑 Nginx 配置文件 <code>vi /etc/nginx/sites-available/gfw.131495.xyz</code>：</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line">    <span class="attribute">listen</span> [::]:<span class="number">80</span>;</span><br><span class="line">    <span class="attribute">server_name</span> gfw.<span class="number">131495</span>.xyz;</span><br><span class="line">    <span class="attribute">return</span> <span class="number">301</span> https://<span class="variable">$host</span><span class="variable">$request_uri</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">443</span> ssl; </span><br><span class="line">    <span class="attribute">listen</span> [::]:<span class="number">443</span> ssl;</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># <span class="doctag">TODO:</span> 修改为对应的子域名</span></span><br><span class="line">    <span class="attribute">server_name</span> gfw.<span class="number">131495</span>.xyz;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># <span class="doctag">TODO:</span> 独立的日志配置</span></span><br><span class="line">    <span class="attribute">access_log</span> /var/log/nginx/gfw.access.log proxy_json;</span><br><span class="line">    <span class="attribute">error_log</span> /var/log/nginx/gfw.<span class="literal">error</span>.log;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 证书配置</span></span><br><span class="line">    <span class="attribute">ssl_certificate</span> /cert/acme_131495.xyz/cert.pem;</span><br><span class="line">    <span class="attribute">ssl_certificate_key</span> /cert/acme_131495.xyz/key.pem;</span><br><span class="line">    <span class="attribute">ssl_ciphers</span> HIGH:!aNULL:!MD5;</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 默认代理（防止探测）</span></span><br><span class="line">    <span class="section">location</span> / &#123;</span><br><span class="line">        <span class="attribute">proxy_pass</span> https://www.bing.com;</span><br><span class="line">        <span class="attribute">proxy_ssl_server_name</span> <span class="literal">on</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> Host www.bing.com;</span><br><span class="line">        <span class="attribute">proxy_ssl_protocols</span> TLSv1.<span class="number">2</span> TLSv1.<span class="number">3</span>;</span><br><span class="line">    &#125;   </span><br><span class="line">    </span><br><span class="line">    <span class="section">location</span> /ray &#123;</span><br><span class="line">        <span class="comment"># <span class="doctag">TODO:</span> 修改为实际的服务地址</span></span><br><span class="line">        <span class="attribute">proxy_pass</span> http://127.0.0.1:2443;</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Websocket 代理参数</span></span><br><span class="line">        <span class="attribute">proxy_http_version</span> <span class="number">1</span>.<span class="number">1</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> Upgrade <span class="variable">$http_upgrade</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> Connection <span class="string">&quot;upgrade&quot;</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="attribute">proxy_set_header</span> Host <span class="variable">$host</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> X-Real-IP <span class="variable">$remote_addr</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>应用配置：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ln</span> -s /etc/nginx/sites-available/gfw.131495.xyz /etc/nginx/sites-enabled/</span><br><span class="line">nginx -t &amp;&amp; systemctl reload nginx</span><br></pre></td></tr></table></figure><hr><h2 id="客户端配置对比"><a href="#客户端配置对比" class="headerlink" title="客户端配置对比"></a>客户端配置对比</h2><p>根据你选择的场景，客户端（<strong>v2rayN</strong> / Shadowrocket / Nekoray）的配置有所不同：</p><div class="table-container"><table><thead><tr><th style="text-align:left">配置项</th><th style="text-align:left">场景一 (Vision)</th><th style="text-align:left">场景二 (Nginx+WS)</th></tr></thead><tbody><tr><td style="text-align:left"><strong>地址 (Address)</strong></td><td style="text-align:left">你的域名</td><td style="text-align:left">你的域名</td></tr><tr><td style="text-align:left"><strong>端口 (Port)</strong></td><td style="text-align:left"><code>2443</code> (Xray 端口)</td><td style="text-align:left"><code>443</code> (Nginx 端口)</td></tr><tr><td style="text-align:left"><strong>用户 ID (UUID)</strong></td><td style="text-align:left">你的 UUID</td><td style="text-align:left">你的 UUID</td></tr><tr><td style="text-align:left"><strong>流控 (Flow)</strong></td><td style="text-align:left"><code>xtls-rprx-vision</code></td><td style="text-align:left"><strong>空</strong></td></tr><tr><td style="text-align:left"><strong>传输协议 (Network)</strong></td><td style="text-align:left"><code>tcp</code></td><td style="text-align:left"><code>ws</code></td></tr><tr><td style="text-align:left"><strong>伪装路径 (Path)</strong></td><td style="text-align:left">空</td><td style="text-align:left"><code>/ray</code></td></tr><tr><td style="text-align:left"><strong>TLS</strong></td><td style="text-align:left">开启 (<code>tls</code>)</td><td style="text-align:left">开启 (<code>tls</code>)</td></tr><tr><td style="text-align:left"><strong>uTLS (指纹)</strong></td><td style="text-align:left"><code>chrome</code> (推荐)</td><td style="text-align:left"><code>chrome</code></td></tr></tbody></table></div><div class="note success flat"><p><strong>总结：</strong></p><ul><li>追求极致速度和直连稳定性 -> 选 <strong>场景一</strong>。</li><li>需要隐藏 IP、使用 CDN 或配合建站 -> 选 <strong>场景二</strong>。</li></ul></div>]]></content>
    
    
    <summary type="html">详解 Xray 的 VLESS 协议部署。涵盖目前最强的 XTLS-Vision 直连流控模式，以及配合 Nginx 反向代理实现 CDN 兼容的 WebSocket 模式。</summary>
    
    
    
    <category term="创意工坊" scheme="https://lijiabao9.github.io/categories/%E5%88%9B%E6%84%8F%E5%B7%A5%E5%9D%8A/"/>
    
    <category term="网络代理" scheme="https://lijiabao9.github.io/categories/%E5%88%9B%E6%84%8F%E5%B7%A5%E5%9D%8A/%E7%BD%91%E7%BB%9C%E4%BB%A3%E7%90%86/"/>
    
    
    <category term="Nginx" scheme="https://lijiabao9.github.io/tags/Nginx/"/>
    
    <category term="Xray" scheme="https://lijiabao9.github.io/tags/Xray/"/>
    
    <category term="VLESS" scheme="https://lijiabao9.github.io/tags/VLESS/"/>
    
    <category term="XTLS" scheme="https://lijiabao9.github.io/tags/XTLS/"/>
    
  </entry>
  
  <entry>
    <title>V2Ray 部署实战：从 VMess 裸奔到 Nginx+WebSocket+TLS 完美伪装</title>
    <link href="https://lijiabao9.github.io/posts/630f476f.html"/>
    <id>https://lijiabao9.github.io/posts/630f476f.html</id>
    <published>2025-12-09T17:19:57.000Z</published>
    <updated>2025-12-27T02:22:20.017Z</updated>
    
    <content type="html"><![CDATA[<p><strong>VMess</strong> 是 V2Ray 原创的加密传输协议。虽然现在有了更先进的 VLESS，但 VMess 凭借其成熟的生态，依然是目前最广泛使用的协议之一。</p><p>本文将带你一步步搭建最稳健的 <strong>VMess + WebSocket + TLS + Nginx</strong> 架构。</p><h2 id="一键安装-V2Fly-官方脚本"><a href="#一键安装-V2Fly-官方脚本" class="headerlink" title="一键安装 (V2Fly 官方脚本)"></a>一键安装 (V2Fly 官方脚本)</h2><p>使用官方提供的 FHS 规范脚本进行安装，文件路径标准，便于管理。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. 安装/更新 V2Ray</span></span><br><span class="line">bash &lt;(curl -L https://raw.githubusercontent.com/v2fly/fhs-install-v2ray/master/install-release.sh)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 设置开机自启，并启动服务</span></span><br><span class="line">systemctl <span class="built_in">enable</span> v2ray</span><br><span class="line">systemctl start v2ray</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 生成一个用户 UUID (复制备用)</span></span><br><span class="line">uuidgen</span><br></pre></td></tr></table></figure><p><em>常用命令备忘：</em></p><ul><li>仅更新 .dat 路由库：<code>bash &lt;(curl -L .../install-dat-release.sh)</code></li><li>卸载：<code>bash &lt;(curl -L .../install-release.sh) --remove</code></li></ul><hr><h2 id="第一阶段：基础部署-TCP直连"><a href="#第一阶段：基础部署-TCP直连" class="headerlink" title="第一阶段：基础部署 (TCP直连)"></a>第一阶段：基础部署 (TCP直连)</h2><p>此模式仅用于测试连通性，<strong>极易被墙</strong>，严禁长期使用。</p><h3 id="1-修改-V2Ray-配置"><a href="#1-修改-V2Ray-配置" class="headerlink" title="1. 修改 V2Ray 配置"></a>1. 修改 V2Ray 配置</h3><p>编辑配置文件：<code>vi /usr/local/etc/v2ray/config.json</code></p><figure class="highlight json"><figcaption><span>config.json</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;inbounds&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;port&quot;</span><span class="punctuation">:</span> <span class="number">2443</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;protocol&quot;</span><span class="punctuation">:</span> <span class="string">&quot;vmess&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;settings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;clients&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">          <span class="punctuation">&#123;</span> <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;你的UUID&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;alterId&quot;</span><span class="punctuation">:</span> <span class="number">0</span> <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">]</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;outbounds&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span> <span class="punctuation">&#123;</span> <span class="attr">&quot;protocol&quot;</span><span class="punctuation">:</span> <span class="string">&quot;freedom&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;settings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span> <span class="punctuation">&#125;</span> <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><div class="note info flat"><p><strong>关于 alterId</strong>：<br>新版 V2Ray 默认启用了 <strong>AEAD</strong> aead 验证机制，<code>alterId</code> 只需设置为 <code>0</code> 即可。这大大降低了服务器负载并提高了安全性。</p></div><p>启动服务：<code>systemctl restart v2ray</code></p><h3 id="2-客户端配置"><a href="#2-客户端配置" class="headerlink" title="2. 客户端配置"></a>2. 客户端配置</h3><p>在 v2rayN / Shadowrocket / Clash 等客户端中填入以下信息：</p><ul><li><strong>地址 (Address)</strong>: 你的域名或者 IP 地址</li><li><strong>端口 (Port)</strong>: <code>port</code></li><li><strong>用户 ID (UUID)</strong>: <code>你的UUID</code></li><li><strong>额外 ID (AlterId)</strong>: <code>0</code></li><li><strong>加密方式 (Security)</strong>: <code>auto</code></li><li><strong>传输协议 (Network)</strong>: <code>tcp</code></li></ul><hr><h2 id="第二阶段：进阶伪装-VMess-WS-TLS"><a href="#第二阶段：进阶伪装-VMess-WS-TLS" class="headerlink" title="第二阶段：进阶伪装 (VMess + WS + TLS)"></a>第二阶段：进阶伪装 (VMess + WS + TLS)</h2><p>为了抵抗流量识别，我们引入 <strong>WebSocket (WS)</strong> 来模拟网页浏览流量，并套上 <strong>TLS</strong> 加密。</p><h3 id="1-准备证书"><a href="#1-准备证书" class="headerlink" title="1. 准备证书"></a>1. 准备证书</h3><p>请确保你已经申请了证书（参考 <a href="/posts/e94f4538.html">从零开始：域名购买、Cloudflare 托管与 Nginx 自动化 HTTPS 配置全指南</a>）。<br>假设证书路径为：<code>/cert/acme_131495.xyz/cert.pem</code> 和 <code>/cert/acme_131495.xyz/key.pem</code>。</p><h3 id="2-修改-V2Ray-配置"><a href="#2-修改-V2Ray-配置" class="headerlink" title="2. 修改 V2Ray 配置"></a>2. 修改 V2Ray 配置</h3><p>修改 <code>config.json</code>，在 <code>inbounds</code> 中增加 <code>streamSettings</code>：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;inbounds&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;port&quot;</span><span class="punctuation">:</span> <span class="number">2443</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;protocol&quot;</span><span class="punctuation">:</span> <span class="string">&quot;vmess&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;settings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;clients&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">          <span class="punctuation">&#123;</span> <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;你的UUID&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;alterId&quot;</span><span class="punctuation">:</span> <span class="number">0</span> <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">]</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;streamSettings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;network&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ws&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;security&quot;</span><span class="punctuation">:</span> <span class="string">&quot;tls&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;tlsSettings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;certificates&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">            <span class="punctuation">&#123;</span></span><br><span class="line">              <span class="attr">&quot;certificateFile&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/cert/acme_131495.xyz/cert.pem&quot;</span><span class="punctuation">,</span></span><br><span class="line">              <span class="attr">&quot;keyFile&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/cert/acme_131495.xyz/key.pem&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">          <span class="punctuation">]</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;outbounds&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span> <span class="punctuation">&#123;</span> <span class="attr">&quot;protocol&quot;</span><span class="punctuation">:</span> <span class="string">&quot;freedom&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;settings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span> <span class="punctuation">&#125;</span> <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><div class="note warning flat"><p><strong>权限陷阱 (Permission Denied)</strong>：<br>默认情况下，V2Ray 以 <code>nobody</code> 用户运行，无法读取 <code>/root/</code> 或 <code>/cert/</code> 目录下的证书文件。</p><p><strong>解决方案</strong>：修改服务运行用户为 root。<br>执行 <code>systemctl edit v2ray</code>，填入以下内容：</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[Service]</span></span><br><span class="line"><span class="attr">User</span>=root</span><br><span class="line"><span class="attr">Group</span>=root</span><br></pre></td></tr></table></figure><p><code>Ctrl + O</code>，<code>Enter</code>，<code>Ctrl + X</code> 保存退出后，执行 <code>systemctl restart v2ray</code>。</p></div><h3 id="3-客户端配置"><a href="#3-客户端配置" class="headerlink" title="3. 客户端配置"></a>3. 客户端配置</h3><p>在 v2rayN / Shadowrocket / Clash 等客户端中填入以下信息：</p><ul><li><strong>地址 (Address)</strong>: 你的域名或者 IP 地址</li><li><strong>端口 (Port)</strong>: <code>port</code></li><li><strong>用户 ID (UUID)</strong>: <code>你的UUID</code></li><li><strong>额外 ID (AlterId)</strong>: <code>0</code></li><li><strong>加密方式 (Security)</strong>: <code>zero</code>（注意：启用了 tls 加密，无需再加密）</li><li><strong>传输协议 (Network)</strong>: <code>ws</code>（注意，改为了 ws）</li><li><strong>传输层安全 (TLS)</strong>: <code>tls</code> (开启)</li><li><strong>SNI</strong>: 如果 <em>地址</em> 填写的是域名，则此处不用填写</li></ul><hr><h2 id="第三阶段：终极方案-Nginx-反代"><a href="#第三阶段：终极方案-Nginx-反代" class="headerlink" title="第三阶段：终极方案 (Nginx 反代)"></a>第三阶段：终极方案 (Nginx 反代)</h2><p>这是生产环境的最佳实践。</p><ul><li><strong>分流</strong>：Nginx 处理 443 端口流量，正常的访问返回伪装网页，<code>/vmess</code> 路径的流量转发给 V2Ray。</li><li><strong>解耦</strong>：TLS 加密解密交给专业的 Nginx，V2Ray 只负责处理明文 WS 流量。</li></ul><h3 id="1-修改-V2Ray-配置-1"><a href="#1-修改-V2Ray-配置-1" class="headerlink" title="1. 修改 V2Ray 配置"></a>1. 修改 V2Ray 配置</h3><p><strong>注意</strong>：</p><ol><li>去掉 TLS 配置（交给 Nginx 了）。</li><li>监听 <code>127.0.0.1</code>（不暴露在公网，更安全）。</li><li>增加 <code>path</code> 路径验证。</li></ol><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;inbounds&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;listen&quot;</span><span class="punctuation">:</span> <span class="string">&quot;127.0.0.1&quot;</span><span class="punctuation">,</span> </span><br><span class="line">      <span class="attr">&quot;port&quot;</span><span class="punctuation">:</span> <span class="number">2443</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;protocol&quot;</span><span class="punctuation">:</span> <span class="string">&quot;vmess&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;settings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;clients&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">          <span class="punctuation">&#123;</span> <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;你的UUID&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;alterId&quot;</span><span class="punctuation">:</span> <span class="number">0</span> <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">]</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;streamSettings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;network&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ws&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;wsSettings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;path&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/ray&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;outbounds&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span> <span class="punctuation">&#123;</span> <span class="attr">&quot;protocol&quot;</span><span class="punctuation">:</span> <span class="string">&quot;freedom&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;settings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span> <span class="punctuation">&#125;</span> <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="2-配置-Nginx-反向代理"><a href="#2-配置-Nginx-反向代理" class="headerlink" title="2. 配置 Nginx 反向代理"></a>2. 配置 Nginx 反向代理</h3><p>创建 Nginx 配置文件：<code>vi /etc/nginx/sites-available/gfw.131495.xyz</code></p><figure class="highlight nginx"><figcaption><span>/etc/nginx/sites-available/gfw.131495.xyz</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line">    <span class="attribute">listen</span> [::]:<span class="number">80</span>;</span><br><span class="line">    <span class="attribute">server_name</span> gfw.<span class="number">131495</span>.xyz;</span><br><span class="line">    <span class="attribute">return</span> <span class="number">301</span> https://<span class="variable">$host</span><span class="variable">$request_uri</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">443</span> ssl;</span><br><span class="line">    <span class="attribute">listen</span> [::]:<span class="number">443</span> ssl;</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># <span class="doctag">TODO:</span> 修改为对应的子域名</span></span><br><span class="line">    <span class="attribute">server_name</span> gfw.<span class="number">131495</span>.xyz;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># <span class="doctag">TODO:</span> 独立的日志配置</span></span><br><span class="line">    <span class="attribute">access_log</span> /var/log/nginx/gfw.access.log proxy_json;</span><br><span class="line">    <span class="attribute">error_log</span> /var/log/nginx/gfw.<span class="literal">error</span>.log;</span><br><span class="line"> </span><br><span class="line">    <span class="comment"># 证书配置</span></span><br><span class="line">    <span class="attribute">ssl_certificate</span> /cert/acme_131495.xyz/cert.pem;</span><br><span class="line">    <span class="attribute">ssl_certificate_key</span> /cert/acme_131495.xyz/key.pem;</span><br><span class="line">    <span class="attribute">ssl_ciphers</span> HIGH:!aNULL:!MD5;</span><br><span class="line">       </span><br><span class="line">    <span class="comment"># 默认代理（防止探测）</span></span><br><span class="line">    <span class="section">location</span> / &#123;</span><br><span class="line">        <span class="attribute">proxy_pass</span> https://www.bing.com;</span><br><span class="line">        <span class="attribute">proxy_ssl_server_name</span> <span class="literal">on</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> Host www.bing.com;</span><br><span class="line">        <span class="attribute">proxy_ssl_protocols</span> TLSv1.<span class="number">2</span> TLSv1.<span class="number">3</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 反向代理设置</span></span><br><span class="line">    <span class="section">location</span> /ray &#123;</span><br><span class="line">        <span class="comment"># <span class="doctag">TODO:</span> 修改为实际的服务地址</span></span><br><span class="line">        <span class="attribute">proxy_pass</span> http://127.0.0.1:2443;</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Websocket 代理参数</span></span><br><span class="line">        <span class="attribute">proxy_http_version</span> <span class="number">1</span>.<span class="number">1</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> Upgrade <span class="variable">$http_upgrade</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> Connection <span class="string">&quot;upgrade&quot;</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="attribute">proxy_set_header</span> Host <span class="variable">$host</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> X-Real-IP <span class="variable">$remote_addr</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>重启 Nginx 和 V2Ray：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 还原之前的 systemctl edit 修改，推荐用普通用户运行</span></span><br><span class="line">systemctl revert v2ray</span><br><span class="line"></span><br><span class="line">systemctl restart v2ray</span><br><span class="line">systemctl reload nginx</span><br></pre></td></tr></table></figure><h3 id="3-客户端配置-1"><a href="#3-客户端配置-1" class="headerlink" title="3. 客户端配置"></a>3. 客户端配置</h3><p>在 v2rayN / Shadowrocket / Clash 等客户端中填入以下信息：</p><ul><li><strong>地址 (Address)</strong>: 你的域名或者 IP 地址</li><li><strong>端口 (Port)</strong>: <code>443</code>（注意：改成了 443）</li><li><strong>用户 ID (UUID)</strong>: <code>你的UUID</code></li><li><strong>额外 ID (AlterId)</strong>: <code>0</code></li><li><strong>加密方式 (Security)</strong>: <code>zero</code></li><li><strong>传输协议 (Network)</strong>: <code>ws</code></li><li><strong>伪装路径 (Path)</strong>: <code>/ray</code>（注意：增加路径）</li><li><strong>传输层安全 (TLS)</strong>: <code>tls</code></li><li><strong>SNI</strong>: 如果 <em>地址</em> 填写的是域名，则此处不用填写</li></ul><hr><p>至此，你的流量看起来就像是在访问一个普通的 HTTPS 网站，隐蔽性极高。</p>]]></content>
    
    
    <summary type="html">详解 V2Ray 的 VMess 协议部署流程。从最基础的 TCP 直连，进阶到 WebSocket 传输，最终实现基于 Nginx 反向代理的 TLS 加密与 Web 伪装。</summary>
    
    
    
    <category term="创意工坊" scheme="https://lijiabao9.github.io/categories/%E5%88%9B%E6%84%8F%E5%B7%A5%E5%9D%8A/"/>
    
    <category term="网络代理" scheme="https://lijiabao9.github.io/categories/%E5%88%9B%E6%84%8F%E5%B7%A5%E5%9D%8A/%E7%BD%91%E7%BB%9C%E4%BB%A3%E7%90%86/"/>
    
    
    <category term="Nginx" scheme="https://lijiabao9.github.io/tags/Nginx/"/>
    
    <category term="V2Ray" scheme="https://lijiabao9.github.io/tags/V2Ray/"/>
    
    <category term="VMess" scheme="https://lijiabao9.github.io/tags/VMess/"/>
    
    <category term="WebSocket" scheme="https://lijiabao9.github.io/tags/WebSocket/"/>
    
  </entry>
  
  <entry>
    <title>Trojan-Go 轻量部署指南：高效隐匿的 TLS 代理服务</title>
    <link href="https://lijiabao9.github.io/posts/1e76d4d4.html"/>
    <id>https://lijiabao9.github.io/posts/1e76d4d4.html</id>
    <published>2025-12-09T15:33:25.000Z</published>
    <updated>2025-12-27T02:22:20.017Z</updated>
    
    <content type="html"><![CDATA[<p><a href="https://github.com/p4gefau1t/trojan-go">Trojan-Go</a> 是 Trojan 协议的一个 Go 语言实现版本，性能强劲且支持多路复用。<br>它的核心逻辑是：<strong>看起来就像一个正常的 HTTPS 网站</strong>。</p><ul><li>如果是正常的 HTTPS 请求（无密码），它会转发到伪装网站（如 Bing）。</li><li>如果是合法的 Trojan 请求（有密码），它会进行代理转发。</li></ul><hr><h2 id="一、下载与安装"><a href="#一、下载与安装" class="headerlink" title="一、下载与安装"></a>一、下载与安装</h2><h3 id="1-确认-CPU-架构"><a href="#1-确认-CPU-架构" class="headerlink" title="1. 确认 CPU 架构"></a>1. 确认 CPU 架构</h3><p>在下载前，请先确认服务器的架构，否则会报错 <code>Exec format error</code>。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">uname</span> -m</span><br></pre></td></tr></table></figure><ul><li>如果输出 <code>x86_64</code>：请下载 <code>linux-amd64.zip</code></li><li>如果输出 <code>aarch64</code>：请下载 <code>linux-armv8.zip</code> (Oracle ARM 机器选这个)</li></ul><h3 id="2-下载二进制文件"><a href="#2-下载二进制文件" class="headerlink" title="2. 下载二进制文件"></a>2. 下载二进制文件</h3><p>以下以 <strong>ARM 架构</strong> 为例（GitHub 最新版）：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建目录</span></span><br><span class="line"><span class="built_in">mkdir</span> -p /app/trojan-go</span><br><span class="line"><span class="built_in">cd</span> /app/trojan-go/</span><br><span class="line"></span><br><span class="line"><span class="comment"># 下载 (请根据上一步结果替换链接中的 linux-armv8 或 linux-amd64)</span></span><br><span class="line">wget https://github.com/p4gefau1t/trojan-go/releases/download/v0.10.6/trojan-go-linux-armv8.zip</span><br><span class="line"><span class="comment"># 解压</span></span><br><span class="line">apt install unzip -y</span><br><span class="line">unzip trojan-go-linux-armv8.zip</span><br><span class="line"></span><br><span class="line"><span class="comment"># 清理压缩包</span></span><br><span class="line"><span class="built_in">rm</span> -f trojan-go-linux-armv8.zip</span><br></pre></td></tr></table></figure><hr><h2 id="二、配置服务"><a href="#二、配置服务" class="headerlink" title="二、配置服务"></a>二、配置服务</h2><h3 id="1-生成强密码"><a href="#1-生成强密码" class="headerlink" title="1. 生成强密码"></a>1. 生成强密码</h3><p>Trojan 协议依赖密码进行认证，建议生成一个复杂的 Base64 字符串。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl rand -<span class="built_in">base64</span> 32 | <span class="built_in">tr</span> <span class="string">&#x27;+/&#x27;</span> <span class="string">&#x27;-_&#x27;</span> | <span class="built_in">tr</span> -d <span class="string">&#x27;=&#x27;</span></span><br></pre></td></tr></table></figure><p><em>复制输出的字符串备用。</em></p><h3 id="2-编写配置文件"><a href="#2-编写配置文件" class="headerlink" title="2. 编写配置文件"></a>2. 编写配置文件</h3><blockquote><p>域名和证书的获取，可参考我的文章 <a href="/posts/e94f4538.html">从零开始：域名购买、Cloudflare 托管与 Nginx 自动化 HTTPS 配置全指南</a></p></blockquote><p>创建或编辑配置文件：<code>vi /app/trojan-go/config.json</code></p><figure class="highlight json"><figcaption><span>config.json</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;run_type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;server&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;local_addr&quot;</span><span class="punctuation">:</span> <span class="string">&quot;0.0.0.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;local_port&quot;</span><span class="punctuation">:</span> <span class="number">2443</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;remote_addr&quot;</span><span class="punctuation">:</span> <span class="string">&quot;127.0.0.1&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;remote_port&quot;</span><span class="punctuation">:</span> <span class="number">80</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;password&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="string">&quot;此处填入上面生成的密码&quot;</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;ssl&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;cert&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/cert/acme_131495.xyz/cert.pem&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;key&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/cert/acme_131495.xyz/key.pem&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;sni&quot;</span><span class="punctuation">:</span> <span class="string">&quot;gfw.131495.xyz&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;fallback_port&quot;</span><span class="punctuation">:</span> <span class="number">443</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p><strong>配置详解：</strong></p><ul><li><code>local_port</code>: <strong>2443</strong>。Trojan-Go 监听的端口，客户端连接这个端口。</li><li><code>remote_addr</code>: <strong>回落地址</strong>。当有人探测你的端口或直接浏览器访问时，Trojan 会将流量转发到此，伪装成你在反向代理。</li><li><code>ssl</code>: 必须指定有效的证书路径。</li><li><code>sni</code>: 你的域名。</li></ul><hr><h2 id="三、Systemd-服务化管理"><a href="#三、Systemd-服务化管理" class="headerlink" title="三、Systemd 服务化管理"></a>三、Systemd 服务化管理</h2><p>手动运行 <code>./trojan-go</code> 会占用终端，且无法开机自启。我们需要将其注册为系统服务。</p><h3 id="1-创建-Service-文件"><a href="#1-创建-Service-文件" class="headerlink" title="1. 创建 Service 文件"></a>1. 创建 Service 文件</h3><p>新建文件：<code>vi /etc/systemd/system/trojan-go.service</code></p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[Unit]</span></span><br><span class="line"><span class="attr">Description</span>=Trojan-Go - An unidentifiable mechanism that helps you bypass GFW</span><br><span class="line"><span class="attr">Documentation</span>=https://p4gefau1t.github.io/trojan-go</span><br><span class="line"><span class="attr">After</span>=network.target nss-lookup.target</span><br><span class="line"></span><br><span class="line"><span class="section">[Service]</span></span><br><span class="line"><span class="attr">User</span>=root</span><br><span class="line"><span class="comment"># 启动命令</span></span><br><span class="line"><span class="attr">ExecStart</span>=/app/trojan-go/trojan-go -config /app/trojan-go/config.json</span><br><span class="line"><span class="attr">Restart</span>=<span class="literal">on</span>-failure</span><br><span class="line"><span class="attr">RestartSec</span>=<span class="number">10</span>s</span><br><span class="line"><span class="attr">LimitNOFILE</span>=infinity</span><br><span class="line"></span><br><span class="line"><span class="section">[Install]</span></span><br><span class="line"><span class="attr">WantedBy</span>=multi-user.target</span><br></pre></td></tr></table></figure><h3 id="2-启动并设置开机自启"><a href="#2-启动并设置开机自启" class="headerlink" title="2. 启动并设置开机自启"></a>2. 启动并设置开机自启</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 重载系统服务配置</span></span><br><span class="line">systemctl daemon-reload</span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动服务</span></span><br><span class="line">systemctl start trojan-go</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置开机自启</span></span><br><span class="line">systemctl <span class="built_in">enable</span> trojan-go</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看运行状态</span></span><br><span class="line">systemctl status trojan-go</span><br></pre></td></tr></table></figure><p>如果状态显示 <span class='p green'>Active: active (running)</span>，说明启动成功。</p><hr><h2 id="四、客户端连接"><a href="#四、客户端连接" class="headerlink" title="四、客户端连接"></a>四、客户端连接</h2><p>配置客户端（<strong>v2rayN</strong>, Clash 等）时，填入以下信息：</p><ul><li><strong>类型 (Type)</strong>: Trojan</li><li><strong>地址 (Address)</strong>: <code>gfw.131495.xyz</code> (你的域名)</li><li><strong>端口 (Port)</strong>: <code>2443</code> (配置中的 local_port)</li><li><strong>密码 (Password)</strong>: 你生成的密码</li><li><strong>传输层协议</strong>: <code>tcp</code></li><li><strong>传输层安全</strong>: <code>tls</code></li></ul><div class="note warning flat"><p><strong>防火墙提醒：</strong><br>别忘了在云服务器的安全组或 UFW 中放行 <strong>2443</strong> 端口！<br><code>ufw allow 2443/tcp</code></p></div>]]></content>
    
    
    <summary type="html">详解如何在 Linux (ARM/AMD) 环境下部署 Trojan-Go 服务。包含二进制文件安装、Config 配置详解、以及通过 Systemd 实现服务自启与守护管理。</summary>
    
    
    
    <category term="创意工坊" scheme="https://lijiabao9.github.io/categories/%E5%88%9B%E6%84%8F%E5%B7%A5%E5%9D%8A/"/>
    
    <category term="网络代理" scheme="https://lijiabao9.github.io/categories/%E5%88%9B%E6%84%8F%E5%B7%A5%E5%9D%8A/%E7%BD%91%E7%BB%9C%E4%BB%A3%E7%90%86/"/>
    
    
    <category term="Trojan-Go" scheme="https://lijiabao9.github.io/tags/Trojan-Go/"/>
    
    <category term="SSL/TLS" scheme="https://lijiabao9.github.io/tags/SSL-TLS/"/>
    
  </entry>
  
  <entry>
    <title>Shadowsocks-libev 部署全指南：从裸奔到 Nginx + TLS + WebSocket 完美伪装</title>
    <link href="https://lijiabao9.github.io/posts/ba9f85ec.html"/>
    <id>https://lijiabao9.github.io/posts/ba9f85ec.html</id>
    <published>2025-12-08T16:23:49.000Z</published>
    <updated>2025-12-27T02:22:20.017Z</updated>
    
    <content type="html"><![CDATA[<p><strong>Shadowsocks (SS)</strong> 是一种基于轻量级对称加密的代理协议。</p><ul><li><strong>优点</strong>：资源占用极低，配置简单，适合低性能机器。</li><li><strong>缺点</strong>：在没有任何伪装的情况下，其流量特征非常明显，极易被防火墙（GFW）识别并阻断。</li></ul><p>本文将由浅入深，介绍如何部署 SS，并一步步为其穿上“隐身衣”。</p><h2 id="第一阶段：基础部署-裸奔模式"><a href="#第一阶段：基础部署-裸奔模式" class="headerlink" title="第一阶段：基础部署 (裸奔模式)"></a>第一阶段：基础部署 (裸奔模式)</h2><p>此模式仅具备加密传输功能，无伪装，容易被墙，仅建议用于中转或内网环境。</p><h3 id="1-安装服务"><a href="#1-安装服务" class="headerlink" title="1. 安装服务"></a>1. 安装服务</h3><p>Ubuntu 官方仓库已收录 <code>libev</code> 版本，直接安装即可：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">apt update</span><br><span class="line">apt install shadowsocks-libev</span><br></pre></td></tr></table></figure><h3 id="2-生成高强度密钥"><a href="#2-生成高强度密钥" class="headerlink" title="2. 生成高强度密钥"></a>2. 生成高强度密钥</h3><p>SS 的新加密算法（如 <code>chacha20-ietf-poly1305</code>）需要 base64 编码的 32 字节密钥。直接使用字符串密码会报错。</p><p>执行以下命令生成密钥，并复制输出结果：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl rand -<span class="built_in">base64</span> 32 | <span class="built_in">tr</span> <span class="string">&#x27;+/&#x27;</span> <span class="string">&#x27;-_&#x27;</span> | <span class="built_in">tr</span> -d <span class="string">&#x27;=&#x27;</span></span><br></pre></td></tr></table></figure><h3 id="3-修改配置"><a href="#3-修改配置" class="headerlink" title="3. 修改配置"></a>3. 修改配置</h3><p>编辑配置文件：<code>vi /etc/shadowsocks-libev/config.json</code></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;server&quot;</span><span class="punctuation">:</span> <span class="string">&quot;0.0.0.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;mode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;tcp_and_udp&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;server_port&quot;</span><span class="punctuation">:</span> <span class="number">8388</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;local_port&quot;</span><span class="punctuation">:</span> <span class="number">1080</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;password&quot;</span><span class="punctuation">:</span> <span class="string">&quot;此处填写上面生成的Base64密钥&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;timeout&quot;</span><span class="punctuation">:</span> <span class="number">86400</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;method&quot;</span><span class="punctuation">:</span> <span class="string">&quot;chacha20-ietf-poly1305&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="4-启动服务"><a href="#4-启动服务" class="headerlink" title="4. 启动服务"></a>4. 启动服务</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart shadowsocks-libev</span><br></pre></td></tr></table></figure><hr><h2 id="第二阶段：流量伪装-v2ray-plugin"><a href="#第二阶段：流量伪装-v2ray-plugin" class="headerlink" title="第二阶段：流量伪装 (v2ray-plugin)"></a>第二阶段：流量伪装 (v2ray-plugin)</h2><p>为了对抗流量识别，我们需要引入插件，将 SS 流量伪装成普通的 HTTP 或 HTTPS 流量。<br>这里使用官方推荐的 <strong>v2ray-plugin</strong>。</p><h3 id="1-安装插件"><a href="#1-安装插件" class="headerlink" title="1. 安装插件"></a>1. 安装插件</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt install shadowsocks-v2ray-plugin</span><br></pre></td></tr></table></figure><p><em>注：安装后插件二进制文件通常位于 <code>/usr/bin/ss-v2ray-plugin</code>。</em></p><h3 id="2-Windows-客户端准备-关键"><a href="#2-Windows-客户端准备-关键" class="headerlink" title="2. Windows 客户端准备 (关键)"></a>2. Windows 客户端准备 (关键)</h3><p>在电脑端使用插件模式，需要手动下载插件程序。</p><ol><li>下载 <a href="https://github.com/shadowsocks/v2ray-plugin/releases">v2ray-plugin-windows-amd64</a>。</li><li>解压并将文件名修改为 <strong>v2ray-plugin.exe</strong>。</li><li>将该文件放入 Shadowsocks 客户端（Shadowsocks.exe）的同级目录下。</li></ol><h3 id="模式-A：HTTP-伪装-简单"><a href="#模式-A：HTTP-伪装-简单" class="headerlink" title="模式 A：HTTP 伪装 (简单)"></a>模式 A：HTTP 伪装 (简单)</h3><p>仅进行 HTTP 混淆，没有 TLS 加密，依然可能被探测。</p><p><strong>服务端配置：</strong></p><figure class="highlight json"><figcaption><span>/etc/shadowsocks-libev/config.json</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;server&quot;</span><span class="punctuation">:</span> <span class="string">&quot;0.0.0.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;server_port&quot;</span><span class="punctuation">:</span> <span class="number">8388</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;password&quot;</span><span class="punctuation">:</span> <span class="string">&quot;你的密钥&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;method&quot;</span><span class="punctuation">:</span> <span class="string">&quot;chacha20-ietf-poly1305&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;plugin&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ss-v2ray-plugin&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;plugin_opts&quot;</span><span class="punctuation">:</span> <span class="string">&quot;server&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p><strong>客户端配置：</strong></p><ul><li><strong>插件程序</strong>：<code>v2ray-plugin.exe</code></li><li><strong>插件选项</strong>：留空</li></ul><h3 id="模式-B：HTTPS-TLS-伪装-直连"><a href="#模式-B：HTTPS-TLS-伪装-直连" class="headerlink" title="模式 B：HTTPS/TLS 伪装 (直连)"></a>模式 B：HTTPS/TLS 伪装 (直连)</h3><p>由 SS 服务直接加载证书，处理 TLS。</p><blockquote><p>域名和证书的获取，可参考我的文章 <a href="/posts/e94f4538.html">从零开始：域名购买、Cloudflare 托管与 Nginx 自动化 HTTPS 配置全指南</a></p></blockquote><p><strong>服务端配置：</strong></p><figure class="highlight json"><figcaption><span>/etc/shadowsocks-libev/config.json</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;server&quot;</span><span class="punctuation">:</span> <span class="string">&quot;0.0.0.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;server_port&quot;</span><span class="punctuation">:</span> <span class="number">8388</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;password&quot;</span><span class="punctuation">:</span> <span class="string">&quot;你的密钥&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;method&quot;</span><span class="punctuation">:</span> <span class="string">&quot;chacha20-ietf-poly1305&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;plugin&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ss-v2ray-plugin&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;plugin_opts&quot;</span><span class="punctuation">:</span> <span class="string">&quot;server;tls;host=gfw.131495.xyz;cert=/cert/acme_131495.xyz/cert.pem;key=/cert/acme_131495.xyz/key.pem&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><div class="note warning flat"><p><strong>权限陷阱</strong>：<br>SS 默认以 <code>shadowsocks</code> 用户运行，而证书文件（尤其是 acme.sh 生成的 key）通常只有 root 或特定组有权限读取，导致启动失败 <code>permission denied</code>。</p><p><strong>解决方案</strong>：修改服务以 root 身份运行。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl edit shadowsocks-libev</span><br></pre></td></tr></table></figure><p>在编辑器中填入：</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[Service]</span></span><br><span class="line"><span class="attr">DynamicUser</span>=<span class="literal">false</span></span><br><span class="line"><span class="attr">User</span>=root</span><br><span class="line"><span class="attr">Group</span>=root</span><br></pre></td></tr></table></figure><p>保存后重启服务。(<code>Ctrl + o</code> 保存，<code>Enter</code> 确认保存，<code>Ctrl + x</code> 退出)</p></div><hr><h2 id="第三阶段：终极方案-Nginx-反代-WebSocket-TLS"><a href="#第三阶段：终极方案-Nginx-反代-WebSocket-TLS" class="headerlink" title="第三阶段：终极方案 (Nginx 反代 + WebSocket + TLS)"></a>第三阶段：终极方案 (Nginx 反代 + WebSocket + TLS)</h2><p>这是目前最稳健的方案。</p><ul><li><strong>隐蔽性高</strong>：SS 躲在 Nginx 后面，对外只暴露 443 端口，看起来就像一个正常的网站。</li><li><strong>CDN 兼容</strong>：支持套 Cloudflare CDN。</li><li><strong>安全性好</strong>：SS 监听本地回环地址，不直接暴露在公网。</li></ul><h3 id="1-修改-SS-配置"><a href="#1-修改-SS-配置" class="headerlink" title="1. 修改 SS 配置"></a>1. 修改 SS 配置</h3><p><strong>注意</strong>：将 <code>server</code> 改为 <code>127.0.0.1</code>，仅允许本机访问。</p><p><code>vi /etc/shadowsocks-libev/config.json</code></p><figure class="highlight json"><figcaption><span>/etc/shadowsocks-libev/config.json</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;server&quot;</span><span class="punctuation">:</span> <span class="string">&quot;127.0.0.1&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;mode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;tcp_and_udp&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;server_port&quot;</span><span class="punctuation">:</span> <span class="number">8388</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;password&quot;</span><span class="punctuation">:</span> <span class="string">&quot;你的密钥&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;method&quot;</span><span class="punctuation">:</span> <span class="string">&quot;chacha20-ietf-poly1305&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;plugin&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ss-v2ray-plugin&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;plugin_opts&quot;</span><span class="punctuation">:</span> <span class="string">&quot;server;host=gfw.131495.xyz;path=/ray&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p><em>配置解释：SS 监听本机的 8388 端口，等待 Nginx 转发过来的 <code>/ray</code> 路径的流量。</em></p><p>重启 SS 服务：(记得先还原之前的 systemctl edit 修改，推荐用普通用户运行)</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl revert shadowsocks-libev</span><br><span class="line">systemctl restart shadowsocks-libev</span><br></pre></td></tr></table></figure><h3 id="2-配置-Nginx-反向代理"><a href="#2-配置-Nginx-反向代理" class="headerlink" title="2. 配置 Nginx 反向代理"></a>2. 配置 Nginx 反向代理</h3><p>创建 Nginx 配置文件：<code>vi /etc/nginx/sites-available/gfw.131495.xyz</code></p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line">    <span class="attribute">listen</span> [::]:<span class="number">80</span>;</span><br><span class="line">    <span class="attribute">server_name</span> gfw.<span class="number">131495</span>.xyz;</span><br><span class="line">    <span class="attribute">return</span> <span class="number">301</span> https://<span class="variable">$host</span><span class="variable">$request_uri</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">443</span> ssl;</span><br><span class="line">    <span class="attribute">listen</span> [::]:<span class="number">443</span> ssl;</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># <span class="doctag">TODO:</span> 修改为对应的子域名</span></span><br><span class="line">    <span class="attribute">server_name</span> gfw.<span class="number">131495</span>.xyz;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># <span class="doctag">TODO:</span> 独立的日志配置</span></span><br><span class="line">    <span class="attribute">access_log</span> /var/log/nginx/gfw.access.log proxy_json;</span><br><span class="line">    <span class="attribute">error_log</span> /var/log/nginx/gfw.<span class="literal">error</span>.log;</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 证书配置</span></span><br><span class="line">    <span class="attribute">ssl_certificate</span> /cert/acme_131495.xyz/cert.pem;</span><br><span class="line">    <span class="attribute">ssl_certificate_key</span> /cert/acme_131495.xyz/key.pem;</span><br><span class="line">    <span class="attribute">ssl_ciphers</span> HIGH:!aNULL:!MD5;</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 默认代理（防止探测）</span></span><br><span class="line">    <span class="section">location</span> / &#123;</span><br><span class="line">        <span class="attribute">proxy_pass</span> https://www.bing.com;</span><br><span class="line">        <span class="attribute">proxy_ssl_server_name</span> <span class="literal">on</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> Host www.bing.com;</span><br><span class="line">        <span class="attribute">proxy_ssl_protocols</span> TLSv1.<span class="number">2</span> TLSv1.<span class="number">3</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 反向代理设置</span></span><br><span class="line">    <span class="section">location</span> /ray &#123;</span><br><span class="line">        <span class="comment"># <span class="doctag">TODO:</span> 修改为实际的服务地址</span></span><br><span class="line">        <span class="attribute">proxy_pass</span> http://127.0.0.1:8388;</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Websocket 代理参数</span></span><br><span class="line">        <span class="attribute">proxy_http_version</span> <span class="number">1</span>.<span class="number">1</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> Upgrade <span class="variable">$http_upgrade</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> Connection <span class="string">&quot;upgrade&quot;</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="attribute">proxy_set_header</span> Host <span class="variable">$host</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> X-Real-IP <span class="variable">$remote_addr</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-生效与验证"><a href="#3-生效与验证" class="headerlink" title="3. 生效与验证"></a>3. 生效与验证</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ln</span> -s /etc/nginx/sites-available/gfw.131495.xyz /etc/nginx/sites-enabled/</span><br><span class="line">nginx -t</span><br><span class="line">systemctl reload nginx</span><br></pre></td></tr></table></figure><h3 id="4-客户端配置-终极版"><a href="#4-客户端配置-终极版" class="headerlink" title="4. 客户端配置 (终极版)"></a>4. 客户端配置 (终极版)</h3><p>在 Windows/Android/iOS 客户端中：</p><ul><li><strong>服务器地址</strong>：<code>gfw.131495.xyz</code> (你的域名)</li><li><strong>端口</strong>：<code>443</code> (Nginx 的端口)</li><li><strong>密码</strong>：<code>你的密钥</code></li><li><strong>加密</strong>：<code>chacha20-ietf-poly1305</code></li><li><strong>插件程序</strong>：<code>v2ray-plugin</code></li><li><strong>插件选项</strong>：<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tls;host=gfw.131495.xyz;path=/ray</span><br></pre></td></tr></table></figure></li></ul><p>现在，你的流量看起来就像是在访问一个普通的 HTTPS 网站，极为隐蔽。</p>]]></content>
    
    
    <summary type="html">详解 Shadowsocks-libev 的安装与配置。从基础的 TCP/UDP 模式，到使用 v2ray-plugin 进行流量伪装，最终实现基于 Nginx 反向代理的 TLS + WebSocket 高级隐匿方案。</summary>
    
    
    
    <category term="创意工坊" scheme="https://lijiabao9.github.io/categories/%E5%88%9B%E6%84%8F%E5%B7%A5%E5%9D%8A/"/>
    
    <category term="网络代理" scheme="https://lijiabao9.github.io/categories/%E5%88%9B%E6%84%8F%E5%B7%A5%E5%9D%8A/%E7%BD%91%E7%BB%9C%E4%BB%A3%E7%90%86/"/>
    
    
    <category term="Nginx" scheme="https://lijiabao9.github.io/tags/Nginx/"/>
    
    <category term="Shadowsocks" scheme="https://lijiabao9.github.io/tags/Shadowsocks/"/>
    
    <category term="V2Ray-Plugin" scheme="https://lijiabao9.github.io/tags/V2Ray-Plugin/"/>
    
    <category term="科学上网" scheme="https://lijiabao9.github.io/tags/%E7%A7%91%E5%AD%A6%E4%B8%8A%E7%BD%91/"/>
    
  </entry>
  
  <entry>
    <title>Microsoft 365 E3 进阶指南：绑定自定义域名并配置企业级 SMTP 发信</title>
    <link href="https://lijiabao9.github.io/posts/57b282c7.html"/>
    <id>https://lijiabao9.github.io/posts/57b282c7.html</id>
    <published>2025-12-06T16:15:50.000Z</published>
    <updated>2025-12-27T02:22:20.019Z</updated>
    
    <content type="html"><![CDATA[<p>拥有了 Microsoft 365 E3 订阅后，我们不仅获得了 Office 全家桶，还解锁了企业级的 <strong>Exchange Online</strong> 服务。</p><p>相比于个人版 Outlook 或 Gmail，企业版 Exchange 允许我们绑定<strong>自定义域名</strong>（如 <code>admin@yourname.com</code>），并提供极高的发信权重。</p><p>本文将指导你将其配置为高送达率的 SMTP 服务，用于博客通知、Alist 消息推送等场景。</p><h2 id="第一步：域名绑定（推荐）"><a href="#第一步：域名绑定（推荐）" class="headerlink" title="第一步：域名绑定（推荐）"></a>第一步：域名绑定（推荐）</h2><h3 id="1-绑定自定义域名"><a href="#1-绑定自定义域名" class="headerlink" title="1. 绑定自定义域名"></a>1. 绑定自定义域名</h3><p>为了让发出的邮件看起来更专业（而不是显示 <code>xxx.onmicrosoft.com</code>），我们需要绑定自己的域名。</p><ol><li><p><strong>进入管理中心</strong>：<br>访问 <a href="https://admin.cloud.microsoft/">M365 Admin Center</a>，点击左侧导航栏的 <strong>Settings (设置)</strong> -&gt; <strong>Domains (域)</strong>。</p></li><li><p><strong>添加域名</strong>：<br>点击 <strong>Add domain</strong>，输入你购买的域名（如 <code>gabriel.edu.kg</code>）。</p></li><li><p><strong>验证域名</strong>：</p><ul><li><strong>自动验证 (推荐)</strong>：如果你的域名托管在 Cloudflare、GoDaddy 等主流平台，选择 “Sign in to…” 可自动添加 DNS 记录。</li><li><strong>手动验证</strong>：选择 “Add a TXT record”，将生成的 TXT 记录添加到你的 DNS 解析中。</li></ul></li><li><p><strong>配置服务记录</strong>：<br>验证通过后，系统会要求配置 Exchange 和其他服务的 DNS 记录。</p><ul><li>建议<strong>全选</strong> (Exchange, Skype, DKIM 等)。</li><li>（手动验证）按照提示在 DNS 服务商处添加生成的 <strong>MX</strong>, <strong>CNAME</strong>, <strong>TXT</strong> 记录。</li><li>待状态显示为 <span class='p green'>Healthy</span> 即为成功。</li></ul></li></ol><hr><h3 id="2-配置-DKIM-防止进垃圾箱-重要"><a href="#2-配置-DKIM-防止进垃圾箱-重要" class="headerlink" title="2. 配置 DKIM 防止进垃圾箱 (重要)"></a>2. 配置 DKIM 防止进垃圾箱 (重要)</h3><p>为了防止 Gmail、Outlook 等收件方将你的邮件标记为垃圾邮件，必须配置 <strong>DKIM (域名密钥识别邮件)</strong>。</p><ol><li><p><strong>访问 Defender 防护中心</strong>：<br><a href="https://security.microsoft.com/dkimv2">点击跳转 DKIM 配置页面</a></p></li><li><p><strong>启用 DKIM</strong>：</p><ul><li>在列表中点击你的<strong>自定义域名</strong>。</li><li>将 <strong>Sign messages for this domain with DKIM signatures</strong> 的滑块切换为 <strong>Enable (开启)</strong>。</li></ul></li><li><p><strong>添加 CNAME 记录</strong>：</p><ul><li>如果系统提示 “You need to create CNAME records…”，请按照提示在你的 DNS 服务商处添加 2 条 CNAME 记录。</li><li><em>记录名通常为 <code>selector1._domainkey</code> 格式。</em></li></ul></li><li><p><strong>再次启用</strong>：</p><ul><li>DNS 生效后（通常几分钟），回到此页面再次点击开启滑块。</li><li>直到状态显示为绿色的 <span class='p green'>Status: Enabled</span>。</li></ul></li></ol><hr><h2 id="第二步：创建专用发信账户"><a href="#第二步：创建专用发信账户" class="headerlink" title="第二步：创建专用发信账户"></a>第二步：创建专用发信账户</h2><h3 id="1-新建用户"><a href="#1-新建用户" class="headerlink" title="1. 新建用户"></a>1. 新建用户</h3><p>为了安全起见，<strong>不要直接使用全局管理员账号进行 SMTP 发信</strong>。建议创建一个权限受限的专用账户（Service Account）。</p><ol><li><p>访问 <a href="https://admin.cloud.microsoft/">M365 Admin Center</a>，点击 <strong>Users (用户)</strong> -&gt; <strong>Active users (活跃用户)</strong>。</p></li><li><p>点击 <strong>Add a user</strong>：</p><ul><li><strong>First/Last name</strong>: 随意（如 Notification Bot）。</li><li><strong>Username</strong>: 建议使用 <code>noreply</code> 或 <code>mailer</code>。</li><li><strong>Domain</strong>: 下拉选择刚才绑定的<strong>自定义域名</strong>。</li><li><strong>Password</strong>: 自动生成或手动设置，<span class='p red'>务必记下此密码，且后续不要修改</span>。</li><li><strong>Licenses</strong>: 必须勾选 <strong>Office 365 E3 Developer</strong> (否则没有 Exchange 邮箱功能)。</li></ul></li></ol><hr><h3 id="2-为用户开启-SMTP"><a href="#2-为用户开启-SMTP" class="headerlink" title="2. 为用户开启 SMTP"></a>2. 为用户开启 SMTP</h3><p>新创建的用户，默认可能未开启 SMTP 传输权限，需要手动启用。</p><ol><li><p>在用户列表中，点击刚才创建的 <code>noreply</code> 用户。</p></li><li><p>在右侧弹出的详情页中，切换到 <strong>Mail (邮件)</strong> 选项卡。</p></li><li><p>点击 <strong>Manage email apps (管理电子邮件应用)</strong> 链接。</p></li><li><p>勾选最底部的 <strong>Authenticated SMTP (经过身份验证的 SMTP)</strong>。</p></li><li><p>点击 <strong>Save changes</strong> 保存。</p></li></ol><div class="note warning flat"><p><strong>生效时间提示：</strong><br>微软全球服务器同步可能需要时间。此处的修改通常 <strong>15 ~ 60 分钟</strong> 后才会完全生效。如果配置完立即测试连接失败，请喝杯咖啡稍后再试。</p></div><hr><h2 id="方式一：配置-SMTP-发信"><a href="#方式一：配置-SMTP-发信" class="headerlink" title="方式一：配置 SMTP 发信"></a>方式一：配置 SMTP 发信</h2><h3 id="1-关闭安全默认值-关键"><a href="#1-关闭安全默认值-关键" class="headerlink" title="1. 关闭安全默认值 (关键)"></a>1. 关闭安全默认值 (关键)</h3><p>Microsoft Entra ID（原 Azure AD）默认的安全策略会 <strong>全局阻止 SMTP 基础认证</strong>（Legacy Authentication）。如果不关闭此选项，SMTP 握手将一直失败。</p><ol><li><p><strong>访问 Azure 门户</strong>：<br><a href="https://portal.azure.com/#view/Microsoft_AAD_IAM/ActiveDirectoryMenuBlade/~/Overview">点击跳转 Microsoft Entra ID 概览页</a></p></li><li><p><strong>登录账号</strong>：<br>使用你的 <strong>E3 全局管理员账号</strong>（<code>admin@xxxx.onmicrosoft.com</code>）登录。</p></li><li><p><strong>修改属性</strong>：<br>在上方菜单栏点击 <strong>Properties (属性)</strong>。</p></li><li><p><strong>管理安全默认值</strong>：<br>滚动到页面最底部，点击蓝色链接 <strong>Manage security defaults (管理安全默认值)</strong>。</p></li><li><p><strong>禁用策略</strong>：<br>在右侧弹出的面板中，将 <strong>Security defaults</strong> 切换为 <span class='p red'>Disabled (禁用)</span>。</p><ul><li><em>Reason for disabling</em>: 随意选择，例如 “Application requires legacy authentication”。</li><li>点击 <strong>Save</strong> 保存。</li></ul></li></ol><p><img src="https://cdn.jsdelivr.net/gh/lijiabao9/pic.cloud@main/hexo/post/20251207002143028.webp" alt=""></p><hr><h3 id="2-SMTP-配置参数速查"><a href="#2-SMTP-配置参数速查" class="headerlink" title="2. SMTP 配置参数速查"></a>2. SMTP 配置参数速查</h3><p>现在，你可以将以下信息填入 Artalk、WordPress、UptimeKuma 等服务的邮件通知配置中：</p><div class="table-container"><table><thead><tr><th style="text-align:left">配置项</th><th style="text-align:left">值</th><th style="text-align:left">说明</th></tr></thead><tbody><tr><td style="text-align:left"><strong>SMTP Host</strong></td><td style="text-align:left"><code>smtp.office365.com</code></td><td style="text-align:left">发信服务器地址</td></tr><tr><td style="text-align:left"><strong>SMTP Port</strong></td><td style="text-align:left"><code>587</code></td><td style="text-align:left">端口 (推荐)</td></tr><tr><td style="text-align:left"><strong>Encryption</strong></td><td style="text-align:left"><code>STARTTLS</code> 或 <code>TLS</code></td><td style="text-align:left">加密方式</td></tr><tr><td style="text-align:left"><strong>Username</strong></td><td style="text-align:left"><code>noreply@gabriel.edu.kg</code></td><td style="text-align:left">你的完整邮箱地址</td></tr><tr><td style="text-align:left"><strong>Password</strong></td><td style="text-align:left"><code>********</code></td><td style="text-align:left">该用户的登录密码</td></tr></tbody></table></div><hr><p>至此，一个高权重、高送达率且带有自定义域名的企业级 SMTP 服务就搭建完成了。</p><h2 id="方式二：配置-Azure-应用-OAuth2-凭证"><a href="#方式二：配置-Azure-应用-OAuth2-凭证" class="headerlink" title="方式二：配置 Azure 应用 (OAuth2 凭证)"></a>方式二：配置 Azure 应用 (OAuth2 凭证)</h2><p>如果你计划使用 <strong>Microsoft Graph API</strong> 发信（如 <strong>Apprise</strong>, LobeChat, Alist），或者第三方应用支持 OAuth2 登录，<br>你需要注册一个 Azure 应用来获取 <code>Client ID</code> 和 <code>Client Secret</code>。</p><h3 id="1-注册应用"><a href="#1-注册应用" class="headerlink" title="1. 注册应用"></a>1. 注册应用</h3><ol><li>访问 <a href="https://portal.azure.com/#view/Microsoft_AAD_IAM/ActiveDirectoryMenuBlade/~/RegisteredApps">Azure AD 应用注册页面</a>。</li><li>点击 <strong>New registration</strong>。</li><li><strong>Name</strong>: 填写应用名（如 <code>MailBot</code>），其他保持默认，点击 <strong>Register</strong>。</li><li>在 <strong>Overview (概览)</strong> 页，复制并保存：<span class='p red'>Application (client) ID</span>, <span class='p red'>Directory (tenant) ID</span></li></ol><h3 id="2-生成客户端密钥"><a href="#2-生成客户端密钥" class="headerlink" title="2. 生成客户端密钥"></a>2. <strong>生成客户端密钥</strong></h3><ol><li>点击左侧 <strong>Certificates &amp; secrets (证书和密码)</strong> -&gt; <strong>Client secrets</strong>。</li><li>点击 <strong>New client secret</strong>，设置过期时间（推荐 24 个月）。<blockquote><p><span class='p red'>务必立即复制 Value 字段</span>（刷新后将不可见）。<br><em>注：若密钥含特殊字符，使用前建议进行 URL Encode。</em></p></blockquote></li></ol><h3 id="3-配置-API-权限"><a href="#3-配置-API-权限" class="headerlink" title="3. 配置 API 权限"></a>3. <strong>配置 API 权限</strong></h3><ol><li>点击左侧 <strong>API permissions</strong> -&gt; <strong>Add a permission</strong> -&gt; <strong>Microsoft Graph</strong>。</li><li>选择 <strong>Application permissions</strong> (应用级权限)。</li><li>搜索并勾选 <strong>Mail.Send</strong>, <strong>Mail.ReadWrite</strong>，点击 <strong>Add permissions</strong>。</li><li>回到权限列表，状态栏会显示 “Not granted for…”， </li><li>点击列表上方的 <strong>Grant admin consent for &lt;组织名&gt;</strong> 按钮并确认。</li><li>看到状态变为绿色的 <span class='p green'>Granted</span> 即为配置成功。</li></ol><hr><p>至此，你已经拥有了 SMTP 和 API 两种强大的发信方式。</p><h2 id="推荐：配置-Catch-all-无限邮箱"><a href="#推荐：配置-Catch-all-无限邮箱" class="headerlink" title="推荐：配置 Catch-all 无限邮箱"></a>推荐：配置 Catch-all 无限邮箱</h2><p>除了基础发信，Exchange 还支持通过规则实现“无限别名”功能。<br>配置后，你可以随意编造邮箱地址（如 <code>test001@gabriel.edu.kg</code>）用于注册不受信任的网站，所有邮件都会自动转发到你的主邮箱。</p><ol><li><p><strong>访问 Exchange 管理中心</strong>：<br>点击跳转 <a href="https://admin.exchange.microsoft.com/">Exchange Admin Center</a>。</p></li><li><p><strong>修改域名类型</strong>：</p><ul><li>在左侧导航栏点击 <strong>Mail flow (邮件流)</strong> -&gt; <strong>Accepted domains (接受的域)</strong>。</li><li>点击你的主域名进入详情页。</li><li>将 <strong>This accepted domain is</strong> 选项从 <strong>Authoritative</strong> 切换为 <span class='p red'>Internal relay (内部中继)</span>。</li><li>点击 <strong>Save</strong> 保存。</li></ul></li><li><p><strong>创建转发规则</strong>：</p><ul><li>点击左侧导航栏 <strong>Mail flow (邮件流)</strong> -&gt; <strong>Rules (规则)</strong>。</li><li>点击 <strong>Add a rule</strong> -&gt; <strong>Create a new rule</strong>。</li><li><strong>Name</strong>: 随意填写，比如 <code>Catch-all</code>。</li><li><strong>Apply this rule if</strong>: 选择 <strong>The recipient</strong> -&gt; <strong>address matches any of these text patterns</strong>。<blockquote><p><strong>specify text patterns</strong>: 输入正则表达式，例如 <code>^test.*@gabriel\.edu\.kg$</code>。<br><em>注：此正则表示匹配所有以 <code>test</code> 开头（如 <code>test-app</code>, <code>test01</code>）的邮箱地址。</em></p></blockquote></li><li><strong>Do the following</strong>: 选择 <strong>Redirect the message to</strong> -&gt; <strong>these recipients</strong>，并在列表中选择你的主账号。</li><li>后续 Settings 保持默认，点击 Finish。</li></ul></li><li><p><strong>启用规则</strong>：</p><ul><li>新创建的规则默认处于 <strong>Disabled</strong> 状态。</li><li>点击规则名称，在详情面板中将滑块切换为 <span class='p green'>Enabled</span>。</li></ul></li></ol><div class="note info flat"><p><strong>配置完成：</strong><br>现在，你可以直接使用 <code>test001@gabriel.edu.kg</code> 或 <code>test-anything@gabriel.edu.kg</code> 进行注册，邮件将自动投递到你的收件箱。</p></div>]]></content>
    
    
    <summary type="html">承接 Microsoft 365 E3 免费订阅教程，详解如何关闭 Azure 安全默认值、绑定自有域名、开启 SMTP Auth，并配置 DKIM 签名，打造高送达率的企业级邮件推送服务。</summary>
    
    
    
    <category term="资源分享" scheme="https://lijiabao9.github.io/categories/%E8%B5%84%E6%BA%90%E5%88%86%E4%BA%AB/"/>
    
    <category term="进阶教程" scheme="https://lijiabao9.github.io/categories/%E8%B5%84%E6%BA%90%E5%88%86%E4%BA%AB/%E8%BF%9B%E9%98%B6%E6%95%99%E7%A8%8B/"/>
    
    
    <category term="Microsoft365" scheme="https://lijiabao9.github.io/tags/Microsoft365/"/>
    
    <category term="SMTP" scheme="https://lijiabao9.github.io/tags/SMTP/"/>
    
    <category term="Exchange" scheme="https://lijiabao9.github.io/tags/Exchange/"/>
    
  </entry>
  
  <entry>
    <title>白嫖指南：免费获取 Microsoft 365 E3 开发者订阅 (含 5TB OneDrive)</title>
    <link href="https://lijiabao9.github.io/posts/93201920.html"/>
    <id>https://lijiabao9.github.io/posts/93201920.html</id>
    <published>2025-12-06T15:52:08.000Z</published>
    <updated>2025-12-27T02:22:20.019Z</updated>
    
    <content type="html"><![CDATA[<p>Microsoft 365 E3 订阅通常是企业级的付费服务，但通过特定的开发者计划或 Symphony 试用链接，我们可以免费获取。</p><p><strong>核心权益：</strong></p><ul><li><strong>Office 365 全家桶</strong>：支持激活本地桌面版 Word, Excel, PPT 等。</li><li><strong>25 个许可证</strong>：可以创建 25 个子账号，分发给亲友使用。</li><li><strong>5TB OneDrive</strong>：每个账号均可享受最高 5TB 的云存储空间。</li><li><strong>自动续期</strong>：保持账号活跃（如 API 调用），微软通常会按年自动续期。</li></ul><div class="note danger flat"><p><strong>免责声明：</strong><br>本教程利用的是微软公开的试用/开发者链接（如 Symphony/Dev 渠道）。此类订阅存在不确定性，微软随时可能收回权益或封禁账号。<br><strong>请勿在 OneDrive 中存储没有任何备份的重要数据！建议仅作为从属/备用网盘或用于激活 Office 软件。</strong></p></div><hr><h2 id="第一步：创建空全局管理员"><a href="#第一步：创建空全局管理员" class="headerlink" title="第一步：创建空全局管理员"></a>第一步：创建空全局管理员</h2><p>我们需要先注册一个没有绑定任何订阅的“空壳”微软企业账号。</p><ol><li><p><strong>访问注册链接</strong>：<br><a href="https://signup.microsoft.com/get-started/signup?products=35dffc92-9eb4-4d5c-82c2-2582b37bb9c4&amp;culture=zh-cn&amp;country=cn&amp;ali=1">点击此处跳转注册页面</a></p></li><li><p><strong>验证邮箱</strong>：<br>输入任意<strong>电子邮件</strong>，点击 <strong>下一步</strong>，如果提示账号不存在，点击 <strong>创建账号</strong>。<br><img src="https://cdn.jsdelivr.net/gh/lijiabao9/pic.cloud@main/hexo/post/20251206221511839.webp" alt=""></p></li><li><p><strong>填写信息</strong>：</p><ul><li><em>基本情况</em>：随意填写，点击 <strong>下一步</strong>。</li><li><em>登录方法</em>：设置你的<strong>全局管理员前缀</strong>（如 <code>admin</code>）和 <strong>专用域名</strong>（<code>xxxx.onmicrosoft.com</code>）。</li><li><span class='p red'>重要：请务必牢记此处的用户名和密码，这是你的最高权限账号。</span><img src="https://cdn.jsdelivr.net/gh/lijiabao9/pic.cloud@main/hexo/post/20251206221912207.webp" alt=""></li></ul></li><li><p><strong>跳过无关项</strong>：</p><ul><li><em>地址</em>：随意填写（提示无法认证也不用管）。</li><li><em>纳税人识别号</em>：随意填写一个身份证号。</li><li><strong>关键点</strong>：当流程进行到 <strong>付款</strong> 或 <strong>添加支付方式</strong> 页面时，<strong>直接关闭网页</strong>，不要填写。<br><img src="https://cdn.jsdelivr.net/gh/lijiabao9/pic.cloud@main/hexo/post/20251206222433419.webp" alt=""></li></ul></li></ol><p>此时，你已经拥有了一个空的全局管理员账号：<code>admin@xxxx.onmicrosoft.com</code>。</p><hr><h2 id="第二步：激活-E3-订阅"><a href="#第二步：激活-E3-订阅" class="headerlink" title="第二步：激活 E3 订阅"></a>第二步：激活 E3 订阅</h2><p>利用特定的 Promo 链接，将 E3 订阅挂载到刚才创建的账号上。</p><ol><li><p><strong>访问购买链接</strong>：<br><a href="https://admin.cloud.microsoft/?pid=C69E7747-2566-4897-8CBA-B998ED3BAB88&amp;quan=25&amp;bc=1&amp;sku=189a915c-fe4f-4ffa-bde4-85b9628d07a0&amp;ru=PDP#/Purchase/checkout">点击此处跳转 E3 Dev 订阅下单页</a><br><em>(如果提示登录，请使用第一步创建的管理员账号登录)</em></p></li><li><p><strong>配置支付方式</strong>：<br>在购物车页面，将付款方式切换为 <strong>Alipay (支付宝)</strong>，点击 <strong>Save</strong>。</p><div class="note info flat"><p><strong>提示</strong>：这里虽然显示金额为 0 元，但仍需验证支付方式。选择支付宝是为了绕过信用卡验证，<strong>实际不会扣费</strong>，也无需扫码支付。</p></div></li><li><p><strong>完成下单</strong>：<br>点击右侧的 <strong>Place order</strong>。当看到如下图提示，即表示“白嫖”成功！<br><img src="https://cdn.jsdelivr.net/gh/lijiabao9/pic.cloud@main/hexo/post/20251206223119617.webp" alt=""></p></li><li><p><strong>验证许可证</strong>：<br>登录 <a href="https://admin.microsoft.com/">Microsoft Admin Center</a>，在首页即可看到 <strong>Office 365 E3 Developer</strong> 订阅已激活，包含 <strong>25</strong> 个许可证。<br><img src="https://cdn.jsdelivr.net/gh/lijiabao9/pic.cloud@main/hexo/post/20251206223327776.webp" alt=""></p></li><li><p><strong>卡 BUG 续期 (转为年付)</strong>：</p><ul><li>进入 <strong>Billing (账单)</strong> -&gt; <strong>Your products (你的产品)</strong>。</li><li>点击 <em>Office 365 E3 Develop</em> 后的三个点 -&gt; <strong>Edit billing frequency (编辑账单频率)</strong>。</li><li>切换为 <strong>Pay yearly (按年付费)</strong>，点击保存。</li><li><em>效果：订阅结束时间通常会自动延长至一年后。</em><br><img src="https://cdn.jsdelivr.net/gh/lijiabao9/pic.cloud@main/hexo/post/20251206223451928.webp" alt=""></li></ul></li></ol><div class="note success flat"><p><strong>进阶玩法 (备用链接)：</strong><br>如果不满足于 25 个账号，同一账号可以重复购买叠加。<br>还可以尝试以下 <strong>200 万个许可证</strong> 的 Symphony 订阅（同一账号互斥，只能选一种）：</p><ul><li><strong>E1 Symphony (后续可在产品中升级为 E3)</strong>: <a href="https://admin.cloud.microsoft/?pid=A89F6463-1F7B-4F51-90DD-8C182637B002&amp;quan=2000000&amp;bc=1&amp;sku=18181a46-0d4e-45cd-891e-60aabd171b4e&amp;ru=PDP#/Purchase/checkout">点击跳转</a></li><li><strong>E3 Symphony (推荐)</strong>: <a href="https://admin.cloud.microsoft/?pid=C18B235E-8366-48B8-AE41-6E596C44944D&amp;quan=2000000&amp;bc=1&amp;sku=6fd2c87f-b296-42f0-b197-1e91e994b900&amp;ru=PDP#/Purchase/checkout">点击跳转</a></li></ul></div><hr><h2 id="第三步：扩容-OneDrive-至-5TB"><a href="#第三步：扩容-OneDrive-至-5TB" class="headerlink" title="第三步：扩容 OneDrive 至 5TB"></a>第三步：扩容 OneDrive 至 5TB</h2><p>默认空间为 1TB，我们需要手动修改全局设置以解锁 5TB 权限。</p><ol><li><p>在 Admin Center 左侧导航栏，点击 <strong>SharePoint</strong> 进入独立管理后台。<br><img src="https://cdn.jsdelivr.net/gh/lijiabao9/pic.cloud@main/hexo/post/20251206225759887.webp" alt=""></p></li><li><p>点击 <strong>Settings</strong> -&gt; <strong>OneDrive</strong> -&gt; <strong>Storage limit</strong>。</p></li><li><p>将默认存储限制修改为 <strong>5120</strong> (GB)，点击保存。<br><img src="https://cdn.jsdelivr.net/gh/lijiabao9/pic.cloud@main/hexo/post/20251206225911266.webp" alt=""></p></li></ol><hr><h2 id="第四步：创建子用户-降低风险"><a href="#第四步：创建子用户-降低风险" class="headerlink" title="第四步：创建子用户 (降低风险)"></a>第四步：创建子用户 (降低风险)</h2><p><strong>强烈建议不要直接使用全局管理员账号进行日常使用</strong>，以降低风控概率。请创建子用户用于激活 Office 和存储数据。</p><ol><li><p>回到 Admin Center，点击 <strong>Users</strong> -&gt; <strong>Active users</strong> -&gt; <strong>Add a user</strong>。<br><img src="https://cdn.jsdelivr.net/gh/lijiabao9/pic.cloud@main/hexo/post/20251206231129025.webp" alt=""></p></li><li><p>填写姓名、用户名，<strong>勾选分配 Office 365 E3 许可证</strong>，角色保持默认（User）即可。记得复制保存生成的子用户密码。<br><img src="https://cdn.jsdelivr.net/gh/lijiabao9/pic.cloud@main/hexo/post/20251206232010026.webp" alt=""></p></li><li><p><strong>检查空间</strong>：<br>创建完成后，点击该用户 -&gt; <strong>OneDrive</strong> 选项卡，查看 “Storage used”。</p><ul><li>如果显示 1024GB，点击 <strong>Edit</strong> 手动改为 5120GB。<br><img src="https://cdn.jsdelivr.net/gh/lijiabao9/pic.cloud@main/hexo/post/20251206232508951.webp" alt=""></li><li>如果显示“未初始化”，请使用该子账号登录一次 <a href="https://mysignins.microsoft.com">MySignins</a> 即可触发初始化。<br><img src="https://cdn.jsdelivr.net/gh/lijiabao9/pic.cloud@main/hexo/post/20251206233457161.webp" alt=""></li></ul></li></ol><hr><h2 id="第五步：在-Windows-上使用"><a href="#第五步：在-Windows-上使用" class="headerlink" title="第五步：在 Windows 上使用"></a>第五步：在 Windows 上使用</h2><p>现在的子账号已经是一个功能完备的“工作账号”了，可以与你原本的“个人账号”完美共存。</p><h3 id="1-系统级接入"><a href="#1-系统级接入" class="headerlink" title="1. 系统级接入"></a>1. 系统级接入</h3><p>打开 Windows <strong>设置</strong> -&gt; <strong>账户</strong> -&gt; <strong>登录工作或学校账号</strong>。<br>点击 <strong>连接</strong>，输入子账号和密码登录，这将允许该账号 SSO 登录系统内的 Office 应用。<br><img src="https://cdn.jsdelivr.net/gh/lijiabao9/pic.cloud@main/hexo/post/20251206234015365.webp" alt=""></p><h3 id="2-激活-Office"><a href="#2-激活-Office" class="headerlink" title="2. 激活 Office"></a>2. 激活 Office</h3><p>打开 Word 或 Excel，点击左下角的 <strong>账号</strong> -&gt; <strong>切换许可证</strong> -&gt; 选择刚刚添加的 E3 子账号。<br><img src="https://cdn.jsdelivr.net/gh/lijiabao9/pic.cloud@main/hexo/post/20251206234325170.webp" alt=""></p><h3 id="3-挂载-OneDrive"><a href="#3-挂载-OneDrive" class="headerlink" title="3. 挂载 OneDrive"></a>3. 挂载 OneDrive</h3><p>右键任务栏 OneDrive 图标 -&gt; <strong>设置</strong>。<br>选择 <strong>账户</strong> -&gt; <strong>添加账户</strong>，登录子账号后，你的文件资源管理器中会出现一个新的 <code>OneDrive - &lt;你的组织名&gt;</code> 文件夹，独享 5TB 空间。<br><img src="https://cdn.jsdelivr.net/gh/lijiabao9/pic.cloud@main/hexo/post/20251206234944249.webp" alt=""></p>]]></content>
    
    
    <summary type="html">详解如何通过特定渠道申请 Microsoft 365 E3 开发者订阅，免费获取 25 个子账号及 Office 桌面版全家桶，并教你如何将 OneDrive 云存储空间扩容至 5TB。</summary>
    
    
    
    <category term="资源分享" scheme="https://lijiabao9.github.io/categories/%E8%B5%84%E6%BA%90%E5%88%86%E4%BA%AB/"/>
    
    <category term="福利教程" scheme="https://lijiabao9.github.io/categories/%E8%B5%84%E6%BA%90%E5%88%86%E4%BA%AB/%E7%A6%8F%E5%88%A9%E6%95%99%E7%A8%8B/"/>
    
    
    <category term="Microsoft365" scheme="https://lijiabao9.github.io/tags/Microsoft365/"/>
    
    <category term="OneDrive" scheme="https://lijiabao9.github.io/tags/OneDrive/"/>
    
    <category term="白嫖指南" scheme="https://lijiabao9.github.io/tags/%E7%99%BD%E5%AB%96%E6%8C%87%E5%8D%97/"/>
    
  </entry>
  
  <entry>
    <title>RustDesk 自建远程桌面服务：告别 TeamViewer，拥抱开源与速度</title>
    <link href="https://lijiabao9.github.io/posts/aed46d6a.html"/>
    <id>https://lijiabao9.github.io/posts/aed46d6a.html</id>
    <published>2025-12-06T13:05:22.000Z</published>
    <updated>2025-12-27T02:22:20.017Z</updated>
    
    <content type="html"><![CDATA[<p><a href="https://rustdesk.com/">RustDesk</a> 是一款开源的远程桌面软件，旨在成为 TeamViewer 和 AnyDesk 的替代品。</p><p>它最大的优势在于<strong>支持自建服务器</strong>。通过自建服务器，你可以拥有完全的数据掌控权，享受局域网般的低延迟体验，且无需支付昂贵的商业授权费用。</p><h2 id="核心组件解析"><a href="#核心组件解析" class="headerlink" title="核心组件解析"></a>核心组件解析</h2><p>在部署之前，我们需要了解 RustDesk 服务端的两个核心组件：</p><ul><li><p><strong>hbbs (RustDesk ID/Rendezvous Server)</strong></p><ul><li><strong>心跳与信令服务器</strong>。</li><li>主要负责设备的心跳保活、P2P 连接的打洞（NAT 穿透）、以及设备 ID 的注册与发现。</li><li>客户端通过它来“找到”对方。</li></ul></li><li><p><strong>hbbr (RustDesk Relay Server)</strong></p><ul><li><strong>中继服务器</strong>。</li><li>当两个客户端无法建立直接的 P2P 连接（例如都在严格的 NAT 后）时，数据将通过此服务器进行转发。</li><li>这是保证连接成功率的兜底方案。</li></ul></li></ul><h2 id="部署流程"><a href="#部署流程" class="headerlink" title="部署流程"></a>部署流程</h2><p>本教程基于 <strong>Docker Compose</strong> 部署，可参考：<a href="/posts/3c32210.html">Ubuntu 系统 Docker 安装全指南：官方源与国内镜像加速</a>。<br>使用 <code>network_mode: &quot;host&quot;</code> 模式，这是官方推荐的最简配置，无需繁琐的端口映射。</p><h3 id="1-创建工作目录"><a href="#1-创建工作目录" class="headerlink" title="1. 创建工作目录"></a>1. 创建工作目录</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> -p /app/rustdesk</span><br><span class="line"><span class="built_in">cd</span> /app/rustdesk</span><br><span class="line"><span class="built_in">touch</span> docker-compose.yml</span><br></pre></td></tr></table></figure><h3 id="2-编写配置文件"><a href="#2-编写配置文件" class="headerlink" title="2. 编写配置文件"></a>2. 编写配置文件</h3><p>编辑 <code>docker-compose.yml</code>：</p><figure class="highlight yaml"><figcaption><span>docker-compose.yml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">hbbs:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">rustdesk/rustdesk-server:latest</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">hbbs</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./data:/root</span></span><br><span class="line">    <span class="attr">network_mode:</span> <span class="string">&quot;host&quot;</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">hbbr</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">unless-stopped</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">hbbr:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">rustdesk/rustdesk-server:latest</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">hbbr</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./data:/root</span></span><br><span class="line">    <span class="attr">network_mode:</span> <span class="string">&quot;host&quot;</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">unless-stopped</span></span><br></pre></td></tr></table></figure><h3 id="3-启动服务"><a href="#3-启动服务" class="headerlink" title="3. 启动服务"></a>3. 启动服务</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker compose up -d</span><br></pre></td></tr></table></figure><h2 id="防火墙配置（关键）"><a href="#防火墙配置（关键）" class="headerlink" title="防火墙配置（关键）"></a>防火墙配置（关键）</h2><p>RustDesk 涉及的端口较多，<strong>防火墙配置错误是导致无法连接的最常见原因</strong>。</p><p>请在云服务器的安全组或防火墙（UFW/IPTables）中放行以下端口：</p><div class="table-container"><table><thead><tr><th style="text-align:left">端口</th><th style="text-align:left">协议</th><th style="text-align:left">用途</th><th style="text-align:left">说明</th></tr></thead><tbody><tr><td style="text-align:left"><strong>21115</strong></td><td style="text-align:left">TCP</td><td style="text-align:left">HBBS</td><td style="text-align:left">NAT 类型测试</td></tr><tr><td style="text-align:left"><strong>21116</strong></td><td style="text-align:left"><strong>TCP</strong></td><td style="text-align:left">HBBS</td><td style="text-align:left">ID 注册与心跳服务</td></tr><tr><td style="text-align:left"><strong>21116</strong></td><td style="text-align:left"><strong>UDP</strong></td><td style="text-align:left">HBBS</td><td style="text-align:left"><strong>重要：</strong> ID 注册与心跳（必须放行）</td></tr><tr><td style="text-align:left"><strong>21117</strong></td><td style="text-align:left">TCP</td><td style="text-align:left">HBBR</td><td style="text-align:left">中继服务（数据转发）</td></tr></tbody></table></div><div class="note info flat"><p><strong>补充说明：</strong></p><ul><li><strong>21114</strong>：仅 Pro 版本（付费版）的 API 端口，开源版无需放行。</li><li><strong>21118 - 21119</strong>：用于支持网页版客户端（Web Client），如果不需要网页版可不放行。</li></ul></div><h2 id="获取连接密钥-Key"><a href="#获取连接密钥-Key" class="headerlink" title="获取连接密钥 (Key)"></a>获取连接密钥 (Key)</h2><p>为了防止未经授权的人使用你的中继服务器消耗流量，我们需要获取服务器自动生成的公钥。</p><p>服务启动后，密钥文件位于挂载的 <code>./data</code> 目录中。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看公钥（注意是 .pub 结尾的文件）</span></span><br><span class="line"><span class="built_in">cat</span> /app/rustdesk/data/id_ed25519.pub</span><br></pre></td></tr></table></figure><p>输出的字符串（如 <code>8B/x+...=</code>）即为 Key，复制保存。</p><h2 id="客户端配置"><a href="#客户端配置" class="headerlink" title="客户端配置"></a>客户端配置</h2><p>下载 <a href="https://github.com/rustdesk/rustdesk/releases">RustDesk 客户端</a>（支持 Windows, Mac, Linux, Android, iOS）。</p><ol><li>打开客户端，点击 <strong>设置</strong>（右上角三条横线图标） -> <strong>网络</strong>。</li><li>找到顶部 <strong>ID / 中继服务器</strong> 选项。</li><li>填入以下信息：<ul><li><strong>ID 服务器</strong>：填入你的服务器 IP（或域名）。</li><li><strong>中继服务器</strong>：填入你的服务器 IP（或域名）。</li><li>API 服务器：留空（除非使用 Pro 版）。</li><li><strong>Key</strong>：填入上一步获取的公钥字符串。</li></ul></li></ol><p>点击 <strong>应用</strong>。</p><p>回到主界面，如果底部状态栏显示 <strong>“就绪”</strong>，且没有报错提示，说明连接自建服务器成功。现在你可以享受高清、流畅的远程控制体验了！</p>]]></content>
    
    
    <summary type="html">详解如何通过 Docker Compose 部署 RustDesk 私有服务器（ID 服务器 + 中继服务器），彻底解决远程桌面卡顿、画质差和付费限制问题。</summary>
    
    
    
    <category term="创意工坊" scheme="https://lijiabao9.github.io/categories/%E5%88%9B%E6%84%8F%E5%B7%A5%E5%9D%8A/"/>
    
    <category term="服务搭建" scheme="https://lijiabao9.github.io/categories/%E5%88%9B%E6%84%8F%E5%B7%A5%E5%9D%8A/%E6%9C%8D%E5%8A%A1%E6%90%AD%E5%BB%BA/"/>
    
    
    <category term="Docker" scheme="https://lijiabao9.github.io/tags/Docker/"/>
    
    <category term="运维" scheme="https://lijiabao9.github.io/tags/%E8%BF%90%E7%BB%B4/"/>
    
    <category term="RustDesk" scheme="https://lijiabao9.github.io/tags/RustDesk/"/>
    
    <category term="远程桌面" scheme="https://lijiabao9.github.io/tags/%E8%BF%9C%E7%A8%8B%E6%A1%8C%E9%9D%A2/"/>
    
  </entry>
  
  <entry>
    <title>极简主义统计：Umami 私有化部署与 Hexo 博客集成指南</title>
    <link href="https://lijiabao9.github.io/posts/fdad30aa.html"/>
    <id>https://lijiabao9.github.io/posts/fdad30aa.html</id>
    <published>2025-12-05T15:15:49.000Z</published>
    <updated>2025-12-27T02:22:20.017Z</updated>
    
    <content type="html"><![CDATA[<p><a href="https://umami.is/">Umami</a> 是一个简单、易用且注重隐私的开源网站分析替代方案。相比 Google Analytics，它更轻量，且完全由你自己掌握数据。</p><p>本文将带你通过 <strong>Docker Compose</strong> 完成全流程部署。</p><h2 id="一、环境准备"><a href="#一、环境准备" class="headerlink" title="一、环境准备"></a>一、环境准备</h2><p>在开始之前，请确保你的服务器已就绪：</p><ol><li><strong>服务器环境</strong>：已安装 Docker 和 Docker Compose。<ul><li>参考：<a href="/posts/3c32210.html">Ubuntu 系统 Docker 安装全指南：官方源与国内镜像加速</a></li></ul></li><li><strong>域名与证书</strong>：拥有一个域名并完成了 SSL 证书申请。<ul><li>参考：<a href="/posts/e94f4538.html">从零开始：域名购买、Cloudflare 托管与 Nginx 自动化 HTTPS 配置全指南</a></li></ul></li></ol><hr><h2 id="二、Docker-服务部署"><a href="#二、Docker-服务部署" class="headerlink" title="二、Docker 服务部署"></a>二、Docker 服务部署</h2><h3 id="1-创建工作目录"><a href="#1-创建工作目录" class="headerlink" title="1. 创建工作目录"></a>1. 创建工作目录</h3><p>登录服务器，建立 Umami 的数据存储目录：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> -p /app/umami</span><br><span class="line"><span class="built_in">cd</span> /app/umami</span><br></pre></td></tr></table></figure><h3 id="2-编写配置-docker-compose-yml"><a href="#2-编写配置-docker-compose-yml" class="headerlink" title="2. 编写配置 (docker-compose.yml)"></a>2. 编写配置 (docker-compose.yml)</h3><p>创建并编辑配置文件：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim docker-compose.yml</span><br></pre></td></tr></table></figure><p>写入以下内容。请注意：</p><ul><li><strong>APP_SECRET</strong>：这是加密盐值，务必修改为随机字符串（可在终端运行 <code>openssl rand -hex 32</code> 生成）。</li><li><strong>端口映射</strong>：将宿主机的 <code>20001</code> 映射到容器的 <code>3000</code>。</li></ul><figure class="highlight yaml"><figcaption><span>docker-compose.yml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">umami:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">ghcr.io/umami-software/umami:latest</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;20002:3000&quot;</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">DATABASE_URL:</span> <span class="string">postgresql://umami:umami@db:5432/umami</span></span><br><span class="line">      <span class="attr">APP_SECRET:</span> <span class="string">replace-me-with-a-random-string</span>  <span class="comment"># &lt;--- 务必修改这里</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="attr">db:</span></span><br><span class="line">        <span class="attr">condition:</span> <span class="string">service_healthy</span></span><br><span class="line">    <span class="attr">init:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">healthcheck:</span></span><br><span class="line">      <span class="attr">test:</span> [<span class="string">&quot;CMD-SHELL&quot;</span>, <span class="string">&quot;curl http://localhost:3000/api/heartbeat&quot;</span>]</span><br><span class="line">      <span class="attr">interval:</span> <span class="string">5s</span></span><br><span class="line">      <span class="attr">timeout:</span> <span class="string">5s</span></span><br><span class="line">      <span class="attr">retries:</span> <span class="number">5</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">db:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">postgres:15-alpine</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">POSTGRES_DB:</span> <span class="string">umami</span></span><br><span class="line">      <span class="attr">POSTGRES_USER:</span> <span class="string">umami</span></span><br><span class="line">      <span class="attr">POSTGRES_PASSWORD:</span> <span class="string">umami</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./umami-db-data:/var/lib/postgresql/data</span> <span class="comment"># 数据持久化挂载</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">healthcheck:</span></span><br><span class="line">      <span class="attr">test:</span> [<span class="string">&quot;CMD-SHELL&quot;</span>, <span class="string">&quot;pg_isready -U $$&#123;POSTGRES_USER&#125; -d $$&#123;POSTGRES_DB&#125;&quot;</span>]</span><br><span class="line">      <span class="attr">interval:</span> <span class="string">5s</span></span><br><span class="line">      <span class="attr">timeout:</span> <span class="string">5s</span></span><br><span class="line">      <span class="attr">retries:</span> <span class="number">5</span></span><br></pre></td></tr></table></figure><h3 id="3-启动服务"><a href="#3-启动服务" class="headerlink" title="3. 启动服务"></a>3. 启动服务</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker compose up -d</span><br></pre></td></tr></table></figure><p>此时，可以通过 <code>http://服务器IP:20002</code> 访问后台。但为了安全，我们接下配置 Nginx 反向代理。</p><hr><h2 id="三、Nginx-反向代理与-HTTPS"><a href="#三、Nginx-反向代理与-HTTPS" class="headerlink" title="三、Nginx 反向代理与 HTTPS"></a>三、Nginx 反向代理与 HTTPS</h2><p>为了通过域名安全访问，我们需要配置 Nginx 反向代理。</p><h3 id="1-编写-Nginx-配置"><a href="#1-编写-Nginx-配置" class="headerlink" title="1. 编写 Nginx 配置"></a>1. 编写 Nginx 配置</h3><p>创建配置文件 <code>vi /etc/nginx/sites-available/umami.131495.xyz</code>：</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line">    <span class="attribute">listen</span> [::]:<span class="number">80</span>;</span><br><span class="line">    <span class="attribute">server_name</span> umami.<span class="number">131495</span>.xyz;</span><br><span class="line">    <span class="attribute">return</span> <span class="number">301</span> https://<span class="variable">$host</span><span class="variable">$request_uri</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">443</span> ssl;</span><br><span class="line">    <span class="attribute">listen</span> [::]:<span class="number">443</span> ssl;</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># <span class="doctag">TODO:</span> 修改为对应的子域名</span></span><br><span class="line">    <span class="attribute">server_name</span> umami.<span class="number">131495</span>.xyz;</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 证书配置</span></span><br><span class="line">    <span class="attribute">ssl_certificate</span> /cert/acme_131495.xyz/cert.pem;</span><br><span class="line">    <span class="attribute">ssl_certificate_key</span> /cert/acme_131495.xyz/key.pem;</span><br><span class="line">    <span class="attribute">ssl_ciphers</span> HIGH:!aNULL:!MD5;</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># <span class="doctag">TODO:</span> 独立的日志配置</span></span><br><span class="line">    <span class="attribute">access_log</span> /var/log/nginx/umami.access.log proxy_json;</span><br><span class="line">    <span class="attribute">error_log</span> /var/log/nginx/umami.<span class="literal">error</span>.log;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 反向代理设置</span></span><br><span class="line">    <span class="section">location</span> / &#123;</span><br><span class="line">        <span class="comment"># <span class="doctag">TODO:</span> 修改为实际的服务地址</span></span><br><span class="line">        <span class="attribute">proxy_pass</span> http://127.0.0.1:20002;</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 代理参数</span></span><br><span class="line">        <span class="attribute">proxy_set_header</span> Host <span class="variable">$host</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> X-Real-IP <span class="variable">$remote_addr</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-启用并重载"><a href="#2-启用并重载" class="headerlink" title="2. 启用并重载"></a>2. 启用并重载</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建软链接</span></span><br><span class="line"><span class="built_in">ln</span> -s /etc/nginx/sites-available/umami.131495.xyz /etc/nginx/sites-enabled/</span><br><span class="line"></span><br><span class="line"><span class="comment"># 测试并重启</span></span><br><span class="line">nginx -t &amp;&amp; systemctl reload nginx</span><br></pre></td></tr></table></figure><h3 id="3-域名DNS记录"><a href="#3-域名DNS记录" class="headerlink" title="3. 域名DNS记录"></a>3. 域名DNS记录</h3><p>给域名添加对应的 A 记录，将 <code>umami.131495.xyz</code> 解析到服务器的 IP 地址。</p><p>现在，你可以通过 <code>https://umami.131495.xyz</code> 访问了。</p><hr><h2 id="四、初始化配置"><a href="#四、初始化配置" class="headerlink" title="四、初始化配置"></a>四、初始化配置</h2><h3 id="1-修改默认密码"><a href="#1-修改默认密码" class="headerlink" title="1. 修改默认密码"></a>1. 修改默认密码</h3><p>访问 <code>https://umami.131495.xyz</code>。</p><ul><li>默认账号：<code>admin</code></li><li>默认密码：<code>umami</code></li></ul><p><strong>重要</strong>：登录后，立即点击左上角头像 -> <strong>Settings</strong> -> <strong>Profile</strong> -> <strong>Change password</strong> 修改密码。</p><h3 id="2-添加网站"><a href="#2-添加网站" class="headerlink" title="2. 添加网站"></a>2. 添加网站</h3><p>在 <strong>Websites</strong> 页面点击 <strong>Add website</strong>，填入你的 <code>网站名称</code> 和 <code>网站网址</code>。</p><p>保存后，点击列表中的 <strong>Edit</strong> 按钮，获取 <strong>Website ID</strong>（一串 UUID）。</p><hr><h2 id="五、集成到-Hexo-Butterfly-主题"><a href="#五、集成到-Hexo-Butterfly-主题" class="headerlink" title="五、集成到 Hexo (Butterfly 主题)"></a>五、集成到 Hexo (Butterfly 主题)</h2><p>Butterfly 主题原生支持 Umami 统计，配置非常简单。</p><h3 id="1-修改主题配置"><a href="#1-修改主题配置" class="headerlink" title="1. 修改主题配置"></a>1. 修改主题配置</h3><p>编辑 <code>_config.butterfly.yml</code>：</p><figure class="highlight yaml"><figcaption><span>_config.butterfly.yml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 关闭不蒜子 (可选，避免功能重复)</span></span><br><span class="line"><span class="attr">busuanzi:</span></span><br><span class="line">  <span class="attr">site_uv:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">site_pv:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">page_pv:</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 启用 Umami</span></span><br><span class="line"><span class="attr">umami_analytics:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">serverURL:</span> <span class="string">https://umami.131495.xyz</span>  <span class="comment"># 你的 Umami 域名</span></span><br><span class="line">  <span class="attr">website_id:</span> <span class="string">xxxxx-xxxx-xxxx-xxxx-xxxxxxx</span> <span class="comment"># 刚刚获取的 UUID</span></span><br><span class="line">  <span class="attr">script_name:</span> <span class="string">script.js</span></span><br><span class="line">  <span class="attr">option:</span></span><br><span class="line">  <span class="comment"># 开启 PV/UV 展示 (需要 Token)</span></span><br><span class="line">  <span class="attr">UV_PV:</span></span><br><span class="line">    <span class="attr">site_uv:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">site_pv:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">page_pv:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">token:</span> <span class="string">填写访问令牌</span> <span class="comment"># 下文说明如何获取</span></span><br></pre></td></tr></table></figure><h3 id="2-获取-Access-Token-硬核方法"><a href="#2-获取-Access-Token-硬核方法" class="headerlink" title="2. 获取 Access Token (硬核方法)"></a>2. 获取 Access Token (硬核方法)</h3><p>Butterfly 主题通过调用 Umami API 来展示页面访问量，这需要通过 Token 进行鉴权。</p><p>目前最快捷的获取方法（针对自托管版）：</p><ol><li>用 Chrome 浏览器登录你的 Umami 后台。</li><li>按 <code>F12</code> 打开开发者工具，切换到 <strong>Network (网络)</strong> 标签。</li><li>刷新页面，随便点击一个 API 请求（如 <code>stats</code> 或 <code>websites</code>）。</li><li>在 <strong>Request Headers (请求头)</strong> 中找到 <code>Authorization</code> 字段。</li><li>复制 <code>Bearer</code> 后面的一长串字符，这就是你的 Token。</li></ol><p>或者通过调用登录 API 获取：参考 <a href="https://umami.is/docs/api/authentication">官方文档</a>。</p><h3 id="3-部署博客"><a href="#3-部署博客" class="headerlink" title="3. 部署博客"></a>3. 部署博客</h3><p>重新部署博客后，此时的访问量数据将由 Umami 接管。</p>]]></content>
    
    
    <summary type="html">摒弃 Google Analytics，拥抱隐私保护。本文详解如何通过 Docker Compose 部署 Umami 统计服务，配置 Nginx HTTPS 反代，并将其无缝集成到 Hexo Butterfly 主题中。</summary>
    
    
    
    <category term="创意工坊" scheme="https://lijiabao9.github.io/categories/%E5%88%9B%E6%84%8F%E5%B7%A5%E5%9D%8A/"/>
    
    <category term="服务搭建" scheme="https://lijiabao9.github.io/categories/%E5%88%9B%E6%84%8F%E5%B7%A5%E5%9D%8A/%E6%9C%8D%E5%8A%A1%E6%90%AD%E5%BB%BA/"/>
    
    
    <category term="Hexo" scheme="https://lijiabao9.github.io/tags/Hexo/"/>
    
    <category term="Docker" scheme="https://lijiabao9.github.io/tags/Docker/"/>
    
    <category term="Nginx" scheme="https://lijiabao9.github.io/tags/Nginx/"/>
    
    <category term="Umami" scheme="https://lijiabao9.github.io/tags/Umami/"/>
    
  </entry>
  
  <entry>
    <title>Artalk 私有化部署全指南：Docker + Nginx + Cloudflare 打造独立评论系统</title>
    <link href="https://lijiabao9.github.io/posts/1b40d3bb.html"/>
    <id>https://lijiabao9.github.io/posts/1b40d3bb.html</id>
    <published>2025-12-05T13:04:00.000Z</published>
    <updated>2025-12-27T02:22:20.017Z</updated>
    
    <content type="html"><![CDATA[<p><a href="https://artalk.js.org/">Artalk</a> 是一款简洁、轻量且功能强大的自托管评论系统。相比于 Valine 或 Gitalk，它提供了更完善的管理后台和数据隐私掌控权。</p><p>本文将演示如何通过 Docker Compose 部署 Artalk，并将其集成到 Hexo 博客（Butterfly 主题）中。</p><h2 id="一、前置准备"><a href="#一、前置准备" class="headerlink" title="一、前置准备"></a>一、前置准备</h2><p>在开始之前，请确保你已经完成了以下基础环境的搭建：</p><ol><li><strong>服务器环境</strong>：已安装 Docker 和 Docker Compose。<ul><li>参考：<a href="/posts/3c32210.html">Ubuntu 系统 Docker 安装全指南：官方源与国内镜像加速</a></li></ul></li><li><strong>域名与证书</strong>：拥有一个域名并完成了 SSL 证书申请。<ul><li>参考：<a href="/posts/e94f4538.html">从零开始：域名购买、Cloudflare 托管与 Nginx 自动化 HTTPS 配置全指南</a></li></ul></li></ol><hr><h2 id="二、服务端部署"><a href="#二、服务端部署" class="headerlink" title="二、服务端部署"></a>二、服务端部署</h2><h3 id="1-创建工作目录"><a href="#1-创建工作目录" class="headerlink" title="1. 创建工作目录"></a>1. 创建工作目录</h3><p>登录服务器，建立 Artalk 的数据存储目录：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> -p /app/artalk</span><br><span class="line"><span class="built_in">cd</span> /app/artalk</span><br></pre></td></tr></table></figure><h3 id="2-编写-Docker-Compose"><a href="#2-编写-Docker-Compose" class="headerlink" title="2. 编写 Docker Compose"></a>2. 编写 Docker Compose</h3><p>创建 <code>docker-compose.yml</code> 文件：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim docker-compose.yml</span><br></pre></td></tr></table></figure><p>写入以下配置（<strong>注意修改 <code>ATK_SITE_URL</code> 为你的博客地址</strong>）：</p><figure class="highlight yaml"><figcaption><span>docker-compose.yml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">artalk:</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">artalk</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">artalk/artalk-go</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">unless-stopped</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">20001</span><span class="string">:23366</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./data:/data</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">TZ=Asia/Shanghai</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ATK_LOCALE=zh-CN</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ATK_SITE_DEFAULT=Gabriel的博客</span>    <span class="comment"># 默认站点名称</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ATK_SITE_URL=https://lijiabao9.github.io</span>  <span class="comment"># 你的博客前端地址（用于跨域信任）</span></span><br></pre></td></tr></table></figure><h3 id="3-启动服务"><a href="#3-启动服务" class="headerlink" title="3. 启动服务"></a>3. 启动服务</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker compose up -d</span><br></pre></td></tr></table></figure><p>等待容器启动后，创建管理员账号：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">exec</span> -it artalk artalk admin</span><br></pre></td></tr></table></figure><p><em>按提示输入管理员昵称、邮箱和密码。</em><br>账号信息后续可进行修改。</p><p>此时，可以通过 <code>http://服务器IP:20001</code> 访问后台。但为了安全，我们接下配置 Nginx 反向代理。</p><hr><h2 id="三、Nginx-反向代理与-HTTPS"><a href="#三、Nginx-反向代理与-HTTPS" class="headerlink" title="三、Nginx 反向代理与 HTTPS"></a>三、Nginx 反向代理与 HTTPS</h2><p>为了启用 HTTPS 并隐藏非标准端口，我们需要配置 Nginx。</p><h3 id="1-编写-Nginx-配置"><a href="#1-编写-Nginx-配置" class="headerlink" title="1. 编写 Nginx 配置"></a>1. 编写 Nginx 配置</h3><p>创建配置文件 <code>vi /etc/nginx/sites-available/artalk.131495.xyz</code>：</p><figure class="highlight nginx"><figcaption><span>artalk.131495.xyz</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line">    <span class="attribute">listen</span> [::]:<span class="number">80</span>;</span><br><span class="line">    <span class="attribute">server_name</span> artalk.<span class="number">131495</span>.xyz;</span><br><span class="line">    <span class="attribute">return</span> <span class="number">301</span> https://<span class="variable">$host</span><span class="variable">$request_uri</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">443</span> ssl;</span><br><span class="line">    <span class="attribute">listen</span> [::]:<span class="number">443</span> ssl;</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># <span class="doctag">TODO:</span> 修改为对应的子域名</span></span><br><span class="line">    <span class="attribute">server_name</span> artalk.<span class="number">131495</span>.xyz;</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 证书配置</span></span><br><span class="line">    <span class="attribute">ssl_certificate</span> /cert/acme_131495.xyz/cert.pem;</span><br><span class="line">    <span class="attribute">ssl_certificate_key</span> /cert/acme_131495.xyz/key.pem;</span><br><span class="line">    <span class="attribute">ssl_ciphers</span> HIGH:!aNULL:!MD5;</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># <span class="doctag">TODO:</span> 独立的日志配置</span></span><br><span class="line">    <span class="attribute">access_log</span> /var/log/nginx/artalk.access.log proxy_json;</span><br><span class="line">    <span class="attribute">error_log</span> /var/log/nginx/artalk.<span class="literal">error</span>.log;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 反向代理设置</span></span><br><span class="line">    <span class="section">location</span> / &#123;</span><br><span class="line">        <span class="comment"># <span class="doctag">TODO:</span> 修改为实际的服务地址</span></span><br><span class="line">        <span class="attribute">proxy_pass</span> http://127.0.0.1:20001;</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 代理参数</span></span><br><span class="line">        <span class="attribute">proxy_set_header</span> Host <span class="variable">$host</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> X-Real-IP <span class="variable">$remote_addr</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-启用配置"><a href="#2-启用配置" class="headerlink" title="2. 启用配置"></a>2. 启用配置</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建软链接</span></span><br><span class="line"><span class="built_in">ln</span> -s /etc/nginx/sites-available/artalk.131495.xyz /etc/nginx/sites-enabled/</span><br><span class="line"></span><br><span class="line"><span class="comment"># 测试并重启</span></span><br><span class="line">nginx -t &amp;&amp; systemctl reload nginx</span><br></pre></td></tr></table></figure><h3 id="3-域名DNS记录"><a href="#3-域名DNS记录" class="headerlink" title="3. 域名DNS记录"></a>3. 域名DNS记录</h3><p>给域名添加对应的 A 记录，将 <code>artalk.131495.xyz</code> 解析到服务器的 IP 地址。</p><p>现在，你可以通过 <code>https://artalk.131495.xyz</code> 访问 Artalk 控制中心了。</p><hr><h2 id="四、前端接入-Hexo-Butterfly"><a href="#四、前端接入-Hexo-Butterfly" class="headerlink" title="四、前端接入 (Hexo Butterfly)"></a>四、前端接入 (Hexo Butterfly)</h2><h3 id="1-修改主题配置"><a href="#1-修改主题配置" class="headerlink" title="1. 修改主题配置"></a>1. 修改主题配置</h3><p>编辑 Hexo 的主题配置文件 <code>_config.butterfly.yml</code>：</p><figure class="highlight yaml"><figcaption><span>_config.butterfly.yml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">comments:</span></span><br><span class="line">  <span class="attr">use:</span> <span class="string">Artalk</span></span><br><span class="line"></span><br><span class="line"><span class="attr">artalk:</span></span><br><span class="line">  <span class="attr">server:</span> <span class="string">https://artalk.131495.xyz</span>   <span class="comment"># 你的 Artalk 后端地址</span></span><br><span class="line">  <span class="attr">site:</span> <span class="string">Gabriel的博客</span>                  <span class="comment"># 必须与后台创建的站点名称一致</span></span><br></pre></td></tr></table></figure><h3 id="2-重新部署"><a href="#2-重新部署" class="headerlink" title="2. 重新部署"></a>2. 重新部署</h3><p>执行 <code>hexo s</code> 重新启动博客。</p><p>访问博客文章页面，评论区应已正常加载。</p><hr><h2 id="五、故障排查-Troubleshooting"><a href="#五、故障排查-Troubleshooting" class="headerlink" title="五、故障排查 (Troubleshooting)"></a>五、故障排查 (Troubleshooting)</h2><p>在部署过程中，特别是配合 Cloudflare 使用时，可能会遇到以下问题：</p><h3 id="1-跨域问题-CORS"><a href="#1-跨域问题-CORS" class="headerlink" title="1. 跨域问题 (CORS)"></a>1. 跨域问题 (CORS)</h3><ul><li><strong>现象</strong>：F12 控制台报错 <code>No &#39;Access-Control-Allow-Origin&#39; header</code>。</li><li><strong>原因</strong>：Artalk 默认开启跨域限制。</li><li><strong>解决</strong>：登录 Artalk 后台 -> <strong>设置</strong> -> <strong>可信域名</strong>，添加你的博客域名（如 <code>https://localhost:4000</code>）。</li></ul><h3 id="2-混合内容错误-Mixed-Content"><a href="#2-混合内容错误-Mixed-Content" class="headerlink" title="2. 混合内容错误 (Mixed Content)"></a>2. 混合内容错误 (Mixed Content)</h3><ul><li><strong>现象</strong>：GitHub Pages (HTTPS) 无法加载 Artalk (HTTP) 资源。</li><li><strong>解决</strong>：确保 Artalk <strong>Server URL</strong> 填写的是 <code>https://</code> 开头的地址。</li></ul><h3 id="3-Cloudflare-特有坑点"><a href="#3-Cloudflare-特有坑点" class="headerlink" title="3. Cloudflare 特有坑点"></a>3. Cloudflare 特有坑点</h3><p>如果你开启了 Cloudflare 的小黄云（代理模式），请注意：</p><div class="note warning flat"><p><strong>1. 端口限制</strong><br>CF 仅代理 443, 8443, 2053 等特定端口。如果直接使用 IP:20002 访问会失败。<strong>请务必使用 Nginx 反代后的 443 端口。</strong></p></div><div class="note warning flat"><p><strong>2. 控制台无法加载 (X-Frame-Options)</strong><br>CF 默认可能会添加安全标头，导致 Artalk iframe 加载失败。<br><strong>解决</strong>：在 CF 后台 -> 规则 -> 转换规则 -> HTTP 响应头 -> <strong>关闭</strong> <code>添加安全性标头</code>。</p></div><div class="note warning flat"><p><strong>3. IP 属地不显示</strong><br>CF 可能会隐藏真实 IP。<br><strong>解决</strong>：在 CF 后台 -> 规则 -> 转换规则 -> HTTP 请求头 -> <strong>关闭</strong> <code>删除访问者 IP 标头</code>。<br>同时，Artalk 后台 -> 设置 -> 服务器 -> 代理标头名，填入 <code>X-Forwarded-For</code>。</p></div><div class="note warning flat"><p><strong>4. 图片上传失败 (403 Forbidden)</strong><br><strong>解决</strong>：在 CF 后台 -> Scrape Shield -> <strong>关闭</strong> <code>Hotlink 保护</code>。</p></div><hr><h2 id="六、高级功能定制"><a href="#六、高级功能定制" class="headerlink" title="六、高级功能定制"></a>六、高级功能定制</h2><h3 id="1-界面个性化"><a href="#1-界面个性化" class="headerlink" title="1. 界面个性化"></a>1. 界面个性化</h3><p>在 Artalk 后台 -&gt; <strong>设置</strong> -&gt; <strong>界面配置</strong>，可进行个性化配置。</p><ul><li>评论框占位文字：<code>让思绪在此停泊，或如风，或如诗…</code></li><li>无评论显示文字：<code>此处静默，却等待你的第一笔心动。</code></li><li>发送按钮文字；<code>寄往光的深处</code></li><li><strong>表情包</strong>：<ul><li>默认的是：<code>https://cdn.jsdelivr.net/gh/ArtalkJS/Emoticons/grps/default.json</code></li><li>改用：<code>https://cdn.jsdelivr.net/gh/eryajf/emotion_generate/dist/artalk.json</code></li></ul></li><li>默认勾选 <strong>投票按钮</strong>；</li><li>默认不勾选 <strong>返回按钮</strong>；</li><li>勾选 <strong>用户UA徽标</strong>；（勾选后，会显示比如 Edge137，Windows11）</li></ul><h3 id="2-IP-属地显示"><a href="#2-IP-属地显示" class="headerlink" title="2. IP 属地显示"></a>2. IP 属地显示</h3><ol><li>下载 IP 数据库：<a href="https://github.com/lionsoul2014/ip2region/tree/v2.12.0/data">ip2region.xdb</a><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget -O /app/artalk/data/ip2region.xdb https://raw.githubusercontent.com/lionsoul2014/ip2region/v2.12.0/data/ip2region.xdb</span><br></pre></td></tr></table></figure></li><li>在 Artalk 后台 -&gt; <strong>设置</strong> -&gt; <strong>IP属地</strong>，勾选 <strong>开启 IP 属地展示</strong>。</li><li>如果网站使用了 CDN 代理，在 Artalk 后台 -&gt; <strong>设置</strong> -&gt; <strong>服务器</strong> -&gt; <strong>代理标头名</strong>，填写 <code>X-Forwarded-For</code>。</li></ol><h3 id="3-UpGit-图片上传-GitHub-图床"><a href="#3-UpGit-图片上传-GitHub-图床" class="headerlink" title="3. UpGit 图片上传 (GitHub 图床)"></a>3. UpGit 图片上传 (GitHub 图床)</h3><p>Artalk 默认支持调用本地程序上传图片。<br>为了节省服务器磁盘空间，我们可以集成 <a href="https://github.com/pluveto/upgit">UpGit</a> 将图片转存 GitHub。</p><h4 id="步骤-A-安装-UpGit"><a href="#步骤-A-安装-UpGit" class="headerlink" title="步骤 A: 安装 UpGit"></a>步骤 A: 安装 UpGit</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 下载 upgit 程序</span></span><br><span class="line">wget  -O /app/artalk/upgit https://github.com/pluveto/upgit/releases/download/v0.2.25/upgit_linux_arm64</span><br><span class="line"><span class="comment"># 设置可执行权限</span></span><br><span class="line"><span class="built_in">chmod</span> 775 /app/artalk/upgit</span><br></pre></td></tr></table></figure><h4 id="步骤-B-配置-UpGit"><a href="#步骤-B-配置-UpGit" class="headerlink" title="步骤 B: 配置 UpGit"></a>步骤 B: 配置 UpGit</h4><p>创建 <code>vi /app/artalk/data/config.upgit.toml</code>，填入你的 GitHub Token 和仓库信息（详见<a href="https://github.com/pluveto/upgit">UpGit文档</a>）。</p><figure class="highlight toml"><figcaption><span>config.upgit.toml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># =============================================================================</span></span><br><span class="line"><span class="comment"># UPGIT 配置</span></span><br><span class="line"><span class="comment"># =============================================================================</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 默认上传器</span></span><br><span class="line"><span class="attr">default_uploader</span> = <span class="string">&quot;github&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 上传文件名的格式模板（仅特定上传器适配）</span></span><br><span class="line"><span class="comment">#   / 目录分隔符, 作用: 是区分目录</span></span><br><span class="line"><span class="comment">#   &#123;year&#125; 年份, 例如: 2022</span></span><br><span class="line"><span class="comment">#   &#123;month&#125; 月份, 例如: 02</span></span><br><span class="line"><span class="comment">#   &#123;day&#125; 天, 例如: 01</span></span><br><span class="line"><span class="comment">#   &#123;unix_ts&#125; 时间戳, 例如: 1643617626</span></span><br><span class="line"><span class="comment">#   &#123;fname&#125; 原始文件名，如 logo (不含后缀名)</span></span><br><span class="line"><span class="comment">#   &#123;fname_hash&#125; &#123;fname&#125;的 MD5 散列值</span></span><br><span class="line"><span class="comment">#   &#123;ext&#125; 文件后缀名, 例如.png</span></span><br><span class="line"><span class="comment">#   下面的例子生成的文件名预览: 2022/01/upgit_20220131_1643617626.png</span></span><br><span class="line"><span class="comment">#   如果目录不存在将会被程序自动创建</span></span><br><span class="line"><span class="attr">rename</span> = <span class="string">&quot;artalk/&#123;year&#125;/&#123;month&#125;/upgit_&#123;year&#125;&#123;month&#125;&#123;day&#125;_&#123;unix_ts&#125;&#123;ext&#125;&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># -----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># 自定义输出格式</span></span><br><span class="line"><span class="comment"># -----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">#   &#123;url&#125; 图片文件的网络URL地址</span></span><br><span class="line"><span class="section">[output_formats]</span></span><br><span class="line"><span class="attr">&quot;bbcode&quot;</span> = <span class="string">&quot;[img]&#123;url&#125;[/img]&quot;</span></span><br><span class="line"><span class="attr">&quot;html&quot;</span> = <span class="string">&#x27;&lt;img src=&quot;&#123;url&#125;&quot; /&gt;&#x27;</span></span><br><span class="line"><span class="attr">&quot;markdown-simple&quot;</span> = <span class="string">&quot;![](&#123;url&#125;)&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># -----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># 直链替换规则 RawUrl -[replace]-&gt; Url</span></span><br><span class="line"><span class="comment"># -----------------------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果您的网络访问Github异常或者缓慢，您可以尝试下面的配置以开启CDN加速</span></span><br><span class="line"><span class="comment"># [replacements]</span></span><br><span class="line"><span class="attr">&quot;raw.githubusercontent.com&quot;</span> = <span class="string">&quot;cdn.jsdelivr.net/gh&quot;</span></span><br><span class="line"><span class="attr">&quot;/main&quot;</span> = <span class="string">&quot;@main&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># =============================================================================</span></span><br><span class="line"><span class="comment"># 以下为各个上传器的配置示例. 用不到的留空即可</span></span><br><span class="line"><span class="comment"># =============================================================================</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Github 上传器</span></span><br><span class="line"><span class="section">[uploaders.github]</span></span><br><span class="line"><span class="comment"># 保存文件的分支，例如 master 或 main</span></span><br><span class="line"><span class="attr">branch</span> = <span class="string">&quot;main&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 您的拥有&quot;repo&quot;权限的 Github 令牌</span></span><br><span class="line"><span class="comment"># 获取Github Token连接: https://github.com/settings/tokens</span></span><br><span class="line"><span class="attr">pat</span> = <span class="string">&quot;ghp_XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 您的公共Github存储库的名称</span></span><br><span class="line"><span class="comment"># 注意: 为了让您和他人可以访问到图片资源, 您的Github仓库一定要是公开的, </span></span><br><span class="line"><span class="comment">#       在私有仓库中Github会拦截未授权的请求,你将会得到一个404.</span></span><br><span class="line"><span class="attr">repo</span> = <span class="string">&quot;pic.cloud&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 您的 Gtihub 用户名 </span></span><br><span class="line"><span class="attr">username</span> = <span class="string">&quot;lijiabao9&quot;</span></span><br></pre></td></tr></table></figure><h4 id="步骤-C-修改-Docker-Compose"><a href="#步骤-C-修改-Docker-Compose" class="headerlink" title="步骤 C: 修改 Docker Compose"></a>步骤 C: 修改 Docker Compose</h4><p>我们需要将宿主机上的 <code>upgit</code> 程序挂载到容器内部。</p><figure class="highlight yaml"><figcaption><span>docker-compose.yml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">artalk:</span></span><br><span class="line">    <span class="comment"># ... 其他配置保持不变</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./data:/data</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./upgit:/usr/bin/upgit</span>  <span class="comment"># 新增挂载</span></span><br></pre></td></tr></table></figure><h4 id="步骤-D-启用集成"><a href="#步骤-D-启用集成" class="headerlink" title="步骤 D: 启用集成"></a>步骤 D: 启用集成</h4><ol><li>重建容器：<code>docker compose down &amp;&amp; docker compose up -d</code></li><li>Artalk 后台 -> 图片上传 -> -&gt; Upgit配置 -&gt; <strong>启用 Upgit</strong>。</li><li>上传命令填写：<code>upgit -c /data/config.upgit.toml</code>。</li></ol><hr><p>此时，上传的图片，会被上传到 GitHub。</p><h3 id="4-精美邮件通知模板"><a href="#4-精美邮件通知模板" class="headerlink" title="4. 精美邮件通知模板"></a>4. 精美邮件通知模板</h3><p>Artalk 支持自定义邮件模板。以下是几款精选的模板代码，复制即可使用。</p><div class="tabs"><div class="nav-tabs"><button type="button" class="tab">仿App聊天界面</button><button type="button" class="tab">左侧视觉分栏</button><button type="button" class="tab active">孟菲斯</button><button type="button" class="tab">故障票据</button><button type="button" class="tab">VSCode代码编辑器</button><button type="button" class="tab">复古打字机</button></div><div class="tab-contents"><div class="tab-item-content"><p><img src="https://cdn.jsdelivr.net/gh/lijiabao9/pic.cloud@main/hexo/post/20251205223757537.webp" alt=""></p><figure class="highlight html"><figcaption><span>./data/mail_tpl/Chat-UI.html</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;background-color: #f2f2f7; padding: 40px 0; font-family: -apple-system, BlinkMacSystemFont, &#x27;Segoe UI&#x27;, Roboto, Helvetica, Arial, sans-serif;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;max-width: 400px; margin: 0 auto; background-color: #ffffff; border-radius: 24px; overflow: hidden; box-shadow: 0 20px 50px rgba(0,0,0,0.15); border: 8px solid #1c1c1e;&quot;</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;background-color: #f9f9f9; padding: 15px 20px; border-bottom: 1px solid #e5e5ea; display: flex; align-items: center; justify-content: space-between;&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;font-size: 12px; font-weight: 600; color: #000;&quot;</span>&gt;</span>&#123;&#123;site_name&#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;font-size: 10px; color: #8e8e93;&quot;</span>&gt;</span>刚刚<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;padding: 20px; background-color: #ffffff; min-height: 250px;&quot;</span>&gt;</span></span><br><span class="line">            </span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;text-align: center; margin-bottom: 20px;&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">&quot;background-color: #f2f2f7; color: #8e8e93; font-size: 10px; padding: 4px 8px; border-radius: 4px;&quot;</span>&gt;</span>收到新回复<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">table</span> <span class="attr">width</span>=<span class="string">&quot;100%&quot;</span> <span class="attr">cellpadding</span>=<span class="string">&quot;0&quot;</span> <span class="attr">cellspacing</span>=<span class="string">&quot;0&quot;</span> <span class="attr">border</span>=<span class="string">&quot;0&quot;</span> <span class="attr">style</span>=<span class="string">&quot;margin-bottom: 20px;&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">td</span> <span class="attr">align</span>=<span class="string">&quot;right&quot;</span> <span class="attr">valign</span>=<span class="string">&quot;top&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;display: inline-block; text-align: left;&quot;</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;background-color: #e5e5ea; color: #000; padding: 10px 14px; border-radius: 18px 18px 4px 18px; font-size: 13px; max-width: 240px; margin-bottom: 4px;&quot;</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">&quot;font-size:10px; color:#666; display:block; margin-bottom:2px;&quot;</span>&gt;</span>我<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                                &#123;&#123;content&#125;&#125;</span><br><span class="line">                            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">td</span> <span class="attr">width</span>=<span class="string">&quot;40&quot;</span> <span class="attr">align</span>=<span class="string">&quot;right&quot;</span> <span class="attr">valign</span>=<span class="string">&quot;bottom&quot;</span> <span class="attr">style</span>=<span class="string">&quot;padding-left: 8px;&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;https://cravatar.cn/avatar/&#123;&#123;parent_comment.email_encrypted&#125;&#125;?d=monsterid&amp;s=80&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width: 30px; height: 30px; border-radius: 50%; background: #ccc;&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">table</span> <span class="attr">width</span>=<span class="string">&quot;100%&quot;</span> <span class="attr">cellpadding</span>=<span class="string">&quot;0&quot;</span> <span class="attr">cellspacing</span>=<span class="string">&quot;0&quot;</span> <span class="attr">border</span>=<span class="string">&quot;0&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">td</span> <span class="attr">width</span>=<span class="string">&quot;40&quot;</span> <span class="attr">valign</span>=<span class="string">&quot;bottom&quot;</span> <span class="attr">style</span>=<span class="string">&quot;padding-right: 8px;&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;https://cravatar.cn/avatar/&#123;&#123;comment.email_encrypted&#125;&#125;?d=monsterid&amp;s=80&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width: 36px; height: 36px; border-radius: 50%; box-shadow: 0 2px 4px rgba(0,0,0,0.1);&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">td</span> <span class="attr">align</span>=<span class="string">&quot;left&quot;</span> <span class="attr">valign</span>=<span class="string">&quot;top&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;font-size: 12px; color: #8e8e93; margin-left: 4px; margin-bottom: 2px;&quot;</span>&gt;</span>&#123;&#123;reply_nick&#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;background-color: #007aff; color: #ffffff; padding: 12px 16px; border-radius: 18px 18px 18px 4px; font-size: 14px; line-height: 1.5; box-shadow: 0 2px 8px rgba(0,122,255,0.25);&quot;</span>&gt;</span></span><br><span class="line">                            &#123;&#123;reply_content&#125;&#125;</span><br><span class="line">                        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;padding: 12px 15px 20px 15px; background-color: #f9f9f9; border-top: 1px solid #e5e5ea;&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&#123;&#123;link_to_reply&#125;&#125;&quot;</span> <span class="attr">style</span>=<span class="string">&quot;display: block; text-decoration: none;&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;background-color: #ffffff; border: 1px solid #e5e5ea; border-radius: 20px; padding: 10px 15px; color: #007aff; font-size: 14px; text-align: center; font-weight: 500;&quot;</span>&gt;</span></span><br><span class="line">                    点击此处回复消息...</span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;text-align: center; margin-top: 10px;&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&#123;&#123;page_url&#125;&#125;&quot;</span> <span class="attr">style</span>=<span class="string">&quot;font-size: 10px; color: #c7c7cc; text-decoration: none;&quot;</span>&gt;</span>来源文章: &#123;&#123;page_title&#125;&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure></div><div class="tab-item-content"><p><img src="https://cdn.jsdelivr.net/gh/lijiabao9/pic.cloud@main/hexo/post/20251205223949926.webp" alt=""></p><figure class="highlight html"><figcaption><span>./data/mail_tpl/Magazine-Split.html</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;background-color: #e9ecef; padding: 40px 0; font-family: &#x27;Helvetica Neue&#x27;, Helvetica, Arial, sans-serif;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;max-width: 600px; margin: 0 auto; background-color: #ffffff; box-shadow: 0 15px 30px rgba(0,0,0,0.1);&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">table</span> <span class="attr">width</span>=<span class="string">&quot;100%&quot;</span> <span class="attr">cellspacing</span>=<span class="string">&quot;0&quot;</span> <span class="attr">cellpadding</span>=<span class="string">&quot;0&quot;</span> <span class="attr">border</span>=<span class="string">&quot;0&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span> <span class="attr">width</span>=<span class="string">&quot;35%&quot;</span> <span class="attr">valign</span>=<span class="string">&quot;top&quot;</span> <span class="attr">style</span>=<span class="string">&quot;background-color: #212529; color: #ffffff; padding: 40px 20px; text-align: center;&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;https://cravatar.cn/avatar/&#123;&#123;comment.email_encrypted&#125;&#125;?d=monsterid&amp;s=120&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width: 80px; height: 80px; border-radius: 50%; border: 3px solid #495057; margin-bottom: 15px;&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;font-size: 18px; font-weight: bold; letter-spacing: 1px;&quot;</span>&gt;</span>&#123;&#123;reply_nick&#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;font-size: 10px; text-transform: uppercase; color: #adb5bd; margin-top: 5px; letter-spacing: 2px;&quot;</span>&gt;</span>Replied To You<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                    </span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;margin-top: 40px; border-top: 1px solid #343a40; padding-top: 20px;&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&#123;&#123;link_to_reply&#125;&#125;&quot;</span> <span class="attr">style</span>=<span class="string">&quot;background-color: #ffd43b; color: #212529; padding: 10px 20px; text-decoration: none; font-size: 12px; font-weight: bold; display: inline-block; border-radius: 2px;&quot;</span>&gt;</span></span><br><span class="line">                            查看详情 <span class="symbol">&amp;rarr;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                </span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span> <span class="attr">width</span>=<span class="string">&quot;65%&quot;</span> <span class="attr">valign</span>=<span class="string">&quot;top&quot;</span> <span class="attr">style</span>=<span class="string">&quot;padding: 40px 30px; background-color: #ffffff;&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;font-size: 10px; color: #868e96; letter-spacing: 1px; margin-bottom: 20px;&quot;</span>&gt;</span>IN ARTICLE: <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&#123;&#123;page_url&#125;&#125;&quot;</span> <span class="attr">style</span>=<span class="string">&quot;color: #868e96; text-decoration: none; border-bottom: 1px dotted #ccc;&quot;</span>&gt;</span>&#123;&#123;page_title&#125;&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                    </span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;border-left: 2px solid #dee2e6; padding-left: 15px; margin-bottom: 25px;&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;font-size: 12px; color: #adb5bd; margin-bottom: 5px;&quot;</span>&gt;</span>YOU SAID:<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;font-size: 13px; color: #868e96; font-style: italic;&quot;</span>&gt;</span>&quot;&#123;&#123;content&#125;&#125;&quot;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;font-family: Georgia, &#x27;Times New Roman&#x27;, serif; font-size: 16px; line-height: 1.6; color: #212529;&quot;</span>&gt;</span></span><br><span class="line">                        &#123;&#123;reply_content&#125;&#125;</span><br><span class="line">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;margin-top: 50px; font-size: 10px; color: #ced4da; text-align: right;&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&#123;&#123;site_url&#125;&#125;&quot;</span> <span class="attr">style</span>=<span class="string">&quot;color: #ced4da; text-decoration: none;&quot;</span>&gt;</span>&#123;&#123;site_name&#125;&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span> Notification System</span><br><span class="line">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure></div><div class="tab-item-content active"><p><img src="https://cdn.jsdelivr.net/gh/lijiabao9/pic.cloud@main/hexo/post/20251205224149287.webp" alt=""></p><figure class="highlight html"><figcaption><span>./data/mail_tpl/Neo-Brutalism.html</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;background-color: #fff4e0; padding: 50px 0; font-family: Helvetica, Arial, sans-serif;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;max-width: 500px; margin: 0 auto;&quot;</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;background-color: #a388ee; border: 3px solid #000; box-shadow: 6px 6px 0px #000; padding: 15px; margin-bottom: 20px; text-align: center;&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">h1</span> <span class="attr">style</span>=<span class="string">&quot;margin: 0; font-size: 28px; font-weight: 900; color: #000; text-transform: uppercase; font-style: italic;&quot;</span>&gt;</span></span><br><span class="line">                Hey! Wake Up!</span><br><span class="line">            <span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;background-color: #fff; border: 3px solid #000; box-shadow: 6px 6px 0px #000; padding: 30px;&quot;</span>&gt;</span></span><br><span class="line">            </span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;text-align: center; margin-top: -60px; margin-bottom: 20px;&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;https://cravatar.cn/avatar/&#123;&#123;comment.email_encrypted&#125;&#125;?d=monsterid&amp;s=100&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width: 80px; height: 80px; border: 3px solid #000; background-color: #ff90e8; border-radius: 50%;&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">p</span> <span class="attr">style</span>=<span class="string">&quot;font-weight: 700; font-size: 18px; text-align: center; margin: 0 0 20px 0;&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">&quot;background-color: #ff90e8; padding: 2px 5px; border: 1px solid #000;&quot;</span>&gt;</span>&#123;&#123;reply_nick&#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span> 刚刚回复了你：</span><br><span class="line">            <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;background-color: #f0f0f0; border: 2px solid #000; padding: 15px; font-size: 16px; font-weight: 500; line-height: 1.5; color: #000;&quot;</span>&gt;</span></span><br><span class="line">                &quot;&#123;&#123;reply_content&#125;&#125;&quot;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;margin-top: 20px; font-size: 12px; color: #666; border-left: 4px solid #000; padding-left: 10px;&quot;</span>&gt;</span></span><br><span class="line">                Target: &quot;&#123;&#123;page_title&#125;&#125;&quot;<span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">                Your text: &#123;&#123;content&#125;&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;margin-top: 30px;&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&#123;&#123;link_to_reply&#125;&#125;&quot;</span> <span class="attr">style</span>=<span class="string">&quot;display: block; background-color: #000; color: #fff; text-decoration: none; text-align: center; padding: 15px; font-weight: 900; text-transform: uppercase; font-size: 16px; transition: all 0.2s;&quot;</span>&gt;</span></span><br><span class="line">                    Go To Reply -&gt;</span><br><span class="line">                <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;text-align: center; margin-top: 20px; font-weight: 700; font-size: 12px;&quot;</span>&gt;</span></span><br><span class="line">            &#123;&#123;site_name&#125;&#125; // NO_SPAM</span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure></div><div class="tab-item-content"><p><img src="https://cdn.jsdelivr.net/gh/lijiabao9/pic.cloud@main/hexo/post/20251205224218660.webp" alt=""></p><figure class="highlight html"><figcaption><span>./data/mail_tpl/Ticket.html</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;background-color: #000000; padding: 40px 10px; font-family: &#x27;Courier New&#x27;, Courier, monospace;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;max-width: 480px; margin: 0 auto; background-color: #ffffff; position: relative;&quot;</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;height: 8px; background: repeating-linear-gradient(45deg, #000, #000 10px, #f4d03f 10px, #f4d03f 20px);&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;padding: 25px;&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">table</span> <span class="attr">width</span>=<span class="string">&quot;100%&quot;</span> <span class="attr">style</span>=<span class="string">&quot;border-bottom: 2px dashed #000; padding-bottom: 15px; margin-bottom: 15px;&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">td</span> <span class="attr">align</span>=<span class="string">&quot;left&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">&quot;font-weight: 900; font-size: 24px; letter-spacing: -1px;&quot;</span>&gt;</span>NEW REPLY<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">td</span> <span class="attr">align</span>=<span class="string">&quot;right&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">&quot;background: #000; color: #fff; padding: 2px 6px; font-size: 12px;&quot;</span>&gt;</span>#ID_&#123;&#123;comment.id&#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;margin-bottom: 20px;&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;font-size: 12px; color: #666; text-transform: uppercase;&quot;</span>&gt;</span>From / Sender<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;display: flex; align-items: center; margin-top: 5px;&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;https://cravatar.cn/avatar/&#123;&#123;comment.email_encrypted&#125;&#125;?d=monsterid&amp;s=80&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width: 40px; height: 40px; border-radius: 0; border: 2px solid #000; margin-right: 15px;&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">&quot;font-size: 18px; font-weight: 700;&quot;</span>&gt;</span>&#123;&#123;reply_nick&#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;border: 2px solid #000; padding: 15px; margin-bottom: 20px; background-color: #f8f8f8;&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">p</span> <span class="attr">style</span>=<span class="string">&quot;margin: 0; font-size: 14px; line-height: 1.5;&quot;</span>&gt;</span>&#123;&#123;reply_content&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;font-size: 12px; color: #666; margin-bottom: 20px;&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">&quot;background: #ccc; color: #000; padding: 0 4px;&quot;</span>&gt;</span>REF<span class="tag">&lt;/<span class="name">span</span>&gt;</span> Your comment in &quot;&#123;&#123;page_title&#125;&#125;&quot;:<span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">&quot;font-style: italic;&quot;</span>&gt;</span>&quot;&#123;&#123;content&#125;&#125;&quot;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;border-top: 2px dashed #000; background-color: #f4d03f; padding: 20px; text-align: center;&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&#123;&#123;link_to_reply&#125;&#125;&quot;</span> <span class="attr">style</span>=<span class="string">&quot;display: block; width: 100%; text-decoration: none; color: #000; font-weight: 900; font-size: 16px; letter-spacing: 1px; text-transform: uppercase;&quot;</span>&gt;</span></span><br><span class="line">                [ CLICK TO VIEW REPLY ]</span><br><span class="line">            <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;font-size: 10px; margin-top: 10px; opacity: 0.6;&quot;</span>&gt;</span></span><br><span class="line">                &#123;&#123;site_url&#125;&#125; // AUTO_GENERATED_MSG</span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure></div><div class="tab-item-content"><p><img src="https://cdn.jsdelivr.net/gh/lijiabao9/pic.cloud@main/hexo/post/20251205224319655.webp" alt=""></p><figure class="highlight html"><figcaption><span>./data/mail_tpl/VSCode.html</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;background-color: #1e1e1e; padding: 40px 0; font-family: Consolas, &#x27;Courier New&#x27;, monospace; color: #d4d4d4;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;max-width: 600px; margin: 0 auto; background-color: #252526; border-radius: 6px; overflow: hidden; box-shadow: 0 10px 20px rgba(0,0,0,0.5); border: 1px solid #3c3c3c;&quot;</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;background-color: #2d2d2d; padding: 10px 15px; display: flex; align-items: center; border-bottom: 1px solid #1e1e1e;&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;display: flex; gap: 6px; margin-right: 15px;&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;width: 10px; height: 10px; border-radius: 50%; background-color: #ff5f56;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;width: 10px; height: 10px; border-radius: 50%; background-color: #ffbd2e;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;width: 10px; height: 10px; border-radius: 50%; background-color: #27c93f;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;background-color: #1e1e1e; padding: 5px 15px; border-radius: 4px 4px 0 0; font-size: 12px; color: #9cdcfe;&quot;</span>&gt;</span></span><br><span class="line">                reply_notification.js</span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;padding: 20px; font-size: 13px; line-height: 1.6;&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">table</span> <span class="attr">width</span>=<span class="string">&quot;100%&quot;</span> <span class="attr">cellpadding</span>=<span class="string">&quot;0&quot;</span> <span class="attr">cellspacing</span>=<span class="string">&quot;0&quot;</span> <span class="attr">border</span>=<span class="string">&quot;0&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">td</span> <span class="attr">valign</span>=<span class="string">&quot;top&quot;</span> <span class="attr">width</span>=<span class="string">&quot;30&quot;</span> <span class="attr">style</span>=<span class="string">&quot;color: #858585; text-align: right; padding-right: 15px; border-right: 1px solid #404040; user-select: none;&quot;</span>&gt;</span></span><br><span class="line">                        1<span class="tag">&lt;<span class="name">br</span>&gt;</span>2<span class="tag">&lt;<span class="name">br</span>&gt;</span>3<span class="tag">&lt;<span class="name">br</span>&gt;</span>4<span class="tag">&lt;<span class="name">br</span>&gt;</span>5<span class="tag">&lt;<span class="name">br</span>&gt;</span>6<span class="tag">&lt;<span class="name">br</span>&gt;</span>7<span class="tag">&lt;<span class="name">br</span>&gt;</span>8<span class="tag">&lt;<span class="name">br</span>&gt;</span>9<span class="tag">&lt;<span class="name">br</span>&gt;</span>10<span class="tag">&lt;<span class="name">br</span>&gt;</span>11</span><br><span class="line">                    <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">td</span> <span class="attr">valign</span>=<span class="string">&quot;top&quot;</span> <span class="attr">style</span>=<span class="string">&quot;padding-left: 15px;&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">&quot;color: #c586c0;&quot;</span>&gt;</span>import<span class="tag">&lt;/<span class="name">span</span>&gt;</span> &#123; Notification &#125; <span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">&quot;color: #c586c0;&quot;</span>&gt;</span>from<span class="tag">&lt;/<span class="name">span</span>&gt;</span> <span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">&quot;color: #ce9178;&quot;</span>&gt;</span>&#x27;&#123;&#123;site_name&#125;&#125;&#x27;<span class="tag">&lt;/<span class="name">span</span>&gt;</span>;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">&quot;color: #6a9955;&quot;</span>&gt;</span>// @Author: You (Original Comment)<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">&quot;color: #6a9955;&quot;</span>&gt;</span>// Content: &quot;&#123;&#123;content&#125;&#125;&quot;<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">&quot;color: #569cd6;&quot;</span>&gt;</span>const<span class="tag">&lt;/<span class="name">span</span>&gt;</span> <span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">&quot;color: #9cdcfe;&quot;</span>&gt;</span>reply<span class="tag">&lt;/<span class="name">span</span>&gt;</span> = <span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">&quot;color: #c586c0;&quot;</span>&gt;</span>new<span class="tag">&lt;/<span class="name">span</span>&gt;</span> <span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">&quot;color: #4ec9b0;&quot;</span>&gt;</span>Message<span class="tag">&lt;/<span class="name">span</span>&gt;</span>(&#123;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;padding-left: 20px;&quot;</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">&quot;color: #9cdcfe;&quot;</span>&gt;</span>from<span class="tag">&lt;/<span class="name">span</span>&gt;</span>: <span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">&quot;color: #ce9178;&quot;</span>&gt;</span>&quot;&#123;&#123;reply_nick&#125;&#125;&quot;<span class="tag">&lt;/<span class="name">span</span>&gt;</span>,</span><br><span class="line">                        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;padding-left: 20px;&quot;</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">&quot;color: #9cdcfe;&quot;</span>&gt;</span>content<span class="tag">&lt;/<span class="name">span</span>&gt;</span>: <span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">&quot;color: #ce9178;&quot;</span>&gt;</span>`&#123;&#123;reply_content&#125;&#125;`<span class="tag">&lt;/<span class="name">span</span>&gt;</span>,</span><br><span class="line">                        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;padding-left: 20px;&quot;</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">&quot;color: #9cdcfe;&quot;</span>&gt;</span>action<span class="tag">&lt;/<span class="name">span</span>&gt;</span>: () <span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">&quot;color: #569cd6;&quot;</span>&gt;</span>=&gt;<span class="tag">&lt;/<span class="name">span</span>&gt;</span> &#123;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;padding-left: 40px;&quot;</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&#123;&#123;link_to_reply&#125;&#125;&quot;</span> <span class="attr">style</span>=<span class="string">&quot;color: #ce9178; text-decoration: underline;&quot;</span>&gt;</span>window.open(url);<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;padding-left: 20px;&quot;</span>&gt;</span>&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">div</span>&gt;</span>&#125;);<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;background-color: #1e1e1e; border-top: 1px solid #3c3c3c; padding: 10px 15px;&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;font-size: 11px; color: #858585; margin-bottom: 8px;&quot;</span>&gt;</span>TERMINAL<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&#123;&#123;link_to_reply&#125;&#125;&quot;</span> <span class="attr">style</span>=<span class="string">&quot;display: block; background-color: #0e639c; color: #fff; text-decoration: none; padding: 8px; text-align: center; font-size: 12px; font-weight: bold; font-family: sans-serif;&quot;</span>&gt;</span></span><br><span class="line">                &gt; npm run view-reply</span><br><span class="line">            <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure></div><div class="tab-item-content"><p><img src="https://cdn.jsdelivr.net/gh/lijiabao9/pic.cloud@main/hexo/post/20251205224351230.webp" alt=""></p><figure class="highlight html"><figcaption><span>./data/mail_tpl/Typewriter.html</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;background-color: #fdfbf7; padding: 60px 0; font-family: Georgia, &#x27;Times New Roman&#x27;, serif; color: #4a4a4a;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;max-width: 560px; margin: 0 auto; border: 1px solid #e0dcd3; background-color: #ffffff; padding: 60px 50px;&quot;</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;text-align: center; border-bottom: 2px solid #4a4a4a; padding-bottom: 20px; margin-bottom: 40px;&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">&quot;font-size: 24px; letter-spacing: 2px; text-transform: uppercase; font-weight: bold;&quot;</span>&gt;</span>&#123;&#123;site_name&#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;font-size: 16px; line-height: 1.8;&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">p</span>&gt;</span>Dear <span class="tag">&lt;<span class="name">strong</span>&gt;</span>&#123;&#123;nick&#125;&#125;<span class="tag">&lt;/<span class="name">strong</span>&gt;</span>,<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">            </span><br><span class="line">            <span class="tag">&lt;<span class="name">p</span>&gt;</span>You have received a new correspondence regarding your note on &quot;<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&#123;&#123;page_url&#125;&#125;&quot;</span> <span class="attr">style</span>=<span class="string">&quot;color: #4a4a4a; text-decoration: underline;&quot;</span>&gt;</span>&#123;&#123;page_title&#125;&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span>&quot;.<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">            </span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;margin: 40px 0; text-align: center;&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">&quot;font-style: italic; font-size: 18px; color: #000;&quot;</span>&gt;</span></span><br><span class="line">                    “ &#123;&#123;reply_content&#125;&#125; ”</span><br><span class="line">                <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;margin-top: 15px; font-size: 14px; color: #888;&quot;</span>&gt;</span></span><br><span class="line">                    — Signed by &#123;&#123;reply_nick&#125;&#125;</span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">p</span> <span class="attr">style</span>=<span class="string">&quot;font-size: 14px; color: #888;&quot;</span>&gt;</span></span><br><span class="line">                Reference to your original thought:<span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">&quot;font-style: italic;&quot;</span>&gt;</span>&quot;&#123;&#123;content&#125;&#125;&quot;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;text-align: center; margin-top: 50px;&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&#123;&#123;link_to_reply&#125;&#125;&quot;</span> <span class="attr">style</span>=<span class="string">&quot;display: inline-block; padding: 10px 30px; border: 1px solid #4a4a4a; color: #4a4a4a; text-decoration: none; text-transform: uppercase; font-size: 12px; letter-spacing: 1px; hover: background-color: #4a4a4a; hover: color: #fff;&quot;</span>&gt;</span></span><br><span class="line">                Read Full Discussion</span><br><span class="line">            <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;margin-top: 60px; text-align: center; font-size: 11px; color: #b0b0b0;&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="symbol">&amp;copy;</span> &#123;&#123;site_name&#125;&#125;. All rights reserved.<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div><h3 id="5-邮件通知"><a href="#5-邮件通知" class="headerlink" title="5. 邮件通知"></a>5. 邮件通知</h3><p>Artalk 支持通过 <strong>SMTP 协议</strong>、阿里云邮件推送、调用系统 Sendmail 命令等方式向用户发送邮件通知。</p><p>在 Artalk 后台，<strong>设置 -&gt; 邮件通知</strong>，勾选 <strong>启用邮件通知</strong>。</p><ul><li><strong>发送方式</strong>：<code>smtp</code></li><li><strong>发送人昵称</strong>：<code>&#123;&#123;reply_nick&#125;&#125;</code></li><li><strong>发送人地址</strong>：<code>noreply@example.com</code></li><li><strong>邮件标题</strong>：<code>[&#123;&#123;site_name&#125;&#125;] 您收到了来自 @&#123;&#123;reply_nick&#125;&#125; 的回复</code></li><li><strong>邮件模板文件</strong>：<code>/data/mail_tpl/Neo-Brutalism.html</code></li></ul><p>在 <strong>SMTP 发送</strong>，配置用于发送邮件的账号授权信息：</p><ul><li>对于 <strong>QQ 邮箱</strong><ul><li><strong>发件地址</strong>：<code>smtp.qq.com</code></li><li><strong>发件端口</strong>：<code>587</code></li><li><strong>用户名</strong>： <code>your_email@qq.com</code></li><li><strong>密码</strong>：（注意：是额外生成的授权码，不是邮箱的登录密码） <code>your_email_authcode</code></li></ul></li><li>对于 <strong>Microsoft 邮箱</strong><ul><li><strong>发件地址</strong>：<code>smtp.office365.com</code></li><li><strong>发件端口</strong>：<code>587</code></li><li><strong>用户名</strong>： <code>your_email@xxx.onmicrosoft.com</code></li><li><strong>密码</strong>：（注意：登录密码） <code>your_email_password</code></li></ul></li></ul><h3 id="6-社交登录"><a href="#6-社交登录" class="headerlink" title="6. 社交登录"></a>6. 社交登录</h3><p>在 Artalk 后台，<strong>设置 -&gt; 社交登录</strong>，勾选 <strong>启用社交登录</strong>，<strong>允许匿名评论</strong>。</p>]]></content>
    
    
    <summary type="html">基于 Docker Compose 私有化部署 Artalk 评论系统，详解 Nginx 反代、HTTPS 配置、Cloudflare 避坑指南，以及邮件通知和 UpGit 图床集成的高级玩法。</summary>
    
    
    
    <category term="创意工坊" scheme="https://lijiabao9.github.io/categories/%E5%88%9B%E6%84%8F%E5%B7%A5%E5%9D%8A/"/>
    
    <category term="服务搭建" scheme="https://lijiabao9.github.io/categories/%E5%88%9B%E6%84%8F%E5%B7%A5%E5%9D%8A/%E6%9C%8D%E5%8A%A1%E6%90%AD%E5%BB%BA/"/>
    
    
    <category term="Hexo" scheme="https://lijiabao9.github.io/tags/Hexo/"/>
    
    <category term="Artalk" scheme="https://lijiabao9.github.io/tags/Artalk/"/>
    
    <category term="Docker" scheme="https://lijiabao9.github.io/tags/Docker/"/>
    
    <category term="Nginx" scheme="https://lijiabao9.github.io/tags/Nginx/"/>
    
    <category term="UpGit" scheme="https://lijiabao9.github.io/tags/UpGit/"/>
    
  </entry>
  
  <entry>
    <title>从零开始：域名购买、Cloudflare 托管与 Nginx 自动化 HTTPS 配置全指南</title>
    <link href="https://lijiabao9.github.io/posts/e94f4538.html"/>
    <id>https://lijiabao9.github.io/posts/e94f4538.html</id>
    <published>2025-12-04T16:32:58.000Z</published>
    <updated>2025-12-27T02:22:20.018Z</updated>
    
    <content type="html"><![CDATA[<p>搭建一个安全的网站，从拥有一个域名开始。本文将带你走完：<strong>域名购买 -&gt; 接入 Cloudflare CDN -&gt; 服务器获取 SSL 证书 -&gt; Nginx 反向代理</strong> 的全套流程。</p><h2 id="第一步：域名购买-SpaceShip"><a href="#第一步：域名购买-SpaceShip" class="headerlink" title="第一步：域名购买 (SpaceShip)"></a>第一步：域名购买 (SpaceShip)</h2><p>推荐使用 <a href="https://www.spaceship.com/">SpaceShip</a>，它是 Namecheap 旗下的新平台，界面现代且价格透明。</p><h3 id="1-选购技巧"><a href="#1-选购技巧" class="headerlink" title="1. 选购技巧"></a>1. 选购技巧</h3><ul><li><strong>搜索策略</strong>：在首页搜索 <strong>6位数字</strong> 的 <code>.xyz</code> 域名（例如 <code>131495.xyz</code>）。</li><li><strong>价格陷阱</strong>：确保首年价格显示为 <strong>$0.67</strong> 左右。</li><li><strong>支付方式</strong>：支持 Visa/MasterCard 信用卡、支付宝等。</li></ul><div class="note warning flat"><p><strong>注意续费价格</strong>：购买前请留意 <em>Renewal Price</em>。建议在结账时直接点击 <strong>Extend subscription</strong>，勾选 <strong>9 years</strong>，一次性买断 10 年，避免后续涨价烦恼。</p></div><p>购买完成后，点击右上角 <strong>Launchpad</strong> -&gt; <strong>Domain Manager</strong> 即可看到你的域名。</p><hr><h2 id="第二步：托管到-Cloudflare"><a href="#第二步：托管到-Cloudflare" class="headerlink" title="第二步：托管到 Cloudflare"></a>第二步：托管到 Cloudflare</h2><p>国内域名解析需要实名认证备案，且解析速度和功能不如 Cloudflare 强大。我们将 DNS 解析权移交给 Cloudflare。</p><h3 id="1-接入站点"><a href="#1-接入站点" class="headerlink" title="1. 接入站点"></a>1. 接入站点</h3><ol><li>登录 <a href="https://www.cloudflare.com/zh-cn/">Cloudflare</a>，点击 <strong>加入域</strong>。</li><li>输入你的域名 <code>131495.xyz</code>，勾选 <strong>快速扫描 DNS 记录</strong>，点击 <strong>继续</strong>。</li><li>选择 <strong>Free (免费计划)</strong>。</li></ol><h3 id="2-修改-NameServer-NS"><a href="#2-修改-NameServer-NS" class="headerlink" title="2. 修改 NameServer (NS)"></a>2. 修改 NameServer (NS)</h3><p>Cloudflare 会分配两个 NS 地址（例如 <code>xxxx.ns.cloudflare.com</code>）。</p><ol><li>回到 <strong>SpaceShip</strong> 的 <strong>Domain Manager</strong>，点击 <em>你的域名</em>。</li><li>找到 <strong>NameServers &amp; DNS</strong> 选项，点击 <strong>Nameservers</strong> 的 <strong>change</strong>。</li><li>选择 <strong>Custom nameservers</strong>，填入 Cloudflare 提供的两个地址并保存。</li></ol><p>等待生效（通常几分钟到几小时），收到 Cloudflare 的邮件即代表托管成功。</p><h3 id="3-DNS-记录与代理状态"><a href="#3-DNS-记录与代理状态" class="headerlink" title="3. DNS 记录与代理状态"></a>3. DNS 记录与代理状态</h3><p>在 Cloudflare 的域名管理页面，在 <strong>DNS</strong> -&gt; <strong>记录</strong> 中配置解析。</p><ul><li><strong>A 记录</strong>：将域名指向你服务器的 IPv4 地址。</li><li><strong>CNAME 记录</strong>：用于别名解析。</li></ul><div class="note info flat"><p><strong>关于“小黄云”（代理状态）：</strong></p><ul><li><strong>开启 (橙云)</strong>：流量经过 Cloudflare CDN。隐藏真实 IP，提供防护，支持 SSL。</li><li><strong>关闭 (灰云)</strong>：仅作为 DNS 解析。直连服务器，暴露真实 IP。</li></ul></div><h3 id="4-推荐的-Cloudflare-优化配置"><a href="#4-推荐的-Cloudflare-优化配置" class="headerlink" title="4. 推荐的 Cloudflare 优化配置"></a>4. 推荐的 Cloudflare 优化配置</h3><p>开启橙云代理后，建议调整以下设置以提升性能和安全：</p><ul><li><strong>SSL/TLS</strong> -&gt; <strong>概述</strong>：设置为 <strong>完全(严格) / Full (Strict)</strong>（最安全，要求源服务器有有效证书）</li><li><strong>安全性</strong> -&gt; <strong>设置</strong>：开启 <strong>自动程序攻击模式</strong>，<strong>连续脚本监视</strong></li><li><strong>速度</strong> -&gt; <strong>配置</strong>：点击 <em>建议</em> 里的 <strong>启用所有可用配置</strong>，<strong>Cloudflare Fonts</strong>，<strong>Early Hints</strong>，<strong>0-RTT 连接恢复</strong></li><li><strong>缓存</strong> -&gt; <strong>配置</strong>：<span class='p gray'>CSAM 扫描工具</span>，<span class='p gray'>Crawler Hints</span>，<span class='p gray'>Always Online™</span></li><li><strong>规则</strong> -&gt; <strong>设置</strong>：开启以下功能<ul><li><strong>添加 TLS 客户端身份验证标头</strong></li><li><strong>添加访问者位置标头</strong></li><li><span class='p gray'>删除访问者 IP 标头</span></li><li><strong>添加泄露凭据检查标头</strong></li><li><strong>删除 “X-Powered-By” 标头</strong></li><li><span class='p gray'>添加安全性标头</span></li><li><strong>URL 规范化 -&gt; 标准化传入到源服务器的 URL</strong></li></ul></li><li><strong>网络</strong>：开启 <strong>gRPC</strong></li><li><strong>Scrape Shiedld</strong>：<span class='p gray'>Hotlink保护</span></li></ul><hr><h2 id="第三步：获取公开可信证书-ACME"><a href="#第三步：获取公开可信证书-ACME" class="headerlink" title="第三步：获取公开可信证书 (ACME)"></a>第三步：获取公开可信证书 (ACME)</h2><p>虽然 Cloudflare 提供源服务器证书，但为了通用性和灵活性（比如后续想切回灰云直连），推荐使用 <a href="https://github.com/acmesh-official/acme.sh">acme.sh</a> 申请 <em>Let’s Encrypt</em> 的泛域名证书。</p><h3 id="1-获取-Cloudflare-API-Token"><a href="#1-获取-Cloudflare-API-Token" class="headerlink" title="1. 获取 Cloudflare API Token"></a>1. 获取 Cloudflare API Token</h3><p>我们需要授权 acme.sh 修改 Cloudflare 的 DNS 记录来完成域名验证。</p><ol><li>首页 -&gt; <strong>管理账号</strong> -&gt; <strong>账号 API 令牌</strong> -&gt; <strong>创建令牌</strong>。</li><li>使用模板：<strong>编辑区域 DNS</strong>。<ul><li><strong>令牌名称</strong>：任意填写，比如 <em>ACME 证书续期</em></li><li><strong>权限</strong>：选择 <strong>区域</strong> -&gt; <strong>DSN</strong> -&gt; <strong>编辑</strong></li><li><strong>区域资源</strong>：选择 <strong>包括</strong> -&gt; <strong>特定区域</strong> -&gt; <em>你的域名</em></li><li><strong>客户端IP地址筛选</strong>：（可选）可设置ip黑白名单</li><li><strong>TTL</strong>：（可选）可配置令牌有效期</li></ul></li><li>生成并复制 Token。</li></ol><h3 id="2-安装-acme-sh"><a href="#2-安装-acme-sh" class="headerlink" title="2. 安装 acme.sh"></a>2. 安装 acme.sh</h3><p>登录服务器，执行安装：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装依赖</span></span><br><span class="line">apt update &amp;&amp; apt install -y curl socat</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装 acme.sh</span></span><br><span class="line">curl https://get.acme.sh | sh</span><br></pre></td></tr></table></figure><h3 id="3-配置环境变量"><a href="#3-配置环境变量" class="headerlink" title="3. 配置环境变量"></a>3. 配置环境变量</h3><p>将 API Token 导入环境变量，<code>vi ~/.bashrc</code> 添加：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 注意：CF_Token 是 Cloudflare 专用的变量名，不可更改</span></span><br><span class="line"><span class="built_in">export</span> CF_Token=<span class="string">&quot;你的_API_Token_xxxxxxxxxxxxxx&quot;</span></span><br></pre></td></tr></table></figure><p>保存退出后，重新启动终端。</p><h3 id="4-申请泛域名证书"><a href="#4-申请泛域名证书" class="headerlink" title="4. 申请泛域名证书"></a>4. 申请泛域名证书</h3><p>我们申请 ECC 算法的证书（更小更快），并同时包含主域名和泛域名：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 切换默认 CA 为 Let&#x27;s Encrypt</span></span><br><span class="line">acme.sh --set-default-ca --server letsencrypt</span><br><span class="line"></span><br><span class="line"><span class="comment"># 申请证书 (自动使用 CF_Token 进行 DNS-01 验证)</span></span><br><span class="line">acme.sh --issue --dns dns_cf -d <span class="string">&quot;131495.xyz&quot;</span> -d <span class="string">&quot;*.131495.xyz&quot;</span></span><br></pre></td></tr></table></figure><p>成功后，证书文件会保存在 <code>~/.acme.sh/131495.xyz_ecc/</code> 目录下。</p><h3 id="5-安装证书"><a href="#5-安装证书" class="headerlink" title="5. 安装证书"></a>5. 安装证书</h3><p><strong>切勿直接使用 .acme.sh 目录下的文件</strong>。应使用 <code>--install-cert</code> 命令将证书复制到指定位置，并配置自动重载 Nginx。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建存放目录</span></span><br><span class="line"><span class="built_in">mkdir</span> -p /cert/acme_131495.xyz/</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装证书并指定重载命令</span></span><br><span class="line">acme.sh --install-cert -d <span class="string">&quot;131495.xyz&quot;</span> \</span><br><span class="line">  --cert-file       /cert/acme_131495.xyz/cert.pem \</span><br><span class="line">  --key-file        /cert/acme_131495.xyz/key.pem \</span><br><span class="line">  --fullchain-file  /cert/acme_131495.xyz/fullchain.pem \</span><br><span class="line">  --ca-file         /cert/acme_131495.xyz/ca.cer \</span><br><span class="line">  --reloadcmd       <span class="string">&quot;systemctl reload nginx&quot;</span></span><br></pre></td></tr></table></figure><hr><h2 id="第四步：Nginx-配置-HTTPS"><a href="#第四步：Nginx-配置-HTTPS" class="headerlink" title="第四步：Nginx 配置 HTTPS"></a>第四步：Nginx 配置 HTTPS</h2><p>证书准备就绪，接下来配置 Nginx 反向代理。</p><h3 id="1-安装-Nginx"><a href="#1-安装-Nginx" class="headerlink" title="1. 安装 Nginx"></a>1. 安装 Nginx</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt install nginx -y</span><br></pre></td></tr></table></figure><h3 id="2-默认配置修改"><a href="#2-默认配置修改" class="headerlink" title="2. 默认配置修改"></a>2. 默认配置修改</h3><p>修改配置文件：<code>vi /etc/nginx/nginx.conf</code>，</p><ul><li>增加默认 SSL/TLS 证书配置</li><li>自定义的日志格式 <code>proxy_json</code></li><li>开启 <code>gzip</code> 配置</li></ul><figure class="highlight plaintext"><figcaption><span>nginx.conf</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">http &#123;</span><br><span class="line">        ##</span><br><span class="line">        # SSL Settings</span><br><span class="line">        ##</span><br><span class="line"></span><br><span class="line">        ssl_protocols TLSv1 TLSv1.1 TLSv1.2 TLSv1.3; # Dropping SSLv3, ref: POODLE</span><br><span class="line">        ssl_prefer_server_ciphers on;</span><br><span class="line">        </span><br><span class="line">        # 加密套件</span><br><span class="line">        ssl_ciphers HIGH:!aNULL:!MD5;</span><br><span class="line">        </span><br><span class="line">        # 配置证书地址</span><br><span class="line">        ssl_certificate /cert/acme_131495.xyz/cert.pem;</span><br><span class="line">        ssl_certificate_key /cert/acme_131495.xyz/key.pem;</span><br><span class="line">        </span><br><span class="line">        ##</span><br><span class="line">        # Logging Settings</span><br><span class="line">        ##</span><br><span class="line">        </span><br><span class="line">        # 日志格式自定义</span><br><span class="line">        log_format proxy_json escape=json </span><br><span class="line">          &#x27;&#123;&#x27;</span><br><span class="line">            &#x27;&quot;timestamp&quot;: &quot;$time_iso8601&quot;, &#x27;</span><br><span class="line">            &#x27;&quot;request_id&quot;: &quot;$request_id&quot;, &#x27;</span><br><span class="line">            &#x27;&quot;client_ip&quot;: &quot;$remote_addr&quot;, &#x27;</span><br><span class="line">            &#x27;&quot;vhost&quot;: &quot;$host&quot;, &#x27;</span><br><span class="line">            &#x27;&quot;method&quot;: &quot;$request_method&quot;, &#x27;</span><br><span class="line">            &#x27;&quot;uri&quot;: &quot;$uri&quot;, &#x27;</span><br><span class="line">            &#x27;&quot;status&quot;: $status, &#x27;</span><br><span class="line">            &#x27;&quot;upstream&quot;: &#123;&#x27;</span><br><span class="line">                &#x27;&quot;addr&quot;: &quot;$upstream_addr&quot;, &#x27;</span><br><span class="line">                &#x27;&quot;status&quot;: &quot;$upstream_status&quot;, &#x27;</span><br><span class="line">                &#x27;&quot;response_time&quot;: &quot;$upstream_response_time&quot;, &#x27;</span><br><span class="line">                &#x27;&quot;connect_time&quot;: &quot;$upstream_connect_time&quot;&#x27;</span><br><span class="line">            &#x27;&#125;,&#x27;</span><br><span class="line">            &#x27;&quot;request_time&quot;: &quot;$request_time&quot;, &#x27;</span><br><span class="line">            &#x27;&quot;headers&quot;: &#123;&#x27;</span><br><span class="line">                &#x27;&quot;user_agent&quot;: &quot;$http_user_agent&quot;, &#x27;</span><br><span class="line">                &#x27;&quot;x_forwarded_for&quot;: &quot;$proxy_add_x_forwarded_for&quot;, &#x27;</span><br><span class="line">                &#x27;&quot;x_forwarded_proto&quot;: &quot;$scheme&quot;&#x27;</span><br><span class="line">            &#x27;&#125;&#x27;</span><br><span class="line">          &#x27;&#125;&#x27;;</span><br><span class="line">          </span><br><span class="line">        access_log /var/log/nginx/access.log;</span><br><span class="line"></span><br><span class="line">        ##</span><br><span class="line">        # Gzip Settings</span><br><span class="line">        ##</span><br><span class="line"></span><br><span class="line">        gzip on;</span><br><span class="line"></span><br><span class="line">        gzip_vary on;</span><br><span class="line">        gzip_proxied any;</span><br><span class="line">        gzip_comp_level 6;</span><br><span class="line">        gzip_buffers 16 8k;</span><br><span class="line">        gzip_http_version 1.1;</span><br><span class="line">        gzip_types text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>修改配置文件：<code>vi /etc/nginx/sites-available/default</code>，强制使用 HTTPS：</p><figure class="highlight plaintext"><figcaption><span>default</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen 80 default_server;</span><br><span class="line">    listen [::]:80 default_server;</span><br><span class="line">    </span><br><span class="line">    server_name _;</span><br><span class="line">    </span><br><span class="line">    return 301 https://$host$request_uri;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">    listen 443 ssl default_server;</span><br><span class="line">    listen [::]:443 ssl default_server;</span><br><span class="line">    </span><br><span class="line">    server_name _;</span><br><span class="line"></span><br><span class="line">    # 静态文件目录</span><br><span class="line">    root /var/www/html;</span><br><span class="line">    index index.html index.htm index.nginx-debian.html;</span><br><span class="line"></span><br><span class="line">    location / &#123;</span><br><span class="line">        try_files $uri $uri/ =404;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-准备-proxy-params"><a href="#3-准备-proxy-params" class="headerlink" title="3. 准备 proxy_params"></a>3. 准备 proxy_params</h3><p>为了让后端应用获取客户端真实 IP，建议创建一个代理参数文件：<code>vi /etc/nginx/proxy_params</code></p><figure class="highlight plaintext"><figcaption><span>proxy_params</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">proxy_set_header Host $host;</span><br><span class="line">proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">proxy_set_header X-Forwarded-Proto $scheme;</span><br></pre></td></tr></table></figure><p>对应的 websocket 协议的代理参数文件：<code>vi /etc/nginx/proxy_params_ws</code></p><figure class="highlight plaintext"><figcaption><span>proxy_params_ws</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">proxy_set_header Host $host;</span><br><span class="line">proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">proxy_set_header X-Forwarded-Proto $scheme;</span><br><span class="line">proxy_http_version 1.1;</span><br><span class="line">proxy_set_header Upgrade $http_upgrade;</span><br><span class="line">proxy_set_header Connection &quot;upgrade&quot;;</span><br></pre></td></tr></table></figure><h3 id="4-配置站点-虚拟主机"><a href="#4-配置站点-虚拟主机" class="headerlink" title="4. 配置站点 (虚拟主机)"></a>4. 配置站点 (虚拟主机)</h3><p>创建配置文件：<code>vi /etc/nginx/sites-available/example.131495.xyz</code></p><figure class="highlight plaintext"><figcaption><span>example.131495.xyz</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen 443 ssl;</span><br><span class="line">    listen [::]:443 ssl;</span><br><span class="line">    </span><br><span class="line">    # TODO: 修改为对应的子域名</span><br><span class="line">    server_name example.131495.xyz;</span><br><span class="line">    </span><br><span class="line">    # TODO: 独立的日志配置</span><br><span class="line">    access_log /var/log/nginx/example.access.log proxy_json;</span><br><span class="line">    error_log /var/log/nginx/example.error.log;</span><br><span class="line"></span><br><span class="line">    # 反向代理设置</span><br><span class="line">    location / &#123;</span><br><span class="line">        # TODO: 修改为实际的服务地址</span><br><span class="line">        proxy_pass http://127.0.0.1:8080;</span><br><span class="line">        </span><br><span class="line">        # 代理参数</span><br><span class="line">        include /etc/nginx/proxy_params;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-启用配置并重启"><a href="#4-启用配置并重启" class="headerlink" title="4. 启用配置并重启"></a>4. 启用配置并重启</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建软链接启用站点</span></span><br><span class="line"><span class="built_in">ln</span> -s /etc/nginx/sites-available/example.131495.xyz /etc/nginx/sites-enabled/</span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查配置语法</span></span><br><span class="line">nginx -t</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重启服务</span></span><br><span class="line">systemctl reload nginx</span><br></pre></td></tr></table></figure><hr><p>至此，你的网站已经拥有了安全的 HTTPS 访问能力，并且证书会由 acme.sh 自动续期，Cloudflare 也会提供全球 CDN 加速与防护。</p>]]></content>
    
    
    <summary type="html">本文详细记录了从 SpaceShip 购买便宜域名，托管至 Cloudflare 进行 DNS 解析，利用 acme.sh 配合 Cloudflare API 自动申请泛域名证书，并最终配置 Nginx 实现全站 HTTPS 的完整流程。</summary>
    
    
    
    <category term="开发环境" scheme="https://lijiabao9.github.io/categories/%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/"/>
    
    <category term="网站运维" scheme="https://lijiabao9.github.io/categories/%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/%E7%BD%91%E7%AB%99%E8%BF%90%E7%BB%B4/"/>
    
    
    <category term="Nginx" scheme="https://lijiabao9.github.io/tags/Nginx/"/>
    
    <category term="Cloudflare" scheme="https://lijiabao9.github.io/tags/Cloudflare/"/>
    
    <category term="Domain" scheme="https://lijiabao9.github.io/tags/Domain/"/>
    
    <category term="ACME" scheme="https://lijiabao9.github.io/tags/ACME/"/>
    
    <category term="HTTPS" scheme="https://lijiabao9.github.io/tags/HTTPS/"/>
    
  </entry>
  
  <entry>
    <title>Oracle Cloud 实例网络配置全解：防火墙放行、IPTables 清空与 Root 登录</title>
    <link href="https://lijiabao9.github.io/posts/6128b66c.html"/>
    <id>https://lijiabao9.github.io/posts/6128b66c.html</id>
    <published>2025-12-04T16:01:53.000Z</published>
    <updated>2025-12-27T02:22:20.018Z</updated>
    
    <content type="html"><![CDATA[<p>在使用 Oracle Cloud (甲骨文云) 的 Ubuntu 实例时，新手常遇到的最大的坑就是 <strong>“双重防火墙”</strong>：</p><ol><li><strong>云端防火墙</strong>：OCI 控制台的安全列表 (Security Lists)。</li><li><strong>系统防火墙</strong>：Linux 系统内部的 Netfilter/IPTables。</li></ol><p>只有两层防火墙都放行，外部流量才能真正到达你的服务。本文将带你一站式打通网络配置。</p><hr><h2 id="第一层：云端防火墙-Security-Lists"><a href="#第一层：云端防火墙-Security-Lists" class="headerlink" title="第一层：云端防火墙 (Security Lists)"></a>第一层：云端防火墙 (Security Lists)</h2><p>这是 Oracle 设定的第一道关卡。默认情况下，只放行了 SSH (22端口)。</p><h3 id="配置步骤"><a href="#配置步骤" class="headerlink" title="配置步骤"></a>配置步骤</h3><ol><li>登录 Oracle 控制台，进入 <strong>实例详情</strong> 页面。</li><li>点击 <strong>网络 (Network)</strong> 里的 <strong>子网 (Subnet)</strong> 名称的链接。</li><li>在子网详情页，点击 <strong>安全</strong> 里的 <strong>安全列表 (Security Lists)</strong>，通常有一个默认列表 <code>Default Security List for...</code>。</li><li>在 <strong>安全规则</strong>，点击 <strong>添加入站规则 (Add Ingress Rules)</strong>。</li></ol><h3 id="推荐规则-放行所有"><a href="#推荐规则-放行所有" class="headerlink" title="推荐规则 (放行所有)"></a>推荐规则 (放行所有)</h3><p>如果你希望由服务器内部防火墙接管所有流量控制，或者用于测试环境，可以添加一条“全放行”规则：</p><ul><li><strong>源 CIDR</strong>：<code>0.0.0.0/0</code> (允许所有 IP)</li><li><strong>IP 协议</strong>：<code>所有协议</code></li><li><strong>源端口范围</strong>：(留空，表示所有端口)</li></ul><h2 id="第二层：系统防火墙-IPTables"><a href="#第二层：系统防火墙-IPTables" class="headerlink" title="第二层：系统防火墙 (IPTables)"></a>第二层：系统防火墙 (IPTables)</h2><p>Oracle 提供的 Ubuntu 镜像默认开启了极其严格的 <code>iptables</code> 规则。即使你在网页控制台放行了端口，系统内部也会拦截。</p><p>最省事的做法是：<strong>清空所有规则，让服务器“裸奔”，完全由云端安全列表控制。</strong></p><h3 id="1-查看当前规则"><a href="#1-查看当前规则" class="headerlink" title="1. 查看当前规则"></a>1. 查看当前规则</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 登录 root</span></span><br><span class="line"><span class="built_in">sudo</span> -i</span><br><span class="line"></span><br><span class="line">iptables -L -n -v</span><br></pre></td></tr></table></figure><p>你会看到大量的 REJECT 规则，这就是导致网络不通的元凶。</p><h3 id="2-暴力清空规则"><a href="#2-暴力清空规则" class="headerlink" title="2. 暴力清空规则"></a>2. 暴力清空规则</h3><p>执行以下命令，删除所有链和规则，并将默认策略设置为 ACCEPT：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. 设置默认策略为接受 (防止清空规则后把自己锁在外面)</span></span><br><span class="line">iptables -P INPUT ACCEPT</span><br><span class="line">iptables -P FORWARD ACCEPT</span><br><span class="line">iptables -P OUTPUT ACCEPT</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 清空所有规则 (Flush)</span></span><br><span class="line">iptables -F</span><br><span class="line">iptables -t nat -F</span><br><span class="line">iptables -t mangle -F</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 删除所有自定义链 (Delete Chain)</span></span><br><span class="line">iptables -X</span><br><span class="line">iptables -t nat -X</span><br><span class="line">iptables -t mangle -X</span><br></pre></td></tr></table></figure><h3 id="3-持久化配置-关键步骤"><a href="#3-持久化配置-关键步骤" class="headerlink" title="3. 持久化配置 (关键步骤)"></a>3. 持久化配置 (关键步骤)</h3><p>通过命令修改的规则在重启后会失效，因为 Oracle 镜像安装了 <code>netfilter-persistent</code> 工具，开机时会自动加载 <code>/etc/iptables/rules.v4</code> 中的默认规则。</p><p>我们需要将当前“清空后”的状态保存下来：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 推荐方式：覆盖保存当前规则</span></span><br><span class="line">netfilter-persistent save</span><br></pre></td></tr></table></figure><p>或者，你也可以选择简单粗暴地卸载该工具（不推荐，不够优雅）：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 暴力方式：卸载持久化工具</span></span><br><span class="line">apt purge netfilter-persistent</span><br><span class="line"><span class="built_in">rm</span> -rf /etc/iptables</span><br></pre></td></tr></table></figure><p>最后，执行 <code>reboot</code> 重启服务器验证规则是否回滚。</p><hr><h2 id="进阶：开启-Root-密码登录"><a href="#进阶：开启-Root-密码登录" class="headerlink" title="进阶：开启 Root 密码登录"></a>进阶：开启 Root 密码登录</h2><p>Oracle 默认强制使用密钥登录且禁用 Root。为了方便管理（如使用 SFTP 客户端），我们通常会开启密码登录。</p><h3 id="1-设置-Root-密码"><a href="#1-设置-Root-密码" class="headerlink" title="1. 设置 Root 密码"></a>1. 设置 Root 密码</h3><p>使用默认用户（通常是 <code>ubuntu</code>）登录后：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 切换到 root 环境</span></span><br><span class="line"><span class="built_in">sudo</span> -i</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置密码 (需输入两次，无回显)</span></span><br><span class="line">passwd</span><br></pre></td></tr></table></figure><h3 id="2-修改-SSH-配置"><a href="#2-修改-SSH-配置" class="headerlink" title="2. 修改 SSH 配置"></a>2. 修改 SSH 配置</h3><p>编辑主配置文件：<code>vim /etc/ssh/sshd_config</code></p><p>找到以下配置并修改（如果没有则添加）：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">PermitRootLogin yes        # 允许 Root 登录</span><br><span class="line">PasswordAuthentication yes # 允许密码验证</span><br></pre></td></tr></table></figure><h3 id="3-处理子配置文件-重要坑点"><a href="#3-处理子配置文件-重要坑点" class="headerlink" title="3. 处理子配置文件 (重要坑点)"></a>3. 处理子配置文件 (重要坑点)</h3><p>在 Ubuntu 云镜像中，还有一个优先级更高的配置文件，必须同时修改：</p><p><code>vim /etc/ssh/sshd_config.d/60-cloudimg-settings.conf</code></p><p>将里面的 <code>no</code> 改为 <code>yes</code>：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PasswordAuthentication yes</span><br></pre></td></tr></table></figure><h3 id="4-重启服务"><a href="#4-重启服务" class="headerlink" title="4. 重启服务"></a>4. 重启服务</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart ssh</span><br></pre></td></tr></table></figure><hr><h2 id="附录：Oracle-网络术语解析"><a href="#附录：Oracle-网络术语解析" class="headerlink" title="附录：Oracle 网络术语解析"></a>附录：Oracle 网络术语解析</h2><p>在配置 Oracle 网络时，你经常会看到以下缩写，理解它们有助于你构建更复杂的网络架构。</p><div class="note success flat"><p><strong>核心概念速查：</strong></p><ul><li><p><strong>OCI (Oracle Cloud Infrastructure)</strong><br>即甲骨文云的基础设施平台。</p></li><li><p><strong>VCN (Virtual Cloud Network)</strong><br><strong>虚拟云网络</strong>。你在云上划出的一块私有网络区域，类似于你家里的局域网。</p></li><li><p><strong>VNIC (Virtual Network Interface Card)</strong><br><strong>虚拟网卡</strong>。实例连接到 VCN 的接口。</p><ul><li>它决定了实例的 <strong>私有/公有 IP</strong>。</li><li>一个实例可以绑定多个 VNIC（多网卡）。</li></ul></li><li><p><strong>Security List (安全列表)</strong><br><strong>子网级别的防火墙</strong>。作用于子网内的所有网卡，通常用于设置通用的规则（如全放行 SSH）。</p></li><li><p><strong>NSG (Network Security Groups)</strong><br><strong>网卡级别的防火墙</strong>。比安全列表更灵活，可以直接绑定到某个具体的 VNIC 上，仅对该实例生效。</p></li></ul></div><p><strong>流量控制层级关系：</strong></p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">实例 (Instance)</span><br><span class="line">  └── VNIC (虚拟网卡)</span><br><span class="line">       ├── 绑定 NSG (网络安全组) [可选，针对单机]</span><br><span class="line">       └── 归属 Subnet (子网)</span><br><span class="line">             └── 受 Security List (安全列表) 控制 [针对整个子网]</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">详解 Oracle Cloud 实例的“双重防火墙”机制。教你如何配置 OCI 安全列表放行端口，彻底清除 Ubuntu 默认的 IPTables 规则，并开启 Root 用户密码登录权限。</summary>
    
    
    
    <category term="开发环境" scheme="https://lijiabao9.github.io/categories/%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/"/>
    
    <category term="Oracle Cloud" scheme="https://lijiabao9.github.io/categories/%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/Oracle-Cloud/"/>
    
    
    <category term="Oracle" scheme="https://lijiabao9.github.io/tags/Oracle/"/>
    
    <category term="运维" scheme="https://lijiabao9.github.io/tags/%E8%BF%90%E7%BB%B4/"/>
    
    <category term="云服务器" scheme="https://lijiabao9.github.io/tags/%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8/"/>
    
  </entry>
  
  <entry>
    <title>Oracle Cloud 实例重装系统：利用替换引导卷 (Replace Boot Volume) 实现系统重置</title>
    <link href="https://lijiabao9.github.io/posts/e62f764.html"/>
    <id>https://lijiabao9.github.io/posts/e62f764.html</id>
    <published>2025-12-04T15:40:20.000Z</published>
    <updated>2025-12-27T02:22:20.018Z</updated>
    
    <content type="html"><![CDATA[<p>与 AWS 或一般的 VPS 提供商不同，Oracle Cloud (OCI) 的控制台中并没有一个显眼的“重装系统”按钮。</p><p>如果我们把系统玩坏了，或者想更换系统版本（例如从 Ubuntu 20.04 升级到 22.04），最优雅的方法不是删除实例重建（可能会丢 IP），而是使用 <strong>“替换引导卷” (Replace Boot Volume)</strong> 功能。</p><h2 id="第一步：获取目标系统的映像-OCID"><a href="#第一步：获取目标系统的映像-OCID" class="headerlink" title="第一步：获取目标系统的映像 OCID"></a>第一步：获取目标系统的映像 OCID</h2><p>在开始操作前，我们需要知道要安装什么系统。OCI 使用 <strong>OCID</strong> (Oracle Cloud Identifier) 来标识每一个官方镜像。</p><p>我们需要获取目标系统的 OCID，这里有两种方式：</p><h3 id="方式一：使用当前实例同款镜像（最简单）"><a href="#方式一：使用当前实例同款镜像（最简单）" class="headerlink" title="方式一：使用当前实例同款镜像（最简单）"></a>方式一：使用当前实例同款镜像（最简单）</h3><p>如果你只是想把当前的系统“恢复出厂设置”，依旧使用之前的系统版本：</p><ol><li>在实例的 <strong>详细信息 (Instance Details)</strong> 页面。</li><li>找到 <strong>映像详细信息 (Image)</strong> 部分。</li><li>点击 <strong>映像名称</strong> 链接，进入详情页。</li><li>复制 <strong>OCID</strong> 备用。</li></ol><h3 id="方式二：查阅官方文档（更换版本）"><a href="#方式二：查阅官方文档（更换版本）" class="headerlink" title="方式二：查阅官方文档（更换版本）"></a>方式二：查阅官方文档（更换版本）</h3><p>如果你想更换系统版本（例如安装最新的 Ubuntu 24.04），需要去官方文档查找。</p><blockquote><p><strong>官方镜像列表</strong>：<a href="https://docs.oracle.com/en-us/iaas/images/">https://docs.oracle.com/en-us/iaas/images/</a></p></blockquote><p><strong>⚠️ 关键注意点：</strong></p><ul><li><strong>区域 (Region)</strong>：必须选择你实例所在的区域（如 Japan East (Osaka) 或 US West (Phoenix)）。</li><li><strong>架构 (Architecture)</strong>：<ul><li>如果是 <strong>AMD</strong> 免费机，找 <code>x86_64</code> 架构的 OCID。</li><li>如果是 <strong>ARM</strong> (4H24G) 机器，必须找 <code>aarch64</code> 架构的 OCID。</li></ul></li></ul><p>复制对应条目的 <strong>OCID</strong>，格式通常为 <code>ocid1.image.oc1.ap-osaka-1.xxxx...</code>。</p><hr><h2 id="第二步：执行替换引导卷"><a href="#第二步：执行替换引导卷" class="headerlink" title="第二步：执行替换引导卷"></a>第二步：执行替换引导卷</h2><p>拿到 OCID 后，就可以开始“重装”了。</p><div class="note warning flat"><p><strong>高能预警</strong>：<br>此操作会<strong>销毁并删除</strong>当前的引导卷（系统盘）。请务必备份旧系统盘内的重要数据！<br>此操作<strong>不会</strong>改变实例的公网 IP 地址。</p></div><ol><li>登录 Oracle 控制台，进入实例详情页面。</li><li>在上方菜单点击 <strong>存储 (Storage)</strong> -&gt; <strong>引导卷 (Boot volume)</strong>。</li><li>点击 <strong>替换引导卷 (Replace Boot Volume)</strong> 按钮。</li><li>在弹出的配置窗口中填写信息：<ul><li><strong>替换方式</strong>：选择 <strong>映像 (Image)</strong>。</li><li><strong>映像应用方式</strong>：选择 <strong>输入 OCID (Enter image OCID)</strong>。</li><li><strong>镜像 OCID</strong>：粘贴第一步中获取的字符串。</li><li><strong>引导卷大小</strong>：输入 <strong>50 - 200</strong> GB（默认免费额度总共 200G，通常填 50 或 100）。</li></ul></li><li>点击 <strong>替换 (Replace)</strong>。</li></ol><h2 id="第三步：等待与连接"><a href="#第三步：等待与连接" class="headerlink" title="第三步：等待与连接"></a>第三步：等待与连接</h2><p>提交后，实例的状态会变为 <strong>Stopping</strong>（停止中），然后是 <strong>Provisioning</strong>（配置中），最后变回 <strong>Running</strong>（运行中）。</p><p>整个过程大约需要 5-10 分钟。</p><p>待状态变绿后，使用 SSH 客户端重新连接：</p><ul><li><strong>IP 地址</strong>：保持不变。</li><li><strong>用户名</strong>：根据系统而定（Ubuntu 镜像默认为 <code>ubuntu</code>，Oracle Linux 默认为 <code>opc</code>）。</li><li><strong>密钥</strong>：使用你原本的私钥（或你刚才上传的新私钥）。</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -i <span class="string">&#x27;你的私钥文件&#x27;</span> ubuntu@你的公网IP</span><br></pre></td></tr></table></figure><p>如果连接成功，恭喜你，系统重装完成！</p>]]></content>
    
    
    <summary type="html">甲骨文云 (Oracle Cloud) 没有直接的重装系统按钮。本文详解如何通过“替换引导卷”的方式，使用官方镜像 OCID 快速重置 VPS 系统，无需删除重建实例。</summary>
    
    
    
    <category term="开发环境" scheme="https://lijiabao9.github.io/categories/%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/"/>
    
    <category term="Oracle Cloud" scheme="https://lijiabao9.github.io/categories/%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/Oracle-Cloud/"/>
    
    
    <category term="Oracle" scheme="https://lijiabao9.github.io/tags/Oracle/"/>
    
    <category term="云服务器" scheme="https://lijiabao9.github.io/tags/%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8/"/>
    
  </entry>
  
  <entry>
    <title>Ubuntu 系统 Docker 安装全指南：官方源与国内镜像加速</title>
    <link href="https://lijiabao9.github.io/posts/3c32210.html"/>
    <id>https://lijiabao9.github.io/posts/3c32210.html</id>
    <published>2025-12-04T14:39:56.000Z</published>
    <updated>2025-12-27T02:22:20.018Z</updated>
    
    <content type="html"><![CDATA[<p>本文将指导你在 Ubuntu 上安装 Docker Engine。安装过程涵盖了从清理旧版本到配置国内加速源的完整生产级实践。</p><blockquote><p><strong>参考文档</strong>：<a href="https://docs.docker.com/engine/install/ubuntu">Docker Official Docs</a></p></blockquote><h2 id="一、环境清理"><a href="#一、环境清理" class="headerlink" title="一、环境清理"></a>一、环境清理</h2><p>为了防止版本冲突，首先卸载系统中可能存在的旧版本 Docker（如 <code>docker.io</code> 或 <code>docker-engine</code>）。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> apt remove $(dpkg --get-selections docker.io docker-compose docker-compose-v2 docker-doc podman-docker containerd runc | <span class="built_in">cut</span> -f1)</span><br></pre></td></tr></table></figure><h2 id="二、配置软件源-Repository"><a href="#二、配置软件源-Repository" class="headerlink" title="二、配置软件源 (Repository)"></a>二、配置软件源 (Repository)</h2><h3 id="1-安装基础工具"><a href="#1-安装基础工具" class="headerlink" title="1. 安装基础工具"></a>1. 安装基础工具</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> apt update</span><br><span class="line"><span class="built_in">sudo</span> apt install ca-certificates curl</span><br></pre></td></tr></table></figure><h3 id="2-添加-GPG-密钥"><a href="#2-添加-GPG-密钥" class="headerlink" title="2. 添加 GPG 密钥"></a>2. 添加 GPG 密钥</h3><p>创建密钥目录并下载 Docker 官方密钥。</p><div class="note info flat"><p><strong>提示</strong>：如果你位于国内服务器，连接 <code>download.docker.com</code> 可能会超时。<br>推荐使用阿里云镜像源，请将下方的 URL 替换为 <code>http://mirrors.aliyun.com/docker-ce/linux/ubuntu/gpg</code></p></div><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建密钥目录</span></span><br><span class="line"><span class="built_in">sudo</span> install -m 0755 -d /etc/apt/keyrings</span><br><span class="line"><span class="comment"># 下载官方 GPG 密钥</span></span><br><span class="line"><span class="built_in">sudo</span> curl -fsSL https://download.docker.com/linux/ubuntu/gpg -o /etc/apt/keyrings/docker.asc</span><br><span class="line"><span class="comment"># 修改密钥权限</span></span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">chmod</span> a+r /etc/apt/keyrings/docker.asc</span><br></pre></td></tr></table></figure><h3 id="3-添加-APT-源"><a href="#3-添加-APT-源" class="headerlink" title="3. 添加 APT 源"></a>3. 添加 APT 源</h3><p>根据你的 Ubuntu 版本，选择对应的源格式。</p><div class="note warning flat"><p><strong>注意</strong>：Ubuntu 24.04 LTS (Noble Numbat) 开始，APT 建议使用 DEB822 格式的 <code>.sources</code> 文件，而非传统的 <code>.list</code> 文件。</p></div><h4 id="方案-A：Ubuntu-24-04-及更高版本-sources"><a href="#方案-A：Ubuntu-24-04-及更高版本-sources" class="headerlink" title="方案 A：Ubuntu 24.04 及更高版本 (.sources)"></a>方案 A：Ubuntu 24.04 及更高版本 (.sources)</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Types: deb</span></span><br><span class="line"><span class="string">URIs: https://download.docker.com/linux/ubuntu</span></span><br><span class="line"><span class="string">Suites: <span class="subst">$(. /etc/os-release &amp;&amp; echo <span class="string">&quot;<span class="variable">$&#123;UBUNTU_CODENAME:-<span class="variable">$VERSION_CODENAME</span>&#125;</span>&quot;</span>)</span></span></span><br><span class="line"><span class="string">Components: stable</span></span><br><span class="line"><span class="string">Architectures: <span class="subst">$(dpkg --print-architecture)</span></span></span><br><span class="line"><span class="string">Signed-By: /etc/apt/keyrings/docker.asc&quot;</span> | \</span><br><span class="line">  <span class="built_in">sudo</span> <span class="built_in">tee</span> /etc/apt/sources.list.d/docker.sources &gt; /dev/null</span><br></pre></td></tr></table></figure><h4 id="方案-B：Ubuntu-23-10-及更低版本-list"><a href="#方案-B：Ubuntu-23-10-及更低版本-list" class="headerlink" title="方案 B：Ubuntu 23.10 及更低版本 (.list)"></a>方案 B：Ubuntu 23.10 及更低版本 (.list)</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> \</span><br><span class="line">  <span class="string">&quot;deb [arch=<span class="subst">$(dpkg --print-architecture)</span> signed-by=/etc/apt/keyrings/docker.asc] https://download.docker.com/linux/ubuntu \</span></span><br><span class="line"><span class="string">  <span class="subst">$(. /etc/os-release &amp;&amp; echo <span class="string">&quot;<span class="variable">$&#123;UBUNTU_CODENAME:-<span class="variable">$VERSION_CODENAME</span>&#125;</span>&quot;</span>)</span> stable&quot;</span> | \</span><br><span class="line">  <span class="built_in">sudo</span> <span class="built_in">tee</span> /etc/apt/sources.list.d/docker.list &gt; /dev/null</span><br></pre></td></tr></table></figure><p>添加完成后，<strong>务必更新索引</strong>：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> apt update</span><br></pre></td></tr></table></figure><h2 id="三、安装-Docker-Engine"><a href="#三、安装-Docker-Engine" class="headerlink" title="三、安装 Docker Engine"></a>三、安装 Docker Engine</h2><p>安装最新版本的 Docker Engine、CLI、Containerd 以及 Docker Compose 插件：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> apt install docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin</span><br></pre></td></tr></table></figure><p>验证安装版本：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker --version</span><br><span class="line">docker compose version</span><br></pre></td></tr></table></figure><h2 id="四、安装后配置-关键步骤"><a href="#四、安装后配置-关键步骤" class="headerlink" title="四、安装后配置 (关键步骤)"></a>四、安装后配置 (关键步骤)</h2><h3 id="1-免-Sudo-执行-非-Root-用户"><a href="#1-免-Sudo-执行-非-Root-用户" class="headerlink" title="1. 免 Sudo 执行 (非 Root 用户)"></a>1. 免 Sudo 执行 (非 Root 用户)</h3><p>默认情况下，运行 docker 命令需要 <code>sudo</code> 权限。为了方便使用，建议将当前用户加入 <code>docker</code> 用户组。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. 创建 docker 组 (通常安装时已自动创建)</span></span><br><span class="line"><span class="built_in">sudo</span> groupadd docker</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 将当前用户加入组</span></span><br><span class="line"><span class="built_in">sudo</span> usermod -aG docker <span class="variable">$USER</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 激活更改 (或者退出终端重新登录)</span></span><br><span class="line">newgrp docker</span><br></pre></td></tr></table></figure><p>现在你可以直接运行 <code>docker ps</code> 而无需输入密码了。</p><h3 id="2-配置镜像加速器"><a href="#2-配置镜像加速器" class="headerlink" title="2. 配置镜像加速器"></a>2. 配置镜像加速器</h3><p>国内拉取 Docker Hub 镜像非常慢，建议配置 Registry Mirrors。</p><p>编辑或创建 <code>/etc/docker/daemon.json</code>：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> vim /etc/docker/daemon.json</span><br></pre></td></tr></table></figure><p>登录 <a href="https://cr.console.aliyun.com/cn-hangzhou/instances/mirrors">阿里云容器镜像服务控制台</a>，在左侧菜单找到 <strong>镜像工具 - 镜像加速器</strong>。</p><p>复制专属的加速器地址（格式通常为 <code>https://xxxx.mirror.aliyuncs.com</code>）。</p><figure class="highlight json"><figcaption><span>daemon.json</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;registry-mirrors&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="string">&quot;https://你的专属ID.mirror.aliyuncs.com&quot;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>重启 Docker 服务使配置生效：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> systemctl daemon-reload</span><br><span class="line"><span class="built_in">sudo</span> systemctl restart docker</span><br></pre></td></tr></table></figure><h2 id="五、验证安装"><a href="#五、验证安装" class="headerlink" title="五、验证安装"></a>五、验证安装</h2><p>运行 Hello World 容器来验证一切是否正常：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run hello-world</span><br></pre></td></tr></table></figure><p>如果看到以下输出，说明安装成功：</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Hello from Docker!</span><br><span class="line">This message shows that your installation appears to be working correctly.</span><br><span class="line">...</span><br></pre></td></tr></table></figure><h2 id="六、卸载-Docker"><a href="#六、卸载-Docker" class="headerlink" title="六、卸载 Docker"></a>六、卸载 Docker</h2><p>如果需要彻底移除 Docker，请执行以下命令：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. 卸载依赖包</span></span><br><span class="line"><span class="built_in">sudo</span> apt purge docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin docker-ce-rootless-extras</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 删除镜像、容器和数据卷 (慎重！)</span></span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">rm</span> -rf /var/lib/docker</span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">rm</span> -rf /var/lib/containerd</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 删除配置文件和密钥</span></span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">rm</span> /etc/apt/sources.list.d/docker.list</span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">rm</span> /etc/apt/sources.list.d/docker.sources</span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">rm</span> /etc/apt/keyrings/docker.asc</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">详解在 Ubuntu 系统（含 24.04 新版）下安装 Docker 的全流程。包含卸载旧版、配置 GPG 密钥、设置 APT 软件源（官方/阿里云）、免 Sudo 配置及镜像加速器设置。</summary>
    
    
    
    <category term="开发环境" scheme="https://lijiabao9.github.io/categories/%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/"/>
    
    <category term="Ubuntu" scheme="https://lijiabao9.github.io/categories/%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/Ubuntu/"/>
    
    
    <category term="Docker" scheme="https://lijiabao9.github.io/tags/Docker/"/>
    
  </entry>
  
  <entry>
    <title>Ubuntu 系统安装 JDK 全指南：OpenJDK 与 Oracle JDK 双方案</title>
    <link href="https://lijiabao9.github.io/posts/3c893d60.html"/>
    <id>https://lijiabao9.github.io/posts/3c893d60.html</id>
    <published>2025-12-04T14:27:42.000Z</published>
    <updated>2025-12-27T02:22:20.018Z</updated>
    
    <content type="html"><![CDATA[<p>在 Ubuntu 服务器上部署 Java 环境通常有两种方式：</p><ol><li><strong>包管理器安装 (apt)</strong>：最简单，通常安装的是 OpenJDK，适合大多数开源项目。</li><li><strong>手动安装</strong>：适合需要特定版本（如 Oracle JDK）或需精确控制安装路径的场景。</li></ol><hr><h2 id="方案一：通过-apt-自动安装-推荐"><a href="#方案一：通过-apt-自动安装-推荐" class="headerlink" title="方案一：通过 apt 自动安装 (推荐)"></a>方案一：通过 apt 自动安装 (推荐)</h2><p>这是最快捷的方式，系统会自动处理依赖和环境变量。以安装 <strong>JDK 8</strong> 为例：</p><h3 id="1-安装与验证"><a href="#1-安装与验证" class="headerlink" title="1. 安装与验证"></a>1. 安装与验证</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. 更新软件源</span></span><br><span class="line"><span class="built_in">sudo</span> apt update</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 安装 OpenJDK 8</span></span><br><span class="line"><span class="built_in">sudo</span> apt install openjdk-8-jdk</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 验证安装</span></span><br><span class="line">java -version</span><br></pre></td></tr></table></figure><h3 id="2-管理多个-Java-版本"><a href="#2-管理多个-Java-版本" class="headerlink" title="2. 管理多个 Java 版本"></a>2. 管理多个 Java 版本</h3><p>如果你的系统同时安装了 JDK 8、JDK 11 和 JDK 17，可以使用 <code>update-alternatives</code> 命令在不同版本间快速切换。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> update-alternatives --config java</span><br></pre></td></tr></table></figure><p>执行后会出现一个列表，输入对应的 <strong>Selection</strong> 编号并回车，即可切换系统默认的 Java 版本。</p><h2 id="方案二：手动解压安装-Oracle-JDK"><a href="#方案二：手动解压安装-Oracle-JDK" class="headerlink" title="方案二：手动解压安装 (Oracle JDK)"></a>方案二：手动解压安装 (Oracle JDK)</h2><p>如果你需要使用 Oracle 官方版本，或者需要将 JDK 安装到指定目录，请使用此方法。</p><h3 id="1-下载安装包"><a href="#1-下载安装包" class="headerlink" title="1. 下载安装包"></a>1. 下载安装包</h3><p>请前往 Oracle 官网下载对应架构（x64 或 aarch64）的 <code>.tar.gz</code> 包：</p><ul><li><a href="https://www.oracle.com/java/technologies/downloads/#java8">JDK 8 下载</a> | <a href="https://www.oracle.com/java/technologies/downloads/#java17">JDK 17 下载</a> | <a href="https://www.oracle.com/java/technologies/downloads/#java21">JDK 21 下载</a></li></ul><h3 id="2-解压部署"><a href="#2-解压部署" class="headerlink" title="2. 解压部署"></a>2. 解压部署</h3><p>建议将第三方软件统一安装在 <code>/usr/local/java</code> 目录下。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. 创建目录</span></span><br><span class="line"><span class="built_in">cd</span> /usr/local</span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">mkdir</span> -p java</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 安装包准备</span></span><br><span class="line"><span class="comment"># 请使用 FTP/SFTP 工具将下载好的 tar.gz 包上传到服务器</span></span><br><span class="line"><span class="comment"># 或者 wget 命令直接下载</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 解压到指定目录 (注意替换具体的文件名)</span></span><br><span class="line"><span class="comment"># -C 参数指定解压的目标路径</span></span><br><span class="line"><span class="built_in">sudo</span> tar -zxvf jdk-8u471-linux-x64.tar.gz -C /usr/local/java/</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. 验证解压是否成功</span></span><br><span class="line"><span class="comment"># 注意：这里的目录名 jdk1.8.0_471 视你下载的具体版本而定</span></span><br><span class="line">/usr/local/java/jdk1.8.0_471/bin/java -version</span><br></pre></td></tr></table></figure><h3 id="3-配置环境变量"><a href="#3-配置环境变量" class="headerlink" title="3. 配置环境变量"></a>3. 配置环境变量</h3><p>为了在任何目录下都能使用 <code>java</code> 命令，需要配置环境变量。</p><p>编辑系统级配置文件 <code>/etc/profile</code>（对所有用户生效）：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> vim /etc/profile</span><br></pre></td></tr></table></figure><p>在文件末尾追加以下内容（<strong>注意修改 <code>JAVA_HOME</code> 为你实际的解压路径</strong>）：</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># Java Environment Config</span><br><span class="line">export JAVA_HOME=/usr/local/java/jdk1.8.0_471</span><br><span class="line">export JRE_HOME=$JAVA_HOME/jre</span><br><span class="line">export CLASSPATH=.:$JAVA_HOME/lib:$JRE_HOME/lib</span><br><span class="line">export PATH=$PATH:$JAVA_HOME/bin:$JRE_HOME/bin</span><br></pre></td></tr></table></figure><h3 id="4-重新加载配置"><a href="#4-重新加载配置" class="headerlink" title="4. 重新加载配置"></a>4. 重新加载配置</h3><p>修改配置文件后，需要强制重载才能立即生效：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">source</span> /etc/profile</span><br><span class="line"></span><br><span class="line"><span class="comment"># 再次验证</span></span><br><span class="line">java -version</span><br></pre></td></tr></table></figure><hr><h2 id="补充：Linux-配置文件加载顺序"><a href="#补充：Linux-配置文件加载顺序" class="headerlink" title="补充：Linux 配置文件加载顺序"></a>补充：Linux 配置文件加载顺序</h2><p>理解配置文件的加载顺序，有助于你决定将环境变量写在哪里。</p><ol><li><p><strong>/etc/profile</strong></p><ul><li><strong>级别</strong>：系统全局</li><li><strong>生效时机</strong>：用户登录时加载。</li><li><strong>建议</strong>：生产服务器通常在此配置 JAVA_HOME，确保所有用户可用。</li></ul></li><li><p><strong>~/.bashrc</strong></p><ul><li><strong>级别</strong>：当前用户</li><li><strong>生效时机</strong>：打开新的终端窗口（Shell）时加载。</li><li><strong>建议</strong>：开发测试环境或仅当前用户使用时，推荐修改此文件，避免污染全局环境。</li></ul></li><li><p><strong>/etc/bash.bashrc</strong></p><ul><li><strong>级别</strong>：系统全局</li><li><strong>生效时机</strong>：交互式 Shell 启动时加载。</li></ul></li></ol><blockquote><p><strong>最佳实践</strong>：</p><ul><li>如果是<strong>服务器</strong>部署应用，建议修改 <code>/etc/profile</code>。</li><li>如果是<strong>个人开发机</strong>，建议修改 <code>~/.bashrc</code>。</li></ul></blockquote>]]></content>
    
    
    <summary type="html">详解在 Ubuntu 系统上安装 Java 开发环境的两种主流方式：通过 apt 包管理器安装 OpenJDK，以及手动部署 Oracle JDK，包含环境变量配置与多版本切换指南。</summary>
    
    
    
    <category term="开发环境" scheme="https://lijiabao9.github.io/categories/%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/"/>
    
    <category term="Ubuntu" scheme="https://lijiabao9.github.io/categories/%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/Ubuntu/"/>
    
    
    <category term="JDK" scheme="https://lijiabao9.github.io/tags/JDK/"/>
    
  </entry>
  
  <entry>
    <title>Ubuntu 系统运维手册：常用命令与配置速查</title>
    <link href="https://lijiabao9.github.io/posts/428aa18f.html"/>
    <id>https://lijiabao9.github.io/posts/428aa18f.html</id>
    <published>2025-12-04T13:45:46.000Z</published>
    <updated>2025-12-27T02:22:20.018Z</updated>
    
    <content type="html"><![CDATA[<p>Ubuntu 是目前最流行的 Linux 服务器发行版之一。熟练掌握其常用命令与配置，是运维与开发的必备技能。</p><h2 id="Ubuntu-版本代号速查"><a href="#Ubuntu-版本代号速查" class="headerlink" title="Ubuntu 版本代号速查"></a>Ubuntu 版本代号速查</h2><div class="table-container"><table><thead><tr><th style="text-align:left">版本号</th><th style="text-align:left">代号</th><th style="text-align:left">状态</th><th style="text-align:left">说明</th></tr></thead><tbody><tr><td style="text-align:left"><strong>18.04 LTS</strong></td><td style="text-align:left"><em>Bionic Beaver</em></td><td style="text-align:left">⚠️ 停止维护</td><td style="text-align:left">已于 2023 年停止免费支持</td></tr><tr><td style="text-align:left"><strong>20.04 LTS</strong></td><td style="text-align:left"><em>Focal Fossa</em></td><td style="text-align:left">✅ 活跃</td><td style="text-align:left">长期支持至 2025 年 4 月</td></tr><tr><td style="text-align:left"><strong>22.04 LTS</strong></td><td style="text-align:left"><em>Jammy Jellyfish</em></td><td style="text-align:left">✅ 活跃</td><td style="text-align:left">长期支持至 2027 年 4 月</td></tr><tr><td style="text-align:left"><strong>24.04 LTS</strong></td><td style="text-align:left"><em>Noble Numbat</em></td><td style="text-align:left">🚀 最新</td><td style="text-align:left">长期支持至 2029 年 4 月</td></tr></tbody></table></div><h2 id="一、SSH-远程连接配置"><a href="#一、SSH-远程连接配置" class="headerlink" title="一、SSH 远程连接配置"></a>一、SSH 远程连接配置</h2><p>新装的 Ubuntu 服务器通常默认未开启 SSH 密码登录，甚至未安装 SSH 服务。</p><h3 id="1-安装-SSH-服务"><a href="#1-安装-SSH-服务" class="headerlink" title="1. 安装 SSH 服务"></a>1. 安装 SSH 服务</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> apt update</span><br><span class="line"><span class="built_in">sudo</span> apt install openssh-server -y</span><br><span class="line"><span class="built_in">sudo</span> systemctl status ssh  <span class="comment"># 检查运行状态</span></span><br></pre></td></tr></table></figure><h3 id="2-配置-SSH-访问权限"><a href="#2-配置-SSH-访问权限" class="headerlink" title="2. 配置 SSH 访问权限"></a>2. 配置 SSH 访问权限</h3><p>编辑配置文件 <code>/etc/ssh/sshd_config</code>：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> vim /etc/ssh/sshd_config</span><br></pre></td></tr></table></figure><p>修改或确认以下核心配置：</p><figure class="highlight text"><figcaption><span>sshd_config</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 允许密码验证登录</span><br><span class="line">PasswordAuthentication yes</span><br><span class="line"></span><br><span class="line"># 允许 root 用户直接登录（生产环境建议改为 no，仅用普通用户 sudo）</span><br><span class="line">PermitRootLogin yes</span><br></pre></td></tr></table></figure><p>重启服务使配置生效：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> systemctl restart ssh</span><br></pre></td></tr></table></figure><h3 id="3-防火墙放行-UFW"><a href="#3-防火墙放行-UFW" class="headerlink" title="3. 防火墙放行 (UFW)"></a>3. 防火墙放行 (UFW)</h3><p>如果开启了 <code>ufw</code> 防火墙，必须放行 SSH 端口（默认 22）：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> ufw allow ssh     <span class="comment"># 或 sudo ufw allow 22/tcp</span></span><br><span class="line"><span class="built_in">sudo</span> ufw <span class="built_in">enable</span>        <span class="comment"># 开启防火墙，disable 禁用防火墙</span></span><br><span class="line"><span class="built_in">sudo</span> ufw status        <span class="comment"># 查看状态</span></span><br></pre></td></tr></table></figure><h2 id="二、APT-软件源配置-国内加速"><a href="#二、APT-软件源配置-国内加速" class="headerlink" title="二、APT 软件源配置 (国内加速)"></a>二、APT 软件源配置 (国内加速)</h2><p>默认的官方源在国内访问较慢，建议替换为阿里云、清华大学等镜像源。</p><h3 id="场景-A：Ubuntu-23-10-及之前的版本-传统格式"><a href="#场景-A：Ubuntu-23-10-及之前的版本-传统格式" class="headerlink" title="场景 A：Ubuntu 23.10 及之前的版本 (传统格式)"></a>场景 A：Ubuntu 23.10 及之前的版本 (传统格式)</h3><p>编辑 <code>/etc/apt/sources.list</code>，将内容替换为（以 20.04 <code>focal</code> 为例）：</p><figure class="highlight text"><figcaption><span>sources.list</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">deb https://mirrors.aliyun.com/ubuntu/ focal main restricted universe multiverse</span><br><span class="line">deb-src https://mirrors.aliyun.com/ubuntu/ focal main restricted universe multiverse</span><br><span class="line"></span><br><span class="line">deb https://mirrors.aliyun.com/ubuntu/ focal-security main restricted universe multiverse</span><br><span class="line">deb-src https://mirrors.aliyun.com/ubuntu/ focal-security main restricted universe multiverse</span><br><span class="line"></span><br><span class="line">deb https://mirrors.aliyun.com/ubuntu/ focal-updates main restricted universe multiverse</span><br><span class="line">deb-src https://mirrors.aliyun.com/ubuntu/ focal-updates main restricted universe multiverse</span><br><span class="line"></span><br><span class="line">deb https://mirrors.aliyun.com/ubuntu/ focal-proposed main restricted universe multiverse</span><br><span class="line">deb-src https://mirrors.aliyun.com/ubuntu/ focal-proposed main restricted universe multiverse</span><br><span class="line"></span><br><span class="line">deb https://mirrors.aliyun.com/ubuntu/ focal-backports main restricted universe multiverse</span><br><span class="line">deb-src https://mirrors.aliyun.com/ubuntu/ focal-backports main restricted universe multiverse</span><br></pre></td></tr></table></figure><blockquote><p><strong>注意</strong>：需将 <code>focal</code> 替换为你当前系统的代号（如 <code>jammy</code>）。</p></blockquote><h3 id="场景-B：Ubuntu-24-04-LTS-新版-DEB822-格式"><a href="#场景-B：Ubuntu-24-04-LTS-新版-DEB822-格式" class="headerlink" title="场景 B：Ubuntu 24.04 LTS (新版 DEB822 格式)"></a>场景 B：Ubuntu 24.04 LTS (新版 DEB822 格式)</h3><p>从 24.04 开始，源配置移至 <code>/etc/apt/sources.list.d/ubuntu.sources</code>。</p><ol><li><p><strong>备份原文件</strong>：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> <span class="built_in">mv</span> /etc/apt/sources.list.d/ubuntu.sources /etc/apt/sources.list.d/ubuntu.sources.bak</span><br></pre></td></tr></table></figure></li><li><p><strong>新建配置</strong> <code>/etc/apt/sources.list.d/aliyun.sources</code>：</p><figure class="highlight text"><figcaption><span>aliyun.sources</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Types: deb</span><br><span class="line">URIs: https://mirrors.aliyun.com/ubuntu/</span><br><span class="line">Suites: noble noble-security noble-updates noble-proposed noble-backports</span><br><span class="line">Components: main restricted universe multiverse</span><br><span class="line">Signed-By: /usr/share/keyrings/ubuntu-archive-keyring.gpg</span><br></pre></td></tr></table></figure></li></ol><p><strong>最后，切记更新缓存：</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> apt update</span><br></pre></td></tr></table></figure><h2 id="三、用户与权限管理"><a href="#三、用户与权限管理" class="headerlink" title="三、用户与权限管理"></a>三、用户与权限管理</h2><h3 id="1-基础操作"><a href="#1-基础操作" class="headerlink" title="1. 基础操作"></a>1. 基础操作</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">whoami</span>                  <span class="comment"># 查看当前用户</span></span><br><span class="line"><span class="built_in">id</span>                      <span class="comment"># 查看当前用户ID和组信息</span></span><br><span class="line">su - ubuntu             <span class="comment"># 切换到指定用户</span></span><br><span class="line"><span class="built_in">sudo</span> -i                 <span class="comment"># 使用 sudo 权限切换到 root 环境</span></span><br><span class="line">passwd                  <span class="comment"># 修改当前用户密码</span></span><br></pre></td></tr></table></figure><h3 id="2-用户增删-推荐使用-adduser"><a href="#2-用户增删-推荐使用-adduser" class="headerlink" title="2. 用户增删 (推荐使用 adduser)"></a>2. 用户增删 (推荐使用 adduser)</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 新增用户 (自动创建家目录、设置 Shell)</span></span><br><span class="line"><span class="built_in">sudo</span> adduser testuser</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除用户 (建议保留家目录，若需彻底删除加 --remove-home --remove-all-files)</span></span><br><span class="line"><span class="built_in">sudo</span> deluser testuser</span><br></pre></td></tr></table></figure><h3 id="3-Sudo-提权"><a href="#3-Sudo-提权" class="headerlink" title="3. Sudo 提权"></a>3. Sudo 提权</h3><p>将普通用户加入 <code>sudo</code> 组，使其具备管理员权限：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> usermod -aG <span class="built_in">sudo</span> testuser</span><br><span class="line"></span><br><span class="line"><span class="comment"># 对应的移除命令（需要谨慎使用，移除后自身没权限提权）</span></span><br><span class="line"><span class="built_in">sudo</span> gpasswd -d testuser <span class="built_in">sudo</span></span><br></pre></td></tr></table></figure><p>或者编辑 <code>/etc/sudoers</code> 文件（需使用 <code>sudo vi</code> 命令安全编辑），添加：<code>testuser ALL=(ALL:ALL) ALL</code></p><h2 id="四、系统设置与监控"><a href="#四、系统设置与监控" class="headerlink" title="四、系统设置与监控"></a>四、系统设置与监控</h2><h3 id="1-时区设置"><a href="#1-时区设置" class="headerlink" title="1. 时区设置"></a>1. 时区设置</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">timedatectl set-timezone Asia/Shanghai  <span class="comment"># 设置为中国标准时间</span></span><br><span class="line">timedatectl                             <span class="comment"># 查看当前时间与时区</span></span><br></pre></td></tr></table></figure><h3 id="2-磁盘与资源监控"><a href="#2-磁盘与资源监控" class="headerlink" title="2. 磁盘与资源监控"></a>2. 磁盘与资源监控</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">df</span> -h                   <span class="comment"># 查看磁盘挂载与空间使用 (Disk Free)</span></span><br><span class="line"><span class="built_in">du</span> -h                   <span class="comment"># 查看当前目录下各文件夹的大小 (Disk Usage)</span></span><br><span class="line">free -m                 <span class="comment"># 查看内存使用情况 (MB)</span></span><br><span class="line">top                     <span class="comment"># 显示进程使用情况</span></span><br></pre></td></tr></table></figure><h3 id="3-网络与进程"><a href="#3-网络与进程" class="headerlink" title="3. 网络与进程"></a>3. 网络与进程</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ss -ntulp | grep 8080   <span class="comment"># 查看占用 8080 端口的进程</span></span><br><span class="line">ps -ef | grep java      <span class="comment"># 查看 Java 进程</span></span><br><span class="line"><span class="built_in">kill</span> -9 &lt;PID&gt;           <span class="comment"># 强制结束指定进程 ID</span></span><br></pre></td></tr></table></figure><h3 id="4-软件包管理-apt"><a href="#4-软件包管理-apt" class="headerlink" title="4. 软件包管理(apt)"></a>4. 软件包管理(apt)</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">apt update              <span class="comment"># 更新软件包</span></span><br><span class="line">apt list --upgradable   <span class="comment"># 列出可升级的包</span></span><br><span class="line">apt upgrade -y          <span class="comment"># 升级软件包</span></span><br><span class="line"></span><br><span class="line">apt install ufw         <span class="comment"># 安装 UFW</span></span><br><span class="line">apt remove ufw          <span class="comment"># 卸载 UFW</span></span><br><span class="line">apt purge ufw           <span class="comment"># 彻底卸载 UFW</span></span><br></pre></td></tr></table></figure><h3 id="5-服务管理"><a href="#5-服务管理" class="headerlink" title="5. 服务管理"></a>5. 服务管理</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">systemctl start/stop/restart ufw    <span class="comment"># 启动/停止/重启服务</span></span><br><span class="line">systemctl status ufw                <span class="comment"># 查看服务状态</span></span><br><span class="line">systemctl <span class="built_in">enable</span>/disable ufw        <span class="comment"># 设置/禁止服务 开机自启</span></span><br><span class="line"></span><br><span class="line">journalctl -f -u ufw                <span class="comment"># 实时滚动查看服务日志 --follow --unit</span></span><br><span class="line"></span><br><span class="line">dpkg -L ufw             <span class="comment"># 查看安装的包释放了哪些文件 --listfiles</span></span><br><span class="line">dpkg -l | grep ufw      <span class="comment"># 查看是否安装了某个包  --list</span></span><br></pre></td></tr></table></figure><h2 id="五、文件操作与压缩"><a href="#五、文件操作与压缩" class="headerlink" title="五、文件操作与压缩"></a>五、文件操作与压缩</h2><h3 id="1-常用命令"><a href="#1-常用命令" class="headerlink" title="1. 常用命令"></a>1. 常用命令</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> -p /data/web        <span class="comment"># 递归创建目录</span></span><br><span class="line"><span class="built_in">touch</span> /file.txt           <span class="comment"># 创建文件</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">rm</span> -rf /data/temp         <span class="comment"># 强制递归删除目录 (慎用!)</span></span><br><span class="line"><span class="built_in">mv</span> old.txt new.txt        <span class="comment"># 重命名或移动</span></span><br><span class="line"><span class="built_in">ln</span> -s /src/file /dst/     <span class="comment"># 创建软链接 (快捷方式)</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">cat</span> /etc/passwd     <span class="comment"># 显示文件内容</span></span><br><span class="line">less /etc/passwd    <span class="comment"># 分页显示文件内容</span></span><br></pre></td></tr></table></figure><h3 id="2-压缩与解压-Tar"><a href="#2-压缩与解压-Tar" class="headerlink" title="2. 压缩与解压 (Tar)"></a>2. 压缩与解压 (Tar)</h3><p><code>.tar.gz</code> 是 Linux 下最通用的压缩格式。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 解压，可通过 -C 指定解压到</span></span><br><span class="line">tar -zxvf filename.tar.gz</span><br><span class="line"></span><br><span class="line"><span class="comment"># 压缩</span></span><br><span class="line">tar -zcvf filename.tar.gz /source/dir</span><br></pre></td></tr></table></figure><ul><li><code>z</code>: gzip 压缩</li><li><code>x</code>: 解压 (extract)</li><li><code>c</code>: 创建 (create)</li><li><code>v</code>: 显示过程 (verbose)</li><li><code>f</code>: 指定文件名 (file)</li></ul><h2 id="六、服务后台运行-Nohup"><a href="#六、服务后台运行-Nohup" class="headerlink" title="六、服务后台运行 (Nohup)"></a>六、服务后台运行 (Nohup)</h2><p>在断开 SSH 连接后继续运行程序（如 Java Jar 包）：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 标准后台启动命令</span></span><br><span class="line"><span class="built_in">nohup</span> java -jar app.jar &gt; app.log 2&gt;&amp;1 &amp;</span><br></pre></td></tr></table></figure><ul><li><code>nohup</code>: 不挂断运行 (No Hang Up)。</li><li><code>&gt; app.log</code>: 将标准输出重定向到 app.log。</li><li><code>2&gt;&amp;1</code>: 将错误输出 (2) 重定向到标准输出 (1) 一并写入日志。</li><li><code>&amp;</code>: 在后台运行。</li></ul><p>查看实时日志：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">tail</span> -f app.log</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">全面的 Ubuntu 系统运维指南。涵盖 SSH 远程连接、时区设置、APT 国内源配置（含 24.04 新版格式）、用户权限管理及高频使用的文件与进程管理命令。</summary>
    
    
    
    <category term="开发环境" scheme="https://lijiabao9.github.io/categories/%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/"/>
    
    <category term="Ubuntu" scheme="https://lijiabao9.github.io/categories/%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/Ubuntu/"/>
    
    
    <category term="运维" scheme="https://lijiabao9.github.io/tags/%E8%BF%90%E7%BB%B4/"/>
    
    <category term="语法手册" scheme="https://lijiabao9.github.io/tags/%E8%AF%AD%E6%B3%95%E6%89%8B%E5%86%8C/"/>
    
  </entry>
  
</feed>
