<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Gabriel的博客</title>
  
  <subtitle>在代码与文字之间</subtitle>
  <link href="https://lijiabao9.github.io/atom.xml" rel="self"/>
  
  <link href="https://lijiabao9.github.io/"/>
  <updated>2025-12-05T15:42:37.264Z</updated>
  <id>https://lijiabao9.github.io/</id>
  
  <author>
    <name>Gabriel</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>极简主义统计：Umami 私有化部署与 Hexo 博客集成指南</title>
    <link href="https://lijiabao9.github.io/posts/fdad30aa.html"/>
    <id>https://lijiabao9.github.io/posts/fdad30aa.html</id>
    <published>2025-12-05T15:15:49.000Z</published>
    <updated>2025-12-05T15:42:37.264Z</updated>
    
    <content type="html"><![CDATA[<p><a href="https://umami.is/">Umami</a> 是一个简单、易用且注重隐私的开源网站分析替代方案。相比 Google Analytics，它更轻量，且完全由你自己掌握数据。</p><p>本文将带你通过 <strong>Docker Compose</strong> 完成全流程部署。</p><h2 id="一、环境准备"><a href="#一、环境准备" class="headerlink" title="一、环境准备"></a>一、环境准备</h2><p>在开始之前，请确保你的服务器已就绪：</p><ol><li><strong>服务器环境</strong>：已安装 Docker 和 Docker Compose。<ul><li>参考：<a href="/posts/3c32210.html">Ubuntu 系统 Docker 安装全指南：官方源与国内镜像加速</a></li></ul></li><li><strong>域名与证书</strong>：拥有一个域名并完成了 SSL 证书申请。<ul><li>参考：<a href="/posts/e94f4538.html">从零开始：域名购买、Cloudflare 托管与 Nginx 自动化 HTTPS 配置全指南</a></li></ul></li></ol><hr><h2 id="二、Docker-服务部署"><a href="#二、Docker-服务部署" class="headerlink" title="二、Docker 服务部署"></a>二、Docker 服务部署</h2><h3 id="1-创建工作目录"><a href="#1-创建工作目录" class="headerlink" title="1. 创建工作目录"></a>1. 创建工作目录</h3><p>登录服务器，建立 Umami 的数据存储目录：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> -p /app/umami</span><br><span class="line"><span class="built_in">cd</span> /app/umami</span><br></pre></td></tr></table></figure><h3 id="2-编写配置-docker-compose-yml"><a href="#2-编写配置-docker-compose-yml" class="headerlink" title="2. 编写配置 (docker-compose.yml)"></a>2. 编写配置 (docker-compose.yml)</h3><p>创建并编辑配置文件：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim docker-compose.yml</span><br></pre></td></tr></table></figure><p>写入以下内容。请注意：</p><ul><li><strong>APP_SECRET</strong>：这是加密盐值，务必修改为随机字符串（可在终端运行 <code>openssl rand -hex 32</code> 生成）。</li><li><strong>端口映射</strong>：将宿主机的 <code>20001</code> 映射到容器的 <code>3000</code>。</li></ul><figure class="highlight yaml"><figcaption><span>docker-compose.yml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">umami:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">ghcr.io/umami-software/umami:latest</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;20002:3000&quot;</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">DATABASE_URL:</span> <span class="string">postgresql://umami:umami@db:5432/umami</span></span><br><span class="line">      <span class="attr">APP_SECRET:</span> <span class="string">replace-me-with-a-random-string</span>  <span class="comment"># &lt;--- 务必修改这里</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="attr">db:</span></span><br><span class="line">        <span class="attr">condition:</span> <span class="string">service_healthy</span></span><br><span class="line">    <span class="attr">init:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">healthcheck:</span></span><br><span class="line">      <span class="attr">test:</span> [<span class="string">&quot;CMD-SHELL&quot;</span>, <span class="string">&quot;curl http://localhost:3000/api/heartbeat&quot;</span>]</span><br><span class="line">      <span class="attr">interval:</span> <span class="string">5s</span></span><br><span class="line">      <span class="attr">timeout:</span> <span class="string">5s</span></span><br><span class="line">      <span class="attr">retries:</span> <span class="number">5</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">db:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">postgres:15-alpine</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">POSTGRES_DB:</span> <span class="string">umami</span></span><br><span class="line">      <span class="attr">POSTGRES_USER:</span> <span class="string">umami</span></span><br><span class="line">      <span class="attr">POSTGRES_PASSWORD:</span> <span class="string">umami</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./umami-db-data:/var/lib/postgresql/data</span> <span class="comment"># 数据持久化挂载</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">healthcheck:</span></span><br><span class="line">      <span class="attr">test:</span> [<span class="string">&quot;CMD-SHELL&quot;</span>, <span class="string">&quot;pg_isready -U $$&#123;POSTGRES_USER&#125; -d $$&#123;POSTGRES_DB&#125;&quot;</span>]</span><br><span class="line">      <span class="attr">interval:</span> <span class="string">5s</span></span><br><span class="line">      <span class="attr">timeout:</span> <span class="string">5s</span></span><br><span class="line">      <span class="attr">retries:</span> <span class="number">5</span></span><br></pre></td></tr></table></figure><h3 id="3-启动服务"><a href="#3-启动服务" class="headerlink" title="3. 启动服务"></a>3. 启动服务</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker compose up -d</span><br></pre></td></tr></table></figure><p>此时，可以通过 <code>http://服务器IP:20002</code> 访问后台。但为了安全，我们接下配置 Nginx 反向代理。</p><hr><h2 id="三、Nginx-反向代理与-HTTPS"><a href="#三、Nginx-反向代理与-HTTPS" class="headerlink" title="三、Nginx 反向代理与 HTTPS"></a>三、Nginx 反向代理与 HTTPS</h2><p>为了通过域名安全访问，我们需要配置 Nginx 反向代理。</p><h3 id="1-编写-Nginx-配置"><a href="#1-编写-Nginx-配置" class="headerlink" title="1. 编写 Nginx 配置"></a>1. 编写 Nginx 配置</h3><p>创建配置文件 <code>vi /etc/nginx/sites-available/umami.131495.xyz</code>：</p><figure class="highlight nginx"><figcaption><span>umami.131495.xyz</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># HTTP 自动跳转 HTTPS</span></span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line">    <span class="attribute">listen</span> [::]:<span class="number">80</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># <span class="doctag">TODO:</span> 修改为对应的子域名</span></span><br><span class="line">    <span class="attribute">server_name</span> umami.<span class="number">131495</span>.xyz;</span><br><span class="line">    </span><br><span class="line">    <span class="attribute">return</span> <span class="number">301</span> https://<span class="variable">$host</span><span class="variable">$request_uri</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># HTTPS 配置</span></span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">443</span> ssl;</span><br><span class="line">    <span class="attribute">listen</span> [::]:<span class="number">443</span> ssl;</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># <span class="doctag">TODO:</span> 修改为对应的子域名</span></span><br><span class="line">    <span class="attribute">server_name</span> umami.<span class="number">131495</span>.xyz;</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 加密套件</span></span><br><span class="line">    <span class="attribute">ssl_ciphers</span> HIGH:!aNULL:!MD5;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 配置证书地址</span></span><br><span class="line">    <span class="attribute">ssl_certificate</span> /cert/acme_131495.xyz/cert.pem;</span><br><span class="line">    <span class="attribute">ssl_certificate_key</span> /cert/acme_131495.xyz/key.pem;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># <span class="doctag">TODO:</span> 独立的日志配置</span></span><br><span class="line">    <span class="attribute">access_log</span> /var/log/nginx/umami.access.log proxy_json;</span><br><span class="line">    <span class="attribute">error_log</span> /var/log/nginx/umami.<span class="literal">error</span>.log;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 反向代理设置</span></span><br><span class="line">    <span class="section">location</span> / &#123;</span><br><span class="line">        <span class="comment"># <span class="doctag">TODO:</span> 修改为实际的服务地址</span></span><br><span class="line">        <span class="attribute">proxy_pass</span> http://127.0.0.1:20002;</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 代理参数</span></span><br><span class="line">        <span class="attribute">include</span> /etc/nginx/proxy_params;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-启用并重载"><a href="#2-启用并重载" class="headerlink" title="2. 启用并重载"></a>2. 启用并重载</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建软链接</span></span><br><span class="line"><span class="built_in">ln</span> -s /etc/nginx/sites-available/umami.131495.xyz /etc/nginx/sites-enabled/</span><br><span class="line"></span><br><span class="line"><span class="comment"># 测试并重启</span></span><br><span class="line">nginx -t &amp;&amp; systemctl reload nginx</span><br></pre></td></tr></table></figure><h3 id="3-域名DNS记录"><a href="#3-域名DNS记录" class="headerlink" title="3. 域名DNS记录"></a>3. 域名DNS记录</h3><p>给域名添加对应的 A 记录，将 <code>umami.131495.xyz</code> 解析到服务器的 IP 地址。</p><p>现在，你可以通过 <code>https://umami.131495.xyz</code> 访问了。</p><hr><h2 id="四、初始化配置"><a href="#四、初始化配置" class="headerlink" title="四、初始化配置"></a>四、初始化配置</h2><h3 id="1-修改默认密码"><a href="#1-修改默认密码" class="headerlink" title="1. 修改默认密码"></a>1. 修改默认密码</h3><p>访问 <code>https://umami.131495.xyz</code>。</p><ul><li>默认账号：<code>admin</code></li><li>默认密码：<code>umami</code></li></ul><p><strong>重要</strong>：登录后，立即点击左上角头像 -> <strong>Settings</strong> -> <strong>Profile</strong> -> <strong>Change password</strong> 修改密码。</p><h3 id="2-添加网站"><a href="#2-添加网站" class="headerlink" title="2. 添加网站"></a>2. 添加网站</h3><p>在 <strong>Websites</strong> 页面点击 <strong>Add website</strong>，填入你的 <code>网站名称</code> 和 <code>网站网址</code>。</p><p>保存后，点击列表中的 <strong>Edit</strong> 按钮，获取 <strong>Website ID</strong>（一串 UUID）。</p><hr><h2 id="五、集成到-Hexo-Butterfly-主题"><a href="#五、集成到-Hexo-Butterfly-主题" class="headerlink" title="五、集成到 Hexo (Butterfly 主题)"></a>五、集成到 Hexo (Butterfly 主题)</h2><p>Butterfly 主题原生支持 Umami 统计，配置非常简单。</p><h3 id="1-修改主题配置"><a href="#1-修改主题配置" class="headerlink" title="1. 修改主题配置"></a>1. 修改主题配置</h3><p>编辑 <code>_config.butterfly.yml</code>：</p><figure class="highlight yaml"><figcaption><span>_config.butterfly.yml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 关闭不蒜子 (可选，避免功能重复)</span></span><br><span class="line"><span class="attr">busuanzi:</span></span><br><span class="line">  <span class="attr">site_uv:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">site_pv:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">page_pv:</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 启用 Umami</span></span><br><span class="line"><span class="attr">umami_analytics:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">serverURL:</span> <span class="string">https://umami.131495.xyz</span>  <span class="comment"># 你的 Umami 域名</span></span><br><span class="line">  <span class="attr">website_id:</span> <span class="string">xxxxx-xxxx-xxxx-xxxx-xxxxxxx</span> <span class="comment"># 刚刚获取的 UUID</span></span><br><span class="line">  <span class="attr">script_name:</span> <span class="string">script.js</span></span><br><span class="line">  <span class="attr">option:</span></span><br><span class="line">  <span class="comment"># 开启 PV/UV 展示 (需要 Token)</span></span><br><span class="line">  <span class="attr">UV_PV:</span></span><br><span class="line">    <span class="attr">site_uv:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">site_pv:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">page_pv:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">token:</span> <span class="string">填写访问令牌</span> <span class="comment"># 下文说明如何获取</span></span><br></pre></td></tr></table></figure><h3 id="2-获取-Access-Token-硬核方法"><a href="#2-获取-Access-Token-硬核方法" class="headerlink" title="2. 获取 Access Token (硬核方法)"></a>2. 获取 Access Token (硬核方法)</h3><p>Butterfly 主题通过调用 Umami API 来展示页面访问量，这需要通过 Token 进行鉴权。</p><p>目前最快捷的获取方法（针对自托管版）：</p><ol><li>用 Chrome 浏览器登录你的 Umami 后台。</li><li>按 <code>F12</code> 打开开发者工具，切换到 <strong>Network (网络)</strong> 标签。</li><li>刷新页面，随便点击一个 API 请求（如 <code>stats</code> 或 <code>websites</code>）。</li><li>在 <strong>Request Headers (请求头)</strong> 中找到 <code>Authorization</code> 字段。</li><li>复制 <code>Bearer</code> 后面的一长串字符，这就是你的 Token。</li></ol><p>或者通过调用登录 API 获取：参考 <a href="https://umami.is/docs/api/authentication">官方文档</a>。</p><h3 id="3-部署博客"><a href="#3-部署博客" class="headerlink" title="3. 部署博客"></a>3. 部署博客</h3><p>重新部署博客后，此时的访问量数据将由 Umami 接管。</p>]]></content>
    
    
    <summary type="html">摒弃 Google Analytics，拥抱隐私保护。本文详解如何通过 Docker Compose 部署 Umami 统计服务，配置 Nginx HTTPS 反代，并将其无缝集成到 Hexo Butterfly 主题中。</summary>
    
    
    
    <category term="创意工坊" scheme="https://lijiabao9.github.io/categories/%E5%88%9B%E6%84%8F%E5%B7%A5%E5%9D%8A/"/>
    
    <category term="服务搭建" scheme="https://lijiabao9.github.io/categories/%E5%88%9B%E6%84%8F%E5%B7%A5%E5%9D%8A/%E6%9C%8D%E5%8A%A1%E6%90%AD%E5%BB%BA/"/>
    
    
    <category term="Hexo" scheme="https://lijiabao9.github.io/tags/Hexo/"/>
    
    <category term="Docker" scheme="https://lijiabao9.github.io/tags/Docker/"/>
    
    <category term="Nginx" scheme="https://lijiabao9.github.io/tags/Nginx/"/>
    
    <category term="Umami" scheme="https://lijiabao9.github.io/tags/Umami/"/>
    
  </entry>
  
  <entry>
    <title>Artalk 私有化部署全指南：Docker + Nginx + Cloudflare 打造独立评论系统</title>
    <link href="https://lijiabao9.github.io/posts/1b40d3bb.html"/>
    <id>https://lijiabao9.github.io/posts/1b40d3bb.html</id>
    <published>2025-12-05T13:04:00.000Z</published>
    <updated>2025-12-05T15:42:37.264Z</updated>
    
    <content type="html"><![CDATA[<p><a href="https://artalk.js.org/">Artalk</a> 是一款简洁、轻量且功能强大的自托管评论系统。相比于 Valine 或 Gitalk，它提供了更完善的管理后台和数据隐私掌控权。</p><p>本文将演示如何通过 Docker Compose 部署 Artalk，并将其集成到 Hexo 博客（Butterfly 主题）中。</p><h2 id="一、前置准备"><a href="#一、前置准备" class="headerlink" title="一、前置准备"></a>一、前置准备</h2><p>在开始之前，请确保你已经完成了以下基础环境的搭建：</p><ol><li><strong>服务器环境</strong>：已安装 Docker 和 Docker Compose。<ul><li>参考：<a href="/posts/3c32210.html">Ubuntu 系统 Docker 安装全指南：官方源与国内镜像加速</a></li></ul></li><li><strong>域名与证书</strong>：拥有一个域名并完成了 SSL 证书申请。<ul><li>参考：<a href="/posts/e94f4538.html">从零开始：域名购买、Cloudflare 托管与 Nginx 自动化 HTTPS 配置全指南</a></li></ul></li></ol><hr><h2 id="二、服务端部署"><a href="#二、服务端部署" class="headerlink" title="二、服务端部署"></a>二、服务端部署</h2><h3 id="1-创建工作目录"><a href="#1-创建工作目录" class="headerlink" title="1. 创建工作目录"></a>1. 创建工作目录</h3><p>登录服务器，建立 Artalk 的数据存储目录：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> -p /app/artalk</span><br><span class="line"><span class="built_in">cd</span> /app/artalk</span><br></pre></td></tr></table></figure><h3 id="2-编写-Docker-Compose"><a href="#2-编写-Docker-Compose" class="headerlink" title="2. 编写 Docker Compose"></a>2. 编写 Docker Compose</h3><p>创建 <code>docker-compose.yml</code> 文件：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim docker-compose.yml</span><br></pre></td></tr></table></figure><p>写入以下配置（<strong>注意修改 <code>ATK_SITE_URL</code> 为你的博客地址</strong>）：</p><figure class="highlight yaml"><figcaption><span>docker-compose.yml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">artalk:</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">artalk</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">artalk/artalk-go</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">unless-stopped</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">20001</span><span class="string">:23366</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./data:/data</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">TZ=Asia/Shanghai</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ATK_LOCALE=zh-CN</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ATK_SITE_DEFAULT=Gabriel的博客</span>    <span class="comment"># 默认站点名称</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ATK_SITE_URL=https://lijiabao9.github.io</span>  <span class="comment"># 你的博客前端地址（用于跨域信任）</span></span><br></pre></td></tr></table></figure><h3 id="3-启动服务"><a href="#3-启动服务" class="headerlink" title="3. 启动服务"></a>3. 启动服务</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker compose up -d</span><br></pre></td></tr></table></figure><p>等待容器启动后，创建管理员账号：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">exec</span> -it artalk artalk admin</span><br></pre></td></tr></table></figure><p><em>按提示输入管理员昵称、邮箱和密码。</em><br>账号信息后续可进行修改。</p><p>此时，可以通过 <code>http://服务器IP:20001</code> 访问后台。但为了安全，我们接下配置 Nginx 反向代理。</p><hr><h2 id="三、Nginx-反向代理与-HTTPS"><a href="#三、Nginx-反向代理与-HTTPS" class="headerlink" title="三、Nginx 反向代理与 HTTPS"></a>三、Nginx 反向代理与 HTTPS</h2><p>为了启用 HTTPS 并隐藏非标准端口，我们需要配置 Nginx。</p><h3 id="1-编写-Nginx-配置"><a href="#1-编写-Nginx-配置" class="headerlink" title="1. 编写 Nginx 配置"></a>1. 编写 Nginx 配置</h3><p>创建配置文件 <code>vi /etc/nginx/sites-available/artalk.131495.xyz</code>：</p><figure class="highlight nginx"><figcaption><span>artalk.131495.xyz</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># HTTP 自动跳转 HTTPS</span></span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line">    <span class="attribute">listen</span> [::]:<span class="number">80</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># <span class="doctag">TODO:</span> 修改为对应的子域名</span></span><br><span class="line">    <span class="attribute">server_name</span> artalk.<span class="number">131495</span>.xyz;</span><br><span class="line">    </span><br><span class="line">    <span class="attribute">return</span> <span class="number">301</span> https://<span class="variable">$host</span><span class="variable">$request_uri</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># HTTPS 配置</span></span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">443</span> ssl;</span><br><span class="line">    <span class="attribute">listen</span> [::]:<span class="number">443</span> ssl;</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># <span class="doctag">TODO:</span> 修改为对应的子域名</span></span><br><span class="line">    <span class="attribute">server_name</span> artalk.<span class="number">131495</span>.xyz;</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 加密套件</span></span><br><span class="line">    <span class="attribute">ssl_ciphers</span> HIGH:!aNULL:!MD5;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 配置证书地址</span></span><br><span class="line">    <span class="attribute">ssl_certificate</span> /cert/acme_131495.xyz/cert.pem;</span><br><span class="line">    <span class="attribute">ssl_certificate_key</span> /cert/acme_131495.xyz/key.pem;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># <span class="doctag">TODO:</span> 独立的日志配置</span></span><br><span class="line">    <span class="attribute">access_log</span> /var/log/nginx/artalk.access.log proxy_json;</span><br><span class="line">    <span class="attribute">error_log</span> /var/log/nginx/artalk.<span class="literal">error</span>.log;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 反向代理设置</span></span><br><span class="line">    <span class="section">location</span> / &#123;</span><br><span class="line">        <span class="comment"># <span class="doctag">TODO:</span> 修改为实际的服务地址</span></span><br><span class="line">        <span class="attribute">proxy_pass</span> http://127.0.0.1:20001;</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 代理参数</span></span><br><span class="line">        <span class="attribute">include</span> /etc/nginx/proxy_params;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-启用配置"><a href="#2-启用配置" class="headerlink" title="2. 启用配置"></a>2. 启用配置</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建软链接</span></span><br><span class="line"><span class="built_in">ln</span> -s /etc/nginx/sites-available/artalk.131495.xyz /etc/nginx/sites-enabled/</span><br><span class="line"></span><br><span class="line"><span class="comment"># 测试并重启</span></span><br><span class="line">nginx -t &amp;&amp; systemctl reload nginx</span><br></pre></td></tr></table></figure><h3 id="3-域名DNS记录"><a href="#3-域名DNS记录" class="headerlink" title="3. 域名DNS记录"></a>3. 域名DNS记录</h3><p>给域名添加对应的 A 记录，将 <code>artalk.131495.xyz</code> 解析到服务器的 IP 地址。</p><p>现在，你可以通过 <code>https://artalk.131495.xyz</code> 访问 Artalk 控制中心了。</p><hr><h2 id="四、前端接入-Hexo-Butterfly"><a href="#四、前端接入-Hexo-Butterfly" class="headerlink" title="四、前端接入 (Hexo Butterfly)"></a>四、前端接入 (Hexo Butterfly)</h2><h3 id="1-修改主题配置"><a href="#1-修改主题配置" class="headerlink" title="1. 修改主题配置"></a>1. 修改主题配置</h3><p>编辑 Hexo 的主题配置文件 <code>_config.butterfly.yml</code>：</p><figure class="highlight yaml"><figcaption><span>_config.butterfly.yml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">comments:</span></span><br><span class="line">  <span class="attr">use:</span> <span class="string">Artalk</span></span><br><span class="line"></span><br><span class="line"><span class="attr">artalk:</span></span><br><span class="line">  <span class="attr">server:</span> <span class="string">https://artalk.131495.xyz</span>   <span class="comment"># 你的 Artalk 后端地址</span></span><br><span class="line">  <span class="attr">site:</span> <span class="string">Gabriel的博客</span>                  <span class="comment"># 必须与后台创建的站点名称一致</span></span><br></pre></td></tr></table></figure><h3 id="2-重新部署"><a href="#2-重新部署" class="headerlink" title="2. 重新部署"></a>2. 重新部署</h3><p>执行 <code>hexo s</code> 重新启动博客。</p><p>访问博客文章页面，评论区应已正常加载。</p><hr><h2 id="五、故障排查-Troubleshooting"><a href="#五、故障排查-Troubleshooting" class="headerlink" title="五、故障排查 (Troubleshooting)"></a>五、故障排查 (Troubleshooting)</h2><p>在部署过程中，特别是配合 Cloudflare 使用时，可能会遇到以下问题：</p><h3 id="1-跨域问题-CORS"><a href="#1-跨域问题-CORS" class="headerlink" title="1. 跨域问题 (CORS)"></a>1. 跨域问题 (CORS)</h3><ul><li><strong>现象</strong>：F12 控制台报错 <code>No &#39;Access-Control-Allow-Origin&#39; header</code>。</li><li><strong>原因</strong>：Artalk 默认开启跨域限制。</li><li><strong>解决</strong>：登录 Artalk 后台 -> <strong>设置</strong> -> <strong>可信域名</strong>，添加你的博客域名（如 <code>https://localhost:4000</code>）。</li></ul><h3 id="2-混合内容错误-Mixed-Content"><a href="#2-混合内容错误-Mixed-Content" class="headerlink" title="2. 混合内容错误 (Mixed Content)"></a>2. 混合内容错误 (Mixed Content)</h3><ul><li><strong>现象</strong>：GitHub Pages (HTTPS) 无法加载 Artalk (HTTP) 资源。</li><li><strong>解决</strong>：确保 Artalk <strong>Server URL</strong> 填写的是 <code>https://</code> 开头的地址。</li></ul><h3 id="3-Cloudflare-特有坑点"><a href="#3-Cloudflare-特有坑点" class="headerlink" title="3. Cloudflare 特有坑点"></a>3. Cloudflare 特有坑点</h3><p>如果你开启了 Cloudflare 的小黄云（代理模式），请注意：</p><div class="note warning flat"><p><strong>1. 端口限制</strong><br>CF 仅代理 443, 8443, 2053 等特定端口。如果直接使用 IP:20002 访问会失败。<strong>请务必使用 Nginx 反代后的 443 端口。</strong></p></div><div class="note warning flat"><p><strong>2. 控制台无法加载 (X-Frame-Options)</strong><br>CF 默认可能会添加安全标头，导致 Artalk iframe 加载失败。<br><strong>解决</strong>：在 CF 后台 -> 规则 -> 转换规则 -> HTTP 响应头 -> <strong>关闭</strong> <code>添加安全性标头</code>。</p></div><div class="note warning flat"><p><strong>3. IP 属地不显示</strong><br>CF 可能会隐藏真实 IP。<br><strong>解决</strong>：在 CF 后台 -> 规则 -> 转换规则 -> HTTP 请求头 -> <strong>关闭</strong> <code>删除访问者 IP 标头</code>。<br>同时，Artalk 后台 -> 设置 -> 服务器 -> 代理标头名，填入 <code>X-Forwarded-For</code>。</p></div><div class="note warning flat"><p><strong>4. 图片上传失败 (403 Forbidden)</strong><br><strong>解决</strong>：在 CF 后台 -> Scrape Shield -> <strong>关闭</strong> <code>Hotlink 保护</code>。</p></div><hr><h2 id="六、高级功能定制"><a href="#六、高级功能定制" class="headerlink" title="六、高级功能定制"></a>六、高级功能定制</h2><h3 id="1-界面个性化"><a href="#1-界面个性化" class="headerlink" title="1. 界面个性化"></a>1. 界面个性化</h3><p>在 Artalk 后台 -&gt; <strong>设置</strong> -&gt; <strong>界面配置</strong>，可进行个性化配置。</p><ul><li>评论框占位文字：<code>让思绪在此停泊，或如风，或如诗…</code></li><li>无评论显示文字：<code>此处静默，却等待你的第一笔心动。</code></li><li>发送按钮文字；<code>寄往光的深处</code></li><li><strong>表情包</strong>：<ul><li>默认的是：<code>https://cdn.jsdelivr.net/gh/ArtalkJS/Emoticons/grps/default.json</code></li><li>改用：<code>https://cdn.jsdelivr.net/gh/eryajf/emotion_generate/dist/artalk.json</code></li></ul></li><li>默认勾选 <strong>投票按钮</strong>；</li><li>默认不勾选 <strong>返回按钮</strong>；</li><li>勾选 <strong>用户UA徽标</strong>；（勾选后，会显示比如 Edge137，Windows11）</li></ul><h3 id="2-IP-属地显示"><a href="#2-IP-属地显示" class="headerlink" title="2. IP 属地显示"></a>2. IP 属地显示</h3><ol><li>下载 IP 数据库：<a href="https://github.com/lionsoul2014/ip2region/tree/v2.12.0/data">ip2region.xdb</a><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget -O /app/artalk/data/ip2region.xdb https://raw.githubusercontent.com/lionsoul2014/ip2region/v2.12.0/data/ip2region.xdb</span><br></pre></td></tr></table></figure></li><li>在 Artalk 后台 -&gt; <strong>设置</strong> -&gt; <strong>IP属地</strong>，勾选 <strong>开启 IP 属地展示</strong>。</li><li>如果网站使用了 CDN 代理，在 Artalk 后台 -&gt; <strong>设置</strong> -&gt; <strong>服务器</strong> -&gt; <strong>代理标头名</strong>，填写 <code>X-Forwarded-For</code>。</li></ol><h3 id="3-UpGit-图片上传-GitHub-图床"><a href="#3-UpGit-图片上传-GitHub-图床" class="headerlink" title="3. UpGit 图片上传 (GitHub 图床)"></a>3. UpGit 图片上传 (GitHub 图床)</h3><p>Artalk 默认支持调用本地程序上传图片。<br>为了节省服务器磁盘空间，我们可以集成 <a href="https://github.com/pluveto/upgit">UpGit</a> 将图片转存 GitHub。</p><h4 id="步骤-A-安装-UpGit"><a href="#步骤-A-安装-UpGit" class="headerlink" title="步骤 A: 安装 UpGit"></a>步骤 A: 安装 UpGit</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 下载 upgit 程序</span></span><br><span class="line">wget  -O /app/artalk/upgit https://github.com/pluveto/upgit/releases/download/v0.2.25/upgit_linux_arm64</span><br><span class="line"><span class="comment"># 设置可执行权限</span></span><br><span class="line"><span class="built_in">chmod</span> 775 /app/artalk/upgit</span><br></pre></td></tr></table></figure><h4 id="步骤-B-配置-UpGit"><a href="#步骤-B-配置-UpGit" class="headerlink" title="步骤 B: 配置 UpGit"></a>步骤 B: 配置 UpGit</h4><p>创建 <code>vi /app/artalk/data/config.upgit.toml</code>，填入你的 GitHub Token 和仓库信息（详见<a href="https://github.com/pluveto/upgit">UpGit文档</a>）。</p><figure class="highlight toml"><figcaption><span>config.upgit.toml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># =============================================================================</span></span><br><span class="line"><span class="comment"># UPGIT 配置</span></span><br><span class="line"><span class="comment"># =============================================================================</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 默认上传器</span></span><br><span class="line"><span class="attr">default_uploader</span> = <span class="string">&quot;github&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 上传文件名的格式模板（仅特定上传器适配）</span></span><br><span class="line"><span class="comment">#   / 目录分隔符, 作用: 是区分目录</span></span><br><span class="line"><span class="comment">#   &#123;year&#125; 年份, 例如: 2022</span></span><br><span class="line"><span class="comment">#   &#123;month&#125; 月份, 例如: 02</span></span><br><span class="line"><span class="comment">#   &#123;day&#125; 天, 例如: 01</span></span><br><span class="line"><span class="comment">#   &#123;unix_ts&#125; 时间戳, 例如: 1643617626</span></span><br><span class="line"><span class="comment">#   &#123;fname&#125; 原始文件名，如 logo (不含后缀名)</span></span><br><span class="line"><span class="comment">#   &#123;fname_hash&#125; &#123;fname&#125;的 MD5 散列值</span></span><br><span class="line"><span class="comment">#   &#123;ext&#125; 文件后缀名, 例如.png</span></span><br><span class="line"><span class="comment">#   下面的例子生成的文件名预览: 2022/01/upgit_20220131_1643617626.png</span></span><br><span class="line"><span class="comment">#   如果目录不存在将会被程序自动创建</span></span><br><span class="line"><span class="attr">rename</span> = <span class="string">&quot;artalk/&#123;year&#125;/&#123;month&#125;/upgit_&#123;year&#125;&#123;month&#125;&#123;day&#125;_&#123;unix_ts&#125;&#123;ext&#125;&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># -----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># 自定义输出格式</span></span><br><span class="line"><span class="comment"># -----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">#   &#123;url&#125; 图片文件的网络URL地址</span></span><br><span class="line"><span class="section">[output_formats]</span></span><br><span class="line"><span class="attr">&quot;bbcode&quot;</span> = <span class="string">&quot;[img]&#123;url&#125;[/img]&quot;</span></span><br><span class="line"><span class="attr">&quot;html&quot;</span> = <span class="string">&#x27;&lt;img src=&quot;&#123;url&#125;&quot; /&gt;&#x27;</span></span><br><span class="line"><span class="attr">&quot;markdown-simple&quot;</span> = <span class="string">&quot;![](&#123;url&#125;)&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># -----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># 直链替换规则 RawUrl -[replace]-&gt; Url</span></span><br><span class="line"><span class="comment"># -----------------------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果您的网络访问Github异常或者缓慢，您可以尝试下面的配置以开启CDN加速</span></span><br><span class="line"><span class="comment"># [replacements]</span></span><br><span class="line"><span class="attr">&quot;raw.githubusercontent.com&quot;</span> = <span class="string">&quot;cdn.jsdelivr.net/gh&quot;</span></span><br><span class="line"><span class="attr">&quot;/main&quot;</span> = <span class="string">&quot;@main&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># =============================================================================</span></span><br><span class="line"><span class="comment"># 以下为各个上传器的配置示例. 用不到的留空即可</span></span><br><span class="line"><span class="comment"># =============================================================================</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Github 上传器</span></span><br><span class="line"><span class="section">[uploaders.github]</span></span><br><span class="line"><span class="comment"># 保存文件的分支，例如 master 或 main</span></span><br><span class="line"><span class="attr">branch</span> = <span class="string">&quot;main&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 您的拥有&quot;repo&quot;权限的 Github 令牌</span></span><br><span class="line"><span class="comment"># 获取Github Token连接: https://github.com/settings/tokens</span></span><br><span class="line"><span class="attr">pat</span> = <span class="string">&quot;ghp_XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 您的公共Github存储库的名称</span></span><br><span class="line"><span class="comment"># 注意: 为了让您和他人可以访问到图片资源, 您的Github仓库一定要是公开的, </span></span><br><span class="line"><span class="comment">#       在私有仓库中Github会拦截未授权的请求,你将会得到一个404.</span></span><br><span class="line"><span class="attr">repo</span> = <span class="string">&quot;pic.cloud&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 您的 Gtihub 用户名 </span></span><br><span class="line"><span class="attr">username</span> = <span class="string">&quot;lijiabao9&quot;</span></span><br></pre></td></tr></table></figure><h4 id="步骤-C-修改-Docker-Compose"><a href="#步骤-C-修改-Docker-Compose" class="headerlink" title="步骤 C: 修改 Docker Compose"></a>步骤 C: 修改 Docker Compose</h4><p>我们需要将宿主机上的 <code>upgit</code> 程序挂载到容器内部。</p><figure class="highlight yaml"><figcaption><span>docker-compose.yml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">artalk:</span></span><br><span class="line">    <span class="comment"># ... 其他配置保持不变</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./data:/data</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./upgit:/usr/bin/upgit</span>  <span class="comment"># 新增挂载</span></span><br></pre></td></tr></table></figure><h4 id="步骤-D-启用集成"><a href="#步骤-D-启用集成" class="headerlink" title="步骤 D: 启用集成"></a>步骤 D: 启用集成</h4><ol><li>重建容器：<code>docker compose down &amp;&amp; docker compose up -d</code></li><li>Artalk 后台 -> 图片上传 -> -&gt; Upgit配置 -&gt; <strong>启用 Upgit</strong>。</li><li>上传命令填写：<code>upgit -c /data/config.upgit.toml</code>。</li></ol><hr><p>此时，上传的图片，会被上传到 GitHub。</p><h3 id="4-精美邮件通知模板"><a href="#4-精美邮件通知模板" class="headerlink" title="4. 精美邮件通知模板"></a>4. 精美邮件通知模板</h3><p>Artalk 支持自定义邮件模板。以下是几款精选的模板代码，复制即可使用。</p><div class="tabs"><div class="nav-tabs"><button type="button" class="tab">仿App聊天界面</button><button type="button" class="tab">左侧视觉分栏</button><button type="button" class="tab active">孟菲斯</button><button type="button" class="tab">故障票据</button><button type="button" class="tab">VSCode代码编辑器</button><button type="button" class="tab">复古打字机</button></div><div class="tab-contents"><div class="tab-item-content"><p><img src="https://cdn.jsdelivr.net/gh/lijiabao9/pic.cloud@main/hexo/post/20251205223757537.webp" alt=""></p><figure class="highlight html"><figcaption><span>./data/mail_tpl/Chat-UI.html</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;background-color: #f2f2f7; padding: 40px 0; font-family: -apple-system, BlinkMacSystemFont, &#x27;Segoe UI&#x27;, Roboto, Helvetica, Arial, sans-serif;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;max-width: 400px; margin: 0 auto; background-color: #ffffff; border-radius: 24px; overflow: hidden; box-shadow: 0 20px 50px rgba(0,0,0,0.15); border: 8px solid #1c1c1e;&quot;</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;background-color: #f9f9f9; padding: 15px 20px; border-bottom: 1px solid #e5e5ea; display: flex; align-items: center; justify-content: space-between;&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;font-size: 12px; font-weight: 600; color: #000;&quot;</span>&gt;</span>&#123;&#123;site_name&#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;font-size: 10px; color: #8e8e93;&quot;</span>&gt;</span>刚刚<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;padding: 20px; background-color: #ffffff; min-height: 250px;&quot;</span>&gt;</span></span><br><span class="line">            </span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;text-align: center; margin-bottom: 20px;&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">&quot;background-color: #f2f2f7; color: #8e8e93; font-size: 10px; padding: 4px 8px; border-radius: 4px;&quot;</span>&gt;</span>收到新回复<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">table</span> <span class="attr">width</span>=<span class="string">&quot;100%&quot;</span> <span class="attr">cellpadding</span>=<span class="string">&quot;0&quot;</span> <span class="attr">cellspacing</span>=<span class="string">&quot;0&quot;</span> <span class="attr">border</span>=<span class="string">&quot;0&quot;</span> <span class="attr">style</span>=<span class="string">&quot;margin-bottom: 20px;&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">td</span> <span class="attr">align</span>=<span class="string">&quot;right&quot;</span> <span class="attr">valign</span>=<span class="string">&quot;top&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;display: inline-block; text-align: left;&quot;</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;background-color: #e5e5ea; color: #000; padding: 10px 14px; border-radius: 18px 18px 4px 18px; font-size: 13px; max-width: 240px; margin-bottom: 4px;&quot;</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">&quot;font-size:10px; color:#666; display:block; margin-bottom:2px;&quot;</span>&gt;</span>我<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                                &#123;&#123;content&#125;&#125;</span><br><span class="line">                            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">td</span> <span class="attr">width</span>=<span class="string">&quot;40&quot;</span> <span class="attr">align</span>=<span class="string">&quot;right&quot;</span> <span class="attr">valign</span>=<span class="string">&quot;bottom&quot;</span> <span class="attr">style</span>=<span class="string">&quot;padding-left: 8px;&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;https://cravatar.cn/avatar/&#123;&#123;parent_comment.email_encrypted&#125;&#125;?d=monsterid&amp;s=80&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width: 30px; height: 30px; border-radius: 50%; background: #ccc;&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">table</span> <span class="attr">width</span>=<span class="string">&quot;100%&quot;</span> <span class="attr">cellpadding</span>=<span class="string">&quot;0&quot;</span> <span class="attr">cellspacing</span>=<span class="string">&quot;0&quot;</span> <span class="attr">border</span>=<span class="string">&quot;0&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">td</span> <span class="attr">width</span>=<span class="string">&quot;40&quot;</span> <span class="attr">valign</span>=<span class="string">&quot;bottom&quot;</span> <span class="attr">style</span>=<span class="string">&quot;padding-right: 8px;&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;https://cravatar.cn/avatar/&#123;&#123;comment.email_encrypted&#125;&#125;?d=monsterid&amp;s=80&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width: 36px; height: 36px; border-radius: 50%; box-shadow: 0 2px 4px rgba(0,0,0,0.1);&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">td</span> <span class="attr">align</span>=<span class="string">&quot;left&quot;</span> <span class="attr">valign</span>=<span class="string">&quot;top&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;font-size: 12px; color: #8e8e93; margin-left: 4px; margin-bottom: 2px;&quot;</span>&gt;</span>&#123;&#123;reply_nick&#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;background-color: #007aff; color: #ffffff; padding: 12px 16px; border-radius: 18px 18px 18px 4px; font-size: 14px; line-height: 1.5; box-shadow: 0 2px 8px rgba(0,122,255,0.25);&quot;</span>&gt;</span></span><br><span class="line">                            &#123;&#123;reply_content&#125;&#125;</span><br><span class="line">                        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;padding: 12px 15px 20px 15px; background-color: #f9f9f9; border-top: 1px solid #e5e5ea;&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&#123;&#123;link_to_reply&#125;&#125;&quot;</span> <span class="attr">style</span>=<span class="string">&quot;display: block; text-decoration: none;&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;background-color: #ffffff; border: 1px solid #e5e5ea; border-radius: 20px; padding: 10px 15px; color: #007aff; font-size: 14px; text-align: center; font-weight: 500;&quot;</span>&gt;</span></span><br><span class="line">                    点击此处回复消息...</span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;text-align: center; margin-top: 10px;&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&#123;&#123;page_url&#125;&#125;&quot;</span> <span class="attr">style</span>=<span class="string">&quot;font-size: 10px; color: #c7c7cc; text-decoration: none;&quot;</span>&gt;</span>来源文章: &#123;&#123;page_title&#125;&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure></div><div class="tab-item-content"><p><img src="https://cdn.jsdelivr.net/gh/lijiabao9/pic.cloud@main/hexo/post/20251205223949926.webp" alt=""></p><figure class="highlight html"><figcaption><span>./data/mail_tpl/Magazine-Split.html</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;background-color: #e9ecef; padding: 40px 0; font-family: &#x27;Helvetica Neue&#x27;, Helvetica, Arial, sans-serif;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;max-width: 600px; margin: 0 auto; background-color: #ffffff; box-shadow: 0 15px 30px rgba(0,0,0,0.1);&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">table</span> <span class="attr">width</span>=<span class="string">&quot;100%&quot;</span> <span class="attr">cellspacing</span>=<span class="string">&quot;0&quot;</span> <span class="attr">cellpadding</span>=<span class="string">&quot;0&quot;</span> <span class="attr">border</span>=<span class="string">&quot;0&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span> <span class="attr">width</span>=<span class="string">&quot;35%&quot;</span> <span class="attr">valign</span>=<span class="string">&quot;top&quot;</span> <span class="attr">style</span>=<span class="string">&quot;background-color: #212529; color: #ffffff; padding: 40px 20px; text-align: center;&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;https://cravatar.cn/avatar/&#123;&#123;comment.email_encrypted&#125;&#125;?d=monsterid&amp;s=120&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width: 80px; height: 80px; border-radius: 50%; border: 3px solid #495057; margin-bottom: 15px;&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;font-size: 18px; font-weight: bold; letter-spacing: 1px;&quot;</span>&gt;</span>&#123;&#123;reply_nick&#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;font-size: 10px; text-transform: uppercase; color: #adb5bd; margin-top: 5px; letter-spacing: 2px;&quot;</span>&gt;</span>Replied To You<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                    </span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;margin-top: 40px; border-top: 1px solid #343a40; padding-top: 20px;&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&#123;&#123;link_to_reply&#125;&#125;&quot;</span> <span class="attr">style</span>=<span class="string">&quot;background-color: #ffd43b; color: #212529; padding: 10px 20px; text-decoration: none; font-size: 12px; font-weight: bold; display: inline-block; border-radius: 2px;&quot;</span>&gt;</span></span><br><span class="line">                            查看详情 <span class="symbol">&amp;rarr;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                </span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span> <span class="attr">width</span>=<span class="string">&quot;65%&quot;</span> <span class="attr">valign</span>=<span class="string">&quot;top&quot;</span> <span class="attr">style</span>=<span class="string">&quot;padding: 40px 30px; background-color: #ffffff;&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;font-size: 10px; color: #868e96; letter-spacing: 1px; margin-bottom: 20px;&quot;</span>&gt;</span>IN ARTICLE: <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&#123;&#123;page_url&#125;&#125;&quot;</span> <span class="attr">style</span>=<span class="string">&quot;color: #868e96; text-decoration: none; border-bottom: 1px dotted #ccc;&quot;</span>&gt;</span>&#123;&#123;page_title&#125;&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                    </span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;border-left: 2px solid #dee2e6; padding-left: 15px; margin-bottom: 25px;&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;font-size: 12px; color: #adb5bd; margin-bottom: 5px;&quot;</span>&gt;</span>YOU SAID:<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;font-size: 13px; color: #868e96; font-style: italic;&quot;</span>&gt;</span>&quot;&#123;&#123;content&#125;&#125;&quot;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;font-family: Georgia, &#x27;Times New Roman&#x27;, serif; font-size: 16px; line-height: 1.6; color: #212529;&quot;</span>&gt;</span></span><br><span class="line">                        &#123;&#123;reply_content&#125;&#125;</span><br><span class="line">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;margin-top: 50px; font-size: 10px; color: #ced4da; text-align: right;&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&#123;&#123;site_url&#125;&#125;&quot;</span> <span class="attr">style</span>=<span class="string">&quot;color: #ced4da; text-decoration: none;&quot;</span>&gt;</span>&#123;&#123;site_name&#125;&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span> Notification System</span><br><span class="line">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure></div><div class="tab-item-content active"><p><img src="https://cdn.jsdelivr.net/gh/lijiabao9/pic.cloud@main/hexo/post/20251205224149287.webp" alt=""></p><figure class="highlight html"><figcaption><span>./data/mail_tpl/Neo-Brutalism.html</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;background-color: #fff4e0; padding: 50px 0; font-family: Helvetica, Arial, sans-serif;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;max-width: 500px; margin: 0 auto;&quot;</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;background-color: #a388ee; border: 3px solid #000; box-shadow: 6px 6px 0px #000; padding: 15px; margin-bottom: 20px; text-align: center;&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">h1</span> <span class="attr">style</span>=<span class="string">&quot;margin: 0; font-size: 28px; font-weight: 900; color: #000; text-transform: uppercase; font-style: italic;&quot;</span>&gt;</span></span><br><span class="line">                Hey! Wake Up!</span><br><span class="line">            <span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;background-color: #fff; border: 3px solid #000; box-shadow: 6px 6px 0px #000; padding: 30px;&quot;</span>&gt;</span></span><br><span class="line">            </span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;text-align: center; margin-top: -60px; margin-bottom: 20px;&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;https://cravatar.cn/avatar/&#123;&#123;comment.email_encrypted&#125;&#125;?d=monsterid&amp;s=100&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width: 80px; height: 80px; border: 3px solid #000; background-color: #ff90e8; border-radius: 50%;&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">p</span> <span class="attr">style</span>=<span class="string">&quot;font-weight: 700; font-size: 18px; text-align: center; margin: 0 0 20px 0;&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">&quot;background-color: #ff90e8; padding: 2px 5px; border: 1px solid #000;&quot;</span>&gt;</span>&#123;&#123;reply_nick&#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span> 刚刚回复了你：</span><br><span class="line">            <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;background-color: #f0f0f0; border: 2px solid #000; padding: 15px; font-size: 16px; font-weight: 500; line-height: 1.5; color: #000;&quot;</span>&gt;</span></span><br><span class="line">                &quot;&#123;&#123;reply_content&#125;&#125;&quot;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;margin-top: 20px; font-size: 12px; color: #666; border-left: 4px solid #000; padding-left: 10px;&quot;</span>&gt;</span></span><br><span class="line">                Target: &quot;&#123;&#123;page_title&#125;&#125;&quot;<span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">                Your text: &#123;&#123;content&#125;&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;margin-top: 30px;&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&#123;&#123;link_to_reply&#125;&#125;&quot;</span> <span class="attr">style</span>=<span class="string">&quot;display: block; background-color: #000; color: #fff; text-decoration: none; text-align: center; padding: 15px; font-weight: 900; text-transform: uppercase; font-size: 16px; transition: all 0.2s;&quot;</span>&gt;</span></span><br><span class="line">                    Go To Reply -&gt;</span><br><span class="line">                <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;text-align: center; margin-top: 20px; font-weight: 700; font-size: 12px;&quot;</span>&gt;</span></span><br><span class="line">            &#123;&#123;site_name&#125;&#125; // NO_SPAM</span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure></div><div class="tab-item-content"><p><img src="https://cdn.jsdelivr.net/gh/lijiabao9/pic.cloud@main/hexo/post/20251205224218660.webp" alt=""></p><figure class="highlight html"><figcaption><span>./data/mail_tpl/Ticket.html</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;background-color: #000000; padding: 40px 10px; font-family: &#x27;Courier New&#x27;, Courier, monospace;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;max-width: 480px; margin: 0 auto; background-color: #ffffff; position: relative;&quot;</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;height: 8px; background: repeating-linear-gradient(45deg, #000, #000 10px, #f4d03f 10px, #f4d03f 20px);&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;padding: 25px;&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">table</span> <span class="attr">width</span>=<span class="string">&quot;100%&quot;</span> <span class="attr">style</span>=<span class="string">&quot;border-bottom: 2px dashed #000; padding-bottom: 15px; margin-bottom: 15px;&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">td</span> <span class="attr">align</span>=<span class="string">&quot;left&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">&quot;font-weight: 900; font-size: 24px; letter-spacing: -1px;&quot;</span>&gt;</span>NEW REPLY<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">td</span> <span class="attr">align</span>=<span class="string">&quot;right&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">&quot;background: #000; color: #fff; padding: 2px 6px; font-size: 12px;&quot;</span>&gt;</span>#ID_&#123;&#123;comment.id&#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;margin-bottom: 20px;&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;font-size: 12px; color: #666; text-transform: uppercase;&quot;</span>&gt;</span>From / Sender<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;display: flex; align-items: center; margin-top: 5px;&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;https://cravatar.cn/avatar/&#123;&#123;comment.email_encrypted&#125;&#125;?d=monsterid&amp;s=80&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width: 40px; height: 40px; border-radius: 0; border: 2px solid #000; margin-right: 15px;&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">&quot;font-size: 18px; font-weight: 700;&quot;</span>&gt;</span>&#123;&#123;reply_nick&#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;border: 2px solid #000; padding: 15px; margin-bottom: 20px; background-color: #f8f8f8;&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">p</span> <span class="attr">style</span>=<span class="string">&quot;margin: 0; font-size: 14px; line-height: 1.5;&quot;</span>&gt;</span>&#123;&#123;reply_content&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;font-size: 12px; color: #666; margin-bottom: 20px;&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">&quot;background: #ccc; color: #000; padding: 0 4px;&quot;</span>&gt;</span>REF<span class="tag">&lt;/<span class="name">span</span>&gt;</span> Your comment in &quot;&#123;&#123;page_title&#125;&#125;&quot;:<span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">&quot;font-style: italic;&quot;</span>&gt;</span>&quot;&#123;&#123;content&#125;&#125;&quot;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;border-top: 2px dashed #000; background-color: #f4d03f; padding: 20px; text-align: center;&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&#123;&#123;link_to_reply&#125;&#125;&quot;</span> <span class="attr">style</span>=<span class="string">&quot;display: block; width: 100%; text-decoration: none; color: #000; font-weight: 900; font-size: 16px; letter-spacing: 1px; text-transform: uppercase;&quot;</span>&gt;</span></span><br><span class="line">                [ CLICK TO VIEW REPLY ]</span><br><span class="line">            <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;font-size: 10px; margin-top: 10px; opacity: 0.6;&quot;</span>&gt;</span></span><br><span class="line">                &#123;&#123;site_url&#125;&#125; // AUTO_GENERATED_MSG</span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure></div><div class="tab-item-content"><p><img src="https://cdn.jsdelivr.net/gh/lijiabao9/pic.cloud@main/hexo/post/20251205224319655.webp" alt=""></p><figure class="highlight html"><figcaption><span>./data/mail_tpl/VSCode.html</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;background-color: #1e1e1e; padding: 40px 0; font-family: Consolas, &#x27;Courier New&#x27;, monospace; color: #d4d4d4;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;max-width: 600px; margin: 0 auto; background-color: #252526; border-radius: 6px; overflow: hidden; box-shadow: 0 10px 20px rgba(0,0,0,0.5); border: 1px solid #3c3c3c;&quot;</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;background-color: #2d2d2d; padding: 10px 15px; display: flex; align-items: center; border-bottom: 1px solid #1e1e1e;&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;display: flex; gap: 6px; margin-right: 15px;&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;width: 10px; height: 10px; border-radius: 50%; background-color: #ff5f56;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;width: 10px; height: 10px; border-radius: 50%; background-color: #ffbd2e;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;width: 10px; height: 10px; border-radius: 50%; background-color: #27c93f;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;background-color: #1e1e1e; padding: 5px 15px; border-radius: 4px 4px 0 0; font-size: 12px; color: #9cdcfe;&quot;</span>&gt;</span></span><br><span class="line">                reply_notification.js</span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;padding: 20px; font-size: 13px; line-height: 1.6;&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">table</span> <span class="attr">width</span>=<span class="string">&quot;100%&quot;</span> <span class="attr">cellpadding</span>=<span class="string">&quot;0&quot;</span> <span class="attr">cellspacing</span>=<span class="string">&quot;0&quot;</span> <span class="attr">border</span>=<span class="string">&quot;0&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">td</span> <span class="attr">valign</span>=<span class="string">&quot;top&quot;</span> <span class="attr">width</span>=<span class="string">&quot;30&quot;</span> <span class="attr">style</span>=<span class="string">&quot;color: #858585; text-align: right; padding-right: 15px; border-right: 1px solid #404040; user-select: none;&quot;</span>&gt;</span></span><br><span class="line">                        1<span class="tag">&lt;<span class="name">br</span>&gt;</span>2<span class="tag">&lt;<span class="name">br</span>&gt;</span>3<span class="tag">&lt;<span class="name">br</span>&gt;</span>4<span class="tag">&lt;<span class="name">br</span>&gt;</span>5<span class="tag">&lt;<span class="name">br</span>&gt;</span>6<span class="tag">&lt;<span class="name">br</span>&gt;</span>7<span class="tag">&lt;<span class="name">br</span>&gt;</span>8<span class="tag">&lt;<span class="name">br</span>&gt;</span>9<span class="tag">&lt;<span class="name">br</span>&gt;</span>10<span class="tag">&lt;<span class="name">br</span>&gt;</span>11</span><br><span class="line">                    <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">td</span> <span class="attr">valign</span>=<span class="string">&quot;top&quot;</span> <span class="attr">style</span>=<span class="string">&quot;padding-left: 15px;&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">&quot;color: #c586c0;&quot;</span>&gt;</span>import<span class="tag">&lt;/<span class="name">span</span>&gt;</span> &#123; Notification &#125; <span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">&quot;color: #c586c0;&quot;</span>&gt;</span>from<span class="tag">&lt;/<span class="name">span</span>&gt;</span> <span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">&quot;color: #ce9178;&quot;</span>&gt;</span>&#x27;&#123;&#123;site_name&#125;&#125;&#x27;<span class="tag">&lt;/<span class="name">span</span>&gt;</span>;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">&quot;color: #6a9955;&quot;</span>&gt;</span>// @Author: You (Original Comment)<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">&quot;color: #6a9955;&quot;</span>&gt;</span>// Content: &quot;&#123;&#123;content&#125;&#125;&quot;<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">&quot;color: #569cd6;&quot;</span>&gt;</span>const<span class="tag">&lt;/<span class="name">span</span>&gt;</span> <span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">&quot;color: #9cdcfe;&quot;</span>&gt;</span>reply<span class="tag">&lt;/<span class="name">span</span>&gt;</span> = <span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">&quot;color: #c586c0;&quot;</span>&gt;</span>new<span class="tag">&lt;/<span class="name">span</span>&gt;</span> <span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">&quot;color: #4ec9b0;&quot;</span>&gt;</span>Message<span class="tag">&lt;/<span class="name">span</span>&gt;</span>(&#123;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;padding-left: 20px;&quot;</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">&quot;color: #9cdcfe;&quot;</span>&gt;</span>from<span class="tag">&lt;/<span class="name">span</span>&gt;</span>: <span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">&quot;color: #ce9178;&quot;</span>&gt;</span>&quot;&#123;&#123;reply_nick&#125;&#125;&quot;<span class="tag">&lt;/<span class="name">span</span>&gt;</span>,</span><br><span class="line">                        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;padding-left: 20px;&quot;</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">&quot;color: #9cdcfe;&quot;</span>&gt;</span>content<span class="tag">&lt;/<span class="name">span</span>&gt;</span>: <span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">&quot;color: #ce9178;&quot;</span>&gt;</span>`&#123;&#123;reply_content&#125;&#125;`<span class="tag">&lt;/<span class="name">span</span>&gt;</span>,</span><br><span class="line">                        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;padding-left: 20px;&quot;</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">&quot;color: #9cdcfe;&quot;</span>&gt;</span>action<span class="tag">&lt;/<span class="name">span</span>&gt;</span>: () <span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">&quot;color: #569cd6;&quot;</span>&gt;</span>=&gt;<span class="tag">&lt;/<span class="name">span</span>&gt;</span> &#123;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;padding-left: 40px;&quot;</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&#123;&#123;link_to_reply&#125;&#125;&quot;</span> <span class="attr">style</span>=<span class="string">&quot;color: #ce9178; text-decoration: underline;&quot;</span>&gt;</span>window.open(url);<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;padding-left: 20px;&quot;</span>&gt;</span>&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">div</span>&gt;</span>&#125;);<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;background-color: #1e1e1e; border-top: 1px solid #3c3c3c; padding: 10px 15px;&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;font-size: 11px; color: #858585; margin-bottom: 8px;&quot;</span>&gt;</span>TERMINAL<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&#123;&#123;link_to_reply&#125;&#125;&quot;</span> <span class="attr">style</span>=<span class="string">&quot;display: block; background-color: #0e639c; color: #fff; text-decoration: none; padding: 8px; text-align: center; font-size: 12px; font-weight: bold; font-family: sans-serif;&quot;</span>&gt;</span></span><br><span class="line">                &gt; npm run view-reply</span><br><span class="line">            <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure></div><div class="tab-item-content"><p><img src="https://cdn.jsdelivr.net/gh/lijiabao9/pic.cloud@main/hexo/post/20251205224351230.webp" alt=""></p><figure class="highlight html"><figcaption><span>./data/mail_tpl/Typewriter.html</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;background-color: #fdfbf7; padding: 60px 0; font-family: Georgia, &#x27;Times New Roman&#x27;, serif; color: #4a4a4a;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;max-width: 560px; margin: 0 auto; border: 1px solid #e0dcd3; background-color: #ffffff; padding: 60px 50px;&quot;</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;text-align: center; border-bottom: 2px solid #4a4a4a; padding-bottom: 20px; margin-bottom: 40px;&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">&quot;font-size: 24px; letter-spacing: 2px; text-transform: uppercase; font-weight: bold;&quot;</span>&gt;</span>&#123;&#123;site_name&#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;font-size: 16px; line-height: 1.8;&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">p</span>&gt;</span>Dear <span class="tag">&lt;<span class="name">strong</span>&gt;</span>&#123;&#123;nick&#125;&#125;<span class="tag">&lt;/<span class="name">strong</span>&gt;</span>,<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">            </span><br><span class="line">            <span class="tag">&lt;<span class="name">p</span>&gt;</span>You have received a new correspondence regarding your note on &quot;<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&#123;&#123;page_url&#125;&#125;&quot;</span> <span class="attr">style</span>=<span class="string">&quot;color: #4a4a4a; text-decoration: underline;&quot;</span>&gt;</span>&#123;&#123;page_title&#125;&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span>&quot;.<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">            </span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;margin: 40px 0; text-align: center;&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">&quot;font-style: italic; font-size: 18px; color: #000;&quot;</span>&gt;</span></span><br><span class="line">                    “ &#123;&#123;reply_content&#125;&#125; ”</span><br><span class="line">                <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;margin-top: 15px; font-size: 14px; color: #888;&quot;</span>&gt;</span></span><br><span class="line">                    — Signed by &#123;&#123;reply_nick&#125;&#125;</span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">p</span> <span class="attr">style</span>=<span class="string">&quot;font-size: 14px; color: #888;&quot;</span>&gt;</span></span><br><span class="line">                Reference to your original thought:<span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">&quot;font-style: italic;&quot;</span>&gt;</span>&quot;&#123;&#123;content&#125;&#125;&quot;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;text-align: center; margin-top: 50px;&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&#123;&#123;link_to_reply&#125;&#125;&quot;</span> <span class="attr">style</span>=<span class="string">&quot;display: inline-block; padding: 10px 30px; border: 1px solid #4a4a4a; color: #4a4a4a; text-decoration: none; text-transform: uppercase; font-size: 12px; letter-spacing: 1px; hover: background-color: #4a4a4a; hover: color: #fff;&quot;</span>&gt;</span></span><br><span class="line">                Read Full Discussion</span><br><span class="line">            <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;margin-top: 60px; text-align: center; font-size: 11px; color: #b0b0b0;&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="symbol">&amp;copy;</span> &#123;&#123;site_name&#125;&#125;. All rights reserved.<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div><h3 id="5-邮件通知"><a href="#5-邮件通知" class="headerlink" title="5. 邮件通知"></a>5. 邮件通知</h3><p>Artalk 支持通过 <strong>SMTP 协议</strong>、阿里云邮件推送、调用系统 Sendmail 命令等方式向用户发送邮件通知。</p><p>在 Artalk 后台，<strong>设置 -&gt; 邮件通知</strong>，勾选 <strong>启用邮件通知</strong>。</p><ul><li><strong>发送方式</strong>：<code>smtp</code></li><li><strong>发送人昵称</strong>：<code>&#123;&#123;reply_nick&#125;&#125;</code></li><li><strong>发送人地址</strong>：<code>noreply@example.com</code></li><li><strong>邮件标题</strong>：<code>[&#123;&#123;site_name&#125;&#125;] 您收到了来自 @&#123;&#123;reply_nick&#125;&#125; 的回复</code></li><li><strong>邮件模板文件</strong>：<code>/data/mail_tpl/Neo-Brutalism.html</code></li></ul><p>在 <strong>SMTP 发送</strong>，配置用于发送邮件的账号授权信息：</p><ul><li>对于 <strong>QQ 邮箱</strong><ul><li><strong>发件地址</strong>：<code>smtp.qq.com</code></li><li><strong>发件端口</strong>：<code>587</code></li><li><strong>用户名</strong>： <code>your_email@qq.com</code></li><li><strong>密码</strong>：（注意：是额外生成的授权码，不是邮箱的登录密码） <code>your_email_authcode</code></li></ul></li><li>对于 <strong>Microsoft 邮箱</strong><ul><li><strong>发件地址</strong>：<code>smtp.office365.com</code></li><li><strong>发件端口</strong>：<code>587</code></li><li><strong>用户名</strong>： <code>your_email@xxx.onmicrosoft.com</code></li><li><strong>密码</strong>：（注意：登录密码） <code>your_email_password</code></li></ul></li></ul><h3 id="6-社交登录"><a href="#6-社交登录" class="headerlink" title="6. 社交登录"></a>6. 社交登录</h3><p>在 Artalk 后台，<strong>设置 -&gt; 社交登录</strong>，勾选 <strong>启用社交登录</strong>，<strong>允许匿名评论</strong>。</p>]]></content>
    
    
    <summary type="html">基于 Docker Compose 私有化部署 Artalk 评论系统，详解 Nginx 反代、HTTPS 配置、Cloudflare 避坑指南，以及邮件通知和 UpGit 图床集成的高级玩法。</summary>
    
    
    
    <category term="创意工坊" scheme="https://lijiabao9.github.io/categories/%E5%88%9B%E6%84%8F%E5%B7%A5%E5%9D%8A/"/>
    
    <category term="服务搭建" scheme="https://lijiabao9.github.io/categories/%E5%88%9B%E6%84%8F%E5%B7%A5%E5%9D%8A/%E6%9C%8D%E5%8A%A1%E6%90%AD%E5%BB%BA/"/>
    
    
    <category term="Hexo" scheme="https://lijiabao9.github.io/tags/Hexo/"/>
    
    <category term="Artalk" scheme="https://lijiabao9.github.io/tags/Artalk/"/>
    
    <category term="Docker" scheme="https://lijiabao9.github.io/tags/Docker/"/>
    
    <category term="Nginx" scheme="https://lijiabao9.github.io/tags/Nginx/"/>
    
    <category term="UpGit" scheme="https://lijiabao9.github.io/tags/UpGit/"/>
    
  </entry>
  
  <entry>
    <title>从零开始：域名购买、Cloudflare 托管与 Nginx 自动化 HTTPS 配置全指南</title>
    <link href="https://lijiabao9.github.io/posts/e94f4538.html"/>
    <id>https://lijiabao9.github.io/posts/e94f4538.html</id>
    <published>2025-12-04T16:32:58.000Z</published>
    <updated>2025-12-05T15:42:37.265Z</updated>
    
    <content type="html"><![CDATA[<p>搭建一个安全的网站，从拥有一个域名开始。本文将带你走完：<strong>域名购买 -&gt; 接入 Cloudflare CDN -&gt; 服务器获取 SSL 证书 -&gt; Nginx 反向代理</strong> 的全套流程。</p><h2 id="第一步：域名购买-SpaceShip"><a href="#第一步：域名购买-SpaceShip" class="headerlink" title="第一步：域名购买 (SpaceShip)"></a>第一步：域名购买 (SpaceShip)</h2><p>推荐使用 <a href="https://www.spaceship.com/">SpaceShip</a>，它是 Namecheap 旗下的新平台，界面现代且价格透明。</p><h3 id="1-选购技巧"><a href="#1-选购技巧" class="headerlink" title="1. 选购技巧"></a>1. 选购技巧</h3><ul><li><strong>搜索策略</strong>：在首页搜索 <strong>6位数字</strong> 的 <code>.xyz</code> 域名（例如 <code>131495.xyz</code>）。</li><li><strong>价格陷阱</strong>：确保首年价格显示为 <strong>$0.67</strong> 左右。</li><li><strong>支付方式</strong>：支持 Visa/MasterCard 信用卡、支付宝等。</li></ul><div class="note warning flat"><p><strong>注意续费价格</strong>：购买前请留意 <em>Renewal Price</em>。建议在结账时直接点击 <strong>Extend subscription</strong>，勾选 <strong>9 years</strong>，一次性买断 10 年，避免后续涨价烦恼。</p></div><p>购买完成后，点击右上角 <strong>Launchpad</strong> -&gt; <strong>Domain Manager</strong> 即可看到你的域名。</p><hr><h2 id="第二步：托管到-Cloudflare"><a href="#第二步：托管到-Cloudflare" class="headerlink" title="第二步：托管到 Cloudflare"></a>第二步：托管到 Cloudflare</h2><p>国内域名解析需要实名认证备案，且解析速度和功能不如 Cloudflare 强大。我们将 DNS 解析权移交给 Cloudflare。</p><h3 id="1-接入站点"><a href="#1-接入站点" class="headerlink" title="1. 接入站点"></a>1. 接入站点</h3><ol><li>登录 <a href="https://www.cloudflare.com/zh-cn/">Cloudflare</a>，点击 <strong>加入域</strong>。</li><li>输入你的域名 <code>131495.xyz</code>，勾选 <strong>快速扫描 DNS 记录</strong>，点击 <strong>继续</strong>。</li><li>选择 <strong>Free (免费计划)</strong>。</li></ol><h3 id="2-修改-NameServer-NS"><a href="#2-修改-NameServer-NS" class="headerlink" title="2. 修改 NameServer (NS)"></a>2. 修改 NameServer (NS)</h3><p>Cloudflare 会分配两个 NS 地址（例如 <code>xxxx.ns.cloudflare.com</code>）。</p><ol><li>回到 <strong>SpaceShip</strong> 的 <strong>Domain Manager</strong>，点击 <em>你的域名</em>。</li><li>找到 <strong>NameServers &amp; DNS</strong> 选项，点击 <strong>Nameservers</strong> 的 <strong>change</strong>。</li><li>选择 <strong>Custom nameservers</strong>，填入 Cloudflare 提供的两个地址并保存。</li></ol><p>等待生效（通常几分钟到几小时），收到 Cloudflare 的邮件即代表托管成功。</p><h3 id="3-DNS-记录与代理状态"><a href="#3-DNS-记录与代理状态" class="headerlink" title="3. DNS 记录与代理状态"></a>3. DNS 记录与代理状态</h3><p>在 Cloudflare 的域名管理页面，在 <strong>DNS</strong> -&gt; <strong>记录</strong> 中配置解析。</p><ul><li><strong>A 记录</strong>：将域名指向你服务器的 IPv4 地址。</li><li><strong>CNAME 记录</strong>：用于别名解析。</li></ul><div class="note info flat"><p><strong>关于“小黄云”（代理状态）：</strong></p><ul><li><strong>开启 (橙云)</strong>：流量经过 Cloudflare CDN。隐藏真实 IP，提供防护，支持 SSL。</li><li><strong>关闭 (灰云)</strong>：仅作为 DNS 解析。直连服务器，暴露真实 IP。</li></ul></div><h3 id="4-推荐的-Cloudflare-优化配置"><a href="#4-推荐的-Cloudflare-优化配置" class="headerlink" title="4. 推荐的 Cloudflare 优化配置"></a>4. 推荐的 Cloudflare 优化配置</h3><p>开启橙云代理后，建议调整以下设置以提升性能和安全：</p><ul><li><strong>SSL/TLS</strong> -&gt; <strong>概述</strong>：设置为 <strong>完全(严格) / Full (Strict)</strong>（最安全，要求源服务器有有效证书）</li><li><strong>安全性</strong> -&gt; <strong>设置</strong>：开启 <strong>自动程序攻击模式</strong>，<strong>连续脚本监视</strong></li><li><strong>速度</strong> -&gt; <strong>配置</strong>：点击 <em>建议</em> 里的 <strong>启用所有可用配置</strong>，<strong>Cloudflare Fonts</strong>，<strong>Early Hints</strong>，<strong>0-RTT 连接恢复</strong></li><li><strong>缓存</strong> -&gt; <strong>配置</strong>：<span class='p gray'>CSAM 扫描工具</span>，<span class='p gray'>Crawler Hints</span>，<span class='p gray'>Always Online™</span></li><li><strong>规则</strong> -&gt; <strong>设置</strong>：开启以下功能<ul><li><strong>添加 TLS 客户端身份验证标头</strong></li><li><strong>添加访问者位置标头</strong></li><li><span class='p gray'>删除访问者 IP 标头</span></li><li><strong>添加泄露凭据检查标头</strong></li><li><strong>删除 “X-Powered-By” 标头</strong></li><li><span class='p gray'>添加安全性标头</span></li><li><strong>URL 规范化 -&gt; 标准化传入到源服务器的 URL</strong></li></ul></li><li><strong>网络</strong>：开启 <strong>gRPC</strong></li><li><strong>Scrape Shiedld</strong>：<span class='p gray'>Hotlink保护</span></li></ul><hr><h2 id="第三步：获取公开可信证书-ACME"><a href="#第三步：获取公开可信证书-ACME" class="headerlink" title="第三步：获取公开可信证书 (ACME)"></a>第三步：获取公开可信证书 (ACME)</h2><p>虽然 Cloudflare 提供源服务器证书，但为了通用性和灵活性（比如后续想切回灰云直连），推荐使用 <a href="https://github.com/acmesh-official/acme.sh">acme.sh</a> 申请 <em>Let’s Encrypt</em> 的泛域名证书。</p><h3 id="1-获取-Cloudflare-API-Token"><a href="#1-获取-Cloudflare-API-Token" class="headerlink" title="1. 获取 Cloudflare API Token"></a>1. 获取 Cloudflare API Token</h3><p>我们需要授权 acme.sh 修改 Cloudflare 的 DNS 记录来完成域名验证。</p><ol><li>首页 -&gt; <strong>管理账号</strong> -&gt; <strong>账号 API 令牌</strong> -&gt; <strong>创建令牌</strong>。</li><li>使用模板：<strong>编辑区域 DNS</strong>。<ul><li><strong>令牌名称</strong>：任意填写，比如 <em>ACME 证书续期</em></li><li><strong>权限</strong>：选择 <strong>区域</strong> -&gt; <strong>DSN</strong> -&gt; <strong>编辑</strong></li><li><strong>区域资源</strong>：选择 <strong>包括</strong> -&gt; <strong>特定区域</strong> -&gt; <em>你的域名</em></li><li><strong>客户端IP地址筛选</strong>：（可选）可设置ip黑白名单</li><li><strong>TTL</strong>：（可选）可配置令牌有效期</li></ul></li><li>生成并复制 Token。</li></ol><h3 id="2-安装-acme-sh"><a href="#2-安装-acme-sh" class="headerlink" title="2. 安装 acme.sh"></a>2. 安装 acme.sh</h3><p>登录服务器，执行安装：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装依赖</span></span><br><span class="line">apt update &amp;&amp; apt install -y curl socat</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装 acme.sh</span></span><br><span class="line">curl https://get.acme.sh | sh</span><br></pre></td></tr></table></figure><h3 id="3-配置环境变量"><a href="#3-配置环境变量" class="headerlink" title="3. 配置环境变量"></a>3. 配置环境变量</h3><p>将 API Token 导入环境变量，<code>vi ~/.bashrc</code> 添加：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 注意：CF_Token 是 Cloudflare 专用的变量名，不可更改</span></span><br><span class="line"><span class="built_in">export</span> CF_Token=<span class="string">&quot;你的_API_Token_xxxxxxxxxxxxxx&quot;</span></span><br></pre></td></tr></table></figure><p>保存退出后，重新启动终端。</p><h3 id="4-申请泛域名证书"><a href="#4-申请泛域名证书" class="headerlink" title="4. 申请泛域名证书"></a>4. 申请泛域名证书</h3><p>我们申请 ECC 算法的证书（更小更快），并同时包含主域名和泛域名：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 切换默认 CA 为 Let&#x27;s Encrypt</span></span><br><span class="line">acme.sh --set-default-ca --server letsencrypt</span><br><span class="line"></span><br><span class="line"><span class="comment"># 申请证书 (自动使用 CF_Token 进行 DNS-01 验证)</span></span><br><span class="line">acme.sh --issue --dns dns_cf -d <span class="string">&quot;131495.xyz&quot;</span> -d <span class="string">&quot;*.131495.xyz&quot;</span></span><br></pre></td></tr></table></figure><p>成功后，证书文件会保存在 <code>~/.acme.sh/131495.xyz_ecc/</code> 目录下。</p><h3 id="5-安装证书"><a href="#5-安装证书" class="headerlink" title="5. 安装证书"></a>5. 安装证书</h3><p><strong>切勿直接使用 .acme.sh 目录下的文件</strong>。应使用 <code>--install-cert</code> 命令将证书复制到指定位置，并配置自动重载 Nginx。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建存放目录</span></span><br><span class="line"><span class="built_in">mkdir</span> -p /cert/acme_131495.xyz/</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装证书并指定重载命令</span></span><br><span class="line">acme.sh --install-cert -d <span class="string">&quot;131495.xyz&quot;</span> \</span><br><span class="line">  --cert-file       /cert/acme_131495.xyz/cert.pem \</span><br><span class="line">  --key-file        /cert/acme_131495.xyz/key.pem \</span><br><span class="line">  --fullchain-file  /cert/acme_131495.xyz/fullchain.pem \</span><br><span class="line">  --ca-file         /cert/acme_131495.xyz/ca.cer \</span><br><span class="line">  --reloadcmd       <span class="string">&quot;systemctl reload nginx&quot;</span></span><br></pre></td></tr></table></figure><hr><h2 id="第四步：Nginx-配置-HTTPS"><a href="#第四步：Nginx-配置-HTTPS" class="headerlink" title="第四步：Nginx 配置 HTTPS"></a>第四步：Nginx 配置 HTTPS</h2><p>证书准备就绪，接下来配置 Nginx 反向代理。</p><h3 id="1-安装-Nginx"><a href="#1-安装-Nginx" class="headerlink" title="1. 安装 Nginx"></a>1. 安装 Nginx</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt install nginx -y</span><br></pre></td></tr></table></figure><h3 id="2-默认配置修改"><a href="#2-默认配置修改" class="headerlink" title="2. 默认配置修改"></a>2. 默认配置修改</h3><p>修改配置文件：<code>vi /etc/nginx/nginx.conf</code>，增加自定义的日志格式 <code>proxy_json</code>，开启 <code>gzip</code> 配置：</p><figure class="highlight plaintext"><figcaption><span>nginx.conf</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">http &#123;</span><br><span class="line">        ##</span><br><span class="line">        # Logging Settings</span><br><span class="line">        ##</span><br><span class="line">        </span><br><span class="line">        # 日志格式自定义</span><br><span class="line">        log_format proxy_json escape=json </span><br><span class="line">          &#x27;&#123;&#x27;</span><br><span class="line">            &#x27;&quot;timestamp&quot;: &quot;$time_iso8601&quot;, &#x27;</span><br><span class="line">            &#x27;&quot;request_id&quot;: &quot;$request_id&quot;, &#x27;</span><br><span class="line">            &#x27;&quot;client_ip&quot;: &quot;$remote_addr&quot;, &#x27;</span><br><span class="line">            &#x27;&quot;vhost&quot;: &quot;$host&quot;, &#x27;</span><br><span class="line">            &#x27;&quot;method&quot;: &quot;$request_method&quot;, &#x27;</span><br><span class="line">            &#x27;&quot;uri&quot;: &quot;$uri&quot;, &#x27;</span><br><span class="line">            &#x27;&quot;status&quot;: $status, &#x27;</span><br><span class="line">            &#x27;&quot;upstream&quot;: &#123;&#x27;</span><br><span class="line">                &#x27;&quot;addr&quot;: &quot;$upstream_addr&quot;, &#x27;</span><br><span class="line">                &#x27;&quot;status&quot;: &quot;$upstream_status&quot;, &#x27;</span><br><span class="line">                &#x27;&quot;response_time&quot;: &quot;$upstream_response_time&quot;, &#x27;</span><br><span class="line">                &#x27;&quot;connect_time&quot;: &quot;$upstream_connect_time&quot;&#x27;</span><br><span class="line">            &#x27;&#125;,&#x27;</span><br><span class="line">            &#x27;&quot;request_time&quot;: &quot;$request_time&quot;, &#x27;</span><br><span class="line">            &#x27;&quot;headers&quot;: &#123;&#x27;</span><br><span class="line">                &#x27;&quot;user_agent&quot;: &quot;$http_user_agent&quot;, &#x27;</span><br><span class="line">                &#x27;&quot;x_forwarded_for&quot;: &quot;$proxy_add_x_forwarded_for&quot;, &#x27;</span><br><span class="line">                &#x27;&quot;x_forwarded_proto&quot;: &quot;$scheme&quot;&#x27;</span><br><span class="line">            &#x27;&#125;&#x27;</span><br><span class="line">          &#x27;&#125;&#x27;;</span><br><span class="line">          </span><br><span class="line">        access_log /var/log/nginx/access.log;</span><br><span class="line"></span><br><span class="line">        ##</span><br><span class="line">        # Gzip Settings</span><br><span class="line">        ##</span><br><span class="line"></span><br><span class="line">        gzip on;</span><br><span class="line"></span><br><span class="line">        gzip_vary on;</span><br><span class="line">        gzip_proxied any;</span><br><span class="line">        gzip_comp_level 6;</span><br><span class="line">        gzip_buffers 16 8k;</span><br><span class="line">        gzip_http_version 1.1;</span><br><span class="line">        gzip_types text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>修改配置文件：<code>vi /etc/nginx/sites-available/default</code>，强制使用 HTTPS：</p><figure class="highlight plaintext"><figcaption><span>default</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen 80 default_server;</span><br><span class="line">    listen [::]:80 default_server;</span><br><span class="line">    </span><br><span class="line">    server_name _;</span><br><span class="line">    </span><br><span class="line">    return 301 https://$host$request_uri;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">    listen 443 ssl default_server;</span><br><span class="line">    listen [::]:443 ssl default_server;</span><br><span class="line">    </span><br><span class="line">    server_name _;</span><br><span class="line"></span><br><span class="line">    # 加密套件</span><br><span class="line">    ssl_ciphers HIGH:!aNULL:!MD5;</span><br><span class="line">    </span><br><span class="line">    # 配置证书地址</span><br><span class="line">    ssl_certificate /cert/acme_131495.xyz/cert.pem;</span><br><span class="line">    ssl_certificate_key /cert/acme_131495.xyz/key.pem;</span><br><span class="line"></span><br><span class="line">    # 静态文件目录</span><br><span class="line">    root /var/www/html;</span><br><span class="line">    index index.html index.htm index.nginx-debian.html;</span><br><span class="line"></span><br><span class="line">    location / &#123;</span><br><span class="line">        try_files $uri $uri/ =404;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-准备-proxy-params"><a href="#3-准备-proxy-params" class="headerlink" title="3. 准备 proxy_params"></a>3. 准备 proxy_params</h3><p>为了让后端应用获取客户端真实 IP，建议创建一个代理参数文件：<code>vi /etc/nginx/proxy_params</code></p><figure class="highlight plaintext"><figcaption><span>proxy_params</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">proxy_set_header Host $host;</span><br><span class="line">proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">proxy_set_header X-Forwarded-Proto $scheme;</span><br></pre></td></tr></table></figure><p>对应的 websocket 协议的代理参数文件：<code>vi /etc/nginx/proxy_params_ws</code></p><figure class="highlight plaintext"><figcaption><span>proxy_params_ws</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">proxy_set_header Host $host;</span><br><span class="line">proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">proxy_set_header X-Forwarded-Proto $scheme;</span><br><span class="line">proxy_http_version 1.1;</span><br><span class="line">proxy_set_header Upgrade $http_upgrade;</span><br><span class="line">proxy_set_header Connection &quot;upgrade&quot;;</span><br></pre></td></tr></table></figure><h3 id="4-配置站点-虚拟主机"><a href="#4-配置站点-虚拟主机" class="headerlink" title="4. 配置站点 (虚拟主机)"></a>4. 配置站点 (虚拟主机)</h3><p>创建配置文件：<code>vi /etc/nginx/sites-available/example.131495.xyz</code></p><figure class="highlight plaintext"><figcaption><span>example.131495.xyz</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"># HTTP 自动跳转 HTTPS</span><br><span class="line">server &#123;</span><br><span class="line">    listen 80;</span><br><span class="line">    listen [::]:80;</span><br><span class="line">    </span><br><span class="line">    # TODO: 修改为对应的子域名</span><br><span class="line">    server_name example.131495.xyz;</span><br><span class="line">    </span><br><span class="line">    return 301 https://$host$request_uri;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># HTTPS 配置</span><br><span class="line">server &#123;</span><br><span class="line">    listen 443 ssl;</span><br><span class="line">    listen [::]:443 ssl;</span><br><span class="line">    </span><br><span class="line">    # TODO: 修改为对应的子域名</span><br><span class="line">    server_name example.131495.xyz;</span><br><span class="line">    </span><br><span class="line">    # 加密套件</span><br><span class="line">    ssl_ciphers HIGH:!aNULL:!MD5;</span><br><span class="line"></span><br><span class="line">    # 配置证书地址</span><br><span class="line">    ssl_certificate /cert/acme_131495.xyz/cert.pem;</span><br><span class="line">    ssl_certificate_key /cert/acme_131495.xyz/key.pem;</span><br><span class="line"></span><br><span class="line">    # TODO: 独立的日志配置</span><br><span class="line">    access_log /var/log/nginx/example.access.log proxy_json;</span><br><span class="line">    error_log /var/log/nginx/example.error.log;</span><br><span class="line"></span><br><span class="line">    # 反向代理设置</span><br><span class="line">    location / &#123;</span><br><span class="line">        # TODO: 修改为实际的服务地址</span><br><span class="line">        proxy_pass http://127.0.0.1:8080;</span><br><span class="line">        </span><br><span class="line">        # 代理参数</span><br><span class="line">        include /etc/nginx/proxy_params;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-启用配置并重启"><a href="#4-启用配置并重启" class="headerlink" title="4. 启用配置并重启"></a>4. 启用配置并重启</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建软链接启用站点</span></span><br><span class="line"><span class="built_in">ln</span> -s /etc/nginx/sites-available/example.131495.xyz /etc/nginx/sites-enabled/</span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查配置语法</span></span><br><span class="line">nginx -t</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重启服务</span></span><br><span class="line">systemctl reload nginx</span><br></pre></td></tr></table></figure><hr><p>至此，你的网站已经拥有了安全的 HTTPS 访问能力，并且证书会由 acme.sh 自动续期，Cloudflare 也会提供全球 CDN 加速与防护。</p>]]></content>
    
    
    <summary type="html">本文详细记录了从 SpaceShip 购买便宜域名，托管至 Cloudflare 进行 DNS 解析，利用 acme.sh 配合 Cloudflare API 自动申请泛域名证书，并最终配置 Nginx 实现全站 HTTPS 的完整流程。</summary>
    
    
    
    <category term="开发环境" scheme="https://lijiabao9.github.io/categories/%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/"/>
    
    <category term="网站运维" scheme="https://lijiabao9.github.io/categories/%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/%E7%BD%91%E7%AB%99%E8%BF%90%E7%BB%B4/"/>
    
    
    <category term="Nginx" scheme="https://lijiabao9.github.io/tags/Nginx/"/>
    
    <category term="Domain" scheme="https://lijiabao9.github.io/tags/Domain/"/>
    
    <category term="Cloudflare" scheme="https://lijiabao9.github.io/tags/Cloudflare/"/>
    
    <category term="ACME" scheme="https://lijiabao9.github.io/tags/ACME/"/>
    
    <category term="HTTPS" scheme="https://lijiabao9.github.io/tags/HTTPS/"/>
    
  </entry>
  
  <entry>
    <title>Oracle Cloud 实例网络配置全解：防火墙放行、IPTables 清空与 Root 登录</title>
    <link href="https://lijiabao9.github.io/posts/6128b66c.html"/>
    <id>https://lijiabao9.github.io/posts/6128b66c.html</id>
    <published>2025-12-04T16:01:53.000Z</published>
    <updated>2025-12-05T15:42:37.265Z</updated>
    
    <content type="html"><![CDATA[<p>在使用 Oracle Cloud (甲骨文云) 的 Ubuntu 实例时，新手常遇到的最大的坑就是 <strong>“双重防火墙”</strong>：</p><ol><li><strong>云端防火墙</strong>：OCI 控制台的安全列表 (Security Lists)。</li><li><strong>系统防火墙</strong>：Linux 系统内部的 Netfilter/IPTables。</li></ol><p>只有两层防火墙都放行，外部流量才能真正到达你的服务。本文将带你一站式打通网络配置。</p><hr><h2 id="第一层：云端防火墙-Security-Lists"><a href="#第一层：云端防火墙-Security-Lists" class="headerlink" title="第一层：云端防火墙 (Security Lists)"></a>第一层：云端防火墙 (Security Lists)</h2><p>这是 Oracle 设定的第一道关卡。默认情况下，只放行了 SSH (22端口)。</p><h3 id="配置步骤"><a href="#配置步骤" class="headerlink" title="配置步骤"></a>配置步骤</h3><ol><li>登录 Oracle 控制台，进入 <strong>实例详情</strong> 页面。</li><li>点击 <strong>网络 (Network)</strong> 里的 <strong>子网 (Subnet)</strong> 名称的链接。</li><li>在子网详情页，点击 <strong>安全</strong> 里的 <strong>安全列表 (Security Lists)</strong>，通常有一个默认列表 <code>Default Security List for...</code>。</li><li>在 <strong>安全规则</strong>，点击 <strong>添加入站规则 (Add Ingress Rules)</strong>。</li></ol><h3 id="推荐规则-放行所有"><a href="#推荐规则-放行所有" class="headerlink" title="推荐规则 (放行所有)"></a>推荐规则 (放行所有)</h3><p>如果你希望由服务器内部防火墙接管所有流量控制，或者用于测试环境，可以添加一条“全放行”规则：</p><ul><li><strong>源 CIDR</strong>：<code>0.0.0.0/0</code> (允许所有 IP)</li><li><strong>IP 协议</strong>：<code>所有协议</code></li><li><strong>源端口范围</strong>：(留空，表示所有端口)</li></ul><h2 id="第二层：系统防火墙-IPTables"><a href="#第二层：系统防火墙-IPTables" class="headerlink" title="第二层：系统防火墙 (IPTables)"></a>第二层：系统防火墙 (IPTables)</h2><p>Oracle 提供的 Ubuntu 镜像默认开启了极其严格的 <code>iptables</code> 规则。即使你在网页控制台放行了端口，系统内部也会拦截。</p><p>最省事的做法是：<strong>清空所有规则，让服务器“裸奔”，完全由云端安全列表控制。</strong></p><h3 id="1-查看当前规则"><a href="#1-查看当前规则" class="headerlink" title="1. 查看当前规则"></a>1. 查看当前规则</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 登录 root</span></span><br><span class="line"><span class="built_in">sudo</span> -i</span><br><span class="line"></span><br><span class="line">iptables -L -n -v</span><br></pre></td></tr></table></figure><p>你会看到大量的 REJECT 规则，这就是导致网络不通的元凶。</p><h3 id="2-暴力清空规则"><a href="#2-暴力清空规则" class="headerlink" title="2. 暴力清空规则"></a>2. 暴力清空规则</h3><p>执行以下命令，删除所有链和规则，并将默认策略设置为 ACCEPT：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. 设置默认策略为接受 (防止清空规则后把自己锁在外面)</span></span><br><span class="line">iptables -P INPUT ACCEPT</span><br><span class="line">iptables -P FORWARD ACCEPT</span><br><span class="line">iptables -P OUTPUT ACCEPT</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 清空所有规则 (Flush)</span></span><br><span class="line">iptables -F</span><br><span class="line">iptables -t nat -F</span><br><span class="line">iptables -t mangle -F</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 删除所有自定义链 (Delete Chain)</span></span><br><span class="line">iptables -X</span><br><span class="line">iptables -t nat -X</span><br><span class="line">iptables -t mangle -X</span><br></pre></td></tr></table></figure><h3 id="3-持久化配置-关键步骤"><a href="#3-持久化配置-关键步骤" class="headerlink" title="3. 持久化配置 (关键步骤)"></a>3. 持久化配置 (关键步骤)</h3><p>通过命令修改的规则在重启后会失效，因为 Oracle 镜像安装了 <code>netfilter-persistent</code> 工具，开机时会自动加载 <code>/etc/iptables/rules.v4</code> 中的默认规则。</p><p>我们需要将当前“清空后”的状态保存下来：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 推荐方式：覆盖保存当前规则</span></span><br><span class="line">netfilter-persistent save</span><br></pre></td></tr></table></figure><p>或者，你也可以选择简单粗暴地卸载该工具（不推荐，不够优雅）：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 暴力方式：卸载持久化工具</span></span><br><span class="line">apt purge netfilter-persistent</span><br><span class="line"><span class="built_in">rm</span> -rf /etc/iptables</span><br></pre></td></tr></table></figure><p>最后，执行 <code>reboot</code> 重启服务器验证规则是否回滚。</p><hr><h2 id="进阶：开启-Root-密码登录"><a href="#进阶：开启-Root-密码登录" class="headerlink" title="进阶：开启 Root 密码登录"></a>进阶：开启 Root 密码登录</h2><p>Oracle 默认强制使用密钥登录且禁用 Root。为了方便管理（如使用 SFTP 客户端），我们通常会开启密码登录。</p><h3 id="1-设置-Root-密码"><a href="#1-设置-Root-密码" class="headerlink" title="1. 设置 Root 密码"></a>1. 设置 Root 密码</h3><p>使用默认用户（通常是 <code>ubuntu</code>）登录后：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 切换到 root 环境</span></span><br><span class="line"><span class="built_in">sudo</span> -i</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置密码 (需输入两次，无回显)</span></span><br><span class="line">passwd</span><br></pre></td></tr></table></figure><h3 id="2-修改-SSH-配置"><a href="#2-修改-SSH-配置" class="headerlink" title="2. 修改 SSH 配置"></a>2. 修改 SSH 配置</h3><p>编辑主配置文件：<code>vim /etc/ssh/sshd_config</code></p><p>找到以下配置并修改（如果没有则添加）：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">PermitRootLogin yes        # 允许 Root 登录</span><br><span class="line">PasswordAuthentication yes # 允许密码验证</span><br></pre></td></tr></table></figure><h3 id="3-处理子配置文件-重要坑点"><a href="#3-处理子配置文件-重要坑点" class="headerlink" title="3. 处理子配置文件 (重要坑点)"></a>3. 处理子配置文件 (重要坑点)</h3><p>在 Ubuntu 云镜像中，还有一个优先级更高的配置文件，必须同时修改：</p><p><code>vim /etc/ssh/sshd_config.d/60-cloudimg-settings.conf</code></p><p>将里面的 <code>no</code> 改为 <code>yes</code>：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PasswordAuthentication yes</span><br></pre></td></tr></table></figure><h3 id="4-重启服务"><a href="#4-重启服务" class="headerlink" title="4. 重启服务"></a>4. 重启服务</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart ssh</span><br></pre></td></tr></table></figure><hr><h2 id="附录：Oracle-网络术语解析"><a href="#附录：Oracle-网络术语解析" class="headerlink" title="附录：Oracle 网络术语解析"></a>附录：Oracle 网络术语解析</h2><p>在配置 Oracle 网络时，你经常会看到以下缩写，理解它们有助于你构建更复杂的网络架构。</p><div class="note success flat"><p><strong>核心概念速查：</strong></p><ul><li><p><strong>OCI (Oracle Cloud Infrastructure)</strong><br>即甲骨文云的基础设施平台。</p></li><li><p><strong>VCN (Virtual Cloud Network)</strong><br><strong>虚拟云网络</strong>。你在云上划出的一块私有网络区域，类似于你家里的局域网。</p></li><li><p><strong>VNIC (Virtual Network Interface Card)</strong><br><strong>虚拟网卡</strong>。实例连接到 VCN 的接口。</p><ul><li>它决定了实例的 <strong>私有/公有 IP</strong>。</li><li>一个实例可以绑定多个 VNIC（多网卡）。</li></ul></li><li><p><strong>Security List (安全列表)</strong><br><strong>子网级别的防火墙</strong>。作用于子网内的所有网卡，通常用于设置通用的规则（如全放行 SSH）。</p></li><li><p><strong>NSG (Network Security Groups)</strong><br><strong>网卡级别的防火墙</strong>。比安全列表更灵活，可以直接绑定到某个具体的 VNIC 上，仅对该实例生效。</p></li></ul></div><p><strong>流量控制层级关系：</strong></p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">实例 (Instance)</span><br><span class="line">  └── VNIC (虚拟网卡)</span><br><span class="line">       ├── 绑定 NSG (网络安全组) [可选，针对单机]</span><br><span class="line">       └── 归属 Subnet (子网)</span><br><span class="line">             └── 受 Security List (安全列表) 控制 [针对整个子网]</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">详解 Oracle Cloud 实例的“双重防火墙”机制。教你如何配置 OCI 安全列表放行端口，彻底清除 Ubuntu 默认的 IPTables 规则，并开启 Root 用户密码登录权限。</summary>
    
    
    
    <category term="开发环境" scheme="https://lijiabao9.github.io/categories/%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/"/>
    
    <category term="Oracle Cloud" scheme="https://lijiabao9.github.io/categories/%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/Oracle-Cloud/"/>
    
    
    <category term="Oracle" scheme="https://lijiabao9.github.io/tags/Oracle/"/>
    
    <category term="运维" scheme="https://lijiabao9.github.io/tags/%E8%BF%90%E7%BB%B4/"/>
    
    <category term="云服务器" scheme="https://lijiabao9.github.io/tags/%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8/"/>
    
  </entry>
  
  <entry>
    <title>Oracle Cloud 实例重装系统：利用替换引导卷 (Replace Boot Volume) 实现系统重置</title>
    <link href="https://lijiabao9.github.io/posts/e62f764.html"/>
    <id>https://lijiabao9.github.io/posts/e62f764.html</id>
    <published>2025-12-04T15:40:20.000Z</published>
    <updated>2025-12-05T15:42:37.265Z</updated>
    
    <content type="html"><![CDATA[<p>与 AWS 或一般的 VPS 提供商不同，Oracle Cloud (OCI) 的控制台中并没有一个显眼的“重装系统”按钮。</p><p>如果我们把系统玩坏了，或者想更换系统版本（例如从 Ubuntu 20.04 升级到 22.04），最优雅的方法不是删除实例重建（可能会丢 IP），而是使用 <strong>“替换引导卷” (Replace Boot Volume)</strong> 功能。</p><h2 id="第一步：获取目标系统的映像-OCID"><a href="#第一步：获取目标系统的映像-OCID" class="headerlink" title="第一步：获取目标系统的映像 OCID"></a>第一步：获取目标系统的映像 OCID</h2><p>在开始操作前，我们需要知道要安装什么系统。OCI 使用 <strong>OCID</strong> (Oracle Cloud Identifier) 来标识每一个官方镜像。</p><p>我们需要获取目标系统的 OCID，这里有两种方式：</p><h3 id="方式一：使用当前实例同款镜像（最简单）"><a href="#方式一：使用当前实例同款镜像（最简单）" class="headerlink" title="方式一：使用当前实例同款镜像（最简单）"></a>方式一：使用当前实例同款镜像（最简单）</h3><p>如果你只是想把当前的系统“恢复出厂设置”，依旧使用之前的系统版本：</p><ol><li>在实例的 <strong>详细信息 (Instance Details)</strong> 页面。</li><li>找到 <strong>映像详细信息 (Image)</strong> 部分。</li><li>点击 <strong>映像名称</strong> 链接，进入详情页。</li><li>复制 <strong>OCID</strong> 备用。</li></ol><h3 id="方式二：查阅官方文档（更换版本）"><a href="#方式二：查阅官方文档（更换版本）" class="headerlink" title="方式二：查阅官方文档（更换版本）"></a>方式二：查阅官方文档（更换版本）</h3><p>如果你想更换系统版本（例如安装最新的 Ubuntu 24.04），需要去官方文档查找。</p><blockquote><p><strong>官方镜像列表</strong>：<a href="https://docs.oracle.com/en-us/iaas/images/">https://docs.oracle.com/en-us/iaas/images/</a></p></blockquote><p><strong>⚠️ 关键注意点：</strong></p><ul><li><strong>区域 (Region)</strong>：必须选择你实例所在的区域（如 Japan East (Osaka) 或 US West (Phoenix)）。</li><li><strong>架构 (Architecture)</strong>：<ul><li>如果是 <strong>AMD</strong> 免费机，找 <code>x86_64</code> 架构的 OCID。</li><li>如果是 <strong>ARM</strong> (4H24G) 机器，必须找 <code>aarch64</code> 架构的 OCID。</li></ul></li></ul><p>复制对应条目的 <strong>OCID</strong>，格式通常为 <code>ocid1.image.oc1.ap-osaka-1.xxxx...</code>。</p><hr><h2 id="第二步：执行替换引导卷"><a href="#第二步：执行替换引导卷" class="headerlink" title="第二步：执行替换引导卷"></a>第二步：执行替换引导卷</h2><p>拿到 OCID 后，就可以开始“重装”了。</p><div class="note warning flat"><p><strong>高能预警</strong>：<br>此操作会<strong>销毁并删除</strong>当前的引导卷（系统盘）。请务必备份旧系统盘内的重要数据！<br>此操作<strong>不会</strong>改变实例的公网 IP 地址。</p></div><ol><li>登录 Oracle 控制台，进入实例详情页面。</li><li>在上方菜单点击 <strong>存储 (Storage)</strong> -&gt; <strong>引导卷 (Boot volume)</strong>。</li><li>点击 <strong>替换引导卷 (Replace Boot Volume)</strong> 按钮。</li><li>在弹出的配置窗口中填写信息：<ul><li><strong>替换方式</strong>：选择 <strong>映像 (Image)</strong>。</li><li><strong>映像应用方式</strong>：选择 <strong>输入 OCID (Enter image OCID)</strong>。</li><li><strong>镜像 OCID</strong>：粘贴第一步中获取的字符串。</li><li><strong>引导卷大小</strong>：输入 <strong>50 - 200</strong> GB（默认免费额度总共 200G，通常填 50 或 100）。</li></ul></li><li>点击 <strong>替换 (Replace)</strong>。</li></ol><h2 id="第三步：等待与连接"><a href="#第三步：等待与连接" class="headerlink" title="第三步：等待与连接"></a>第三步：等待与连接</h2><p>提交后，实例的状态会变为 <strong>Stopping</strong>（停止中），然后是 <strong>Provisioning</strong>（配置中），最后变回 <strong>Running</strong>（运行中）。</p><p>整个过程大约需要 5-10 分钟。</p><p>待状态变绿后，使用 SSH 客户端重新连接：</p><ul><li><strong>IP 地址</strong>：保持不变。</li><li><strong>用户名</strong>：根据系统而定（Ubuntu 镜像默认为 <code>ubuntu</code>，Oracle Linux 默认为 <code>opc</code>）。</li><li><strong>密钥</strong>：使用你原本的私钥（或你刚才上传的新私钥）。</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -i <span class="string">&#x27;你的私钥文件&#x27;</span> ubuntu@你的公网IP</span><br></pre></td></tr></table></figure><p>如果连接成功，恭喜你，系统重装完成！</p>]]></content>
    
    
    <summary type="html">甲骨文云 (Oracle Cloud) 没有直接的重装系统按钮。本文详解如何通过“替换引导卷”的方式，使用官方镜像 OCID 快速重置 VPS 系统，无需删除重建实例。</summary>
    
    
    
    <category term="开发环境" scheme="https://lijiabao9.github.io/categories/%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/"/>
    
    <category term="Oracle Cloud" scheme="https://lijiabao9.github.io/categories/%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/Oracle-Cloud/"/>
    
    
    <category term="Oracle" scheme="https://lijiabao9.github.io/tags/Oracle/"/>
    
    <category term="云服务器" scheme="https://lijiabao9.github.io/tags/%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8/"/>
    
  </entry>
  
  <entry>
    <title>Ubuntu 系统 Docker 安装全指南：官方源与国内镜像加速</title>
    <link href="https://lijiabao9.github.io/posts/3c32210.html"/>
    <id>https://lijiabao9.github.io/posts/3c32210.html</id>
    <published>2025-12-04T14:39:56.000Z</published>
    <updated>2025-12-05T15:42:37.265Z</updated>
    
    <content type="html"><![CDATA[<p>本文将指导你在 Ubuntu 上安装 Docker Engine。安装过程涵盖了从清理旧版本到配置国内加速源的完整生产级实践。</p><blockquote><p><strong>参考文档</strong>：<a href="https://docs.docker.com/engine/install/ubuntu">Docker Official Docs</a></p></blockquote><h2 id="一、环境清理"><a href="#一、环境清理" class="headerlink" title="一、环境清理"></a>一、环境清理</h2><p>为了防止版本冲突，首先卸载系统中可能存在的旧版本 Docker（如 <code>docker.io</code> 或 <code>docker-engine</code>）。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> apt remove $(dpkg --get-selections docker.io docker-compose docker-compose-v2 docker-doc podman-docker containerd runc | <span class="built_in">cut</span> -f1)</span><br></pre></td></tr></table></figure><h2 id="二、配置软件源-Repository"><a href="#二、配置软件源-Repository" class="headerlink" title="二、配置软件源 (Repository)"></a>二、配置软件源 (Repository)</h2><h3 id="1-安装基础工具"><a href="#1-安装基础工具" class="headerlink" title="1. 安装基础工具"></a>1. 安装基础工具</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> apt update</span><br><span class="line"><span class="built_in">sudo</span> apt install ca-certificates curl</span><br></pre></td></tr></table></figure><h3 id="2-添加-GPG-密钥"><a href="#2-添加-GPG-密钥" class="headerlink" title="2. 添加 GPG 密钥"></a>2. 添加 GPG 密钥</h3><p>创建密钥目录并下载 Docker 官方密钥。</p><div class="note info flat"><p><strong>提示</strong>：如果你位于国内服务器，连接 <code>download.docker.com</code> 可能会超时。<br>推荐使用阿里云镜像源，请将下方的 URL 替换为 <code>http://mirrors.aliyun.com/docker-ce/linux/ubuntu/gpg</code></p></div><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建密钥目录</span></span><br><span class="line"><span class="built_in">sudo</span> install -m 0755 -d /etc/apt/keyrings</span><br><span class="line"><span class="comment"># 下载官方 GPG 密钥</span></span><br><span class="line"><span class="built_in">sudo</span> curl -fsSL https://download.docker.com/linux/ubuntu/gpg -o /etc/apt/keyrings/docker.asc</span><br><span class="line"><span class="comment"># 修改密钥权限</span></span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">chmod</span> a+r /etc/apt/keyrings/docker.asc</span><br></pre></td></tr></table></figure><h3 id="3-添加-APT-源"><a href="#3-添加-APT-源" class="headerlink" title="3. 添加 APT 源"></a>3. 添加 APT 源</h3><p>根据你的 Ubuntu 版本，选择对应的源格式。</p><div class="note warning flat"><p><strong>注意</strong>：Ubuntu 24.04 LTS (Noble Numbat) 开始，APT 建议使用 DEB822 格式的 <code>.sources</code> 文件，而非传统的 <code>.list</code> 文件。</p></div><h4 id="方案-A：Ubuntu-24-04-及更高版本-sources"><a href="#方案-A：Ubuntu-24-04-及更高版本-sources" class="headerlink" title="方案 A：Ubuntu 24.04 及更高版本 (.sources)"></a>方案 A：Ubuntu 24.04 及更高版本 (.sources)</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Types: deb</span></span><br><span class="line"><span class="string">URIs: https://download.docker.com/linux/ubuntu</span></span><br><span class="line"><span class="string">Suites: <span class="subst">$(. /etc/os-release &amp;&amp; echo <span class="string">&quot;<span class="variable">$&#123;UBUNTU_CODENAME:-<span class="variable">$VERSION_CODENAME</span>&#125;</span>&quot;</span>)</span></span></span><br><span class="line"><span class="string">Components: stable</span></span><br><span class="line"><span class="string">Architectures: <span class="subst">$(dpkg --print-architecture)</span></span></span><br><span class="line"><span class="string">Signed-By: /etc/apt/keyrings/docker.asc&quot;</span> | \</span><br><span class="line">  <span class="built_in">sudo</span> <span class="built_in">tee</span> /etc/apt/sources.list.d/docker.sources &gt; /dev/null</span><br></pre></td></tr></table></figure><h4 id="方案-B：Ubuntu-23-10-及更低版本-list"><a href="#方案-B：Ubuntu-23-10-及更低版本-list" class="headerlink" title="方案 B：Ubuntu 23.10 及更低版本 (.list)"></a>方案 B：Ubuntu 23.10 及更低版本 (.list)</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> \</span><br><span class="line">  <span class="string">&quot;deb [arch=<span class="subst">$(dpkg --print-architecture)</span> signed-by=/etc/apt/keyrings/docker.asc] https://download.docker.com/linux/ubuntu \</span></span><br><span class="line"><span class="string">  <span class="subst">$(. /etc/os-release &amp;&amp; echo <span class="string">&quot;<span class="variable">$&#123;UBUNTU_CODENAME:-<span class="variable">$VERSION_CODENAME</span>&#125;</span>&quot;</span>)</span> stable&quot;</span> | \</span><br><span class="line">  <span class="built_in">sudo</span> <span class="built_in">tee</span> /etc/apt/sources.list.d/docker.list &gt; /dev/null</span><br></pre></td></tr></table></figure><p>添加完成后，<strong>务必更新索引</strong>：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> apt update</span><br></pre></td></tr></table></figure><h2 id="三、安装-Docker-Engine"><a href="#三、安装-Docker-Engine" class="headerlink" title="三、安装 Docker Engine"></a>三、安装 Docker Engine</h2><p>安装最新版本的 Docker Engine、CLI、Containerd 以及 Docker Compose 插件：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> apt install docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin</span><br></pre></td></tr></table></figure><p>验证安装版本：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker --version</span><br><span class="line">docker compose version</span><br></pre></td></tr></table></figure><h2 id="四、安装后配置-关键步骤"><a href="#四、安装后配置-关键步骤" class="headerlink" title="四、安装后配置 (关键步骤)"></a>四、安装后配置 (关键步骤)</h2><h3 id="1-免-Sudo-执行-非-Root-用户"><a href="#1-免-Sudo-执行-非-Root-用户" class="headerlink" title="1. 免 Sudo 执行 (非 Root 用户)"></a>1. 免 Sudo 执行 (非 Root 用户)</h3><p>默认情况下，运行 docker 命令需要 <code>sudo</code> 权限。为了方便使用，建议将当前用户加入 <code>docker</code> 用户组。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. 创建 docker 组 (通常安装时已自动创建)</span></span><br><span class="line"><span class="built_in">sudo</span> groupadd docker</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 将当前用户加入组</span></span><br><span class="line"><span class="built_in">sudo</span> usermod -aG docker <span class="variable">$USER</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 激活更改 (或者退出终端重新登录)</span></span><br><span class="line">newgrp docker</span><br></pre></td></tr></table></figure><p>现在你可以直接运行 <code>docker ps</code> 而无需输入密码了。</p><h3 id="2-配置镜像加速器"><a href="#2-配置镜像加速器" class="headerlink" title="2. 配置镜像加速器"></a>2. 配置镜像加速器</h3><p>国内拉取 Docker Hub 镜像非常慢，建议配置 Registry Mirrors。</p><p>编辑或创建 <code>/etc/docker/daemon.json</code>：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> vim /etc/docker/daemon.json</span><br></pre></td></tr></table></figure><p>登录 <a href="https://cr.console.aliyun.com/cn-hangzhou/instances/mirrors">阿里云容器镜像服务控制台</a>，在左侧菜单找到 <strong>镜像工具 - 镜像加速器</strong>。</p><p>复制专属的加速器地址（格式通常为 <code>https://xxxx.mirror.aliyuncs.com</code>）。</p><figure class="highlight json"><figcaption><span>daemon.json</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;registry-mirrors&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="string">&quot;https://你的专属ID.mirror.aliyuncs.com&quot;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>重启 Docker 服务使配置生效：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> systemctl daemon-reload</span><br><span class="line"><span class="built_in">sudo</span> systemctl restart docker</span><br></pre></td></tr></table></figure><h2 id="五、验证安装"><a href="#五、验证安装" class="headerlink" title="五、验证安装"></a>五、验证安装</h2><p>运行 Hello World 容器来验证一切是否正常：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run hello-world</span><br></pre></td></tr></table></figure><p>如果看到以下输出，说明安装成功：</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Hello from Docker!</span><br><span class="line">This message shows that your installation appears to be working correctly.</span><br><span class="line">...</span><br></pre></td></tr></table></figure><h2 id="六、卸载-Docker"><a href="#六、卸载-Docker" class="headerlink" title="六、卸载 Docker"></a>六、卸载 Docker</h2><p>如果需要彻底移除 Docker，请执行以下命令：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. 卸载依赖包</span></span><br><span class="line"><span class="built_in">sudo</span> apt purge docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin docker-ce-rootless-extras</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 删除镜像、容器和数据卷 (慎重！)</span></span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">rm</span> -rf /var/lib/docker</span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">rm</span> -rf /var/lib/containerd</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 删除配置文件和密钥</span></span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">rm</span> /etc/apt/sources.list.d/docker.list</span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">rm</span> /etc/apt/sources.list.d/docker.sources</span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">rm</span> /etc/apt/keyrings/docker.asc</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">详解在 Ubuntu 系统（含 24.04 新版）下安装 Docker 的全流程。包含卸载旧版、配置 GPG 密钥、设置 APT 软件源（官方/阿里云）、免 Sudo 配置及镜像加速器设置。</summary>
    
    
    
    <category term="开发环境" scheme="https://lijiabao9.github.io/categories/%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/"/>
    
    <category term="Ubuntu" scheme="https://lijiabao9.github.io/categories/%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/Ubuntu/"/>
    
    
    <category term="Docker" scheme="https://lijiabao9.github.io/tags/Docker/"/>
    
  </entry>
  
  <entry>
    <title>Ubuntu 系统安装 JDK 全指南：OpenJDK 与 Oracle JDK 双方案</title>
    <link href="https://lijiabao9.github.io/posts/3c893d60.html"/>
    <id>https://lijiabao9.github.io/posts/3c893d60.html</id>
    <published>2025-12-04T14:27:42.000Z</published>
    <updated>2025-12-05T15:42:37.265Z</updated>
    
    <content type="html"><![CDATA[<p>在 Ubuntu 服务器上部署 Java 环境通常有两种方式：</p><ol><li><strong>包管理器安装 (apt)</strong>：最简单，通常安装的是 OpenJDK，适合大多数开源项目。</li><li><strong>手动安装</strong>：适合需要特定版本（如 Oracle JDK）或需精确控制安装路径的场景。</li></ol><hr><h2 id="方案一：通过-apt-自动安装-推荐"><a href="#方案一：通过-apt-自动安装-推荐" class="headerlink" title="方案一：通过 apt 自动安装 (推荐)"></a>方案一：通过 apt 自动安装 (推荐)</h2><p>这是最快捷的方式，系统会自动处理依赖和环境变量。以安装 <strong>JDK 8</strong> 为例：</p><h3 id="1-安装与验证"><a href="#1-安装与验证" class="headerlink" title="1. 安装与验证"></a>1. 安装与验证</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. 更新软件源</span></span><br><span class="line"><span class="built_in">sudo</span> apt update</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 安装 OpenJDK 8</span></span><br><span class="line"><span class="built_in">sudo</span> apt install openjdk-8-jdk</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 验证安装</span></span><br><span class="line">java -version</span><br></pre></td></tr></table></figure><h3 id="2-管理多个-Java-版本"><a href="#2-管理多个-Java-版本" class="headerlink" title="2. 管理多个 Java 版本"></a>2. 管理多个 Java 版本</h3><p>如果你的系统同时安装了 JDK 8、JDK 11 和 JDK 17，可以使用 <code>update-alternatives</code> 命令在不同版本间快速切换。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> update-alternatives --config java</span><br></pre></td></tr></table></figure><p>执行后会出现一个列表，输入对应的 <strong>Selection</strong> 编号并回车，即可切换系统默认的 Java 版本。</p><h2 id="方案二：手动解压安装-Oracle-JDK"><a href="#方案二：手动解压安装-Oracle-JDK" class="headerlink" title="方案二：手动解压安装 (Oracle JDK)"></a>方案二：手动解压安装 (Oracle JDK)</h2><p>如果你需要使用 Oracle 官方版本，或者需要将 JDK 安装到指定目录，请使用此方法。</p><h3 id="1-下载安装包"><a href="#1-下载安装包" class="headerlink" title="1. 下载安装包"></a>1. 下载安装包</h3><p>请前往 Oracle 官网下载对应架构（x64 或 aarch64）的 <code>.tar.gz</code> 包：</p><ul><li><a href="https://www.oracle.com/java/technologies/downloads/#java8">JDK 8 下载</a> | <a href="https://www.oracle.com/java/technologies/downloads/#java17">JDK 17 下载</a> | <a href="https://www.oracle.com/java/technologies/downloads/#java21">JDK 21 下载</a></li></ul><h3 id="2-解压部署"><a href="#2-解压部署" class="headerlink" title="2. 解压部署"></a>2. 解压部署</h3><p>建议将第三方软件统一安装在 <code>/usr/local/java</code> 目录下。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. 创建目录</span></span><br><span class="line"><span class="built_in">cd</span> /usr/local</span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">mkdir</span> -p java</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 安装包准备</span></span><br><span class="line"><span class="comment"># 请使用 FTP/SFTP 工具将下载好的 tar.gz 包上传到服务器</span></span><br><span class="line"><span class="comment"># 或者 wget 命令直接下载</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 解压到指定目录 (注意替换具体的文件名)</span></span><br><span class="line"><span class="comment"># -C 参数指定解压的目标路径</span></span><br><span class="line"><span class="built_in">sudo</span> tar -zxvf jdk-8u471-linux-x64.tar.gz -C /usr/local/java/</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. 验证解压是否成功</span></span><br><span class="line"><span class="comment"># 注意：这里的目录名 jdk1.8.0_471 视你下载的具体版本而定</span></span><br><span class="line">/usr/local/java/jdk1.8.0_471/bin/java -version</span><br></pre></td></tr></table></figure><h3 id="3-配置环境变量"><a href="#3-配置环境变量" class="headerlink" title="3. 配置环境变量"></a>3. 配置环境变量</h3><p>为了在任何目录下都能使用 <code>java</code> 命令，需要配置环境变量。</p><p>编辑系统级配置文件 <code>/etc/profile</code>（对所有用户生效）：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> vim /etc/profile</span><br></pre></td></tr></table></figure><p>在文件末尾追加以下内容（<strong>注意修改 <code>JAVA_HOME</code> 为你实际的解压路径</strong>）：</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># Java Environment Config</span><br><span class="line">export JAVA_HOME=/usr/local/java/jdk1.8.0_471</span><br><span class="line">export JRE_HOME=$JAVA_HOME/jre</span><br><span class="line">export CLASSPATH=.:$JAVA_HOME/lib:$JRE_HOME/lib</span><br><span class="line">export PATH=$PATH:$JAVA_HOME/bin:$JRE_HOME/bin</span><br></pre></td></tr></table></figure><h3 id="4-重新加载配置"><a href="#4-重新加载配置" class="headerlink" title="4. 重新加载配置"></a>4. 重新加载配置</h3><p>修改配置文件后，需要强制重载才能立即生效：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">source</span> /etc/profile</span><br><span class="line"></span><br><span class="line"><span class="comment"># 再次验证</span></span><br><span class="line">java -version</span><br></pre></td></tr></table></figure><hr><h2 id="补充：Linux-配置文件加载顺序"><a href="#补充：Linux-配置文件加载顺序" class="headerlink" title="补充：Linux 配置文件加载顺序"></a>补充：Linux 配置文件加载顺序</h2><p>理解配置文件的加载顺序，有助于你决定将环境变量写在哪里。</p><ol><li><p><strong>/etc/profile</strong></p><ul><li><strong>级别</strong>：系统全局</li><li><strong>生效时机</strong>：用户登录时加载。</li><li><strong>建议</strong>：生产服务器通常在此配置 JAVA_HOME，确保所有用户可用。</li></ul></li><li><p><strong>~/.bashrc</strong></p><ul><li><strong>级别</strong>：当前用户</li><li><strong>生效时机</strong>：打开新的终端窗口（Shell）时加载。</li><li><strong>建议</strong>：开发测试环境或仅当前用户使用时，推荐修改此文件，避免污染全局环境。</li></ul></li><li><p><strong>/etc/bash.bashrc</strong></p><ul><li><strong>级别</strong>：系统全局</li><li><strong>生效时机</strong>：交互式 Shell 启动时加载。</li></ul></li></ol><blockquote><p><strong>最佳实践</strong>：</p><ul><li>如果是<strong>服务器</strong>部署应用，建议修改 <code>/etc/profile</code>。</li><li>如果是<strong>个人开发机</strong>，建议修改 <code>~/.bashrc</code>。</li></ul></blockquote>]]></content>
    
    
    <summary type="html">详解在 Ubuntu 系统上安装 Java 开发环境的两种主流方式：通过 apt 包管理器安装 OpenJDK，以及手动部署 Oracle JDK，包含环境变量配置与多版本切换指南。</summary>
    
    
    
    <category term="开发环境" scheme="https://lijiabao9.github.io/categories/%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/"/>
    
    <category term="Ubuntu" scheme="https://lijiabao9.github.io/categories/%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/Ubuntu/"/>
    
    
    <category term="JDK" scheme="https://lijiabao9.github.io/tags/JDK/"/>
    
  </entry>
  
  <entry>
    <title>Ubuntu 系统运维手册：常用命令与配置速查</title>
    <link href="https://lijiabao9.github.io/posts/428aa18f.html"/>
    <id>https://lijiabao9.github.io/posts/428aa18f.html</id>
    <published>2025-12-04T13:45:46.000Z</published>
    <updated>2025-12-05T15:42:37.265Z</updated>
    
    <content type="html"><![CDATA[<p>Ubuntu 是目前最流行的 Linux 服务器发行版之一。熟练掌握其常用命令与配置，是运维与开发的必备技能。</p><h2 id="Ubuntu-版本代号速查"><a href="#Ubuntu-版本代号速查" class="headerlink" title="Ubuntu 版本代号速查"></a>Ubuntu 版本代号速查</h2><div class="table-container"><table><thead><tr><th style="text-align:left">版本号</th><th style="text-align:left">代号</th><th style="text-align:left">状态</th><th style="text-align:left">说明</th></tr></thead><tbody><tr><td style="text-align:left"><strong>18.04 LTS</strong></td><td style="text-align:left"><em>Bionic Beaver</em></td><td style="text-align:left">⚠️ 停止维护</td><td style="text-align:left">已于 2023 年停止免费支持</td></tr><tr><td style="text-align:left"><strong>20.04 LTS</strong></td><td style="text-align:left"><em>Focal Fossa</em></td><td style="text-align:left">✅ 活跃</td><td style="text-align:left">长期支持至 2025 年 4 月</td></tr><tr><td style="text-align:left"><strong>22.04 LTS</strong></td><td style="text-align:left"><em>Jammy Jellyfish</em></td><td style="text-align:left">✅ 活跃</td><td style="text-align:left">长期支持至 2027 年 4 月</td></tr><tr><td style="text-align:left"><strong>24.04 LTS</strong></td><td style="text-align:left"><em>Noble Numbat</em></td><td style="text-align:left">🚀 最新</td><td style="text-align:left">长期支持至 2029 年 4 月</td></tr></tbody></table></div><h2 id="一、SSH-远程连接配置"><a href="#一、SSH-远程连接配置" class="headerlink" title="一、SSH 远程连接配置"></a>一、SSH 远程连接配置</h2><p>新装的 Ubuntu 服务器通常默认未开启 SSH 密码登录，甚至未安装 SSH 服务。</p><h3 id="1-安装-SSH-服务"><a href="#1-安装-SSH-服务" class="headerlink" title="1. 安装 SSH 服务"></a>1. 安装 SSH 服务</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> apt update</span><br><span class="line"><span class="built_in">sudo</span> apt install openssh-server -y</span><br><span class="line"><span class="built_in">sudo</span> systemctl status ssh  <span class="comment"># 检查运行状态</span></span><br></pre></td></tr></table></figure><h3 id="2-配置-SSH-访问权限"><a href="#2-配置-SSH-访问权限" class="headerlink" title="2. 配置 SSH 访问权限"></a>2. 配置 SSH 访问权限</h3><p>编辑配置文件 <code>/etc/ssh/sshd_config</code>：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> vim /etc/ssh/sshd_config</span><br></pre></td></tr></table></figure><p>修改或确认以下核心配置：</p><figure class="highlight text"><figcaption><span>sshd_config</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 允许密码验证登录</span><br><span class="line">PasswordAuthentication yes</span><br><span class="line"></span><br><span class="line"># 允许 root 用户直接登录（生产环境建议改为 no，仅用普通用户 sudo）</span><br><span class="line">PermitRootLogin yes</span><br></pre></td></tr></table></figure><p>重启服务使配置生效：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> systemctl restart ssh</span><br></pre></td></tr></table></figure><h3 id="3-防火墙放行-UFW"><a href="#3-防火墙放行-UFW" class="headerlink" title="3. 防火墙放行 (UFW)"></a>3. 防火墙放行 (UFW)</h3><p>如果开启了 <code>ufw</code> 防火墙，必须放行 SSH 端口（默认 22）：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> ufw allow ssh     <span class="comment"># 或 sudo ufw allow 22/tcp</span></span><br><span class="line"><span class="built_in">sudo</span> ufw <span class="built_in">enable</span>        <span class="comment"># 开启防火墙，disable 禁用防火墙</span></span><br><span class="line"><span class="built_in">sudo</span> ufw status        <span class="comment"># 查看状态</span></span><br></pre></td></tr></table></figure><h2 id="二、APT-软件源配置-国内加速"><a href="#二、APT-软件源配置-国内加速" class="headerlink" title="二、APT 软件源配置 (国内加速)"></a>二、APT 软件源配置 (国内加速)</h2><p>默认的官方源在国内访问较慢，建议替换为阿里云、清华大学等镜像源。</p><h3 id="场景-A：Ubuntu-23-10-及之前的版本-传统格式"><a href="#场景-A：Ubuntu-23-10-及之前的版本-传统格式" class="headerlink" title="场景 A：Ubuntu 23.10 及之前的版本 (传统格式)"></a>场景 A：Ubuntu 23.10 及之前的版本 (传统格式)</h3><p>编辑 <code>/etc/apt/sources.list</code>，将内容替换为（以 20.04 <code>focal</code> 为例）：</p><figure class="highlight text"><figcaption><span>sources.list</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">deb https://mirrors.aliyun.com/ubuntu/ focal main restricted universe multiverse</span><br><span class="line">deb-src https://mirrors.aliyun.com/ubuntu/ focal main restricted universe multiverse</span><br><span class="line"></span><br><span class="line">deb https://mirrors.aliyun.com/ubuntu/ focal-security main restricted universe multiverse</span><br><span class="line">deb-src https://mirrors.aliyun.com/ubuntu/ focal-security main restricted universe multiverse</span><br><span class="line"></span><br><span class="line">deb https://mirrors.aliyun.com/ubuntu/ focal-updates main restricted universe multiverse</span><br><span class="line">deb-src https://mirrors.aliyun.com/ubuntu/ focal-updates main restricted universe multiverse</span><br><span class="line"></span><br><span class="line">deb https://mirrors.aliyun.com/ubuntu/ focal-proposed main restricted universe multiverse</span><br><span class="line">deb-src https://mirrors.aliyun.com/ubuntu/ focal-proposed main restricted universe multiverse</span><br><span class="line"></span><br><span class="line">deb https://mirrors.aliyun.com/ubuntu/ focal-backports main restricted universe multiverse</span><br><span class="line">deb-src https://mirrors.aliyun.com/ubuntu/ focal-backports main restricted universe multiverse</span><br></pre></td></tr></table></figure><blockquote><p><strong>注意</strong>：需将 <code>focal</code> 替换为你当前系统的代号（如 <code>jammy</code>）。</p></blockquote><h3 id="场景-B：Ubuntu-24-04-LTS-新版-DEB822-格式"><a href="#场景-B：Ubuntu-24-04-LTS-新版-DEB822-格式" class="headerlink" title="场景 B：Ubuntu 24.04 LTS (新版 DEB822 格式)"></a>场景 B：Ubuntu 24.04 LTS (新版 DEB822 格式)</h3><p>从 24.04 开始，源配置移至 <code>/etc/apt/sources.list.d/ubuntu.sources</code>。</p><ol><li><p><strong>备份原文件</strong>：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> <span class="built_in">mv</span> /etc/apt/sources.list.d/ubuntu.sources /etc/apt/sources.list.d/ubuntu.sources.bak</span><br></pre></td></tr></table></figure></li><li><p><strong>新建配置</strong> <code>/etc/apt/sources.list.d/aliyun.sources</code>：</p><figure class="highlight text"><figcaption><span>aliyun.sources</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Types: deb</span><br><span class="line">URIs: https://mirrors.aliyun.com/ubuntu/</span><br><span class="line">Suites: noble noble-security noble-updates noble-proposed noble-backports</span><br><span class="line">Components: main restricted universe multiverse</span><br><span class="line">Signed-By: /usr/share/keyrings/ubuntu-archive-keyring.gpg</span><br></pre></td></tr></table></figure></li></ol><p><strong>最后，切记更新缓存：</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> apt update</span><br></pre></td></tr></table></figure><h2 id="三、用户与权限管理"><a href="#三、用户与权限管理" class="headerlink" title="三、用户与权限管理"></a>三、用户与权限管理</h2><h3 id="1-基础操作"><a href="#1-基础操作" class="headerlink" title="1. 基础操作"></a>1. 基础操作</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">whoami</span>                  <span class="comment"># 查看当前用户</span></span><br><span class="line"><span class="built_in">id</span>                      <span class="comment"># 查看当前用户ID和组信息</span></span><br><span class="line">su - ubuntu             <span class="comment"># 切换到指定用户</span></span><br><span class="line"><span class="built_in">sudo</span> -i                 <span class="comment"># 使用 sudo 权限切换到 root 环境</span></span><br><span class="line">passwd                  <span class="comment"># 修改当前用户密码</span></span><br></pre></td></tr></table></figure><h3 id="2-用户增删-推荐使用-adduser"><a href="#2-用户增删-推荐使用-adduser" class="headerlink" title="2. 用户增删 (推荐使用 adduser)"></a>2. 用户增删 (推荐使用 adduser)</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 新增用户 (自动创建家目录、设置 Shell)</span></span><br><span class="line"><span class="built_in">sudo</span> adduser testuser</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除用户 (建议保留家目录，若需彻底删除加 --remove-home --remove-all-files)</span></span><br><span class="line"><span class="built_in">sudo</span> deluser testuser</span><br></pre></td></tr></table></figure><h3 id="3-Sudo-提权"><a href="#3-Sudo-提权" class="headerlink" title="3. Sudo 提权"></a>3. Sudo 提权</h3><p>将普通用户加入 <code>sudo</code> 组，使其具备管理员权限：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> usermod -aG <span class="built_in">sudo</span> testuser</span><br><span class="line"></span><br><span class="line"><span class="comment"># 对应的移除命令（需要谨慎使用，移除后自身没权限提权）</span></span><br><span class="line"><span class="built_in">sudo</span> gpasswd -d testuser <span class="built_in">sudo</span></span><br></pre></td></tr></table></figure><p>或者编辑 <code>/etc/sudoers</code> 文件（需使用 <code>sudo vi</code> 命令安全编辑），添加：<code>testuser ALL=(ALL:ALL) ALL</code></p><h2 id="四、系统设置与监控"><a href="#四、系统设置与监控" class="headerlink" title="四、系统设置与监控"></a>四、系统设置与监控</h2><h3 id="1-时区设置"><a href="#1-时区设置" class="headerlink" title="1. 时区设置"></a>1. 时区设置</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">timedatectl set-timezone Asia/Shanghai  <span class="comment"># 设置为中国标准时间</span></span><br><span class="line">timedatectl                             <span class="comment"># 查看当前时间与时区</span></span><br></pre></td></tr></table></figure><h3 id="2-磁盘与资源监控"><a href="#2-磁盘与资源监控" class="headerlink" title="2. 磁盘与资源监控"></a>2. 磁盘与资源监控</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">df</span> -h                   <span class="comment"># 查看磁盘挂载与空间使用 (Disk Free)</span></span><br><span class="line"><span class="built_in">du</span> -h                   <span class="comment"># 查看当前目录下各文件夹的大小 (Disk Usage)</span></span><br><span class="line">free -m                 <span class="comment"># 查看内存使用情况 (MB)</span></span><br><span class="line">top                     <span class="comment"># 显示进程使用情况</span></span><br></pre></td></tr></table></figure><h3 id="3-网络与进程"><a href="#3-网络与进程" class="headerlink" title="3. 网络与进程"></a>3. 网络与进程</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ss -ntulp | grep 8080   <span class="comment"># 查看占用 8080 端口的进程</span></span><br><span class="line">ps -ef | grep java      <span class="comment"># 查看 Java 进程</span></span><br><span class="line"><span class="built_in">kill</span> -9 &lt;PID&gt;           <span class="comment"># 强制结束指定进程 ID</span></span><br></pre></td></tr></table></figure><h3 id="4-软件包管理-apt"><a href="#4-软件包管理-apt" class="headerlink" title="4. 软件包管理(apt)"></a>4. 软件包管理(apt)</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">apt update              <span class="comment"># 更新软件包</span></span><br><span class="line">apt list --upgradable   <span class="comment"># 列出可升级的包</span></span><br><span class="line">apt upgrade -y          <span class="comment"># 升级软件包</span></span><br><span class="line"></span><br><span class="line">apt install ufw         <span class="comment"># 安装 UFW</span></span><br><span class="line">apt remove ufw          <span class="comment"># 卸载 UFW</span></span><br><span class="line">apt purge ufw           <span class="comment"># 彻底卸载 UFW</span></span><br></pre></td></tr></table></figure><h3 id="5-服务管理"><a href="#5-服务管理" class="headerlink" title="5. 服务管理"></a>5. 服务管理</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">systemctl start/stop/restart ufw    <span class="comment"># 启动/停止/重启服务</span></span><br><span class="line">systemctl status ufw                <span class="comment"># 查看服务状态</span></span><br><span class="line">systemctl <span class="built_in">enable</span>/disable ufw        <span class="comment"># 设置/禁止服务 开机自启</span></span><br><span class="line"></span><br><span class="line">journalctl -f -u ufw                <span class="comment"># 实时滚动查看服务日志 --follow --unit</span></span><br><span class="line"></span><br><span class="line">dpkg -L ufw             <span class="comment"># 查看安装的包释放了哪些文件 --listfiles</span></span><br><span class="line">dpkg -l | grep ufw      <span class="comment"># 查看是否安装了某个包  --list</span></span><br></pre></td></tr></table></figure><h2 id="五、文件操作与压缩"><a href="#五、文件操作与压缩" class="headerlink" title="五、文件操作与压缩"></a>五、文件操作与压缩</h2><h3 id="1-常用命令"><a href="#1-常用命令" class="headerlink" title="1. 常用命令"></a>1. 常用命令</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> -p /data/web        <span class="comment"># 递归创建目录</span></span><br><span class="line"><span class="built_in">touch</span> /file.txt           <span class="comment"># 创建文件</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">rm</span> -rf /data/temp         <span class="comment"># 强制递归删除目录 (慎用!)</span></span><br><span class="line"><span class="built_in">mv</span> old.txt new.txt        <span class="comment"># 重命名或移动</span></span><br><span class="line"><span class="built_in">ln</span> -s /src/file /dst/     <span class="comment"># 创建软链接 (快捷方式)</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">cat</span> /etc/passwd     <span class="comment"># 显示文件内容</span></span><br><span class="line">less /etc/passwd    <span class="comment"># 分页显示文件内容</span></span><br></pre></td></tr></table></figure><h3 id="2-压缩与解压-Tar"><a href="#2-压缩与解压-Tar" class="headerlink" title="2. 压缩与解压 (Tar)"></a>2. 压缩与解压 (Tar)</h3><p><code>.tar.gz</code> 是 Linux 下最通用的压缩格式。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 解压，可通过 -C 指定解压到</span></span><br><span class="line">tar -zxvf filename.tar.gz</span><br><span class="line"></span><br><span class="line"><span class="comment"># 压缩</span></span><br><span class="line">tar -zcvf filename.tar.gz /source/dir</span><br></pre></td></tr></table></figure><ul><li><code>z</code>: gzip 压缩</li><li><code>x</code>: 解压 (extract)</li><li><code>c</code>: 创建 (create)</li><li><code>v</code>: 显示过程 (verbose)</li><li><code>f</code>: 指定文件名 (file)</li></ul><h2 id="六、服务后台运行-Nohup"><a href="#六、服务后台运行-Nohup" class="headerlink" title="六、服务后台运行 (Nohup)"></a>六、服务后台运行 (Nohup)</h2><p>在断开 SSH 连接后继续运行程序（如 Java Jar 包）：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 标准后台启动命令</span></span><br><span class="line"><span class="built_in">nohup</span> java -jar app.jar &gt; app.log 2&gt;&amp;1 &amp;</span><br></pre></td></tr></table></figure><ul><li><code>nohup</code>: 不挂断运行 (No Hang Up)。</li><li><code>&gt; app.log</code>: 将标准输出重定向到 app.log。</li><li><code>2&gt;&amp;1</code>: 将错误输出 (2) 重定向到标准输出 (1) 一并写入日志。</li><li><code>&amp;</code>: 在后台运行。</li></ul><p>查看实时日志：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">tail</span> -f app.log</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">全面的 Ubuntu 系统运维指南。涵盖 SSH 远程连接、时区设置、APT 国内源配置（含 24.04 新版格式）、用户权限管理及高频使用的文件与进程管理命令。</summary>
    
    
    
    <category term="开发环境" scheme="https://lijiabao9.github.io/categories/%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/"/>
    
    <category term="Ubuntu" scheme="https://lijiabao9.github.io/categories/%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/Ubuntu/"/>
    
    
    <category term="运维" scheme="https://lijiabao9.github.io/tags/%E8%BF%90%E7%BB%B4/"/>
    
    <category term="语法手册" scheme="https://lijiabao9.github.io/tags/%E8%AF%AD%E6%B3%95%E6%89%8B%E5%86%8C/"/>
    
  </entry>
  
  <entry>
    <title>SpringBoot 整合 MyBatis-Plus 全解：从入门到代码生成器</title>
    <link href="https://lijiabao9.github.io/posts/b4f7cadb.html"/>
    <id>https://lijiabao9.github.io/posts/b4f7cadb.html</id>
    <published>2025-12-03T16:31:11.000Z</published>
    <updated>2025-12-05T15:42:37.266Z</updated>
    
    <content type="html"><![CDATA[<p><a href="https://baomidou.com/">MyBatis-Plus</a> (MP) 是一个 MyBatis 的增强工具，在 MyBatis 的基础上只做增强不做改变，为简化开发、提高效率而生。</p><h2 id="一、快速起步"><a href="#一、快速起步" class="headerlink" title="一、快速起步"></a>一、快速起步</h2><h3 id="1-引入依赖"><a href="#1-引入依赖" class="headerlink" title="1. 引入依赖"></a>1. 引入依赖</h3><p>建议使用 BOM 管理版本，避免依赖冲突。以下基于 Spring Boot 3 + JDK 17 环境：</p><figure class="highlight xml"><figcaption><span>pom.xml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus-bom<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.5.15<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus-spring-boot3-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus-jsqlparser<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="2-可选：全局配置-YAML"><a href="#2-可选：全局配置-YAML" class="headerlink" title="2. 可选：全局配置 (YAML)"></a>2. 可选：全局配置 (YAML)</h3><p>MP 的配置项非常丰富，以下是推荐的生产环境配置：</p><figure class="highlight yaml"><figcaption><span>application.yml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">mybatis-plus:</span></span><br><span class="line">  <span class="attr">mapper-locations:</span> <span class="string">classpath*:mapper/**/*.xml</span>  <span class="comment"># Mapper XML 扫描路径</span></span><br><span class="line">  <span class="attr">type-aliases-package:</span> <span class="string">com.example.demo.entity</span> <span class="comment"># 实体类别名扫描包</span></span><br><span class="line">  <span class="attr">configuration:</span></span><br><span class="line">    <span class="attr">log-impl:</span> <span class="string">org.apache.ibatis.logging.stdout.StdOutImpl</span> <span class="comment"># 开启 SQL 日志打印 (生产环境建议关闭)</span></span><br><span class="line">    <span class="attr">map-underscore-to-camel-case:</span> <span class="literal">true</span> <span class="comment"># 开启下划线转驼峰</span></span><br><span class="line">    <span class="attr">default-enum-type-handler:</span> <span class="string">com.baomidou.mybatisplus.core.handlers.MybatisEnumTypeHandler</span> <span class="comment"># 枚举自动映射</span></span><br><span class="line">  <span class="attr">global-config:</span></span><br><span class="line">    <span class="attr">db-config:</span></span><br><span class="line">      <span class="attr">id-type:</span> <span class="string">AUTO</span> <span class="comment"># 主键策略：数据库自增</span></span><br><span class="line">      <span class="attr">logic-delete-field:</span> <span class="string">deleted</span> <span class="comment"># 全局逻辑删除字段</span></span><br><span class="line">      <span class="attr">logic-delete-value:</span> <span class="number">1</span> <span class="comment"># 已删除值</span></span><br><span class="line">      <span class="attr">logic-not-delete-value:</span> <span class="number">0</span> <span class="comment"># 未删除值</span></span><br></pre></td></tr></table></figure><h3 id="3-说明：实体类规约"><a href="#3-说明：实体类规约" class="headerlink" title="3. 说明：实体类规约"></a>3. 说明：实体类规约</h3><p>MP 默认遵守 <strong>“约定优于配置”</strong> 的原则：</p><ul><li><strong>类名</strong> -> <strong>表名</strong> (驼峰转下划线)</li><li><strong>属性名</strong> -> <strong>字段名</strong> (驼峰转下划线)</li><li><strong>id</strong> -> <strong>主键</strong></li></ul><p>若需自定义，可使用注解：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@TableName(&quot;t_user&quot;)</span> <span class="comment">// 指定表名</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="meta">@TableId(type = IdType.AUTO)</span> <span class="comment">// 指定主键策略</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@TableField(&quot;username&quot;)</span> <span class="comment">// 指定字段名</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@TableField(exist = false)</span> <span class="comment">// 标记非数据库字段</span></span><br><span class="line">    <span class="keyword">private</span> String ignoreField;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-Mapper-接口"><a href="#4-Mapper-接口" class="headerlink" title="4. Mapper 接口"></a>4. Mapper 接口</h3><p>继承 <code>BaseMapper</code> 即可获得通用的 CRUD 能力。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> <span class="keyword">extends</span> <span class="title class_">BaseMapper</span>&lt;User&gt; &#123;</span><br><span class="line">    <span class="comment">// 可以在这里编写自定义 SQL 方法</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h2 id="二、核心功能详解"><a href="#二、核心功能详解" class="headerlink" title="二、核心功能详解"></a>二、核心功能详解</h2><h3 id="1-Service-层-CRUD"><a href="#1-Service-层-CRUD" class="headerlink" title="1. Service 层 CRUD"></a>1. Service 层 CRUD</h3><p>继承 <code>IService</code> 和 <code>ServiceImpl</code>，不仅拥有 Mapper 的能力，还扩展了批量操作。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">IUserService</span> <span class="keyword">extends</span> <span class="title class_">IService</span>&lt;User&gt; &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">extends</span> <span class="title class_">ServiceImpl</span>&lt;UserMapper, User&gt; <span class="keyword">implements</span> <span class="title class_">IUserService</span> &#123;</span><br><span class="line">    <span class="comment">// 业务逻辑代码</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-链式调用-Chain"><a href="#2-链式调用-Chain" class="headerlink" title="2. 链式调用 (Chain)"></a>2. 链式调用 (Chain)</h3><p>MP 提供了类似 Stream 流的链式操作，代码更优雅。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 链式查询：查询 id=1 的用户</span></span><br><span class="line">userService.lambdaQuery().eq(User::getId, <span class="number">1L</span>).one();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 链式更新：将 id=1 的用户年龄改为 18</span></span><br><span class="line">userService.lambdaUpdate().eq(User::getId, <span class="number">1L</span>).set(User::getAge, <span class="number">18</span>).update();</span><br></pre></td></tr></table></figure><h3 id="3-ActiveRecord-模式"><a href="#3-ActiveRecord-模式" class="headerlink" title="3. ActiveRecord 模式"></a>3. ActiveRecord 模式</h3><p>让实体类本身具备 CRUD 能力（需继承 <code>Model</code>）。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">user.setName(<span class="string">&quot;Tom&quot;</span>);</span><br><span class="line">user.insert(); <span class="comment">// 直接调用 insert 方法保存自己</span></span><br></pre></td></tr></table></figure><h3 id="4-Db-Kit-工具类"><a href="#4-Db-Kit-工具类" class="headerlink" title="4. Db Kit 工具类"></a>4. Db Kit 工具类</h3><p>为了避免 service 循环注入，MP 提供了 <code>Db</code> 工具类。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">User</span> <span class="variable">user2</span> <span class="operator">=</span> Db.getById(<span class="number">1L</span>, User.class);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 等效于原本的</span></span><br><span class="line"><span class="type">User</span> <span class="variable">user1</span> <span class="operator">=</span> userService.getById(<span class="number">1L</span>);</span><br></pre></td></tr></table></figure><hr><h2 id="三、条件构造器-Wrapper"><a href="#三、条件构造器-Wrapper" class="headerlink" title="三、条件构造器 (Wrapper)"></a>三、条件构造器 (Wrapper)</h2><p>Wrapper 是 MP 的精髓，用于构建复杂的 WHERE 条件。推荐使用 <strong>LambdaWrapper</strong> 以避免魔法值。</p><h3 id="1-类继承关系"><a href="#1-类继承关系" class="headerlink" title="1. 类继承关系"></a>1. 类继承关系</h3><p><img src="https://cdn.jsdelivr.net/gh/lijiabao9/pic.cloud@main/hexo/post/20251204005149679.webp" alt=""></p><h3 id="2-实战示例"><a href="#2-实战示例" class="headerlink" title="2. 实战示例"></a>2. 实战示例</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 构造条件：name 包含 &quot;Jack&quot; 且 age &gt; 20</span></span><br><span class="line">LambdaQueryWrapper&lt;User&gt; wrapper = Wrappers.lambdaQuery();</span><br><span class="line">wrapper.like(User::getName, <span class="string">&quot;Jack&quot;</span>)</span><br><span class="line">       .gt(User::getAge, <span class="number">20</span>);</span><br><span class="line"></span><br><span class="line">List&lt;User&gt; users = userMapper.selectList(wrapper);</span><br></pre></td></tr></table></figure><h3 id="3-自定义-SQL-结合-Wrapper"><a href="#3-自定义-SQL-结合-Wrapper" class="headerlink" title="3. 自定义 SQL 结合 Wrapper"></a>3. 自定义 SQL 结合 Wrapper</h3><p>在复杂场景下，你可能需要手写 SQL，但又想复用 Wrapper 的条件。</p><p><strong>Mapper 接口：</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 使用 $&#123;ew.customSqlSegment&#125; 拼接 Wrapper 生成的 SQL</span></span><br><span class="line"><span class="meta">@Select(&quot;SELECT * FROM t_user $&#123;ew.customSqlSegment&#125;&quot;)</span></span><br><span class="line">List&lt;User&gt; <span class="title function_">selectByCustomWrapper</span><span class="params">(<span class="meta">@Param(Constants.WRAPPER)</span> Wrapper&lt;User&gt; wrapper)</span>;</span><br></pre></td></tr></table></figure><hr><h2 id="四、自动化高级特性"><a href="#四、自动化高级特性" class="headerlink" title="四、自动化高级特性"></a>四、自动化高级特性</h2><h3 id="1-自动填充-Audit"><a href="#1-自动填充-Audit" class="headerlink" title="1. 自动填充 (Audit)"></a>1. 自动填充 (Audit)</h3><p>自动维护 <code>create_time</code>, <code>update_time</code> 等字段。</p><p><strong>实体类配置：</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@TableField(fill = FieldFill.INSERT)</span></span><br><span class="line"><span class="keyword">private</span> LocalDateTime createTime;</span><br><span class="line"></span><br><span class="line"><span class="meta">@TableField(fill = FieldFill.INSERT_UPDATE)</span></span><br><span class="line"><span class="keyword">private</span> LocalDateTime updateTime;</span><br></pre></td></tr></table></figure><p><strong>处理器实现：</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyMetaObjectHandler</span> <span class="keyword">implements</span> <span class="title class_">MetaObjectHandler</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">insertFill</span><span class="params">(MetaObject metaObject)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.strictInsertFill(metaObject, <span class="string">&quot;createTime&quot;</span>, LocalDateTime.class, LocalDateTime.now());</span><br><span class="line">        <span class="built_in">this</span>.strictInsertFill(metaObject, <span class="string">&quot;updateTime&quot;</span>, LocalDateTime.class, LocalDateTime.now());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateFill</span><span class="params">(MetaObject metaObject)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.strictInsertFill(metaObject, <span class="string">&quot;updateTime&quot;</span>, LocalDateTime.class, LocalDateTime.now());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-逻辑删除"><a href="#2-逻辑删除" class="headerlink" title="2. 逻辑删除"></a>2. 逻辑删除</h3><p>配置后，<code>deleteById</code> 会变成 <code>UPDATE t_user SET deleted=1 WHERE id=?</code>。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="meta">@TableLogic</span></span><br><span class="line">    <span class="keyword">private</span> Integer deleted;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p><strong>⚠️ 注意</strong>：逻辑删除与数据库唯一索引存在冲突风险。建议逻辑删除字段使用 <code>delete_time</code> (时间戳) 或在唯一索引中包含逻辑删除字段。</p></blockquote><h3 id="3-枚举映射"><a href="#3-枚举映射" class="headerlink" title="3. 枚举映射"></a>3. 枚举映射</h3><p>当实体类 User 的属性 gender，javaType 是枚举，columnType 是 int 时。</p><p>MyBatis-Plus 提供了全局配置的枚举映射处理器，无需再写转换代码。</p><figure class="highlight yaml"><figcaption><span>application.yml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">mybatis-plus:</span></span><br><span class="line">  <span class="attr">configuration:</span></span><br><span class="line">    <span class="attr">default-enum-type-handler:</span> <span class="string">com.baomidou.mybatisplus.core.handlers.MybatisEnumTypeHandler</span></span><br></pre></td></tr></table></figure><p>在对应的枚举类中，给对应属性添加注解 <code>EnumValue</code>：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">Gender</span> &#123;</span><br><span class="line">    MALE(<span class="number">1</span>, <span class="string">&quot;男&quot;</span>),</span><br><span class="line">    FEMALE(<span class="number">2</span>, <span class="string">&quot;女&quot;</span>),</span><br><span class="line">    ;</span><br><span class="line">    <span class="meta">@com</span>.baomidou.mybatisplus.annotation.EnumValue</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Integer code;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@com</span>.fasterxml.jackson.annotation.JsonValue</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String description;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-JSON-字段映射"><a href="#4-JSON-字段映射" class="headerlink" title="4. JSON 字段映射"></a>4. JSON 字段映射</h3><p>利用 <code>JacksonTypeHandler</code> 自动实现 JSON 字符串与 Java 对象的互转。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@TableName(autoResultMap = true)</span> <span class="comment">// 必须开启</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="meta">@TableField(typeHandler = JacksonTypeHandler.class)</span></span><br><span class="line">    <span class="keyword">private</span> UserInfo info; <span class="comment">// 数据库存 JSON，Java 用对象</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h2 id="五、插件体系"><a href="#五、插件体系" class="headerlink" title="五、插件体系"></a>五、插件体系</h2><p>MP 的插件通过拦截器机制实现，需配置 <code>MybatisPlusInterceptor</code>。</p><h3 id="1-插件配置类"><a href="#1-插件配置类" class="headerlink" title="1. 插件配置类"></a>1. 插件配置类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MybatisPlusConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> MybatisPlusInterceptor <span class="title function_">mybatisPlusInterceptor</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">MybatisPlusInterceptor</span> <span class="variable">interceptor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MybatisPlusInterceptor</span>();</span><br><span class="line">        <span class="comment">// 1. 分页插件 (必须放在最后)</span></span><br><span class="line">        interceptor.addInnerInterceptor(<span class="keyword">new</span> <span class="title class_">PaginationInnerInterceptor</span>(DbType.MYSQL));</span><br><span class="line">        <span class="keyword">return</span> interceptor;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-分页查询"><a href="#2-分页查询" class="headerlink" title="2. 分页查询"></a>2. 分页查询</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// IPage 是分页结果，current 是当前页，size 是每页条数</span></span><br><span class="line">Page&lt;User&gt; page = <span class="keyword">new</span> <span class="title class_">Page</span>&lt;&gt;(<span class="number">1</span>, <span class="number">10</span>);</span><br><span class="line">userService.page(page, <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;User&gt;().gt(User::getAge, <span class="number">18</span>));</span><br><span class="line"></span><br><span class="line">System.out.println(<span class="string">&quot;总条数：&quot;</span> + page.getTotal());</span><br><span class="line">System.out.println(<span class="string">&quot;当前页数据：&quot;</span> + page.getRecords());</span><br></pre></td></tr></table></figure><hr><h2 id="六、代码生成器-Generator"><a href="#六、代码生成器-Generator" class="headerlink" title="六、代码生成器 (Generator)"></a>六、代码生成器 (Generator)</h2><p>无需手写繁琐的 Entity、Mapper、Service 代码，一键生成。</p><h3 id="1-引入依赖-1"><a href="#1-引入依赖-1" class="headerlink" title="1. 引入依赖"></a>1. 引入依赖</h3><figure class="highlight xml"><figcaption><span>pom.xml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus-generator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.5.14<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.freemarker<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>freemarker<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.3.34<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="2-配置运行代码"><a href="#2-配置运行代码" class="headerlink" title="2. 配置运行代码"></a>2. 配置运行代码</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CodeGenerator</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 数据库连接信息</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> <span class="string">&quot;jdbc:mysql://localhost:3306/test&quot;</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> <span class="string">&quot;root&quot;</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">password</span> <span class="operator">=</span> <span class="string">&quot;123456&quot;</span>;</span><br><span class="line">        <span class="comment">// 包名</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">packageName</span> <span class="operator">=</span> <span class="string">&quot;com.example.demo&quot;</span>;</span><br><span class="line">        <span class="comment">// 需要生成的表</span></span><br><span class="line">        String[] tables = &#123;<span class="string">&quot;user&quot;</span>&#125;;</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">projectPath</span> <span class="operator">=</span> System.getProperty(<span class="string">&quot;user.dir&quot;</span>);</span><br><span class="line">        FastAutoGenerator</span><br><span class="line">                <span class="comment">// 数据库连接</span></span><br><span class="line">                .create(url, username, password)</span><br><span class="line">                <span class="comment">// 全局配置</span></span><br><span class="line">                .globalConfig(builder -&gt; builder</span><br><span class="line">                        .author(<span class="string">&quot;Gabriel&quot;</span>)  <span class="comment">// 设置作者</span></span><br><span class="line">                        .enableSpringdoc()  <span class="comment">// 开启 swagger 模式（OpenAPI2 使用 .enableSwagger()）</span></span><br><span class="line">                        .outputDir(projectPath + <span class="string">&quot;/src/main/java/&quot;</span>) <span class="comment">// 指定输出目录</span></span><br><span class="line">                        .disableOpenDir()   <span class="comment">// 禁止打开输出目录</span></span><br><span class="line">                )</span><br><span class="line">                <span class="comment">// 数据源配置</span></span><br><span class="line">                .dataSourceConfig(builder -&gt; builder</span><br><span class="line">                        .typeConvertHandler((globalConfig, typeRegistry, metaInfo) -&gt; &#123;</span><br><span class="line">                            <span class="type">int</span> <span class="variable">typeCode</span> <span class="operator">=</span> metaInfo.getJdbcType().TYPE_CODE;</span><br><span class="line">                            <span class="comment">// 自定义类型转换</span></span><br><span class="line">                            <span class="keyword">if</span> (typeCode == Types.TINYINT || typeCode == Types.SMALLINT) &#123;</span><br><span class="line">                                <span class="keyword">return</span> DbColumnType.INTEGER;</span><br><span class="line">                            &#125;</span><br><span class="line">                            <span class="keyword">return</span> typeRegistry.getColumnType(metaInfo);</span><br><span class="line">                        &#125;)</span><br><span class="line">                )</span><br><span class="line">                <span class="comment">// 包配置</span></span><br><span class="line">                .packageConfig(builder -&gt; builder</span><br><span class="line">                        .parent(packageName)    <span class="comment">// 设置父包名</span></span><br><span class="line">                        .pathInfo(Collections.singletonMap(OutputFile.xml, projectPath + <span class="string">&quot;/src/main/resources/mapper&quot;</span>)) <span class="comment">// 设置 xml 文件输出目录</span></span><br><span class="line">                )</span><br><span class="line">                <span class="comment">// 策略配置</span></span><br><span class="line">                .strategyConfig(builder -&gt; builder</span><br><span class="line">                        .addTablePrefix(<span class="string">&quot;t_&quot;</span>)       <span class="comment">// 删除表前缀</span></span><br><span class="line">                        .addFieldPrefix(<span class="string">&quot;is_&quot;</span>)      <span class="comment">// 删除字段前缀</span></span><br><span class="line">                        .addFieldSuffix(<span class="string">&quot;_flag&quot;</span>)    <span class="comment">// 删除字段后缀</span></span><br><span class="line">                        .addInclude(tables)         <span class="comment">// 设置需要生成的表</span></span><br><span class="line">                        .controllerBuilder()</span><br><span class="line">                        .enableRestStyle()          <span class="comment">// @Controller -&gt; @RestController</span></span><br><span class="line">                        .enableHyphenStyle()        <span class="comment">// @RequestMapping(&quot;/managerUser&quot;) -&gt; @RequestMapping(&quot;/manager-user&quot;)</span></span><br><span class="line">                        .serviceBuilder()</span><br><span class="line">                        .mapperBuilder()</span><br><span class="line">                        .enableBaseResultMap()      <span class="comment">// xml 生成 BaseResultMap</span></span><br><span class="line">                        .enableBaseColumnList()     <span class="comment">// xml 生成 BaseColumnList</span></span><br><span class="line">                        .entityBuilder()</span><br><span class="line">                        .enableLombok()             <span class="comment">// 添加 lombok 注解</span></span><br><span class="line">                        .enableSerialAnnotation()   <span class="comment">// 添加 @Serial 注解（since JDK 14）</span></span><br><span class="line">                )</span><br><span class="line">                <span class="comment">// 模板配置。默认的是Velocity引擎模板。需要引入对应模板的依赖</span></span><br><span class="line">                .templateEngine(<span class="keyword">new</span> <span class="title class_">FreemarkerTemplateEngine</span>())</span><br><span class="line">                <span class="comment">// 执行</span></span><br><span class="line">                .execute();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">深度解析 SpringBoot 整合 MyBatis-Plus 的全流程。涵盖 Maven 依赖、CRUD 接口使用、Wrapper 条件构造器、自动填充、逻辑删除、分页插件及官方代码生成器的详细配置。</summary>
    
    
    
    <category term="编程语言" scheme="https://lijiabao9.github.io/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/"/>
    
    <category term="Java" scheme="https://lijiabao9.github.io/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/Java/"/>
    
    
    <category term="SpringBoot" scheme="https://lijiabao9.github.io/tags/SpringBoot/"/>
    
    <category term="MyBatis-Plus" scheme="https://lijiabao9.github.io/tags/MyBatis-Plus/"/>
    
    <category term="ORM" scheme="https://lijiabao9.github.io/tags/ORM/"/>
    
  </entry>
  
  <entry>
    <title>SpringBoot 整合 Knife4j：从入门到精通 Swagger 接口文档</title>
    <link href="https://lijiabao9.github.io/posts/7687e76b.html"/>
    <id>https://lijiabao9.github.io/posts/7687e76b.html</id>
    <published>2025-12-03T15:26:11.000Z</published>
    <updated>2025-12-05T15:42:37.266Z</updated>
    
    <content type="html"><![CDATA[<p>在前后端分离的开发模式中，一份实时更新、可调试的接口文档至关重要。</p><p><a href="https://doc.xiaominfo.com/">Knife4j</a> 是基于 Swagger/OpenAPI 构建的增强型接口文档工具，它提供了更符合国人习惯的 UI 界面和强大的调试功能。</p><blockquote><p><strong>访问地址</strong>：<br>配置完成后，浏览器访问：<kbd><a href="http://localhost:8080/doc.html">http://localhost:8080/doc.html</a></kbd><br><em>注：某些网络环境下，直接使用 IP (127.0.0.1) 可能会导致跨域或静态资源加载问题，推荐优先使用 localhost。</em></p></blockquote><hr><h2 id="场景一：Spring-Boot-2-OpenAPI-2"><a href="#场景一：Spring-Boot-2-OpenAPI-2" class="headerlink" title="场景一：Spring Boot 2 (OpenAPI 2)"></a>场景一：Spring Boot 2 (OpenAPI 2)</h2><p>适用于老项目或 <strong>JDK 1.8</strong> 环境，底层基于 <strong>Swagger 2 (OpenAPI 2)</strong> 规范。</p><h3 id="1-引入依赖"><a href="#1-引入依赖" class="headerlink" title="1. 引入依赖"></a>1. 引入依赖</h3><p>在 <code>pom.xml</code> 中添加 Knife4j 的 starter 依赖：</p><figure class="highlight xml"><figcaption><span>pom.xml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.xiaoymin<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>knife4j-openapi2-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.5.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="2-配置文件-YAML"><a href="#2-配置文件-YAML" class="headerlink" title="2. 配置文件 (YAML)"></a>2. 配置文件 (YAML)</h3><p>无需编写 Java 配置类，直接在 <code>application.yml</code> 中开启增强模式：</p><figure class="highlight yaml"><figcaption><span>application.yml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">knife4j:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">openapi:</span></span><br><span class="line">    <span class="attr">title:</span> <span class="string">&quot;项目接口文档&quot;</span></span><br><span class="line">    <span class="attr">description:</span> <span class="string">&quot;基于 Knife4j 的后端接口服务&quot;</span></span><br><span class="line">    <span class="attr">email:</span> <span class="string">&quot;contact@example.com&quot;</span></span><br><span class="line">    <span class="attr">concat:</span> <span class="string">&quot;开发者名称&quot;</span></span><br><span class="line">    <span class="attr">version:</span> <span class="string">v1.0.0</span></span><br><span class="line">    <span class="attr">group:</span></span><br><span class="line">      <span class="attr">default:</span></span><br><span class="line">        <span class="attr">group-name:</span> <span class="string">默认分组</span></span><br><span class="line">        <span class="attr">api-rule:</span> <span class="string">package</span></span><br><span class="line">        <span class="comment"># ⚠️ 注意：此处需修改为你项目的 Controller 包路径</span></span><br><span class="line">        <span class="attr">api-rule-resources:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">com.example.demo.web</span></span><br></pre></td></tr></table></figure><h3 id="3-常用注解-Swagger-2"><a href="#3-常用注解-Swagger-2" class="headerlink" title="3. 常用注解 (Swagger 2)"></a>3. 常用注解 (Swagger 2)</h3><div class="table-container"><table><thead><tr><th style="text-align:left">作用目标</th><th style="text-align:left">注解</th><th style="text-align:left">说明</th></tr></thead><tbody><tr><td style="text-align:left"><strong>类 (Controller)</strong></td><td style="text-align:left"><code>@Api(tags = &quot;用户模块&quot;)</code></td><td style="text-align:left">标记控制器类的功能说明</td></tr><tr><td style="text-align:left"><strong>方法 (Method)</strong></td><td style="text-align:left"><code>@ApiOperation(&quot;新增用户&quot;)</code></td><td style="text-align:left">标记具体接口的功能说明</td></tr><tr><td style="text-align:left"><strong>参数 (Param)</strong></td><td style="text-align:left"><code>@ApiParam(&quot;用户ID&quot;)</code></td><td style="text-align:left">标记接口参数的含义</td></tr><tr><td style="text-align:left"><strong>实体类 (DTO)</strong></td><td style="text-align:left"><code>@ApiModel(description = &quot;用户信息&quot;)</code></td><td style="text-align:left">标记数据模型类</td></tr><tr><td style="text-align:left"><strong>字段 (Field)</strong></td><td style="text-align:left"><code>@ApiModelProperty(&quot;用户名&quot;)</code></td><td style="text-align:left">标记模型中的字段含义</td></tr></tbody></table></div><hr><h2 id="场景二：Spring-Boot-3-OpenAPI-3"><a href="#场景二：Spring-Boot-3-OpenAPI-3" class="headerlink" title="场景二：Spring Boot 3 (OpenAPI 3)"></a>场景二：Spring Boot 3 (OpenAPI 3)</h2><p>适用于新项目，要求 <strong>JDK >= 17</strong>，底层基于 <strong>SpringDoc (OpenAPI 3)</strong> 规范。</p><h3 id="1-引入依赖-1"><a href="#1-引入依赖-1" class="headerlink" title="1. 引入依赖"></a>1. 引入依赖</h3><p><strong>注意</strong>：Spring Boot 3 使用 Jakarta EE 规范，必须引入 <code>jakarta</code> 版本的 starter。</p><figure class="highlight xml"><figcaption><span>pom.xml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.xiaoymin<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>knife4j-openapi3-jakarta-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.5.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="2-配置文件-YAML-1"><a href="#2-配置文件-YAML-1" class="headerlink" title="2. 配置文件 (YAML)"></a>2. 配置文件 (YAML)</h3><p>Spring Boot 3 中，配置主要围绕 <code>springdoc</code> 进行，<code>knife4j</code> 仅作为 UI 增强配置。</p><figure class="highlight yaml"><figcaption><span>application.yml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. SpringDoc 基础配置</span></span><br><span class="line"><span class="attr">springdoc:</span></span><br><span class="line">  <span class="attr">swagger-ui:</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">/swagger-ui.html</span></span><br><span class="line">    <span class="attr">tags-sorter:</span> <span class="string">alpha</span>      <span class="comment"># 接口分组排序规则</span></span><br><span class="line">    <span class="attr">operations-sorter:</span> <span class="string">alpha</span> <span class="comment"># 接口方法排序规则</span></span><br><span class="line">  <span class="attr">api-docs:</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">/v3/api-docs</span>      <span class="comment"># OpenAPI 描述文件路径</span></span><br><span class="line">  <span class="attr">group-configs:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">group:</span> <span class="string">&#x27;default&#x27;</span></span><br><span class="line">      <span class="attr">paths-to-match:</span> <span class="string">&#x27;/**&#x27;</span></span><br><span class="line">      <span class="comment"># ⚠️ 注意：此处需修改为你项目的 Controller 包路径</span></span><br><span class="line">      <span class="attr">packages-to-scan:</span> <span class="string">com.example.demo.web</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. Knife4j 增强配置</span></span><br><span class="line"><span class="attr">knife4j:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">setting:</span></span><br><span class="line">    <span class="attr">language:</span> <span class="string">zh_cn</span>         <span class="comment"># 默认中文</span></span><br></pre></td></tr></table></figure><h3 id="3-常用注解-OpenAPI-3"><a href="#3-常用注解-OpenAPI-3" class="headerlink" title="3. 常用注解 (OpenAPI 3)"></a>3. 常用注解 (OpenAPI 3)</h3><p>OpenAPI 3 的注解更加语义化，与 Swagger 2 有较大区别：</p><div class="table-container"><table><thead><tr><th style="text-align:left">作用目标</th><th style="text-align:left">注解</th><th style="text-align:left">说明</th></tr></thead><tbody><tr><td style="text-align:left"><strong>类 (Controller)</strong></td><td style="text-align:left"><code>@Tag(name = &quot;用户模块&quot;)</code></td><td style="text-align:left">对应 Swagger2 的 @Api</td></tr><tr><td style="text-align:left"><strong>方法 (Method)</strong></td><td style="text-align:left"><code>@Operation(summary = &quot;新增用户&quot;)</code></td><td style="text-align:left">对应 Swagger2 的 @ApiOperation</td></tr><tr><td style="text-align:left"><strong>参数 (Param)</strong></td><td style="text-align:left"><code>@Parameter(description = &quot;用户ID&quot;)</code></td><td style="text-align:left">对应 Swagger2 的 @ApiParam</td></tr><tr><td style="text-align:left"><strong>实体类 (DTO)</strong></td><td style="text-align:left"><code>@Schema(description = &quot;用户信息&quot;)</code></td><td style="text-align:left">对应 Swagger2 的 @ApiModel</td></tr><tr><td style="text-align:left"><strong>字段 (Field)</strong></td><td style="text-align:left"><code>@Schema(description = &quot;用户名&quot;)</code></td><td style="text-align:left">对应 Swagger2 的 @ApiModelProperty</td></tr></tbody></table></div><hr><h2 id="附录：注解迁移对照表"><a href="#附录：注解迁移对照表" class="headerlink" title="附录：注解迁移对照表"></a>附录：注解迁移对照表</h2><p>如果你正在将老项目从 Spring Boot 2 升级到 3，可以参考下图进行注解替换：</p><p><strong>总结：</strong></p><ul><li><strong>SB2</strong> 使用 <code>io.swagger.annotations.*</code> 包。</li><li><strong>SB3</strong> 使用 <code>io.swagger.v3.oas.annotations.*</code> 包。</li><li>大体原则是：<code>Api</code> 变成了 <code>Tag</code> 或 <code>Operation</code>，<code>Model</code> 变成了 <code>Schema</code>。</li></ul>]]></content>
    
    
    <summary type="html">详解 SpringBoot 2.x 与 3.x 版本下 Knife4j 的集成差异。涵盖 OpenAPI2 与 OpenAPI3 的配置区别、注解迁移指南，助你快速生成美观的在线接口文档。</summary>
    
    
    
    <category term="编程语言" scheme="https://lijiabao9.github.io/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/"/>
    
    <category term="Java" scheme="https://lijiabao9.github.io/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/Java/"/>
    
    
    <category term="SpringBoot" scheme="https://lijiabao9.github.io/tags/SpringBoot/"/>
    
    <category term="Swagger" scheme="https://lijiabao9.github.io/tags/Swagger/"/>
    
    <category term="Knife4j" scheme="https://lijiabao9.github.io/tags/Knife4j/"/>
    
  </entry>
  
  <entry>
    <title>PostgreSQL 绿色版安装指南：集成 PostGIS 空间数据库</title>
    <link href="https://lijiabao9.github.io/posts/8e6be576.html"/>
    <id>https://lijiabao9.github.io/posts/8e6be576.html</id>
    <published>2025-12-02T16:19:30.000Z</published>
    <updated>2025-12-05T15:42:37.265Z</updated>
    
    <content type="html"><![CDATA[<p>相比于 EXE 安装程序，使用 <strong>Zip 压缩包</strong> 安装 PostgreSQL 更加清爽：它不会在注册表中留下难以清理的垃圾，且支持多版本共存，非常适合开发环境。</p><p>本文将演示安装 <code>PostgreSQL 18.1</code> 并集成 PostGIS 空间扩展的完整流程。</p><h2 id="一、PostgreSQL-基础安装"><a href="#一、PostgreSQL-基础安装" class="headerlink" title="一、PostgreSQL 基础安装"></a>一、PostgreSQL 基础安装</h2><h3 id="1-下载与解压"><a href="#1-下载与解压" class="headerlink" title="1. 下载与解压"></a>1. 下载与解压</h3><p>前往 EnterpriseDB 提供的二进制包下载页面（也可去官网找 Binaries）：</p><blockquote><p><strong>下载地址</strong>：<a href="https://www.enterprisedb.com/download-postgresql-binaries">https://www.enterprisedb.com/download-postgresql-binaries</a></p></blockquote><p>将下载的压缩包解压到目标路径，例如：<code>D:\Program Files\PostgreSQL\postgresql-18.1-1</code>。</p><h3 id="2-配置环境变量-推荐"><a href="#2-配置环境变量-推荐" class="headerlink" title="2. 配置环境变量 (推荐)"></a>2. 配置环境变量 (推荐)</h3><p>为了方便在任意终端使用 <code>psql</code>、<code>pg_ctl</code> 等命令，建议配置环境变量。</p><ul><li><strong>操作</strong>：在系统变量 <code>Path</code> 中添加一行：<code>D:\Program Files\PostgreSQL\postgresql-18.1-1\bin</code></li></ul><h3 id="3-初始化数据库"><a href="#3-初始化数据库" class="headerlink" title="3. 初始化数据库"></a>3. 初始化数据库</h3><p>以管理员身份打开命令提示符 (CMD)，进入软件根目录，执行初始化命令：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin\initdb.exe -D data -U postgres -A password -E UTF8 --locale=C -W</span><br></pre></td></tr></table></figure><p><strong>参数详解：</strong></p><ul><li><code>-D data</code>: 指定数据存储目录为当前目录下的 <code>data</code> 文件夹（会自动创建）。</li><li><code>-U postgres</code>: 指定超级用户名为 <code>postgres</code>。</li><li><code>-A password</code>: 指定认证方式为密码认证。</li><li><code>-E UTF8</code>: 设置数据库编码为 UTF-8。</li><li><code>--locale=C</code>: 设置区域语言环境为 C（避免操作系统语言导致的排序或乱码问题）。</li><li><code>-W</code>: 强制提示输入并确认超级用户的密码。</li></ul><blockquote><p><strong>提示</strong>：执行后需输入两次密码，请务必记住该密码！</p></blockquote><h3 id="4-注册系统服务"><a href="#4-注册系统服务" class="headerlink" title="4. 注册系统服务"></a>4. 注册系统服务</h3><p>为了让数据库开机自启或后台运行，需要将其注册为 Windows 服务。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -N 后接服务名称，-S auto 表示开机自启</span></span><br><span class="line">bin\pg_ctl.exe register -N PostgreSQL -D <span class="string">&quot;D:\Program Files\PostgreSQL\postgresql-18.1-1\data&quot;</span> -S auto</span><br></pre></td></tr></table></figure><h2 id="二、PostGIS-扩展集成"><a href="#二、PostGIS-扩展集成" class="headerlink" title="二、PostGIS 扩展集成"></a>二、PostGIS 扩展集成</h2><p>PostGIS 是 PostgreSQL 的灵魂伴侣，安装后数据库将支持空间地理信息存储与分析。</p><h3 id="1-下载插件包"><a href="#1-下载插件包" class="headerlink" title="1. 下载插件包"></a>1. 下载插件包</h3><p>前往 OSGeo 下载对应版本的 PostGIS 压缩包（注意与 PG 版本号对应，如 pg18）：</p><blockquote><p><strong>下载地址</strong>：<a href="https://download.osgeo.org/postgis/windows/">https://download.osgeo.org/postgis/windows/</a></p></blockquote><h3 id="2-手动覆盖安装-最稳妥方式"><a href="#2-手动覆盖安装-最稳妥方式" class="headerlink" title="2. 手动覆盖安装 (最稳妥方式)"></a>2. 手动覆盖安装 (最稳妥方式)</h3><p>虽然压缩包内提供了安装脚本，但由于路径识别问题极易报错。<strong>推荐直接使用文件夹合并法</strong>：</p><ol><li>解压 PostGIS 压缩包。</li><li>将解压出来的 <code>bin</code>、<code>lib</code>、<code>share</code>、<code>gdal-data</code> 等文件夹，<strong>全选并复制</strong>。</li><li><strong>粘贴到 PostgreSQL 的安装根目录</strong> (<code>D:\Program Files\PostgreSQL\postgresql-18.1-1</code>)。</li><li>若提示文件冲突，选择 <strong>“替换目标中的文件”</strong>。</li></ol><h3 id="3-验证空间函数"><a href="#3-验证空间函数" class="headerlink" title="3. 验证空间函数"></a>3. 验证空间函数</h3><p>启动数据库服务后，连接数据库（使用 psql 或 Navicat/DBeaver），执行以下 SQL 启用插件并测试：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 连接数据库</span></span><br><span class="line">psql -U postgres</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 0. 创建数据库，切换数据库</span></span><br><span class="line"><span class="keyword">CREATE</span> DATABASE example_postgis36;</span><br><span class="line">\c example_postgis36;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 1. 在当前数据库启用 PostGIS 扩展</span></span><br><span class="line"><span class="keyword">CREATE</span> EXTENSION postgis;</span><br><span class="line"><span class="keyword">CREATE</span> EXTENSION postgis_raster;</span><br><span class="line"><span class="keyword">CREATE</span> EXTENSION postgis_sfcgal;</span><br><span class="line"><span class="keyword">CREATE</span> EXTENSION postgis_topology;</span><br><span class="line"><span class="keyword">CREATE</span> EXTENSION address_standardizer;</span><br><span class="line"><span class="keyword">CREATE</span> EXTENSION address_standardizer_data_us;</span><br><span class="line"><span class="keyword">CREATE</span> EXTENSION fuzzystrmatch;</span><br><span class="line"><span class="keyword">CREATE</span> EXTENSION postgis_tiger_geocoder;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 2. 测试空间计算函数 (计算点位距离)</span></span><br><span class="line"><span class="keyword">SELECT</span> st_geogfromtext(<span class="string">&#x27;POINT(113 23)&#x27;</span>);</span><br></pre></td></tr></table></figure><p>若返回二进制或十六进制的几何数据，即表示 PostGIS 安装成功。</p><h2 id="三、服务管理常用命令"><a href="#三、服务管理常用命令" class="headerlink" title="三、服务管理常用命令"></a>三、服务管理常用命令</h2><p>建议以 <strong>管理员身份</strong> 运行 CMD 或 PowerShell。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 启动服务</span></span><br><span class="line">net start PostgreSQL</span><br><span class="line"></span><br><span class="line"><span class="comment"># 停止服务</span></span><br><span class="line">net stop PostgreSQL</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置服务为开机自启</span></span><br><span class="line">sc config PostgreSQL start=auto</span><br></pre></td></tr></table></figure><h2 id="四、彻底卸载"><a href="#四、彻底卸载" class="headerlink" title="四、彻底卸载"></a>四、彻底卸载</h2><p>绿色版的卸载非常简单且彻底：</p><ol><li><strong>停止服务</strong>：<code>net stop PostgreSQL</code></li><li><strong>移除服务</strong>：<code>sc delete PostgreSQL</code></li><li><strong>删除文件</strong>：直接删除整个 PostgreSQL 安装目录。</li><li><strong>清理环境</strong>：如果在第一步配置了环境变量 Path，记得移除。</li></ol>]]></content>
    
    
    <summary type="html">详解在 Windows 下通过 Zip 压缩包安装 PostgreSQL (v17.6) 及 PostGIS 插件的全过程。包含初始化配置、服务注册、环境变量设置及彻底卸载方案。</summary>
    
    
    
    <category term="开发环境" scheme="https://lijiabao9.github.io/categories/%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/"/>
    
    <category term="Windows" scheme="https://lijiabao9.github.io/categories/%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/Windows/"/>
    
    
    <category term="PostgreSQL" scheme="https://lijiabao9.github.io/tags/PostgreSQL/"/>
    
    <category term="PostGIS" scheme="https://lijiabao9.github.io/tags/PostGIS/"/>
    
    <category term="数据库" scheme="https://lijiabao9.github.io/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    <category term="GIS" scheme="https://lijiabao9.github.io/tags/GIS/"/>
    
  </entry>
  
  <entry>
    <title>MySQL 绿色版安装指南：压缩包部署、配置与卸载全流程</title>
    <link href="https://lijiabao9.github.io/posts/7d511698.html"/>
    <id>https://lijiabao9.github.io/posts/7d511698.html</id>
    <published>2025-12-02T16:01:19.000Z</published>
    <updated>2025-12-05T15:42:37.265Z</updated>
    
    <content type="html"><![CDATA[<p>相比于 MSI 安装版，使用 <strong>Zip 压缩包</strong>（Archive）方式安装 MySQL 有着巨大的优势：<strong>系统侵入性低、配置灵活、卸载极其干净</strong>。</p><p>本文记录了在 Windows 环境下部署 <code>MySQL 9.5.0</code> 绿色版的完整流程。</p><h2 id="一、下载与解压"><a href="#一、下载与解压" class="headerlink" title="一、下载与解压"></a>一、下载与解压</h2><h3 id="1-下载压缩包"><a href="#1-下载压缩包" class="headerlink" title="1. 下载压缩包"></a>1. 下载压缩包</h3><p>前往 MySQL 官方下载页面，选择 <strong>Windows (x86, 64-bit), ZIP Archive</strong>。</p><blockquote><p><strong>下载地址</strong>：<a href="https://dev.mysql.com/downloads/mysql/">https://dev.mysql.com/downloads/mysql/</a></p></blockquote><h3 id="2-解压部署"><a href="#2-解压部署" class="headerlink" title="2. 解压部署"></a>2. 解压部署</h3><p>将下载的压缩包解压到你希望安装的目录。</p><p>例如：<code>D:\Program Files\MySQL\mysql-9.5.0\</code></p><h2 id="二、核心配置-my-ini"><a href="#二、核心配置-my-ini" class="headerlink" title="二、核心配置 (my.ini)"></a>二、核心配置 (my.ini)</h2><p>MySQL 启动时需要读取配置文件。在安装根目录下新建一个文本文件，重命名为 <strong>my.ini</strong>（注意后缀名）。</p><p>写入以下内容，<strong>请务必根据实际路径修改 <code>basedir</code> 和 <code>datadir</code></strong>：</p><figure class="highlight ini"><figcaption><span>my.ini</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[mysql]</span></span><br><span class="line"><span class="comment"># 设置 mysql 客户端的默认字符集</span></span><br><span class="line"><span class="attr">default-character-set</span>=utf8mb4</span><br><span class="line"></span><br><span class="line"><span class="section">[mysqld]</span></span><br><span class="line"><span class="comment"># 设置服务端口</span></span><br><span class="line"><span class="attr">port</span>=<span class="number">3306</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># MySQL 的安装目录</span></span><br><span class="line"><span class="attr">basedir</span>=D:\\Program Files\\MySQL\\mysql-<span class="number">9.5</span>.<span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 数据库的数据存放目录 (data 目录会自动生成，无需手动创建)</span></span><br><span class="line"><span class="attr">datadir</span>=D:\\Program Files\\MySQL\\mysql-<span class="number">9.5</span>.<span class="number">0</span>\\data</span><br><span class="line"></span><br><span class="line"><span class="comment"># 允许的最大连接数</span></span><br><span class="line"><span class="attr">max_connections</span>=<span class="number">200</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 服务端字符集与排序规则 (推荐 utf8mb4)</span></span><br><span class="line"><span class="attr">character-set-server</span>=utf8mb4</span><br><span class="line"><span class="attr">collation-server</span>=utf8mb4_general_ci</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建新表时使用的存储引擎</span></span><br><span class="line"><span class="attr">default-storage-engine</span>=InnoDB</span><br></pre></td></tr></table></figure><h2 id="三、初始化与安装"><a href="#三、初始化与安装" class="headerlink" title="三、初始化与安装"></a>三、初始化与安装</h2><p>以下操作建议在 <strong>管理员权限</strong> 的命令提示符（CMD）或 PowerShell 中执行。</p><h3 id="1-初始化数据"><a href="#1-初始化数据" class="headerlink" title="1. 初始化数据"></a>1. 初始化数据</h3><p>进入 <code>bin</code> 目录，执行初始化命令。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /d <span class="string">&quot;D:\Program Files\MySQL\mysql-9.5.0\bin&quot;</span></span><br><span class="line">mysqld.exe --initialize --console</span><br></pre></td></tr></table></figure><blockquote><p><strong>⚠️ 关键步骤</strong>：<br>执行完毕后，控制台会输出一行含有 <code>root@localhost: xxxxxxx</code> 的信息。<br><strong>请务必复制并保存这个初始临时密码！</strong></p></blockquote><h3 id="2-注册-Windows-服务"><a href="#2-注册-Windows-服务" class="headerlink" title="2. 注册 Windows 服务"></a>2. 注册 Windows 服务</h3><p>将 MySQL 注册为系统服务，以便开机自启或后台运行。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># MySQL 是服务名称，可自定义</span></span><br><span class="line">mysqld.exe install MySQL</span><br></pre></td></tr></table></figure><h2 id="四、服务启动与管理"><a href="#四、服务启动与管理" class="headerlink" title="四、服务启动与管理"></a>四、服务启动与管理</h2><h3 id="方式一：命令行管理-推荐"><a href="#方式一：命令行管理-推荐" class="headerlink" title="方式一：命令行管理 (推荐)"></a>方式一：命令行管理 (推荐)</h3><p>需要管理员权限。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 启动服务</span></span><br><span class="line">net start MySQL</span><br><span class="line"></span><br><span class="line"><span class="comment"># 停止服务</span></span><br><span class="line">net stop MySQL</span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置服务开机自启</span></span><br><span class="line">sc config MySQL start=auto</span><br></pre></td></tr></table></figure><h3 id="方式二：任务管理器"><a href="#方式二：任务管理器" class="headerlink" title="方式二：任务管理器"></a>方式二：任务管理器</h3><p>按下快捷键 <code>Ctrl</code> + <code>Shift</code> + <code>Esc</code> 打开任务管理器，切换到 <strong>服务</strong> 选项卡，找到 <code>MySQL</code> 右键操作。</p><h2 id="五、修改初始密码"><a href="#五、修改初始密码" class="headerlink" title="五、修改初始密码"></a>五、修改初始密码</h2><p>使用刚才记录的临时密码登录，并修改为便于记忆的密码（如 <code>123456</code>）。</p><p>在 <code>bin</code> 目录下执行：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. 登录 (回车后输入临时密码)</span></span><br><span class="line">mysql.exe -uroot -p</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 修改密码 SQL 语句 (注意分号)</span></span><br><span class="line">ALTER USER <span class="string">&#x27;root&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> IDENTIFIED BY <span class="string">&#x27;123456&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 刷新权限 (可选，通常 ALTER USER 会自动刷新)</span></span><br><span class="line">FLUSH PRIVILEGES;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. 退出</span></span><br><span class="line"><span class="built_in">exit</span></span><br></pre></td></tr></table></figure><h2 id="六、进阶建议：配置环境变量"><a href="#六、进阶建议：配置环境变量" class="headerlink" title="六、进阶建议：配置环境变量"></a>六、进阶建议：配置环境变量</h2><p>为了避免每次都要进入 <code>bin</code> 目录才能使用 <code>mysql</code> 命令，建议配置环境变量：</p><ol><li>此电脑 -> 右键 -> 属性 -> 高级系统设置 -> 环境变量。</li><li>在 <strong>系统变量</strong> 中找到 <code>Path</code>，点击编辑。</li><li>新建，填入路径：<code>D:\Program Files\MySQL\mysql-9.5.0\bin</code>。</li></ol><p>配置后，你可以在任意终端直接使用 <code>mysql -uroot -p123456</code>。</p><h2 id="七、彻底卸载"><a href="#七、彻底卸载" class="headerlink" title="七、彻底卸载"></a>七、彻底卸载</h2><p>如果需要删除 MySQL，压缩包版的卸载非常干净：</p><ol><li><strong>停止服务</strong>：<code>net stop MySQL</code></li><li><strong>移除服务</strong>：<code>sc delete MySQL</code> (或者 <code>mysqld remove</code>)</li><li><strong>删除文件</strong>：直接删除整个 MySQL 安装目录。</li><li><strong>清理环境</strong>：如果是步骤六配置了 Path 变量，记得删掉。</li></ol><p>至此，系统就恢复如初了。</p>]]></content>
    
    
    <summary type="html">详解如何通过 Zip 压缩包方式安装 MySQL (v9.4.0)，涵盖解压、my.ini 配置文件编写、服务初始化、密码修改及彻底卸载方法，保持系统整洁。</summary>
    
    
    
    <category term="开发环境" scheme="https://lijiabao9.github.io/categories/%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/"/>
    
    <category term="Windows" scheme="https://lijiabao9.github.io/categories/%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/Windows/"/>
    
    
    <category term="数据库" scheme="https://lijiabao9.github.io/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    <category term="MySQL" scheme="https://lijiabao9.github.io/tags/MySQL/"/>
    
  </entry>
  
  <entry>
    <title>打造免费极速图床：PicGo + GitHub + jsDelivr 全流程指南</title>
    <link href="https://lijiabao9.github.io/posts/c17ea3c3.html"/>
    <id>https://lijiabao9.github.io/posts/c17ea3c3.html</id>
    <published>2025-12-02T15:16:17.000Z</published>
    <updated>2025-12-05T15:42:37.265Z</updated>
    
    <content type="html"><![CDATA[<p>在 Markdown 写作或博客搭建中，图片的存储和引用一直是个痛点。将图片直接存放在本地会导致分享困难，而商业图床又面临收费或跑路的风险。</p><p>本文将带你搭建一套 <strong>“GitHub (存储) + jsDelivr (加速) + PicGo (上传工具)”</strong> 的黄金组合，实现免费、稳定且全球访问极速的图床服务。</p><h2 id="第一步：创建-GitHub-仓库"><a href="#第一步：创建-GitHub-仓库" class="headerlink" title="第一步：创建 GitHub 仓库"></a>第一步：创建 GitHub 仓库</h2><p>所谓的“图床”，本质上就是一个 <strong>Public (公开)</strong> 的 GitHub 仓库。</p><ol><li>登录 <a href="https://github.com/">GitHub</a>，点击右上角的 <code>+</code> 号，选择 <strong>New repository</strong>。</li><li><strong>Repository name</strong>：填写仓库名（例如：<code>pic.cloud</code>）。</li><li><strong>Visibility</strong>：<strong>必须选择 Public</strong>（私有仓库无法通过 CDN 访问）。</li><li>点击 <strong>Create repository</strong>。</li></ol><p>此时，你已经拥有了一个云端存储空间。虽然你可以手动上传图片，但为了效率，我们需要工具辅助。</p><h2 id="第二步：获取-Access-Token"><a href="#第二步：获取-Access-Token" class="headerlink" title="第二步：获取 Access Token"></a>第二步：获取 Access Token</h2><p>为了让 PicGo 有权限向你的仓库上传文件，我们需要生成一个访问令牌（Token）。</p><ol><li>点击 GitHub 头像 -&gt; <strong>Settings</strong>。</li><li>在左侧菜单最下方找到 <strong>Developer settings</strong> -&gt; <strong>Personal access tokens</strong> -&gt; <strong>Tokens (classic)</strong>。</li><li>点击右上角的 <strong>Generate new token (classic)</strong>。</li><li><strong>配置 Token</strong>：<ul><li><strong>Note (名称)</strong>：随意填写，如 <code>PicGo</code>。</li><li><strong>Expiration (过期时间)</strong>：建议选择 <strong>No expiration</strong> (永不过期)，以免频繁更换。</li><li><strong>Scopes (权限)</strong>：<strong>必须勾选 <code>repo</code></strong>，这包含了上传文件所需的权限。</li></ul></li><li>点击底部的 <strong>Generate token</strong>。</li></ol><blockquote><p><strong>⚠️ 重要提示</strong>：<br>生成的 Token <strong>只会显示一次</strong>！请务必立即复制并保存到安全的地方。如果遗忘，只能重新生成。</p></blockquote><h2 id="第三步：安装与配置-PicGo"><a href="#第三步：安装与配置-PicGo" class="headerlink" title="第三步：安装与配置 PicGo"></a>第三步：安装与配置 PicGo</h2><p><a href="https://github.com/Molunerfinn/PicGo">PicGo</a> 是一款优秀的开源图片上传工具。</p><h3 id="1-安装"><a href="#1-安装" class="headerlink" title="1. 安装"></a>1. 安装</h3><p>PicGo 的安装非常简单，直接从 <a href="https://github.com/Molunerfinn/PicGo/releases">GitHub Releases</a> 下载最新版安装包，并双击安装。</p><h3 id="2-配置-GitHub-图床"><a href="#2-配置-GitHub-图床" class="headerlink" title="2. 配置 GitHub 图床"></a>2. 配置 GitHub 图床</h3><p>打开 PicGo 主界面，进入 <strong>图床设置</strong> -&gt; <strong>GitHub</strong>。如果侧边栏没有 GitHub，请在“PicGo设置”中勾选“显示GitHub”。</p><p>点击 <strong>编辑</strong>（或新建配置），填入以下信息：</p><div class="table-container"><table><thead><tr><th style="text-align:left">字段</th><th style="text-align:left">说明与示例</th><th style="text-align:left">是否必填</th></tr></thead><tbody><tr><td style="text-align:left"><strong>图床配置名</strong></td><td style="text-align:left">随意填写，用于区分不同配置。<br>例：<code>pic.cloud</code></td><td style="text-align:left">是</td></tr><tr><td style="text-align:left"><strong>设定仓库名</strong></td><td style="text-align:left">格式为 <code>用户名/仓库名</code>。<br>例：<code>lijiabao9/pic.cloud</code></td><td style="text-align:left">是</td></tr><tr><td style="text-align:left"><strong>设定分支名</strong></td><td style="text-align:left">仓库的分支，新仓库默认为 <code>main</code>，旧仓库可能是 <code>master</code>。<br>例：<code>main</code></td><td style="text-align:left">是</td></tr><tr><td style="text-align:left"><strong>设定Token</strong></td><td style="text-align:left">粘贴第二步中生成的 <strong>ghp_</strong> 开头的字符串。</td><td style="text-align:left">是</td></tr><tr><td style="text-align:left"><strong>设定存储路径</strong></td><td style="text-align:left">图片在仓库中的子目录，建议以 <code>/</code> 结尾。<br>例：<code>img/</code> 或 <code>hexo/post/</code></td><td style="text-align:left">否</td></tr><tr><td style="text-align:left"><strong>设定自定义域名</strong></td><td style="text-align:left"><strong>(关键)</strong> 配置 jsDelivr CDN 加速链接。<br>格式：<code>https://cdn.jsdelivr.net/gh/用户名/仓库名@分支名</code><br>例：<code>https://cdn.jsdelivr.net/gh/lijiabao9/pic.cloud@main</code></td><td style="text-align:left">否(强烈推荐)</td></tr></tbody></table></div><blockquote><p><strong>💡 关于自定义域名（CDN 加速）</strong><br>GitHub 的原始图片链接 (<code>raw.githubusercontent.com</code>) 在国内访问极不稳定。<br>强烈建议配置 <code>jsDelivr</code>，格式严格遵循：<br><code>https://cdn.jsdelivr.net/gh/【你的GitHub用户名】/【仓库名】@【分支名】</code></p></blockquote><p>点击 <strong>确定</strong> 并在列表中将其设置为 <strong>默认图床</strong>。</p><h2 id="第四步：极速工作流"><a href="#第四步：极速工作流" class="headerlink" title="第四步：极速工作流"></a>第四步：极速工作流</h2><p>配置完成后，我们就可以体验行云流水的写作体验了。</p><h3 id="1-快捷键上传"><a href="#1-快捷键上传" class="headerlink" title="1. 快捷键上传"></a>1. 快捷键上传</h3><p>推荐配合截图神器 <a href="https://zh.snipaste.com/">Snipaste</a> 使用：</p><ol><li>使用 Snipaste 截图 (<code>F1</code>) 并复制到剪贴板 (<code>Ctrl + C</code>)。</li><li>使用 PicGo 快捷键上传（可在设置中修改为 <code>Ctrl + Shift + G</code> 顺手的键）。</li><li>PicGo 上传成功后，会自动将 CDN 链接（Markdown 格式）写入剪贴板。</li><li>在文章中直接粘贴 (<code>Ctrl + V</code>) 即可。</li></ol><h3 id="2-自动复制设置"><a href="#2-自动复制设置" class="headerlink" title="2. 自动复制设置"></a>2. 自动复制设置</h3><p>确保在 <strong>PicGo 设置</strong> 中开启了以下选项：</p><ul><li>[√] <strong>时间戳重命名</strong>（可选，推荐开启，防止文件名冲突）</li><li>[√] <strong>上传后自动复制 URL</strong></li></ul><h3 id="3-插件集成"><a href="#3-插件集成" class="headerlink" title="3. 插件集成"></a>3. 插件集成</h3><p>在 <strong>插件设置</strong> 中，搜索安装 <code>webp 1.0.0</code> 插件，启用该插件。上传图片时，此插件会自动将图片转为 <em>.webp</em> 格式。</p><p>至此，一个免费、高速、稳定的图床环境就搭建完成了。</p>]]></content>
    
    
    <summary type="html">详细教程：如何使用 PicGo 配合 GitHub 仓库搭建免费图床，并配置 jsDelivr CDN 加速，配合 Snipaste 实现截图一键上传，大幅提升 Markdown 写作效率。</summary>
    
    
    
    <category term="开发环境" scheme="https://lijiabao9.github.io/categories/%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/"/>
    
    <category term="Windows" scheme="https://lijiabao9.github.io/categories/%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/Windows/"/>
    
    
    <category term="GitHub" scheme="https://lijiabao9.github.io/tags/GitHub/"/>
    
    <category term="效率工具" scheme="https://lijiabao9.github.io/tags/%E6%95%88%E7%8E%87%E5%B7%A5%E5%85%B7/"/>
    
    <category term="PicGo" scheme="https://lijiabao9.github.io/tags/PicGo/"/>
    
    <category term="图床" scheme="https://lijiabao9.github.io/tags/%E5%9B%BE%E5%BA%8A/"/>
    
    <category term="Snipaste" scheme="https://lijiabao9.github.io/tags/Snipaste/"/>
    
  </entry>
  
  <entry>
    <title>Sublime Text 4 进阶配置：打造轻量级 Java &amp; C++ 开发环境</title>
    <link href="https://lijiabao9.github.io/posts/9dc77c0b.html"/>
    <id>https://lijiabao9.github.io/posts/9dc77c0b.html</id>
    <published>2025-12-02T15:00:20.000Z</published>
    <updated>2025-12-05T15:42:37.265Z</updated>
    
    <content type="html"><![CDATA[<p><a href="https://www.sublimetext.com/">Sublime Text 4</a> 以其极速响应和优雅的界面著称。<br>虽然它主要是一个文本编辑器，但通过配置构建系统（Build System），我们可以将其变身为一个轻量级的 IDE，支持 Java 和 C++ 的编译、运行以及命令行交互。</p><p>本文将介绍如何修改原生配置，解决默认控制台无法输入数据（Scanner/cin）以及中文乱码的痛点。</p><blockquote><p><strong>环境说明</strong></p><ul><li>版本：Sublime Text 4 (Build 4200)</li><li>系统：Windows 10/11</li></ul></blockquote><h2 id="一、Java-开发环境配置"><a href="#一、Java-开发环境配置" class="headerlink" title="一、Java 开发环境配置"></a>一、Java 开发环境配置</h2><p>Sublime 自带 Java 编译功能，但默认只能输出结果，无法进行交互式输入。我们需要配置它调用系统的 CMD 窗口来运行程序。</p><h3 id="1-JDK-依赖检查"><a href="#1-JDK-依赖检查" class="headerlink" title="1. JDK 依赖检查"></a>1. JDK 依赖检查</h3><p>确保电脑已安装 JDK 并配置好系统环境变量 (<code>JAVA_HOME</code> 和 <code>Path</code>)。<br>在命令提示符（CMD）中输入 <code>java -version</code>，若能显示版本号则说明环境就绪。</p><h3 id="2-编写测试代码"><a href="#2-编写测试代码" class="headerlink" title="2. 编写测试代码"></a>2. 编写测试代码</h3><p>创建一个 <code>Hello.java</code> 文件用于测试：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Hello</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Hello World! 你好，世界！&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-拓展构建指令-Build-System"><a href="#3-拓展构建指令-Build-System" class="headerlink" title="3. 拓展构建指令 (Build System)"></a>3. 拓展构建指令 (Build System)</h3><p>我们需要修改 Sublime 默认的 Java 构建配置。</p><ol><li>进入 Sublime Text 安装目录下的 <strong>Packages</strong> 文件夹。</li><li>找到 <strong>Java.sublime-package</strong> 文件，使用压缩软件（如 Bandizip、7-Zip 或 WinRAR）直接打开它。</li><li>在压缩包内找到并编辑 <strong>JavaC.sublime-build</strong> 文件。</li><li>在 <code>variants</code> 字段中添加一段新的配置（”Run in cmd”）：</li></ol><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;shell_cmd&quot;</span><span class="punctuation">:</span> <span class="string">&quot;javac \&quot;$file\&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;file_regex&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^(...*?):([0-9]*):?([0-9]*)&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;selector&quot;</span><span class="punctuation">:</span> <span class="string">&quot;source.java&quot;</span><span class="punctuation">,</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">&quot;variants&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Run in cmd&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;shell_cmd&quot;</span><span class="punctuation">:</span> <span class="string">&quot;javac -encoding UTF-8 \&quot;$&#123;file&#125;\&quot; &amp;&amp; start cmd /c \&quot;java --class-path \&quot;$&#123;file_path&#125;\&quot; \&quot;$&#123;file_base_name&#125;\&quot; &amp; pause\&quot;&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p><strong>配置详解：</strong></p><ul><li><code>javac -encoding UTF-8</code>: 强制使用 UTF-8 编码编译源文件，有效防止编译时的中文乱码。</li><li><code>start cmd /c</code>: 启动一个新的 CMD 窗口运行 Java 程序，程序结束后通过 <code>pause</code> 暂停窗口，防止闪退。</li></ul><h3 id="4-运行"><a href="#4-运行" class="headerlink" title="4. 运行"></a>4. 运行</h3><p>使用 Sublime 打开 Java 文件，按下快捷键 <code>Ctrl + Shift + B</code>，选择 <strong>JavaC - Run in cmd</strong> 即可看到弹出的 CMD 窗口并正确输出中文。</p><hr><h2 id="二、C-开发环境配置"><a href="#二、C-开发环境配置" class="headerlink" title="二、C++ 开发环境配置"></a>二、C++ 开发环境配置</h2><p>Windows 系统默认不包含 C++ 编译器，我们需要手动安装 MinGW。</p><h3 id="1-安装-MinGW-GCC-G"><a href="#1-安装-MinGW-GCC-G" class="headerlink" title="1. 安装 MinGW (GCC/G++)"></a>1. 安装 MinGW (GCC/G++)</h3><p>推荐使用轻量级的 MinGW 工具链。</p><ul><li><strong>下载地址</strong>：<a href="https://github.com/niXman/mingw-builds-binaries/releases">MinGW-w64 GitHub Releases</a></li></ul><p><strong>配置步骤：</strong></p><ol><li>下载并解压压缩包（选择 <strong>x86_64-15.2.0-release-win32-seh-ucrt-rt_v13-rev0.7z</strong>）。</li><li>将解压后文件夹内的 <code>/bin</code> 目录路径复制。</li><li>将该路径添加到系统的 <strong>环境变量 -> Path</strong> 中。</li><li>验证：在 CMD 执行 <code>g++ -v</code>，有输出即表示配置成功。</li></ol><h3 id="2-编写测试代码-1"><a href="#2-编写测试代码-1" class="headerlink" title="2. 编写测试代码"></a>2. 编写测试代码</h3><p>创建一个 <code>Hello.cpp</code> 文件：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> <span class="type">const</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Hello World! 你好，世界！&quot;</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-拓展构建指令-Build-System-1"><a href="#3-拓展构建指令-Build-System-1" class="headerlink" title="3. 拓展构建指令 (Build System)"></a>3. 拓展构建指令 (Build System)</h3><p>同样的方法，修改 C++ 的默认构建配置。</p><ol><li>在 <strong>Packages</strong> 目录下，用压缩软件打开 <strong>C++.sublime-package</strong>。</li><li>找到并编辑 <strong>C++ Single File.sublime-build</strong> 文件。</li><li>修改代码如下（注意 <code>Run in cmd</code> 部分）：</li></ol><!-- end list --><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;shell_cmd&quot;</span><span class="punctuation">:</span> <span class="string">&quot;g++ \&quot;$&#123;file&#125;\&quot; -o \&quot;$&#123;file_path&#125;/$&#123;file_base_name&#125;\&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;file_regex&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^(..[^:]*):([0-9]+):?([0-9]+)?:? (.*)$&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;working_dir&quot;</span><span class="punctuation">:</span> <span class="string">&quot;$&#123;file_path&#125;&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;selector&quot;</span><span class="punctuation">:</span> <span class="string">&quot;source.c++&quot;</span><span class="punctuation">,</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">&quot;variants&quot;</span><span class="punctuation">:</span></span><br><span class="line">  <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Run&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;shell_cmd&quot;</span><span class="punctuation">:</span> <span class="string">&quot;g++ \&quot;$&#123;file&#125;\&quot; -o \&quot;$&#123;file_path&#125;/$&#123;file_base_name&#125;\&quot; &amp;&amp; \&quot;$&#123;file_path&#125;/$&#123;file_base_name&#125;\&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;interactive&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Run in cmd&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;shell_cmd&quot;</span><span class="punctuation">:</span> <span class="string">&quot;g++ -fexec-charset=GBK \&quot;$&#123;file&#125;\&quot; -o \&quot;$&#123;file_path&#125;/$&#123;file_base_name&#125;\&quot; &amp;&amp; start cmd /c \&quot;\&quot;$&#123;file_path&#125;/$&#123;file_base_name&#125;\&quot; &amp; pause\&quot;&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p><strong>关键配置解析：</strong></p><ul><li><code>-fexec-charset=GBK</code>: 这是一个非常重要的参数！Windows 的 CMD 窗口默认编码是 GBK，而 Sublime Text 默认是 UTF-8。如果不加这个参数，编译出的程序在 CMD 中运行时，中文会显示为乱码。该参数告诉编译器：请生成一个运行时输出 GBK 字符的 exe 文件。</li></ul><h3 id="4-运行-1"><a href="#4-运行-1" class="headerlink" title="4. 运行"></a>4. 运行</h3><p>使用 <code>Ctrl + Shift + B</code> 选择 <strong>C++ Single File - Run in cmd</strong>，即可体验完美的 C++ 编译运行环境。</p>]]></content>
    
    
    <summary type="html">详解如何在 Sublime Text 4 中配置 Java 和 C++ 的自定义构建系统（Build System），实现弹出 CMD 窗口运行程序，完美解决控制台交互输入和中文乱码问题。</summary>
    
    
    
    <category term="开发环境" scheme="https://lijiabao9.github.io/categories/%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/"/>
    
    <category term="Windows" scheme="https://lijiabao9.github.io/categories/%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/Windows/"/>
    
    
    <category term="Sublime Text" scheme="https://lijiabao9.github.io/tags/Sublime-Text/"/>
    
  </entry>
  
  <entry>
    <title>本地大模型终极指南：Ollama + Open WebUI 搭建私有 ChatGPT</title>
    <link href="https://lijiabao9.github.io/posts/798e3348.html"/>
    <id>https://lijiabao9.github.io/posts/798e3348.html</id>
    <published>2025-12-02T14:28:58.000Z</published>
    <updated>2025-12-05T15:42:37.265Z</updated>
    
    <content type="html"><![CDATA[<p>想要拥有一个完全隐私、离线可用且免费的 AI 助手？</p><p>本文将带你通过 <strong>Ollama</strong>（后端模型服务）和 <strong>Open WebUI</strong>（前端交互界面）的组合，在本地电脑上搭建一套私有的 “ChatGPT”。</p><h2 id="第一部分：Ollama-环境搭建"><a href="#第一部分：Ollama-环境搭建" class="headerlink" title="第一部分：Ollama 环境搭建"></a>第一部分：Ollama 环境搭建</h2><p>Ollama 是目前最流行的本地大模型运行工具，支持 Llama 3、Gemma、Mistral 等多种模型。</p><h3 id="1-下载安装包"><a href="#1-下载安装包" class="headerlink" title="1. 下载安装包"></a>1. 下载安装包</h3><p>前往官网下载 Windows 版本的安装程序：</p><blockquote><p><strong>下载地址：</strong> <a href="https://ollama.com/download">https://ollama.com/download</a></p></blockquote><h3 id="2-进阶技巧：强制安装在-D-盘"><a href="#2-进阶技巧：强制安装在-D-盘" class="headerlink" title="2. 进阶技巧：强制安装在 D 盘"></a>2. 进阶技巧：强制安装在 D 盘</h3><p>Ollama 默认会自动安装到 C 盘（用户目录）。为了节省系统盘空间，我们可以通过命令行参数强制修改安装位置。</p><ol><li>在 D 盘创建目标文件夹，例如：<code>D:\Ollama</code>。</li><li>将下载好的 <strong>OllamaSetup.exe</strong> 移动到该目录下。</li><li>在该目录下打开<strong>命令提示符 (CMD)</strong> 或 PowerShell，执行以下命令：</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">OllamaSetup.exe /DIR=D:\Ollama</span><br></pre></td></tr></table></figure><p>安装完成后，Setup 引导程序即可删除。</p><h3 id="3-配置环境变量"><a href="#3-配置环境变量" class="headerlink" title="3. 配置环境变量"></a>3. 配置环境变量</h3><p>为了在任意目录下都能使用 <code>ollama</code> 命令，我们需要检查或手动添加环境变量。</p><ul><li><strong>操作：</strong> 将 Ollama 的安装目录（如 <code>D:\Ollama</code>）添加到系统变量 <code>PATH</code> 中。</li></ul><h3 id="4-关键配置：修改模型存储路径"><a href="#4-关键配置：修改模型存储路径" class="headerlink" title="4. 关键配置：修改模型存储路径"></a>4. 关键配置：修改模型存储路径</h3><p>大模型文件通常非常占用空间（几个 GB 到几十 GB 不等）。默认情况下，模型存储在 <code>~/.Ollama/models</code> (C 盘)。</p><p>打开 Ollama 的图形化界面，点击 <code>Settings</code> -&gt; <code>Model location</code>，修改模型存储路径为 D 盘的 <code>D:\Ollama\models</code>。</p><h3 id="5-拉取并测试模型"><a href="#5-拉取并测试模型" class="headerlink" title="5. 拉取并测试模型"></a>5. 拉取并测试模型</h3><p>一切准备就绪，让我们运行第一个模型。你可以访问 <a href="https://github.com/ollama/ollama?tab=readme-ov-file#model-library">Ollama 模型库</a> 查看支持的模型列表。</p><p>以 Google 最新的 <code>gemma3</code> 为例，在终端执行：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ollama run gemma3</span><br></pre></td></tr></table></figure><p>首次执行时，Ollama 会自动拉取模型文件。下载完成后，你就可以在终端直接与 AI 对话了。</p><hr><h2 id="第二部分：Open-WebUI-可视化界面搭建"><a href="#第二部分：Open-WebUI-可视化界面搭建" class="headerlink" title="第二部分：Open WebUI 可视化界面搭建"></a>第二部分：Open WebUI 可视化界面搭建</h2><p>虽然终端可以使用 AI，但一个类似 ChatGPT 的网页界面能提供更好的体验（历史记录、Markdown 渲染、多模态支持）。<br>我们将使用 <a href="https://github.com/open-webui/open-webui">Open WebUI</a>。</p><h3 id="1-环境依赖"><a href="#1-环境依赖" class="headerlink" title="1. 环境依赖"></a>1. 环境依赖</h3><ul><li><strong>Docker Desktop</strong>：Open WebUI 基于 Docker 运行，请确保已安装 Docker。<a href="/posts/c3ae7e15.html">Docker Desktop 最佳实践：自定义安装路径与镜像加速配置</a></li><li><strong>Ollama</strong>：确保上述 Ollama 服务已在运行。默认会监听 <code>127.0.0.1:11434</code>，请确保该端口未被其他程序占用。</li></ul><h3 id="2-部署-Open-WebUI"><a href="#2-部署-Open-WebUI" class="headerlink" title="2. 部署 Open WebUI"></a>2. 部署 Open WebUI</h3><p>使用 Docker 一键部署。在终端执行以下命令：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -p 3000:8080 --add-host=host.docker.internal:host-gateway -v open-webui:/app/backend/data --name open-webui --restart always ghcr.io/open-webui/open-webui:main</span><br></pre></td></tr></table></figure><p><strong>命令详解：</strong></p><ul><li><code>-p 3000:8080</code>: 将容器的 8080 端口映射到本地的 3000 端口。</li><li><code>--add-host=host.docker.internal:host-gateway</code>: <strong>关键参数</strong>，允许 Docker 容器内部访问宿主机（也就是你的 Windows 电脑）上的 Ollama 服务。</li><li><code>-v open-webui:/app/backend/data</code>: 数据持久化，确保你的聊天记录不会因重启容器而丢失。</li><li><code>--restart always</code>: 设置开机自启。</li></ul><h3 id="3-开始使用"><a href="#3-开始使用" class="headerlink" title="3. 开始使用"></a>3. 开始使用</h3><ol><li><strong>访问界面</strong>：打开浏览器，访问 <code>http://localhost:3000</code>。</li><li><strong>创建管理员账号</strong>：首次进入系统，界面会提示注册账号。<ul><li><em>注：这是完全运行在你本地数据库的账号，数据不会上传到云端。</em></li></ul></li></ol><p>注册并登录后，你会看到一个熟悉的聊天界面。Open WebUI 会自动检测本地运行的 Ollama 模型。选择刚才下载的 <code>gemma3</code>，即可开始畅聊！</p><hr><p>至此，你已经拥有了一套完全属于自己的、无需联网（模型下载后）、无隐私泄露风险的 AI 生产力工具。</p>]]></content>
    
    
    <summary type="html">从零开始搭建本地大模型环境。本文详细介绍了如何在 Windows 上将 Ollama 强制安装至非系统盘、配置模型存储路径，并通过 Docker 部署 Open WebUI，打造一个功能媲美 ChatGPT 的私有化 AI 助手。</summary>
    
    
    
    <category term="开发环境" scheme="https://lijiabao9.github.io/categories/%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/"/>
    
    <category term="Windows" scheme="https://lijiabao9.github.io/categories/%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/Windows/"/>
    
    
    <category term="Docker" scheme="https://lijiabao9.github.io/tags/Docker/"/>
    
    <category term="Ollama" scheme="https://lijiabao9.github.io/tags/Ollama/"/>
    
    <category term="Open WebUI" scheme="https://lijiabao9.github.io/tags/Open-WebUI/"/>
    
  </entry>
  
  <entry>
    <title>Windows 终端改造计划：PowerShell 7 + Oh My Posh 极速美化</title>
    <link href="https://lijiabao9.github.io/posts/7e710df8.html"/>
    <id>https://lijiabao9.github.io/posts/7e710df8.html</id>
    <published>2025-12-01T15:04:22.000Z</published>
    <updated>2025-12-05T15:42:37.265Z</updated>
    
    <content type="html"><![CDATA[<p>长期以来，Windows 默认的 PowerShell 5.1 无论是性能还是颜值都略显过时。<br>通过 <strong>PowerShell 7</strong> (跨平台核心版) 搭配 <strong>Windows Terminal</strong> 和 <strong>Oh My Posh</strong>，我们可以获得媲美 macOS/Linux 的终端体验。</p><h2 id="第一步：配置容器-Windows-Terminal"><a href="#第一步：配置容器-Windows-Terminal" class="headerlink" title="第一步：配置容器 (Windows Terminal)"></a>第一步：配置容器 (Windows Terminal)</h2><p>Windows 11 已默认预装 Windows Terminal。这是一个现代化的终端宿主应用。</p><ul><li><strong>快速启动</strong>：<code>Win</code> + <code>R</code> 输入 <code>wt</code>。</li><li><strong>基础设置</strong>：建议在 <strong>设置</strong> 中开启以下功能：<ul><li><strong>交互</strong>：<code>自动将所选内容复制到剪贴板</code></li><li><strong>外观</strong>：<code>在选项卡行中使用亚克力材料</code></li></ul></li></ul><h2 id="第二步：升级核心-PowerShell-7"><a href="#第二步：升级核心-PowerShell-7" class="headerlink" title="第二步：升级核心 (PowerShell 7)"></a>第二步：升级核心 (PowerShell 7)</h2><p>PowerShell 7 是基于 .NET Core 构建的跨平台版本，比系统自带的 5.1 启动更快，功能更强。</p><blockquote><p>官方文档：<a href="https://learn.microsoft.com/zh-cn/powershell/scripting/install/installing-powershell-on-windows">在 Windows 上安装 PowerShell</a></p></blockquote><h3 id="1-使用-winget-安装"><a href="#1-使用-winget-安装" class="headerlink" title="1. 使用 winget 安装"></a>1. 使用 winget 安装</h3><p>推荐使用微软官方包管理器 <strong>winget</strong> 进行安装。</p><div class="note warning flat"><p><strong>常见报错处理：</strong><br>如果提示找不到 <code>winget</code> 命令，请在旧版 PowerShell 中执行以下命令重置应用安装程序：<br><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Get-AppxPackage</span> Microsoft.DesktopAppInstaller | <span class="built_in">Reset-AppxPackage</span></span><br></pre></td></tr></table></figure></p></div><p>执行安装命令：</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 搜索版本</span></span><br><span class="line">winget search Microsoft.PowerShell</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装稳定版</span></span><br><span class="line">winget install <span class="literal">--id</span> Microsoft.PowerShell</span><br></pre></td></tr></table></figure><h3 id="2-验证与集成"><a href="#2-验证与集成" class="headerlink" title="2. 验证与集成"></a>2. 验证与集成</h3><p>安装完成后，程序位于 <code>C:/Program Files/PowerShell/7/</code>。</p><p>打开 Windows Terminal -> 设置 -> <strong>打开 JSON 文件</strong>。<br>在 <code>profiles</code> -> <code>list</code> 数组中，添加以下配置块：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;guid&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&#123;36c5dc75-0ca3-42b8-881d-247330cd4477&#125;&quot;</span><span class="punctuation">,</span> </span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;PowerShell 7.5&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;commandline&quot;</span><span class="punctuation">:</span> <span class="string">&quot;C:\\Program Files\\PowerShell\\7\\pwsh.exe&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;icon&quot;</span><span class="punctuation">:</span> <span class="string">&quot;C:\\Program Files\\PowerShell\\7\\assets\\Powershell_black.ico&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;startingDirectory&quot;</span><span class="punctuation">:</span> <span class="string">&quot;%USERPROFILE%&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h2 id="第三步：注入灵魂-Oh-My-Posh"><a href="#第三步：注入灵魂-Oh-My-Posh" class="headerlink" title="第三步：注入灵魂 (Oh My Posh)"></a>第三步：注入灵魂 (Oh My Posh)</h2><p><a href="https://ohmyposh.dev/">Oh My Posh</a> 是一个全平台的终端提示符自定义引擎，它能让你的路径显示包含 Git 状态、执行时间、内存占用等信息。</p><h3 id="1-安装程序"><a href="#1-安装程序" class="headerlink" title="1. 安装程序"></a>1. 安装程序</h3><p>继续使用 winget 安装（建议开启全局梯子，下载速度会快很多）：</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">winget install <span class="literal">--id</span> JanDeDobbeleer.OhMyPosh</span><br></pre></td></tr></table></figure><h3 id="2-字体配置-关键步骤"><a href="#2-字体配置-关键步骤" class="headerlink" title="2. 字体配置 (关键步骤)"></a>2. 字体配置 (关键步骤)</h3><p>Oh My Posh 的漂亮图标依赖于 <a href="https://www.nerdfonts.com/font-downloads">Nerd Fonts</a> 字体。如果没有正确安装字体，终端会出现大量乱码方框。</p><ul><li>推荐：<a href="https://github.com/ryanoasis/nerd-fonts/releases/download/v3.4.0/Meslo.zip">Meslo LGM Nerd Font</a></li><li>下载解压后，全选 <code>.ttf</code> 文件，右键 -> 安装。</li><li>打开 Windows Terminal 设置 -> 默认值 -> 外观 -> 字体，选择 <strong>“MesloLGM Nerd Font”</strong>。</li></ul><details class="folding-tag" red><summary> 字体安装避坑指南（文件占用问题） </summary>              <div class='content'>              <p>若使用官方提供的 <code>oh-my-posh font install</code> 命令，有时会将字体安装到用户目录 (<code>~\AppData\Local\Microsoft\Windows\Fonts</code>)，导致被系统核心进程 <code>vcshost.exe</code> 锁定，无法删除或覆盖。</p><p><strong>解决方案：</strong></p><ul><li><code>Win</code> + <code>R</code> 输入 <code>regedit</code>。</li><li>定位到：<code>HKEY_CURRENT_USER\Software\Microsoft\Windows NT\CurrentVersion\Fonts</code>。</li><li>删除对应的字体注册表项。</li><li>重启电脑后即可手动删除文件。</li></ul>              </div>            </details><h3 id="3-应用主题"><a href="#3-应用主题" class="headerlink" title="3. 应用主题"></a>3. 应用主题</h3><blockquote><p>主题在线预览：<a href="https://ohmyposh.dev/docs/themes/">https://ohmyposh.dev/docs/themes/</a></p></blockquote><p>我们需要修改 PowerShell 的配置文件 (<code>$PROFILE</code>) 来启用 Oh My Posh。</p><p>在 PowerShell 7 中输入 <code>notepad $PROFILE</code> 打开（如果提示不存在，选择创建文件）。</p><p>写入以下内容：</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># === 1. 环境变量与代理 (根据需要开启) ===</span></span><br><span class="line"><span class="comment"># $env:HTTP_PROXY = &quot;http://127.0.0.1:10808&quot;</span></span><br><span class="line"><span class="comment"># $env:HTTPS_PROXY = &quot;http://127.0.0.1:10808&quot;</span></span><br><span class="line"><span class="comment"># $env:ALL_PROXY = &quot;socks5://127.0.0.1:10808&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># === 2. 启动 Oh My Posh ===</span></span><br><span class="line"><span class="comment"># 在线主题预览：https://ohmyposh.dev/docs/themes/</span></span><br><span class="line"><span class="built_in">oh</span><span class="literal">-my-posh</span> init pwsh <span class="literal">--config</span> <span class="string">&#x27;https://github.com/JanDeDobbeleer/oh-my-posh/blob/main/themes/1_shell.omp.json&#x27;</span> | <span class="built_in">Invoke-Expression</span></span><br></pre></td></tr></table></figure><p>保存后，在终端执行 <code>.$PROFILE</code> 刷新配置，即可看到效果。</p><h2 id="第四步：功能增强-插件推荐"><a href="#第四步：功能增强-插件推荐" class="headerlink" title="第四步：功能增强 (插件推荐)"></a>第四步：功能增强 (插件推荐)</h2><p>光好看还不够，我们还需要它好用。推荐安装以下两个模块：</p><h3 id="1-Terminal-Icons-图标增强"><a href="#1-Terminal-Icons-图标增强" class="headerlink" title="1. Terminal-Icons (图标增强)"></a>1. Terminal-Icons (图标增强)</h3><p>让 <code>ls</code> 或 <code>dir</code> 命令显示文件的图标（如 Docker 显示鲸鱼，JS 显示 JS 图标）。</p><ul><li><p><strong>安装模块：</strong></p>  <figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Install-Module</span> <span class="literal">-Name</span> Terminal<span class="literal">-Icons</span> <span class="literal">-Repository</span> PSGallery <span class="literal">-Force</span></span><br></pre></td></tr></table></figure></li><li><p><strong>配置：</strong></p>  <figure class="highlight powershell"><figcaption><span>.$PROFILE</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Import-Module</span> <span class="literal">-Name</span> Terminal<span class="literal">-Icons</span></span><br></pre></td></tr></table></figure></li></ul><h3 id="2-ZLocation-历史路径导航"><a href="#2-ZLocation-历史路径导航" class="headerlink" title="2. ZLocation (历史路径导航)"></a>2. ZLocation (历史路径导航)</h3><p>允许你快速导航到历史路径。</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Install-Module</span> <span class="literal">-Name</span> ZLocation <span class="literal">-Force</span></span><br></pre></td></tr></table></figure><p><strong>使用方法：</strong>（无需配置）</p><ul><li><strong>跳转</strong>：<code>z doc</code>（跳转到包含 doc 的常用目录）</li><li><strong>后退</strong>：<code>z -</code> (跳回上一个目录)</li></ul><h3 id="3-PSReadLine-自动补全"><a href="#3-PSReadLine-自动补全" class="headerlink" title="3. PSReadLine (自动补全)"></a>3. PSReadLine (自动补全)</h3><p>提供类似 Zsh 的历史命令预测和自动补全功能。</p><ul><li><p><strong>安装模块：</strong></p>  <figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Install-Module</span> <span class="literal">-Name</span> PSReadLine <span class="literal">-AllowPrerelease</span> <span class="literal">-Scope</span> CurrentUser <span class="literal">-Force</span> <span class="literal">-SkipPublisherCheck</span></span><br></pre></td></tr></table></figure></li><li><p><strong>配置：</strong></p>  <figure class="highlight powershell"><figcaption><span>.$PROFILE</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Set-PSReadLineOption</span> <span class="literal">-PredictionSource</span> <span class="built_in">History</span>   <span class="comment"># 设置预测源为历史记录</span></span><br><span class="line"><span class="built_in">Set-PSReadLineOption</span> <span class="literal">-PredictionViewStyle</span> InlineView <span class="comment"># 设置预测显示风格 ( InlineView / ListView )</span></span><br><span class="line"><span class="built_in">Set-PSReadLineOption</span> <span class="literal">-EditMode</span> Windows           <span class="comment"># 设置键位模式</span></span><br></pre></td></tr></table></figure></li></ul><h3 id="4-PSFzf-模糊搜索"><a href="#4-PSFzf-模糊搜索" class="headerlink" title="4. PSFzf (模糊搜索)"></a>4. PSFzf (模糊搜索)</h3><p>这是命令行界的“Spotlight”或“Everything”。<br>允许你使用模糊搜索快速找到文件或历史命令。配合 PSReadLine 使用简直是绝杀。</p><ul><li><p><strong>安装模块：</strong></p>  <figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 先安装 fzf 底层工具</span></span><br><span class="line">winget install junegunn.fzf</span><br><span class="line"></span><br><span class="line"><span class="built_in">Install-Module</span> <span class="literal">-Name</span> PSFzf <span class="literal">-Force</span></span><br></pre></td></tr></table></figure></li><li><p><strong>配置：</strong></p>  <figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Set-PsFzfOption</span> <span class="literal">-PSReadlineChordProvider</span> <span class="string">&#x27;Ctrl+t&#x27;</span> <span class="literal">-PSReadlineChordReverseHistory</span> <span class="string">&#x27;Ctrl+r&#x27;</span></span><br></pre></td></tr></table></figure></li><li><p><strong>使用方法：</strong>按下 <code>Ctrl</code> + <code>T</code> 键，当前目录下快速搜索文件。按下 <code>Ctrl</code> + <code>R</code> 键，快速搜索历史命令。</p></li></ul><h2 id="最终配置文件"><a href="#最终配置文件" class="headerlink" title="最终配置文件"></a>最终配置文件</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># === 1. 环境变量与代理 (根据需要开启) ===</span></span><br><span class="line"><span class="comment"># $env:HTTP_PROXY = &quot;http://127.0.0.1:10808&quot;</span></span><br><span class="line"><span class="comment"># $env:HTTPS_PROXY = &quot;http://127.0.0.1:10808&quot;</span></span><br><span class="line"><span class="comment"># $env:ALL_PROXY = &quot;socks5://127.0.0.1:10808&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># === 2. 启动 Oh My Posh ===</span></span><br><span class="line"><span class="comment"># 在线主题预览：https://ohmyposh.dev/docs/themes/</span></span><br><span class="line"><span class="built_in">oh</span><span class="literal">-my-posh</span> init pwsh <span class="literal">--config</span> <span class="string">&#x27;https://github.com/JanDeDobbeleer/oh-my-posh/blob/main/themes/1_shell.omp.json&#x27;</span> | <span class="built_in">Invoke-Expression</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># === 3.1 引入图标模块 ===</span></span><br><span class="line"><span class="built_in">Import-Module</span> <span class="literal">-Name</span> Terminal<span class="literal">-Icons</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># === 3.3 配置 PSReadLine ===</span></span><br><span class="line"><span class="built_in">Set-PSReadLineOption</span> <span class="literal">-PredictionSource</span> <span class="built_in">History</span>   <span class="comment"># 设置预测源为历史记录</span></span><br><span class="line"><span class="built_in">Set-PSReadLineOption</span> <span class="literal">-PredictionViewStyle</span> InlineView <span class="comment"># 设置预测显示风格 ( InlineView / ListView )</span></span><br><span class="line"><span class="built_in">Set-PSReadLineOption</span> <span class="literal">-EditMode</span> Windows           <span class="comment"># 设置键位模式</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># === 3.4 配置 PSFzf ===</span></span><br><span class="line"><span class="built_in">Set-PsFzfOption</span> <span class="literal">-PSReadlineChordProvider</span> <span class="string">&#x27;Ctrl+t&#x27;</span> <span class="literal">-PSReadlineChordReverseHistory</span> <span class="string">&#x27;Ctrl+r&#x27;</span></span><br></pre></td></tr></table></figure><p>现在，你的 Windows 终端不仅拥有了黑客级的颜值，更拥有了极高的生产力。</p>]]></content>
    
    
    <summary type="html">告别枯燥的蓝底白字。本文详细介绍如何安装 PowerShell 7，配合 Windows Terminal 和 Oh My Posh 打造高颜值、高效率的终端环境，包含字体避坑指南与自动补全配置。</summary>
    
    
    
    <category term="开发环境" scheme="https://lijiabao9.github.io/categories/%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/"/>
    
    <category term="Windows" scheme="https://lijiabao9.github.io/categories/%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/Windows/"/>
    
    
    <category term="效率工具" scheme="https://lijiabao9.github.io/tags/%E6%95%88%E7%8E%87%E5%B7%A5%E5%85%B7/"/>
    
    <category term="PowerShell" scheme="https://lijiabao9.github.io/tags/PowerShell/"/>
    
    <category term="Oh My Posh" scheme="https://lijiabao9.github.io/tags/Oh-My-Posh/"/>
    
    <category term="Windows Terminal" scheme="https://lijiabao9.github.io/tags/Windows-Terminal/"/>
    
  </entry>
  
  <entry>
    <title>Windows 终端终极进化：Git + Zsh + Oh My Zsh 全攻略</title>
    <link href="https://lijiabao9.github.io/posts/59e74bb9.html"/>
    <id>https://lijiabao9.github.io/posts/59e74bb9.html</id>
    <published>2025-12-01T13:43:14.000Z</published>
    <updated>2025-12-05T15:42:37.265Z</updated>
    
    <content type="html"><![CDATA[<p>Windows 原生的 CMD 和 PowerShell 在体验上与 Unix/Linux 存在差距。<br>本文将利用 <strong>Git Bash</strong> 作为基础，植入 <strong>Zsh</strong> shell，并结合 <strong>Windows Terminal</strong> 和 <strong>Oh My Zsh</strong>，打造一套既美观又高效的终端环境。</p><h2 id="第一步：安装-Git-基础环境"><a href="#第一步：安装-Git-基础环境" class="headerlink" title="第一步：安装 Git (基础环境)"></a>第一步：安装 Git (基础环境)</h2><p>Git Bash 是 Windows 上最轻量的类 Unix 环境，我们将以它为宿主运行 Zsh。</p><h3 id="1-下载与安装"><a href="#1-下载与安装" class="headerlink" title="1. 下载与安装"></a>1. 下载与安装</h3><ul><li><strong>官方下载</strong>：<a href="https://git-scm.com/downloads">git-scm.com/downloads</a></li></ul><p>下载后运行安装程序，<strong>建议一路保持默认 (Next)</strong> 即可完成安装。</p><p>验证安装：打开 CMD 或 PowerShell，输入以下命令：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git -v</span><br><span class="line"><span class="comment"># 输出例如：git version 2.52.0.windows.1</span></span><br></pre></td></tr></table></figure><h3 id="2-基础配置"><a href="#2-基础配置" class="headerlink" title="2. 基础配置"></a>2. 基础配置</h3><p>安装完成后，配置你的身份信息（用于提交代码）：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">git config --global user.name <span class="string">&quot;你的用户名&quot;</span></span><br><span class="line">git config --global user.email <span class="string">&quot;你的邮箱地址&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 推荐：防止 Windows/Linux 换行符混乱</span></span><br><span class="line">git config --global core.autocrlf <span class="literal">true</span></span><br></pre></td></tr></table></figure><h2 id="第二步：植入-Zsh-Shell"><a href="#第二步：植入-Zsh-Shell" class="headerlink" title="第二步：植入 Zsh Shell"></a>第二步：植入 Zsh Shell</h2><p>Git Bash 默认使用 Bash，我们需要手动下载并“植入” Zsh。</p><h3 id="1-下载-Zsh-包"><a href="#1-下载-Zsh-包" class="headerlink" title="1. 下载 Zsh 包"></a>1. 下载 Zsh 包</h3><p>我们需要从 MSYS2 仓库下载 Zsh 的二进制包。</p><ul><li><strong>下载地址</strong>：<a href="https://packages.msys2.org/packages/zsh?repo=msys&amp;variant=x86_64">MSYS2 Packages - Zsh</a></li></ul><p>在 <strong>File</strong> 处，点击链接下载，得到 <code>zsh-5.x-x-x86_64.pkg.zst</code> 的文件。</p><h3 id="2-解压并安装"><a href="#2-解压并安装" class="headerlink" title="2. 解压并安装"></a>2. 解压并安装</h3><div class="note warning flat"><p><strong>注意：</strong> 此步骤需要管理员权限，且解压过程需要细心。</p></div><ol><li><strong>解压文件</strong>：下载的文件通常需要解压两次（先解压 <code>.zst</code> ，再解压内部的 <code>.pkg</code>），直到看到 <code>usr</code>、<code>etc</code> 等文件夹。</li><li><strong>合并文件</strong>：将解压出来的所有文件（主要是 <code>usr</code> 目录下的内容），<strong>覆盖复制</strong>到 Git 的安装目录中。<ul><li>Git 默认安装路径：<code>C:\Program Files\Git</code></li><li>操作逻辑：将解压包 <code>usr/</code> 下的所有文件 -> 复制到 -> <code>C:\Program Files\Git\usr\</code> 下合并。</li></ul></li></ol><h3 id="3-激活-Zsh"><a href="#3-激活-Zsh" class="headerlink" title="3. 激活 Zsh"></a>3. 激活 Zsh</h3><p>打开 Git Bash，输入 <code>zsh</code>。如果出现配置向导，说明安装成功。<br>按 <strong>0</strong> 退出向导（我们会用 Oh My Zsh 来生成配置文件）。</p><h3 id="4-设置默认启动"><a href="#4-设置默认启动" class="headerlink" title="4. 设置默认启动"></a>4. 设置默认启动</h3><p>为了让 Git Bash 打开时自动进入 Zsh，需编辑 Bash 配置文件。</p><p>在终端执行：<code>notepad ~/.bashrc</code>，填入以下内容：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> [ -t 1 ]; <span class="keyword">then</span></span><br><span class="line">  <span class="built_in">exec</span> zsh</span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure><h2 id="第三步：安装-Oh-My-Zsh"><a href="#第三步：安装-Oh-My-Zsh" class="headerlink" title="第三步：安装 Oh My Zsh"></a>第三步：安装 Oh My Zsh</h2><p>Oh My Zsh 是 Zsh 的配置框架，提供了丰富的主题和插件。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sh -c <span class="string">&quot;<span class="subst">$(curl -fsSL https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh)</span>&quot;</span></span><br></pre></td></tr></table></figure><p>看到大大的 “Oh My Zsh” 字符画，即表示安装成功。</p><h2 id="第四步：集成到-Windows-Terminal-推荐"><a href="#第四步：集成到-Windows-Terminal-推荐" class="headerlink" title="第四步：集成到 Windows Terminal (推荐)"></a>第四步：集成到 Windows Terminal (推荐)</h2><p>不要直接使用 Git Bash 的窗口，<strong>Windows Terminal</strong> 才是现代化的选择。</p><h3 id="1-安装字体-关键"><a href="#1-安装字体-关键" class="headerlink" title="1. 安装字体 (关键)"></a>1. 安装字体 (关键)</h3><p>Zsh 的许多主题依赖特殊图标。请下载并安装 <a href="https://www.nerdfonts.com/font-downloads">Nerd Fonts</a>。</p><ul><li>推荐：<a href="https://github.com/ryanoasis/nerd-fonts/releases/download/v3.4.0/JetBrainsMono.zip">JetBrainsMono Nerd Font</a></li><li>下载解压后，全选 <code>.ttf</code> 文件，右键 -> 安装。</li></ul><h3 id="2-添加配置文件"><a href="#2-添加配置文件" class="headerlink" title="2. 添加配置文件"></a>2. 添加配置文件</h3><p>打开 Windows Terminal -> 设置 -> <strong>打开 JSON 文件</strong>。<br>在 <code>profiles</code> -> <code>list</code> 数组中，添加以下配置块：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;guid&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&#123;2ece5bfe-50ed-5f3a-ab87-5cd4baafed2b&#125;&quot;</span><span class="punctuation">,</span> </span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Git Bash&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;commandline&quot;</span><span class="punctuation">:</span> <span class="string">&quot;C:\\Program Files\\Git\\bin\\bash.exe -i -l&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;icon&quot;</span><span class="punctuation">:</span> <span class="string">&quot;C:\\Program Files\\Git\\mingw64\\share\\git\\git-for-windows.ico&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;startingDirectory&quot;</span><span class="punctuation">:</span> <span class="string">&quot;%USERPROFILE%&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;font&quot;</span><span class="punctuation">:</span> </span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;face&quot;</span><span class="punctuation">:</span> <span class="string">&quot;JetBrainsMono NF&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;opacity&quot;</span><span class="punctuation">:</span> <span class="number">90</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;useAcrylic&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p><em>注意：请根据你的实际安装路径调整 <code>commandline</code> 和 <code>icon</code>。</em></p><h2 id="第五步：插件与美化"><a href="#第五步：插件与美化" class="headerlink" title="第五步：插件与美化"></a>第五步：插件与美化</h2><p>编辑 Zsh 配置文件：<code>notepad ~/.zshrc</code>。</p><h3 id="1-修改主题"><a href="#1-修改主题" class="headerlink" title="1. 修改主题"></a>1. 修改主题</h3><p>找到 <code>ZSH_THEME</code> 字段。</p><ul><li>默认：<code>robbyrussell</code></li><li>推荐：<code>cloud</code> (炫酷，需要 Nerd Fonts)</li><li>在线主题预览：<a href="https://github.com/ohmyzsh/ohmyzsh/wiki/Themes">https://github.com/ohmyzsh/ohmyzsh/wiki/Themes</a></li></ul><!-- end list --><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ZSH_THEME=<span class="string">&quot;cloud&quot;</span></span><br></pre></td></tr></table></figure><h3 id="2-安装高效率插件"><a href="#2-安装高效率插件" class="headerlink" title="2. 安装高效率插件"></a>2. 安装高效率插件</h3><p>我们安装两个最神器的插件：<strong>自动建议</strong> 和 <strong>语法高亮</strong>。</p><p><strong>下载插件：</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 进入插件目录</span></span><br><span class="line"><span class="built_in">cd</span> ~/.oh-my-zsh/custom/plugins</span><br><span class="line"></span><br><span class="line"><span class="comment"># 下载 zsh-autosuggestions (自动补全建议)</span></span><br><span class="line">git <span class="built_in">clone</span> https://github.com/zsh-users/zsh-autosuggestions</span><br><span class="line"></span><br><span class="line"><span class="comment"># 下载 zsh-syntax-highlighting (语法高亮)</span></span><br><span class="line">git <span class="built_in">clone</span> https://github.com/zsh-users/zsh-syntax-highlighting</span><br></pre></td></tr></table></figure><p><strong>启用插件：</strong></p><p>修改 <code>~/.zshrc</code> 中的 <code>plugins</code> 字段（注意：括号内是空格分隔）：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">plugins=(git zsh-autosuggestions zsh-syntax-highlighting)</span><br></pre></td></tr></table></figure><h3 id="3-配置网络代理-可选"><a href="#3-配置网络代理-可选" class="headerlink" title="3. 配置网络代理 (可选)"></a>3. 配置网络代理 (可选)</h3><p>如果你在拉取代码时网络不畅，可以在 <code>~/.zshrc</code> 末尾添加代理别名：</p><details class="folding-tag" gray><summary> 点击展开代理配置代码 </summary>              <div class='content'>              <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># === 代理设置 ===</span></span><br><span class="line"><span class="comment"># 请修改为你的代理端口</span></span><br><span class="line">PROXY_HTTP=<span class="string">&quot;http://127.0.0.1:10808&quot;</span></span><br><span class="line">PROXY_SOCKS=<span class="string">&quot;socks5://127.0.0.1:10808&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">proxy_on</span></span>() &#123;</span><br><span class="line">  <span class="built_in">export</span> http_proxy=<span class="string">&quot;<span class="variable">$PROXY_HTTP</span>&quot;</span></span><br><span class="line">  <span class="built_in">export</span> https_proxy=<span class="string">&quot;<span class="variable">$PROXY_HTTP</span>&quot;</span></span><br><span class="line">  <span class="built_in">export</span> all_proxy=<span class="string">&quot;<span class="variable">$PROXY_SOCKS</span>&quot;</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;🌐 Proxy ON: <span class="variable">$PROXY_HTTP</span>&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">proxy_off</span></span>() &#123;</span><br><span class="line">  <span class="built_in">unset</span> http_proxy https_proxy all_proxy</span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;❌ Proxy OFF&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">proxy_status</span></span>() &#123;</span><br><span class="line">  <span class="keyword">if</span> [[ -n <span class="string">&quot;<span class="variable">$http_proxy</span>&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;✅ Proxy ON (<span class="variable">$PROXY_HTTP</span>)&quot;</span></span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;🚫 Proxy OFF&quot;</span></span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 默认开启（可选）</span></span><br><span class="line">proxy_on</span><br></pre></td></tr></table></figure>              </div>            </details><p>最后，执行 <code>source ~/.zshrc</code> 让所有配置生效。现在，尽情享受你的 Windows 终端吧！</p>]]></content>
    
    
    <summary type="html">在 Windows 上打造媲美 Mac 的终端体验。详细教程涵盖 Git 安装、Zsh 环境配置、Windows Terminal 集成以及 Oh My Zsh 主题与插件优化。</summary>
    
    
    
    <category term="开发环境" scheme="https://lijiabao9.github.io/categories/%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/"/>
    
    <category term="Windows" scheme="https://lijiabao9.github.io/categories/%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/Windows/"/>
    
    
    <category term="效率工具" scheme="https://lijiabao9.github.io/tags/%E6%95%88%E7%8E%87%E5%B7%A5%E5%85%B7/"/>
    
    <category term="Windows Terminal" scheme="https://lijiabao9.github.io/tags/Windows-Terminal/"/>
    
    <category term="Git" scheme="https://lijiabao9.github.io/tags/Git/"/>
    
    <category term="Zsh" scheme="https://lijiabao9.github.io/tags/Zsh/"/>
    
    <category term="Oh My Zsh" scheme="https://lijiabao9.github.io/tags/Oh-My-Zsh/"/>
    
  </entry>
  
  <entry>
    <title>Docker 核心语法速查：从容器管理到编排实战</title>
    <link href="https://lijiabao9.github.io/posts/bdbe2a9.html"/>
    <id>https://lijiabao9.github.io/posts/bdbe2a9.html</id>
    <published>2025-11-30T15:45:58.000Z</published>
    <updated>2025-12-05T15:42:37.266Z</updated>
    
    <content type="html"><![CDATA[<p>Docker 是现代开发必不可少的工具。本文整理了高频使用的核心语法与实战案例，助你快速查阅。</p><h2 id="快速上手：启动-MySQL-容器"><a href="#快速上手：启动-MySQL-容器" class="headerlink" title="快速上手：启动 MySQL 容器"></a>快速上手：启动 MySQL 容器</h2><p>这是最经典的入门案例，涵盖了端口映射、环境变量和后台运行等核心参数。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">docker run -d \</span><br><span class="line">  --name mysql \</span><br><span class="line">  --restart always \</span><br><span class="line">  -p 3306:3306 \</span><br><span class="line">  -v /root/mysql/data:/var/lib/mysql \</span><br><span class="line">  --network my-net \</span><br><span class="line">  -e TZ=Asia/Shanghai \</span><br><span class="line">  -e MYSQL_ROOT_PASSWORD=123456 \</span><br><span class="line">  mysql:8.0</span><br></pre></td></tr></table></figure><p><strong>参数详解：</strong></p><div class="table-container"><table><thead><tr><th style="text-align:left">参数</th><th style="text-align:left">含义</th><th style="text-align:left">说明</th></tr></thead><tbody><tr><td style="text-align:left"><code>-d</code></td><td style="text-align:left">Detached</td><td style="text-align:left">后台静默运行容器</td></tr><tr><td style="text-align:left"><code>--name</code></td><td style="text-align:left">Name</td><td style="text-align:left">指定容器名称，后续可通过名称操作容器</td></tr><tr><td style="text-align:left"><code>--restart</code></td><td style="text-align:left">Restart</td><td style="text-align:left"><code>always</code> 表示开机自启或崩溃后自动重启</td></tr><tr><td style="text-align:left"><code>-p</code></td><td style="text-align:left">Publish</td><td style="text-align:left">端口映射，格式：<code>宿主机端口:容器内端口</code></td></tr><tr><td style="text-align:left"><code>-v</code></td><td style="text-align:left">Volumes</td><td style="text-align:left">数据卷挂载，格式：<code>宿主机路径:容器内路径</code></td></tr><tr><td style="text-align:left"><code>--network</code></td><td style="text-align:left">Network</td><td style="text-align:left">指定容器加入的网络</td></tr><tr><td style="text-align:left"><code>-e</code></td><td style="text-align:left">Environment</td><td style="text-align:left">设置环境变量（如时区、密码），具体变量需查阅镜像文档</td></tr><tr><td style="text-align:left"><code>mysql:8.0</code></td><td style="text-align:left">Image</td><td style="text-align:left">指定镜像名称与 Tag（版本），不写 Tag 默认为 <code>latest</code></td></tr></tbody></table></div><h2 id="容器生命周期管理"><a href="#容器生命周期管理" class="headerlink" title="容器生命周期管理"></a>容器生命周期管理</h2><p><img src="https://cdn.jsdelivr.net/gh/lijiabao9/pic.cloud@main/hexo/post/20251201003518427.webp" alt=""></p><details class="folding-tag" cyan><summary> 常用命令速查表 </summary>              <div class='content'>              <div class="table-container"><table><thead><tr><th style="text-align:left">操作</th><th style="text-align:left">命令示例</th><th style="text-align:left">说明</th></tr></thead><tbody><tr><td style="text-align:left"><strong>拉取镜像</strong></td><td style="text-align:left"><code>docker pull mysql</code></td><td style="text-align:left">从仓库拉取镜像</td></tr><tr><td style="text-align:left"><strong>查看镜像</strong></td><td style="text-align:left"><code>docker images</code> <br/> <code>docker rmi mysql</code></td><td style="text-align:left">列出所有镜像、删除指定镜像</td></tr><tr><td style="text-align:left"><strong>本地管理</strong></td><td style="text-align:left"><code>docker save -o mysql.tar mysql</code> <br/> <code>docker load -i mysql.tar</code></td><td style="text-align:left">导出镜像到 tar 文件、导入镜像</td></tr><tr><td style="text-align:left"><strong>查看容器</strong></td><td style="text-align:left"><code>docker ps</code> <br/> <code>docker ps -a</code> <br/> <code>docker rm -f mysql</code></td><td style="text-align:left">查看正在运行的容器、查看所有容器、删除容器</td></tr><tr><td style="text-align:left"><strong>管理容器</strong></td><td style="text-align:left"><code>docker stop mysql</code> <br/> <code>docker start mysql</code> <br/> <code>docker restart mysql</code></td><td style="text-align:left">优雅停止、启动、重启容器</td></tr><tr><td style="text-align:left"><strong>查看日志</strong></td><td style="text-align:left"><code>docker logs -f -n 100 mysql</code></td><td style="text-align:left">实时查看最后100行日志</td></tr><tr><td style="text-align:left"><strong>进入容器</strong></td><td style="text-align:left"><code>docker exec -it mysql bash</code></td><td style="text-align:left">进入容器内部终端</td></tr></tbody></table></div>              </div>            </details><h2 id="数据持久化-挂载"><a href="#数据持久化-挂载" class="headerlink" title="数据持久化 (挂载)"></a>数据持久化 (挂载)</h2><p>容器删除后，其内部产生的数据会默认丢失。为了保存数据，我们需要进行挂载。</p><h3 id="方式一：数据卷-Volumes"><a href="#方式一：数据卷-Volumes" class="headerlink" title="方式一：数据卷 (Volumes)"></a>方式一：数据卷 (Volumes)</h3><p>由 Docker 自动管理，存储在宿主机的特定目录下（通常是 <code>/var/lib/docker/volumes/</code>），路径较深，不便直接修改。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建并挂载</span></span><br><span class="line">docker run -d --name nginx -p 80:80 -v html_vol:/usr/share/nginx/html nginx</span><br></pre></td></tr></table></figure><p>常用命令：</p><ul><li><code>docker volume create vol_name</code>：创建数据卷</li><li><code>docker volume ls</code>：列出所有数据卷</li><li><code>docker volume prune</code>：清理无主的数据卷</li><li><code>docker volume inspect vol_name</code>：查看指定数据卷的信息</li><li><code>docker volume rm vol_name</code>：删除指定的数据卷</li></ul><h3 id="方式二：目录挂载-Bind-Mounts-【推荐】"><a href="#方式二：目录挂载-Bind-Mounts-【推荐】" class="headerlink" title="方式二：目录挂载 (Bind Mounts) 【推荐】"></a>方式二：目录挂载 (Bind Mounts) 【推荐】</h3><p>直接将宿主机的 <strong>指定路径</strong> 映射到容器内，修改宿主机文件即可实时影响容器，非常适合开发调试和配置文件管理。</p><p>以 MySQL 为例，挂载数据、配置和初始化脚本：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">docker run -d \</span><br><span class="line">  --name mysql \</span><br><span class="line">  -p 3306:3306 \</span><br><span class="line">  -e TZ=Asia/Shanghai \</span><br><span class="line">  -e MYSQL_ROOT_PASSWORD=123 \</span><br><span class="line">  -v /root/mysql/data:/var/lib/mysql \</span><br><span class="line">  -v /root/mysql/conf:/etc/mysql/conf.d \</span><br><span class="line">  -v /root/mysql/init:/docker-entrypoint-initdb.d \</span><br><span class="line">  mysql</span><br></pre></td></tr></table></figure><blockquote><p><strong>注意</strong>：目录挂载必须使用 <strong>绝对路径</strong> 或以 <code>./</code> 开头的相对路径。</p></blockquote><h2 id="容器网络"><a href="#容器网络" class="headerlink" title="容器网络"></a>容器网络</h2><p>默认情况下，容器使用 <code>bridge</code> 模式，IP 是动态分配的。</p><p>为了方便容器间通信（例如后端连接数据库），推荐<strong>自定义网络</strong>。<br>加入同一自定义网络的容器，可以直接通过<strong>容器名</strong>互相访问，无需关心 IP 变化。</p><p>常用命令：</p><ul><li><code>docker network create my-net</code>：创建自定义网络</li><li><code>docker network connect my-net mysql</code>：将容器加入网络</li><li><code>docker network disconnect my-net mysql</code>：将容器从网络中移除</li><li><code>docker network ls</code>：列出所有网络</li><li><code>docker network prune</code>：清理无用的网络</li><li><code>docker network inspect my-net</code>：查看指定网络的信息</li><li><code>docker network rm my-net</code>：删除指定的网络</li></ul><p><strong>实战用法：</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建容器时，通过 --network 参数加入自定义网络，网络不存在会自动创建</span></span><br><span class="line">docker run -d --name mysql --network my-net mysql</span><br><span class="line">docker run -d --name nginx --network my-net nginx</span><br><span class="line"></span><br><span class="line"><span class="comment"># 此时 nginx 内部可以直接 ping mysql</span></span><br></pre></td></tr></table></figure><h2 id="镜像构建-Dockerfile"><a href="#镜像构建-Dockerfile" class="headerlink" title="镜像构建 (Dockerfile)"></a>镜像构建 (Dockerfile)</h2><p><strong>镜像</strong>是应用程序及其运行环境的只读模板。<strong>构建镜像</strong>就是将代码、运行时、库和配置打包在一起的过程。</p><p>Docker 镜像采用<strong>分层存储</strong>结构：</p><p><strong>常用 Dockerfile 指令：</strong></p><p><strong>构建示例：Java 应用</strong></p><ol><li><p>编写 <code>Dockerfile</code> 文件：</p> <figure class="highlight text"><figcaption><span>Dockerfile</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># 1. 基础镜像</span><br><span class="line">FROM openjdk:11.0-jre-buster</span><br><span class="line"></span><br><span class="line"># 2. 设定时区</span><br><span class="line">ENV TZ=Asia/Shanghai</span><br><span class="line">RUN ln -snf /usr/share/zoneinfo/$TZ /etc/localtime &amp;&amp; echo $TZ &gt; /etc/timezone</span><br><span class="line"></span><br><span class="line"># 3. 拷贝 jar 包</span><br><span class="line">COPY docker-demo.jar /app.jar</span><br><span class="line"></span><br><span class="line"># 4. 启动命令</span><br><span class="line">ENTRYPOINT [&quot;java&quot;, &quot;-jar&quot;, &quot;/app.jar&quot;]</span><br></pre></td></tr></table></figure><p><strong>注意：</strong>当前目录下，此时应当包括 <strong>docker-demo.jar</strong> 和 <strong>Dockerfile</strong> 文件。</p></li><li><p>执行构建命令：</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -t 指定名称和标签，. 表示上下文路径为当前目录</span></span><br><span class="line">docker build -t docker-demo:1.0 .</span><br></pre></td></tr></table></figure></li></ol><h2 id="容器编排-Docker-Compose"><a href="#容器编排-Docker-Compose" class="headerlink" title="容器编排 (Docker Compose)"></a>容器编排 (Docker Compose)</h2><p>对于包含多个服务（如 Nginx + Java + MySQL）的复杂应用，使用 <code>docker run</code> 逐个启动非常繁琐且难以管理依赖。</p><p><strong>Docker Compose</strong> 通过 <code>docker-compose.yml</code> 文件定义服务集群，实现一键启停。</p><p><strong>示例配置 (<code>docker-compose.yml</code>)：</strong></p><figure class="highlight yaml"><figcaption><span>docker-compose.yml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">mysql:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">mysql:8.0</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">mysql</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;3306:3306&quot;</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">TZ:</span> <span class="string">Asia/Shanghai</span></span><br><span class="line">      <span class="attr">MYSQL_ROOT_PASSWORD:</span> <span class="number">123456</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;./mysql/conf:/etc/mysql/conf.d&quot;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;./mysql/data:/var/lib/mysql&quot;</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">hm-net</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">hmall:</span></span><br><span class="line">    <span class="attr">build:</span></span><br><span class="line">      <span class="attr">context:</span> <span class="string">.</span></span><br><span class="line">      <span class="attr">dockerfile:</span> <span class="string">Dockerfile</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">hmall</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;8080:8080&quot;</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">hm-net</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">mysql</span>  <span class="comment"># 等待 mysql 启动后再启动</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">nginx:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">nginx</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">nginx</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;18080:18080&quot;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;18081:18081&quot;</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;./nginx/nginx.conf:/etc/nginx/nginx.conf&quot;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;./nginx/html:/usr/share/nginx/html&quot;</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">hmall</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">hm-net</span></span><br><span class="line"></span><br><span class="line"><span class="attr">networks:</span></span><br><span class="line">  <span class="attr">hm-net:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">hmall</span></span><br></pre></td></tr></table></figure><p><strong>常用编排命令：</strong></p><ul><li><strong>一键部署(后台运行)</strong>：<code>docker compose up -d</code></li><li><strong>查看集群状态</strong>：<code>docker compose ps</code></li><li><strong>查看集群日志</strong>：<code>docker compose logs -f</code></li><li><strong>一键销毁</strong>：<code>docker compose down</code> (会移除容器和网络)</li></ul>]]></content>
    
    
    <summary type="html">本文系统梳理 Docker 常用语法，涵盖容器生命周期管理、数据卷挂载策略、Dockerfile 镜像构建指南、自定义网络配置以及 Docker Compose 服务编排实战。</summary>
    
    
    
    <category term="编程语言" scheme="https://lijiabao9.github.io/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/"/>
    
    <category term="DevOps" scheme="https://lijiabao9.github.io/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/DevOps/"/>
    
    
    <category term="Docker" scheme="https://lijiabao9.github.io/tags/Docker/"/>
    
    <category term="语法手册" scheme="https://lijiabao9.github.io/tags/%E8%AF%AD%E6%B3%95%E6%89%8B%E5%86%8C/"/>
    
  </entry>
  
  <entry>
    <title>Docker Desktop 最佳实践：自定义安装路径与镜像加速配置</title>
    <link href="https://lijiabao9.github.io/posts/c3ae7e15.html"/>
    <id>https://lijiabao9.github.io/posts/c3ae7e15.html</id>
    <published>2025-11-30T14:56:59.000Z</published>
    <updated>2025-12-05T15:42:37.265Z</updated>
    
    <content type="html"><![CDATA[<p>Docker Desktop 是 Windows 平台上开发容器化应用的标准工具。</p><p><strong>前置条件</strong>：Docker Desktop 依赖于 WSL2 后端。<br>安装前请确保系统已开启 WSL 功能，详细步骤请参考我的文章：<a href="/posts/ce55e54a.html">WSL2 全方位指南：安装、配置、迁移与网络优化</a>。</p><h2 id="1-下载安装包"><a href="#1-下载安装包" class="headerlink" title="1. 下载安装包"></a>1. 下载安装包</h2><ul><li><strong>官方下载地址</strong>：<a href="https://www.docker.com/products/docker-desktop/">Docker Desktop for Windows</a></li></ul><h2 id="2-自定义路径安装（强制-D-盘）"><a href="#2-自定义路径安装（强制-D-盘）" class="headerlink" title="2. 自定义路径安装（强制 D 盘）"></a>2. 自定义路径安装（强制 D 盘）</h2><div class="note warning flat"><p><strong>注意：</strong> 如果直接双击运行安装程序，Docker 会强制安装在 C 盘，且 GUI 界面不提供路径修改选项。<br>为了节省系统盘空间，我们必须通过命令行参数进行安装。</p></div><h3 id="2-1-规划目录"><a href="#2-1-规划目录" class="headerlink" title="2.1 规划目录"></a>2.1 规划目录</h3><p>首先，在 D 盘（或其他非系统盘）手动创建以下两个文件夹：</p><ul><li><code>D:\Program Files\Docker</code>：用于存放 Docker 应用程序本体。</li><li><code>D:\Distro\Docker</code>：用于存放 Docker 的镜像、容器、卷等数据（随着使用体积会越来越大）。</li></ul><h3 id="2-2-执行安装命令"><a href="#2-2-执行安装命令" class="headerlink" title="2.2 执行安装命令"></a>2.2 执行安装命令</h3><p>以 <strong>管理员身份</strong> 打开命令提示符（CMD）或 PowerShell，进入下载目录（通常是 <code>Downloads</code>），执行以下命令。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">start /w <span class="string">&quot;&quot;</span> <span class="string">&quot;Docker Desktop Installer.exe&quot;</span> install -accept-license --installation-dir=<span class="string">&quot;D:\Program Files\Docker&quot;</span> --wsl-default-data-root=<span class="string">&quot;D:\Distro\Docker&quot;</span></span><br></pre></td></tr></table></figure><p><strong>参数解释：</strong></p><ul><li><code>--installation-dir</code>：指定应用程序安装位置。</li><li><code>--wsl-default-data-root</code>：指定 WSL 发行版（docker-desktop-data）的数据存储位置。</li></ul><p>执行后，会弹出安装界面，等待进度条跑完即可。</p><p>安装完成后，建议重启计算机。</p><h2 id="3-配置镜像加速"><a href="#3-配置镜像加速" class="headerlink" title="3. 配置镜像加速"></a>3. 配置镜像加速</h2><p>由于网络原因，国内直接从 Docker Hub 拉取镜像速度极慢。推荐配置阿里云镜像加速器。</p><h3 id="3-1-获取加速地址"><a href="#3-1-获取加速地址" class="headerlink" title="3.1 获取加速地址"></a>3.1 获取加速地址</h3><p>登录 <a href="https://cr.console.aliyun.com/cn-hangzhou/instances/mirrors">阿里云容器镜像服务控制台</a>，在左侧菜单找到 <strong>镜像工具 - 镜像加速器</strong>。</p><p>复制专属的加速器地址（格式通常为 <code>https://xxxx.mirror.aliyuncs.com</code>）。</p><h3 id="3-2-应用配置"><a href="#3-2-应用配置" class="headerlink" title="3.2 应用配置"></a>3.2 应用配置</h3><p>运行 Docker Desktop，点击右上角的 <strong>设置（齿轮图标）</strong> -> <strong>Docker Engine</strong>。</p><p>在右侧的 JSON 编辑框中，修改或添加 <code>registry-mirrors</code> 字段：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;builder&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;gc&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;defaultKeepStorage&quot;</span><span class="punctuation">:</span> <span class="string">&quot;20GB&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;enabled&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;experimental&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;registry-mirrors&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="string">&quot;https://你的专属ID.mirror.aliyuncs.com&quot;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>点击右下角的 <strong>Apply &amp; restart</strong> 按钮使配置生效。</p><h2 id="4-验证安装"><a href="#4-验证安装" class="headerlink" title="4. 验证安装"></a>4. 验证安装</h2><p>打开 PowerShell 或 CMD，输入以下命令检查版本和运行状态：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker -v</span><br><span class="line"><span class="comment"># 输出：Docker version 29.0.x, build ...</span></span><br><span class="line"></span><br><span class="line">docker run hello-world</span><br></pre></td></tr></table></figure><p>如果看到 “Hello from Docker!“ 的提示信息，说明安装与配置均已成功。</p>]]></content>
    
    
    <summary type="html">详解如何在 Windows 上安装 Docker Desktop 并强制修改默认安装路径至 D 盘，同时配置阿里云镜像加速以提升拉取速度。</summary>
    
    
    
    <category term="开发环境" scheme="https://lijiabao9.github.io/categories/%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/"/>
    
    <category term="Windows" scheme="https://lijiabao9.github.io/categories/%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/Windows/"/>
    
    
    <category term="Docker" scheme="https://lijiabao9.github.io/tags/Docker/"/>
    
    <category term="效率工具" scheme="https://lijiabao9.github.io/tags/%E6%95%88%E7%8E%87%E5%B7%A5%E5%85%B7/"/>
    
  </entry>
  
  <entry>
    <title>WSL2 全方位指南：安装、配置、迁移与网络优化</title>
    <link href="https://lijiabao9.github.io/posts/ce55e54a.html"/>
    <id>https://lijiabao9.github.io/posts/ce55e54a.html</id>
    <published>2025-11-30T13:55:59.000Z</published>
    <updated>2025-12-05T15:42:37.265Z</updated>
    
    <content type="html"><![CDATA[<p>借助适用于 Linux 的 Windows 子系统（WSL2），开发人员可以在 Windows 计算机上直接运行 GNU/Linux 环境（包括大多数命令行工具、实用工具和应用程序），且不会产生传统虚拟机或双启动设置的开销。</p><blockquote><p>官方文档参考：<a href="https://learn.microsoft.com/zh-cn/windows/wsl/install">Microsoft Learn - 安装 WSL</a></p></blockquote><h2 id="基础：开启-WSL-功能"><a href="#基础：开启-WSL-功能" class="headerlink" title="基础：开启 WSL 功能"></a>基础：开启 WSL 功能</h2><h3 id="方法一：命令行一键安装（推荐）"><a href="#方法一：命令行一键安装（推荐）" class="headerlink" title="方法一：命令行一键安装（推荐）"></a>方法一：命令行一键安装（推荐）</h3><p>对于较新的 Windows 10 (2004+) 或 Windows 11，只需以 <strong>管理员身份</strong> 打开 PowerShell 并输入：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wsl --install</span><br></pre></td></tr></table></figure><p>此命令将自动启用所需的可选组件，下载最新的 Linux 内核，将 WSL 2 设置为默认值，并安装 Ubuntu 发行版。</p><h3 id="方法二：手动启用"><a href="#方法二：手动启用" class="headerlink" title="方法二：手动启用"></a>方法二：手动启用</h3><p>如果你更习惯图形界面，可以在「Windows 功能」中手动开启。</p><ol><li>Win + s 搜索 “启用或关闭 Windows 功能”。</li><li>勾选 <strong>“适用于 Linux 的 Windows 子系统”</strong>。</li><li>点击确定并<strong>重启计算机</strong>。</li></ol><p>重启后，打开 PowerShell 输入 <code>wsl -v</code> 验证版本：</p><blockquote><p><strong>注</strong>：如果 <code>wsl -v</code> 报错，提示无法解析命令，可能需要先执行 <code>wsl --update</code> 进行内核更新。</p></blockquote><h2 id="管理：系统与更新"><a href="#管理：系统与更新" class="headerlink" title="管理：系统与更新"></a>管理：系统与更新</h2><h3 id="常用管理命令"><a href="#常用管理命令" class="headerlink" title="常用管理命令"></a>常用管理命令</h3><details class="folding-tag" cyan><summary> 点击查看常用命令速查表 </summary>              <div class='content'>              <div class="table-container"><table><thead><tr><th style="text-align:left">描述</th><th style="text-align:left">命令</th></tr></thead><tbody><tr><td style="text-align:left"><strong>检查更新</strong></td><td style="text-align:left"><code>wsl --update</code></td></tr><tr><td style="text-align:left"><strong>查看在线可用系统</strong></td><td style="text-align:left"><code>wsl --list --online</code> (或 <code>wsl -l -o</code>)</td></tr><tr><td style="text-align:left"><strong>查看已安装系统</strong></td><td style="text-align:left"><code>wsl --list --verbose</code> (或 <code>wsl -l -v</code>)</td></tr><tr><td style="text-align:left"><strong>关闭所有系统</strong></td><td style="text-align:left"><code>wsl --shutdown</code></td></tr><tr><td style="text-align:left"><strong>停止系统</strong></td><td style="text-align:left"><code>wsl --terminate &lt;DistroName&gt;</code></td></tr><tr><td style="text-align:left"><strong>注销(删除)系统</strong></td><td style="text-align:left"><code>wsl --unregister &lt;DistroName&gt;</code></td></tr><tr><td style="text-align:left"><strong>导出系统</strong></td><td style="text-align:left"><code>wsl --export &lt;DistroName&gt; &lt;FileName&gt;</code></td></tr><tr><td style="text-align:left"><strong>导入系统</strong></td><td style="text-align:left"><code>wsl --import &lt;DistroName&gt; &lt;InstallLocation&gt; &lt;FileName&gt;</code></td></tr></tbody></table></div><ul><li><strong>FileName</strong>：默认为 <code>.tar</code> 格式。</li><li><strong>更多命令</strong>：<a href="https://learn.microsoft.com/zh-cn/windows/wsl/basic-commands#update-wsl">基本 WSL 命令</a></li></ul>              </div>            </details><h3 id="安装-Ubuntu"><a href="#安装-Ubuntu" class="headerlink" title="安装 Ubuntu"></a>安装 Ubuntu</h3><ol><li><p><strong>查看可用列表</strong>：</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wsl --list --online</span><br></pre></td></tr></table></figure></li><li><p><strong>安装指定版本</strong>：</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wsl --install Ubuntu</span><br></pre></td></tr></table></figure></li><li><p><strong>设置默认系统</strong>（如果你安装了多个发行版）：</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wsl --set-default Ubuntu</span><br></pre></td></tr></table></figure></li></ol><h3 id="启动系统"><a href="#启动系统" class="headerlink" title="启动系统"></a>启动系统</h3><ul><li><strong>默认系统</strong>：直接在命令行输入 <code>wsl</code>。</li><li><strong>指定系统</strong>：输入 <code>wsl -d &lt;发行版名称&gt;</code>，例如 <code>wsl -d Ubuntu</code>。</li></ul><h2 id="进阶：存储位置迁移"><a href="#进阶：存储位置迁移" class="headerlink" title="进阶：存储位置迁移"></a>进阶：存储位置迁移</h2><p>WSL2 安装的 Linux 系统默认存储在 C 盘（<code>%LOCALAPPDATA%\Packages</code> 下）。随着开发环境的膨胀，C 盘空间可能告急。我们可以将其导出并迁移到其他磁盘。</p><p><strong>操作步骤：</strong></p><ol><li><p><strong>停止 WSL 服务</strong>：</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wsl --shutdown</span><br></pre></td></tr></table></figure></li><li><p><strong>导出系统备份</strong>：</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建临时目录</span></span><br><span class="line"><span class="built_in">mkdir</span> D:\tmp</span><br><span class="line"><span class="comment"># 导出 Ubuntu 到 tar 文件</span></span><br><span class="line">wsl --<span class="built_in">export</span> Ubuntu D:\tmp\Ubuntu.tar</span><br></pre></td></tr></table></figure></li><li><p><strong>注销当前系统</strong>（注意：这会删除 C 盘的原有系统）：</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wsl --unregister Ubuntu</span><br></pre></td></tr></table></figure></li><li><p><strong>导入到新位置</strong>：</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建新的存储目录</span></span><br><span class="line"><span class="built_in">mkdir</span> D:\WslDistro</span><br><span class="line"><span class="comment"># 导入系统</span></span><br><span class="line">wsl --import Ubuntu D:\WslDistro D:\tmp\Ubuntu.tar</span><br></pre></td></tr></table></figure></li></ol><blockquote><p><strong>注意：用户身份重置问题</strong><br>使用 <code>--import</code> 恢复的系统，默认登录用户会变回 <code>root</code>。如果需要恢复默认登录为你的普通用户（例如 <code>gabriel</code>），</p><ul><li>需要在 Ubuntu 内部创建或修改 <code>/etc/wsl.conf</code> 文件（见下文配置）</li><li>或者使用 <code>Ubuntu config --default-user gabriel</code> 命令设置默认用户</li></ul></blockquote><h2 id="配置：环境隔离与网络"><a href="#配置：环境隔离与网络" class="headerlink" title="配置：环境隔离与网络"></a>配置：环境隔离与网络</h2><h3 id="环境变量独立"><a href="#环境变量独立" class="headerlink" title="环境变量独立"></a>环境变量独立</h3><p>默认情况下，WSL 会继承 Windows 的 PATH 环境变量（例如你可以直接在 Linux 里调用 <code>notepad.exe</code>）。但这可能导致 PATH 变量过长或命令冲突。</p><p>若需隔离环境，请进入 Ubuntu 系统，编辑 <code>/etc/wsl.conf</code>：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> vim /etc/wsl.conf</span><br></pre></td></tr></table></figure><p>添加以下内容：</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[boot]</span></span><br><span class="line"><span class="attr">systemd</span>=<span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="section">[user]</span></span><br><span class="line"><span class="comment"># 确保这里填写你迁移前创建的用户名，否则导入后默认是 root</span></span><br><span class="line"><span class="attr">default</span>=gabriel</span><br><span class="line"></span><br><span class="line"><span class="section">[interop]</span></span><br><span class="line"><span class="comment"># 禁止将 Windows PATH 添加到 WSL 中</span></span><br><span class="line"><span class="attr">appendWindowsPath</span>=<span class="literal">false</span></span><br></pre></td></tr></table></figure><h3 id="应用宿主机代理-Mirrored-模式"><a href="#应用宿主机代理-Mirrored-模式" class="headerlink" title="应用宿主机代理 (Mirrored 模式)"></a>应用宿主机代理 (Mirrored 模式)</h3><p>在旧版 WSL2 中，Linux 子系统拥有独立的虚拟网卡，导致无法直接共享 Windows 的 VPN 代理，也难以访问局域网设备。</p><p>Windows 11 (22H2 及以上) 引入了 <strong>Mirrored (镜像)</strong> 网络模式，完美解决了这个问题。</p><h4 id="方法一：使用-GUI-设置（推荐）"><a href="#方法一：使用-GUI-设置（推荐）" class="headerlink" title="方法一：使用 GUI 设置（推荐）"></a>方法一：使用 GUI 设置（推荐）</h4><p>在 Windows 【开始】 菜单中找到 <strong>【WSL Settings】</strong> 应用，将网络模式修改为 <strong>Mirrored</strong>：</p><h4 id="方法二：使用配置文件（通用）"><a href="#方法二：使用配置文件（通用）" class="headerlink" title="方法二：使用配置文件（通用）"></a>方法二：使用配置文件（通用）</h4><p>如果找不到 GUI 设置，可以直接修改全局配置文件。在 Windows 用户主目录（<code>C:\Users\&lt;你的用户名&gt;\</code>）下新建或编辑 <code>.wslconfig</code> 文件：</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[wsl2]</span></span><br><span class="line"><span class="attr">networkingMode</span>=mirrored</span><br></pre></td></tr></table></figure><p><strong>生效设置：</strong><br>配置修改后，必须完全重启 WSL 才能生效：</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wsl <span class="literal">--shutdown</span></span><br></pre></td></tr></table></figure><p>开启 Mirrored 模式后，WSL2 将直接复用宿主机的网络接口，此时宿主机的代理软件（如 Clash/V2Ray）开启 “TUN 模式” 或 “系统代理” 后，WSL2 即可直接通过代理联网，无需额外配置环境变量。</p>]]></content>
    
    
    <summary type="html">本文详细介绍 Windows Subsystem for Linux (WSL2) 的安装步骤、常用管理命令。深入讲解如何迁移 Linux 子系统存储位置到非系统盘，以及如何配置环境变量隔离和 Mirrored 网络模式以解决代理问题。</summary>
    
    
    
    <category term="开发环境" scheme="https://lijiabao9.github.io/categories/%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/"/>
    
    <category term="Windows" scheme="https://lijiabao9.github.io/categories/%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/Windows/"/>
    
    
    <category term="WSL" scheme="https://lijiabao9.github.io/tags/WSL/"/>
    
    <category term="Ubuntu" scheme="https://lijiabao9.github.io/tags/Ubuntu/"/>
    
  </entry>
  
</feed>
